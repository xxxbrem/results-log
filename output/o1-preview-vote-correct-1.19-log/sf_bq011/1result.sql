WITH all_events AS (
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210101"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210102"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210103"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210104"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210105"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210106"
  UNION ALL
  SELECT "USER_PSEUDO_ID", "EVENT_DATE" FROM 
    "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210107"
)
SELECT COUNT(*) AS "number_of_users"
FROM (
  SELECT "USER_PSEUDO_ID"
  FROM all_events
  GROUP BY "USER_PSEUDO_ID"
  HAVING
    MAX(CASE WHEN "EVENT_DATE" BETWEEN '20210101' AND '20210105' THEN 1 ELSE 0 END) = 1
    AND
    MAX(CASE WHEN "EVENT_DATE" IN ('20210106', '20210107') THEN 1 ELSE 0 END) = 0
)
;