WITH 
  InitialPrices AS (
    SELECT 
      SPT."TICKER", 
      SPT."DATE" AS "INITIAL_DATE", 
      SPT."VALUE" AS "INITIAL_PRICE"
    FROM FINANCE__ECONOMICS.CYBERSYN."STOCK_PRICE_TIMESERIES" SPT
    WHERE 
      SPT."TICKER" IN ('AAPL', 'MSFT', 'AMZN', 'GOOGL', 'NVDA', 'TSLA', 'META')
      AND SPT."VARIABLE" = 'post-market_close'
      AND SPT."DATE" >= '2024-01-01'
    QUALIFY ROW_NUMBER() OVER (
      PARTITION BY SPT."TICKER" 
      ORDER BY SPT."DATE" ASC NULLS LAST
    ) = 1
  ),
  FinalPrices AS (
    SELECT 
      SPT."TICKER", 
      SPT."DATE" AS "FINAL_DATE", 
      SPT."VALUE" AS "FINAL_PRICE"
    FROM FINANCE__ECONOMICS.CYBERSYN."STOCK_PRICE_TIMESERIES" SPT
    WHERE 
      SPT."TICKER" IN ('AAPL', 'MSFT', 'AMZN', 'GOOGL', 'NVDA', 'TSLA', 'META')
      AND SPT."VARIABLE" = 'post-market_close'
      AND SPT."DATE" <= '2024-06-30'
    QUALIFY ROW_NUMBER() OVER (
      PARTITION BY SPT."TICKER" 
      ORDER BY SPT."DATE" DESC NULLS LAST
    ) = 1
  )
SELECT 
  I."TICKER", 
  I."INITIAL_DATE", 
  I."INITIAL_PRICE", 
  F."FINAL_DATE", 
  F."FINAL_PRICE", 
  ROUND(((F."FINAL_PRICE" - I."INITIAL_PRICE") / I."INITIAL_PRICE") * 100, 4) AS "PERCENT_CHANGE"
FROM 
  InitialPrices I
INNER JOIN 
  FinalPrices F ON I."TICKER" = F."TICKER";