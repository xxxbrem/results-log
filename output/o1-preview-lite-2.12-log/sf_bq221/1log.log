2025-01-27 01:37:21 - openai._base_client - INFO - Retrying request to /chat/completions in 0.405343 seconds
2025-01-27 01:38:18 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:38:18 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:38:18 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:38:18 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:38:19 - snowflake.connector.connection - INFO - closed
2025-01-27 01:38:20 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:38:32 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:38:32 - root - INFO - The error occurs because some records in the `"filing_date"` column have invalid values that cannot be parsed into a date using the `'YYYYMMDD'` format. Specifically, values like `'0'` cannot be converted into a valid date, which causes the `TO_DATE` function to fail.

To resolve this issue, you can modify your query to handle or exclude invalid date values. Here are two approaches:

---

**Option 1: Use `TRY_TO_DATE` Function**

The `TRY_TO_DATE` function attempts to convert a string to a date and returns `NULL` if it fails, instead of raising an error. You can use this function to safely attempt the conversion and then filter out any `NULL` results.

```sql
SELECT DISTINCT YEAR(TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
LIMIT 100;
```

**Explanation:**

- `TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')` attempts to parse the filing date.
- The `WHERE` clause filters out records where the parsing fails (returns `NULL`).
- `YEAR(...)` extracts the year from the successfully parsed dates.

---

**Option 2: Exclude Invalid Dates Based on Length and Value**

If you know that valid dates should be exactly 8 digits long (e.g., `'20231015'` for October 15, 2023), you can filter out any records that don't meet this criterion.

```sql
SELECT DISTINCT YEAR(TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "filing_date" IS NOT NULL
  AND "filing_date" <> '0'
  AND LENGTH(TRIM("filing_date")) = 8
LIMIT 100;
```

**Explanation:**

- The `WHERE` clause ensures that:
  - `"filing_date"` is not `NULL`.
  - `"filing_date"` is not equal to `'0'` or any other invalid value.
  - The length of `"filing_date"` after trimming is exactly 8 characters.
- This filters out invalid dates before attempting to convert them.
- `TO_DATE` then safely converts the remaining valid date strings.
- `YEAR(...)` extracts the filing year.

---

**Additional Notes:**

- **Data Cleaning:** It's common in datasets to encounter incomplete or placeholder values like `'0'`, which need to be handled carefully to avoid errors during data processing.
- **TRY_TO_DATE vs. TO_DATE:** Using `TRY_TO_DATE` is generally safer as it handles parsing errors gracefully by returning `NULL`, allowing you to filter out invalid records without interrupting the query execution.
- **Date Formats:** Ensure that the date format `'YYYYMMDD'` matches the actual format of the `filing_date` values in your data.

---

By applying either of these solutions, your query should execute without errors, and you'll get the distinct filing years from the `PUBLICATIONS` table.
2025-01-27 01:38:32 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:38:32 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:38:32 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:38:34 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:38:34 - snowflake.connector.connection - INFO - closed
2025-01-27 01:38:34 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:39:48 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:39:48 - root - INFO - SQL:
SELECT DISTINCT YEAR(TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
LIMIT 100;
Results:
filing_year
2017
1899
1962
2019
1934
1988
1998
1885
1960
1903
1985
1888
1944
1880
1902
2001
1980
1947
1952
1992
1955
1919
1909
1882
1928
2004
1983
1937
1964
2008
1895
1993
1974
1916
2014
1853
1911
1940
1939
1967
1984
1904
1877
1860
1914
1936
1990
1966
1886
1986
1997
1981
1931
1945
1912
1961
2007
1890
1915
1970
1976
2005
1953
1907
2009
1995
1918
1999
1972
1982
1846
1929
1991
1938
1969
1977
1979
1898
1978
1956
1933
1958
1913
2002
1948
1910
1946
1949
1942
1963
1905
1921
2015
2022
1950
2011
1989
1971
1975
1889

2025-01-27 01:39:48 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:39:48 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:39:48 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:39:49 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:39:49 - snowflake.connector.connection - INFO - closed
2025-01-27 01:39:50 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:40:07 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:40:07 - root - INFO - ```sql
SELECT f.value:"symbol"::STRING AS "cpc_symbol"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
WHERE t."cpc" IS NOT NULL
  AND f.value:"symbol"::STRING IS NOT NULL
  AND f.value:"symbol"::STRING <> ''
LIMIT 100;
```
2025-01-27 01:40:07 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:40:07 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:40:07 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:40:08 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-27 01:40:08 - snowflake.connector.connection - INFO - closed
2025-01-27 01:40:08 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:41:13 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:41:13 - root - INFO - ```sql
SELECT f.value::STRING AS "cpc_symbol"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
LIMIT 100;
```
2025-01-27 01:41:13 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:41:13 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:41:13 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:41:14 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:41:14 - snowflake.connector.connection - INFO - closed
2025-01-27 01:41:14 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:05 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:42:05 - root - INFO - SQL:
SELECT f.value::STRING AS "cpc_symbol"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
LIMIT 100;
Results:
Too long, hard cut:
cpc_symbol
"{""code"":""B62K11/007"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62M23/00"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K1/00"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""B62M23/00"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K21/12"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K11/007"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K21/12"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K1/00"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61B3/103"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/0025"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61B3/0008"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G02B27/0068"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M1/4225"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M1/4225"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""Y02B70/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M1/42"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""Y02B70/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M3/1584"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M3/1584"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M1/42"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/0637"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0662"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/064"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0659"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N5/0616"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/064"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0662"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0659"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N5/0616"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/0637"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/137"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/1399"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/027"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M10/0525"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/623"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/625"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/606"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/021"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M2004/021"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/623"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/625"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/137"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/606"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/1399"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/027"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M10/0525"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""Y02E60/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G06Q10/107"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H04L51/212"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H04L51/212"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G06Q10/107"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G06F3/0481"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G06F3/013"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""B60K2350/1068"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G02B27/01"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B60K2350/352"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""B60K2350/2052"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G02B2027/0187"",

2025-01-27 01:42:05 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:05 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:05 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:07 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:42:07 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:07 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:07 - root - INFO - SQL:
-- Corrected Query 1
SELECT "symbol", "titleFull", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "level" = '5'
LIMIT 100
Results:
Too long, hard cut:
symbol,titleFull,level
A01H,NEW PLANTS OR NON-TRANSGENIC PROCESSES FOR OBTAINING THEM; PLANT REPRODUCTION BY TISSUE CULTURE TECHNIQUES,5.0
A01F,PROCESSING OF HARVESTED PRODUCE; HAY OR STRAW PRESSES; DEVICES FOR STORING AGRICULTURAL OR HORTICULTURAL PRODUCE,5.0
A01C,PLANTING; SOWING; FERTILISING,5.0
A01G,"HORTICULTURE; CULTIVATION OF VEGETABLES, FLOWERS, RICE, FRUIT, VINES, HOPS OR SEAWEED; FORESTRY; WATERING",5.0
A01N,"PRESERVATION OF BODIES OF HUMANS OR ANIMALS OR PLANTS OR PARTS THEREOF; BIOCIDES, e.g. AS DISINFECTANTS, AS PESTICIDES OR AS HERBICIDES; PEST REPELLANTS OR ATTRACTANTS; PLANT GROWTH REGULATORS",5.0
A01P,"BIOCIDAL, PEST REPELLANT, PEST ATTRACTANT OR PLANT GROWTH REGULATORY ACTIVITY OF CHEMICAL COMPOUNDS OR PREPARATIONS",5.0
A01D,HARVESTING; MOWING,5.0
A01L,SHOEING OF ANIMALS,5.0
A01K,"ANIMAL HUSBANDRY; AVICULTURE; APICULTURE; PISCICULTURE; FISHING; REARING OR BREEDING ANIMALS, NOT OTHERWISE PROVIDED FOR; NEW BREEDS OF ANIMALS",5.0
A01M,"CATCHING, TRAPPING OR SCARING OF ANIMALS; APPARATUS FOR THE DESTRUCTION OF NOXIOUS ANIMALS OR NOXIOUS PLANTS",5.0
A01J,MANUFACTURE OF DAIRY PRODUCTS,5.0
A01B,"SOIL WORKING IN AGRICULTURE OR FORESTRY; PARTS, DETAILS, OR ACCESSORIES OF AGRICULTURAL MACHINES OR IMPLEMENTS, IN GENERAL",5.0
A21D,"TREATMENT, e.g. PRESERVATION, OF FLOUR OR DOUGH, e.g. BY ADDITION OF MATERIALS; BAKING; BAKERY PRODUCTS; PRESERVATION THEREOF",5.0
A21C,MACHINES OR EQUIPMENT FOR MAKING OR PROCESSING DOUGHS; HANDLING BAKED ARTICLES MADE FROM DOUGH,5.0
A21B,BAKERS' OVENS; MACHINES OR EQUIPMENT FOR BAKING,5.0
A22B,SLAUGHTERING,5.0
A22C,"PROCESSING MEAT, POULTRY, OR FISH",5.0
A23P,"SHAPING OR WORKING OF FOODSTUFFS, NOT FULLY COVERED BY A SINGLE OTHER SUBCLASS",5.0
A23C,"DAIRY PRODUCTS, e.g. MILK, BUTTER OR CHEESE; MILK OR CHEESE SUBSTITUTES; MAKING THEREOF",5.0
A23J,PROTEIN COMPOSITIONS FOR FOODSTUFFS; WORKING-UP PROTEINS FOR FOODSTUFFS; PHOSPHATIDE COMPOSITIONS FOR FOODSTUFFS,5.0
A23K,FODDER,5.0
A23L,"FOODS, FOODSTUFFS, OR NON-ALCOHOLIC BEVERAGES, NOT COVERED BY SUBCLASSES A21D OR A23B-A23J; THEIR PREPARATION OR TREATMENT, e.g. COOKING, MODIFICATION OF NUTRITIVE QUALITIES, PHYSICAL TREATMENT; PRESERVATION OF FOODS OR FOODSTUFFS, IN GENERAL",5.0
A23N,"MACHINES OR APPARATUS FOR TREATING HARVESTED FRUIT, VEGETABLES OR FLOWER BULBS IN BULK, NOT OTHERWISE PROVIDED FOR; PEELING VEGETABLES OR FRUIT IN BULK; APPARATUS FOR PREPARING ANIMAL FEEDING- STUFFS",5.0
A23V,"INDEXING SCHEME RELATING TO FOODS, FOODSTUFFS OR NON-ALCOHOLIC BEVERAGES AND LACTIC OR PROPIONIC ACID BACTERIA USED IN FOODSTUFFS OR FOOD PREPARATION",5.0
A23F,"COFFEE; TEA; THEIR SUBSTITUTES; MANUFACTURE, PREPARATION, OR INFUSION THEREOF",5.0
A23G,"COCOA; COCOA PRODUCTS, e.g. CHOCOLATE; SUBSTITUTES FOR COCOA OR COCOA PRODUCTS; CONFECTIONERY; CHEWING GUM; ICE-CREAM; PREPARATION THEREOF",5.0
A23B,"PRESERVING, e.g. BY CANNING, MEAT, FISH, EGGS, FRUIT, VEGETABLES, EDIBLE SEEDS; CHEMICAL RIPENING OF FRUIT OR VEGETABLES; THE PRESERVED, RIPENED, OR CANNED PRODUCTS",5.0
A23D,"EDIBLE OILS OR FATS, e.g. MARGARINES, SHORTENINGS, COOKING OILS",5.0
A24C,MACHINES FOR MAKING CIGARS OR CIGARETTES,5.0
A24D,CIGARS; CIGARETTES; TOBACCO SMOKE FILTERS; MOUTHPIECES FOR CIGARS OR CIGARETTES; MANUFACTURE OF TOBACCO SMOKE FILTERS OR MOUTHPIECES,5.0
A24F,SMOKERS' REQUISITES; MATCH BOXES; SIMULATED SMOKING DEVICES,5.0
A24B,MANUFACTURE OR PREPARATION OF TOBACCO FOR SMOKING OR CHEWING; TOBACCO; SNUFF,5.0
A41F,GARMENT FASTENINGS; SUSPENDERS,5.0
A41G,ARTIFICIAL FLOWERS; WIGS; MASKS; FEATHERS,5.0
A41B,SHIRTS; UNDERWEAR; BABY LINEN; HANDKERCHIEFS,5.0
A41D,OUTERWEAR; PROTECTIVE GARMENTS; ACCESSORIES,5.0
A41C,CORSETS; BRASSIERES,5.0
A41H,"APPLIANCES OR METHODS FOR MAKING CLOTHES, e.g. FOR DRESS-MAKING OR FOR TAILORING, NOT OTHERWISE PROVIDED FOR",5.0
A42B,HATS; HEAD COVERINGS,5.0
A42C,"MANUFACTURING OR TRIMMING HEAD COVERINGS, e.g. HATS",5.0
A43B,CHARACTERISTIC FEATURES OF FOOTWEAR; PARTS OF FOOTWEAR,5.0
A43C,FASTENINGS OR ATTACHMENTS OF FOOTWEAR; LACES IN GENERAL,5.0
A43D,"MACHINES, TOOLS, EQUIPMENT OR METHODS FOR MANUFACTURING OR REPAIRING FOOTWEAR",5.0
A44D,"INDEXING SCHEME RELATING TO BUTTONS, PINS, BUCKLES OR SLIDE FASTENERS, AND TO JEWELLERY, BRACELETS OR OTHER PERSONAL ADORNMENTS",5.0
A44B,"BUTTONS, PINS, BUCKLES, SLIDE FASTENERS, OR THE LIKE",5.0
A44C,"PERSONAL ADORNMENTS, e.g. JEWELLERY; COINS",5.0
A45F,TRAVELLING OR CAMP EQUIPMENT: SACKS OR PACKS CARRIED ON THE BODY,5.0
A45C,PURSES; LUGGAGE; HAND CARRIED BAGS,5.0
A45D,"HAIRDRESSING OR SHAVING EQUIPMENT; EQUIPMENT FOR COSMETICS OR COSMETIC TREATMENTS, e.g. FOR MANICURING OR PEDICURING",5.0
A45B,WALKING STICKS; UMBRELLAS; LADIES' OR LIKE FANS,5.0
A46D,MANUFACTURE OF BRUSHES,5.0
A46B,BRUSHES,5.0
A47L,DOMESTIC WASHING OR CLEANING; SUCTION CLEANERS IN GENERAL,5.0
A47F,"SPECIAL FURNITURE, FITTINGS, OR ACCESSORIES FOR SHOPS, STOREHOUSES, BARS, RESTAURANTS OR THE LIKE; PAYING COUNTERS",5.0
A47D,FURNITURE SPECIALLY ADAPTED FOR CHILDREN,5.0
A47G,HOUSEHOLD OR TABLE EQUIPMENT,5.0
A47K,SANITARY EQUIPMENT NOT OTHERWISE PROVIDE

2025-01-27 01:42:07 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:07 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:07 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:09 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:42:09 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:09 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:09 - root - INFO - SQL:
-- Corrected Query 2
SELECT "publication_number", "filing_date"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "filing_date" IS NOT NULL
  AND "filing_date" <> '0'
  AND LENGTH(TRIM("filing_date")) = 8
LIMIT 100
Results:
publication_number,filing_date
WO-2017120317-A1,20170105
WO-2017127291-A1,20170113
WO-2017127659-A1,20170120
WO-2017136263-A1,20170130
WO-2017142834-A1,20170213
WO-2018169530-A1,20170316
WO-2017205009-A1,20170501
WO-2017214099-A1,20170606
WO-2017218485-A1,20170613
WO-2017223041-A1,20170620
WO-2018017413-A1,20170714
WO-2019040086-A1,20170829
WO-2018048690-A1,20170830
WO-2018075308-A1,20171011
WO-2018075529-A1,20171017
WO-2018085047-A1,20171018
WO-2018085600-A1,20171102
WO-2018111462-A1,20171109
WO-2018128713-A1,20171110
WO-2018106970-A1,20171207
WO-2018132427-A1,20180110
WO-2018148325-A1,20180207
WO-2018183768-A1,20180329
WO-2018204491-A1,20180502
WO-2018217638-A1,20180521
WO-2019067408-A1,20180925
WO-2019068025-A1,20180928
WO-2019084454-A1,20181026
WO-2019094412-A1,20181107
WO-2019099661-A1,20181115
WO-2019161308-A1,20190215
WO-2019173059-A1,20190221
WO-2019165335-A1,20190225
WO-2019168898-A1,20190227
WO-2019209905-A1,20190424
WO-2019212894-A1,20190426
WO-2019227040-A1,20190524
WO-2021021211-A1,20190801
WO-2020046846-A1,20190826
WO-2020060742-A1,20190829
WO-2021045721-A1,20190903
WO-2020073035-A1,20191007
WO-2020102388-A1,20191113
WO-2020163193-A1,20200203
WO-2020172380-A1,20200220
WO-2020236362-A1,20200416
WO-2020226939-A1,20200428
WO-2021045884-A1,20200814
WO-2021086822-A1,20201027
WO-2021092233-A1,20201105
WO-2022125064-A1,20201208
WO-2021225636-A1,20201222
WO-2021158942-A1,20210205
WO-2021168036-A1,20210218
WO-2021202049-A1,20210304
WO-2021188558-A1,20210316
WO-2021188756-A1,20210318
WO-2021202695-A1,20210331
WO-2021236703-A1,20210519
WO-2021262857-A1,20210623
WO-2022032197-A1,20210806
WO-2022072910-A1,20211002
WO-2022125386-A1,20211203
WO-2022120146-A1,20211203
WO-2022125499-A1,20211207
WO-2022133129-A1,20211216
WO-2022191895-A1,20211222
WO-2023121705-A1,20220517
WO-2022271473-A1,20220613
WO-2023034099-A1,20220824
WO-2023039176-A1,20220909
WO-2023043940-A1,20220915
WO-2022174216-A1,20220207
WO-2022213072-A1,20220329
WO-2023064808-A1,20221012
WO-2023069868-A1,20221014
WO-2023211611-A1,20230329
WO-2023196189-A1,20230331
WO-2023212035-A1,20230426
WO-2023244710-A1,20230615
WO-2024030444-A1,20230801
WO-2024072645-A1,20230915
WO-2024129224-A1,20230717
WO-2024112568-A1,20231116
WO-2024155399-A1,20231215
WO-2024151607-A1,20240109
PH-12014501678-A1,20140723
PH-12015500830-A1,20150415
PH-12018502292-A1,20181029
DE-102004001953-A1,20040113
DE-102004017082-A1,20040407
DE-102004020690-A1,20040428
DE-102004022424-A1,20040506
DE-102004030135-A1,20040622
DE-102004042100-A1,20040830
DE-102005009678-A1,20050228
DE-102005019774-A1,20050428
DE-102005021735-A1,20050511
DE-102005042868-A1,20050908
DE-102005043940-A1,20050915

2025-01-27 01:42:09 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:09 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:09 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:10 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:42:10 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:11 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:11 - root - INFO - SQL:
-- Corrected Query 3
SELECT "symbol", "titleFull"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "symbol" IS NOT NULL
  AND "symbol" <> ''
  AND "titleFull" IS NOT NULL
  AND "titleFull" <> ''
LIMIT 100
Results:
Too long, hard cut:
symbol,titleFull
B,PERFORMING OPERATIONS; TRANSPORTING
H,ELECTRICITY
Y,GENERAL TAGGING OF NEW TECHNOLOGICAL DEVELOPMENTS; GENERAL TAGGING OF CROSS-SECTIONAL TECHNOLOGIES SPANNING OVER SEVERAL SECTIONS OF THE IPC; TECHNICAL SUBJECTS COVERED BY FORMER USPC CROSS-REFERENCE ART COLLECTIONS [XRACs] AND DIGESTS
D,TEXTILES; PAPER
F,MECHANICAL ENGINEERING; LIGHTING; HEATING; WEAPONS; BLASTING
E,FIXED CONSTRUCTIONS
C,CHEMISTRY; METALLURGY
G,PHYSICS
A,HUMAN NECESSITIES
A45,HAND OR TRAVELLING ARTICLES
A24,TOBACCO; CIGARS; CIGARETTES; SIMULATED SMOKING DEVICES; SMOKERS' REQUISITES
A61,MEDICAL OR VETERINARY SCIENCE; HYGIENE
A63,SPORTS; GAMES; AMUSEMENTS
A22,BUTCHERING; MEAT TREATMENT; PROCESSING POULTRY OR FISH
A42,HEADWEAR
A99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
A43,FOOTWEAR
A01,AGRICULTURE; FORESTRY; ANIMAL HUSBANDRY; HUNTING; TRAPPING; FISHING
A62,LIFE-SAVING; FIRE-FIGHTING
A23,"FOODS OR FOODSTUFFS; TREATMENT THEREOF, NOT COVERED BY OTHER CLASSES"
A47,FURNITURE; DOMESTIC ARTICLES OR APPLIANCES; COFFEE MILLS; SPICE MILLS; SUCTION CLEANERS IN GENERAL
A46,BRUSHWARE
A44,HABERDASHERY; JEWELLERY
A21,BAKING; EDIBLE DOUGHS
A41,WEARING APPAREL
B27,WORKING OR PRESERVING WOOD OR SIMILAR MATERIAL; NAILING OR STAPLING MACHINES IN GENERAL
B68,SADDLERY; UPHOLSTERY
B04,CENTRIFUGAL APPARATUS OR MACHINES FOR CARRYING-OUT PHYSICAL OR CHEMICAL PROCESSES
B23,MACHINE TOOLS; METAL-WORKING NOT OTHERWISE PROVIDED FOR
B30,PRESSES
B21,MECHANICAL METAL-WORKING WITHOUT ESSENTIALLY REMOVING MATERIAL; PUNCHING METAL
B25,HAND TOOLS; PORTABLE POWER-DRIVEN TOOLS; MANIPULATORS
B99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
B29,WORKING OF PLASTICS; WORKING OF SUBSTANCES IN A PLASTIC STATE IN GENERAL
B31,"MAKING ARTICLES OF PAPER, CARDBOARD OR MATERIAL WORKED IN A MANNER ANALOGOUS TO PAPER; WORKING PAPER, CARDBOARD OR MATERIAL WORKED IN A MANNER ANALOGOUS TO PAPER"
B26,HAND CUTTING TOOLS; CUTTING; SEVERING
B66,HOISTING; LIFTING; HAULING
B02,"CRUSHING, PULVERISING, OR DISINTEGRATING; PREPARATORY TREATMENT OF GRAIN FOR MILLING"
B65,CONVEYING; PACKING; STORING; HANDLING THIN OR FILAMENTARY MATERIAL
B61,RAILWAYS
B24,GRINDING; POLISHING
B06,GENERATING OR TRANSMITTING MECHANICAL VIBRATIONS IN GENERAL
B43,WRITING OR DRAWING IMPLEMENTS; BUREAU ACCESSORIES
B62,LAND VEHICLES FOR TRAVELLING OTHERWISE THAN ON RAILS
B64,AIRCRAFT; AVIATION; COSMONAUTICS
B22,CASTING; POWDER METALLURGY
B28,"WORKING CEMENT, CLAY, OR STONE"
B09,DISPOSAL OF SOLID WASTE; RECLAMATION OF CONTAMINATED SOIL
B01,PHYSICAL OR CHEMICAL PROCESSES OR APPARATUS IN GENERAL
B63,SHIPS OR OTHER WATERBORNE VESSELS; RELATED EQUIPMENT
B60,VEHICLES IN GENERAL
B44,DECORATIVE ARTS
B07,SEPARATING SOLIDS FROM SOLIDS; SORTING
B08,CLEANING
B82,NANOTECHNOLOGY
B42,BOOKBINDING; ALBUMS; FILES; SPECIAL PRINTED MATTER
B32,LAYERED PRODUCTS
B81,MICROSTRUCTURAL TECHNOLOGY
B05,"SPRAYING OR ATOMISING IN GENERAL; APPLYING FLUENT MATERIALS TO SURFACES, IN GENERAL"
B41,PRINTING; LINING MACHINES; TYPEWRITERS; STAMPS
B03,SEPARATION OF SOLID MATERIALS USING LIQUIDS OR USING PNEUMATIC TABLES OR JIGS; MAGNETIC OR ELECTROSTATIC SEPARATION OF SOLID MATERIALS FROM SOLID MATERIALS OR FLUIDS; SEPARATION BY HIGH-VOLTAGE ELECTRIC FIELDS
B67,"OPENING, CLOSING OR CLEANING BOTTLES, JARS OR SIMILAR CONTAINERS; LIQUID HANDLING"
B33,ADDITIVE MANUFACTURING TECHNOLOGY
C22,METALLURGY; FERROUS OR NON-FERROUS ALLOYS; TREATMENT OF ALLOYS OR NON-FERROUS METALS
C23,"COATING METALLIC MATERIAL; COATING MATERIAL WITH METALLIC MATERIAL; CHEMICAL SURFACE TREATMENT; DIFFUSION TREATMENT OF METALLIC MATERIAL; COATING BY VACUUM EVAPORATION, BY SPUTTERING, BY ION IMPLANTATION OR BY CHEMICAL VAPOUR DEPOSITION, IN GENERAL; INHIBITING CORROSION OF METALLIC MATERIAL OR INCRUSTATION IN GENERAL"
C06,EXPLOSIVES; MATCHES
C02,"TREATMENT OF WATER, WASTE WATER, SEWAGE, OR SLUDGE"
C07,ORGANIC CHEMISTRY
C25,ELECTROLYTIC OR ELECTROPHORETIC PROCESSES; APPARATUS THEREFOR
C30,CRYSTAL GROWTH
C12,BIOCHEMISTRY; BEER; SPIRITS; WINE; VINEGAR; MICROBIOLOGY; ENZYMOLOGY; MUTATION OR GENETIC ENGINEERING
C99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
C05,FERTILISERS; MANUFACTURE THEREOF
C40,COMBINATORIAL TECHNOLOGY
C11,"ANIMAL OR VEGETABLE OILS, FATS, FATTY SUBSTANCES OR WAXES; FATTY ACIDS THEREFROM; DETERGENTS; CANDLES"
C08,ORGANIC MACROMOLECULAR COMPOUNDS; THEIR PREPARATION OR CHEMICAL WORKING-UP; COMPOSITIONS BASED THEREON
C10,"PETROLEUM, GAS OR COKE INDUSTRIES; TECHNICAL GASES CONTAINING CARBON MONOXIDE; FUELS; LUBRICANTS; PEAT"
C21,METALLURGY OF IRON
C04,CEMENTS; CONCRETE; ARTIFICIAL STONE; CERAMICS; REFRACTORIES
C09,DYES; PAINTS; POLISHES; NATURAL RESINS; ADHESIVES; COMPOSITIONS NOT OTHERWISE PROVIDED FOR; APPLICATIONS OF MATERIALS NOT OTHERWISE PROVIDED FOR
C03,GLASS; MINERAL OR SLAG WOOL
C13,SUGAR INDUSTRY
C14,SKINS; HIDES; PELTS; LEATHER
C01,INORGANIC CHEMISTRY
D02,YARNS; MECHANICAL FINISHING OF YARNS OR ROPES; WARPING OR BEAMING
D21,PAPER-MAKING; PRODUCTION OF CELLULOSE
D04,BRAIDING; LACE-MAKING; KNITTING; TRIMMINGS; NON-WOVEN F

2025-01-27 01:42:11 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:11 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:11 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:12 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:42:12 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:12 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:13 - root - INFO - SQL:
-- Corrected Query 4
SELECT YEAR(TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       COUNT(*) AS "patent_count"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
GROUP BY "filing_year"
ORDER BY "filing_year"
LIMIT 100
Results:
filing_year,patent_count
1846,1
1853,1
1860,1
1867,1
1877,4
1880,1
1881,2
1882,3
1883,2
1885,4
1886,3
1887,3
1888,3
1889,10
1890,4
1891,9
1892,10
1893,18
1894,34
1895,28
1896,44
1897,44
1898,51
1899,110
1900,81
1901,91
1902,100
1903,111
1904,136
1905,149
1906,189
1907,197
1908,160
1909,155
1910,164
1911,228
1912,276
1913,275
1914,197
1915,171
1916,173
1917,143
1918,111
1919,149
1920,173
1921,208
1922,159
1923,166
1924,174
1925,203
1926,214
1927,211
1928,243
1929,264
1930,272
1931,263
1932,219
1933,236
1934,298
1935,314
1936,335
1937,295
1938,346
1939,309
1940,289
1941,288
1942,211
1943,270
1944,248
1945,256
1946,302
1947,327
1948,300
1949,329
1950,357
1951,354
1952,382
1953,387
1954,478
1955,472
1956,519
1957,493
1958,514
1959,575
1960,552
1961,566
1962,573
1963,544
1964,857
1965,942
1966,1036
1967,1011
1968,1085
1969,1427
1970,1478
1971,2192
1972,2741
1973,3017
1974,3091
1975,3236

2025-01-27 01:42:13 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:13 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:13 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:14 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:15 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:42:26 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:42:26 - root - INFO - ```sql
SELECT "symbol", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "symbol" IS NOT NULL
  AND "symbol" <> ''
  AND "level" IS NOT NULL
LIMIT 100;
```
2025-01-27 01:42:26 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:42:26 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:42:26 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:42:27 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:42:27 - snowflake.connector.connection - INFO - closed
2025-01-27 01:42:27 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:43:02 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:43:02 - root - INFO - SQL:
SELECT "symbol", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "symbol" IS NOT NULL
  AND "symbol" <> ''
  AND "level" IS NOT NULL
LIMIT 100;
Results:
symbol,level
B,2.0
H,2.0
Y,2.0
D,2.0
F,2.0
E,2.0
C,2.0
G,2.0
A,2.0
A45,4.0
A24,4.0
A61,4.0
A63,4.0
A22,4.0
A42,4.0
A99,4.0
A43,4.0
A01,4.0
A62,4.0
A23,4.0
A47,4.0
A46,4.0
A44,4.0
A21,4.0
A41,4.0
B27,4.0
B68,4.0
B04,4.0
B23,4.0
B30,4.0
B21,4.0
B25,4.0
B99,4.0
B29,4.0
B31,4.0
B26,4.0
B66,4.0
B02,4.0
B65,4.0
B61,4.0
B24,4.0
B06,4.0
B43,4.0
B62,4.0
B64,4.0
B22,4.0
B28,4.0
B09,4.0
B01,4.0
B63,4.0
B60,4.0
B44,4.0
B07,4.0
B08,4.0
B82,4.0
B42,4.0
B32,4.0
B81,4.0
B05,4.0
B41,4.0
B03,4.0
B67,4.0
B33,4.0
C22,4.0
C23,4.0
C06,4.0
C02,4.0
C07,4.0
C25,4.0
C30,4.0
C12,4.0
C99,4.0
C05,4.0
C40,4.0
C11,4.0
C08,4.0
C10,4.0
C21,4.0
C04,4.0
C09,4.0
C03,4.0
C13,4.0
C14,4.0
C01,4.0
D02,4.0
D21,4.0
D04,4.0
D07,4.0
D01,4.0
D10,4.0
D99,4.0
D06,4.0
D03,4.0
D05,4.0
E05,4.0
E21,4.0
E04,4.0
E99,4.0
E06,4.0
E02,4.0

2025-01-27 01:43:02 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:43:02 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:43:02 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:43:04 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:43:04 - snowflake.connector.connection - INFO - closed
2025-01-27 01:43:04 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:43:04 - root - INFO - SQL:
-- Corrected Query 6
SELECT f.value:"code"::STRING AS "cpc_symbol", d."titleFull"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
JOIN PATENTS.PATENTS.CPC_DEFINITION d
  ON f.value:"code"::STRING = d."symbol"
WHERE t."cpc" IS NOT NULL
  AND f.value:"code"::STRING IS NOT NULL
  AND f.value:"code"::STRING <> ''
LIMIT 100
Results:
Too long, hard cut:
cpc_symbol,titleFull
B08B15/04,"Preventing escape of dirt or fumes from the area where they are produced; Collecting or removing dirt or fumes from that area from a small area, e.g. a tool"
B01D9/0013,Crystallisation cooling by heat exchange by indirect heat exchange
A61B2017/1157,Staplers for performing anastomosis in a single operation applying the staples radially
A61B2017/1157,Staplers for performing anastomosis in a single operation applying the staples radially
A61B17/1155,Circular staplers comprising a plurality of staples
A61B17/1155,Circular staplers comprising a plurality of staples
A61B17/1155,Circular staplers comprising a plurality of staples
A61B2017/07257,Stapler heads characterised by its anvil
A61B2017/07257,Stapler heads characterised by its anvil
G01N27/301,Reference electrodes
C08J2367/03,Polyesters derived from dicarboxylic acids and dihydroxy compounds the dicarboxylic acids and dihydroxy compounds having the hydroxy and the carboxyl groups directly linked to aromatic rings
F15C1/12,"Multiple arrangements thereof for performing operations of the same kind, e.g. majority gates, identity gates ; Counting circuits; Sliding registers"
E01B3/24,Slabs; Blocks; Pot sleepers; Fastening tie-rods to them
A61B18/085,"Forceps, scissors"
B27M1/02,"Working of wood not provided for in subclasses B27B - B27L, e.g. by stretching by compressing"
Y02W30/50,"Reuse, recycling or recovery technologies"
H10B12/373,DRAM devices comprising one-transistor - one-capacitor [1T-1C] memory cells the capacitor being at least partially in a trench in the substrate the capacitor extending under or around the transistor
H10B12/373,DRAM devices comprising one-transistor - one-capacitor [1T-1C] memory cells the capacitor being at least partially in a trench in the substrate the capacitor extending under or around the transistor
F16M13/02,"Other supports for positioning apparatus or articles; Means for steadying hand-held apparatus or articles for supporting on, or attaching to, an object, e.g. tree, gate, window-frame, cycle"
G10D13/08,"Multi-toned musical instruments with sonorous bars, blocks, forks, gongs, plates, rods or teeth"
G10D13/08,"Multi-toned musical instruments with sonorous bars, blocks, forks, gongs, plates, rods or teeth"
C13B30/023,"Continuous processes, apparatus therefor having rotatable means for agitation or transportation"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
G06F13/1663,Access to shared memory
G06F13/1663,Access to shared memory
F01L2001/34473,Lock movement perpendicular to camshaft axis
F01L2001/34473,Lock movement perpendicular to camshaft axis
F01L2001/34426,Oil control valves
F01L2001/34426,Oil control valves
E21B29/02,"Cutting or destroying pipes, packers, plugs or wire lines, located in boreholes or wells, e.g. cutting of damaged pipes, of windows; Deforming of pipes in boreholes or wells; Reconditioning of well casings while in the ground by explosives or by thermal or chemical means"
G06K15/12,"Arrangements for producing a permanent visual presentation of the output data, e.g. computer output printers using printers by photographic printing, e.g. by laser printers"
G06K15/12,"Arrangements for producing a permanent visual presentation of the output data, e.g. computer output printers using printers by photographic printing, e.g. by laser printers"
D21H21/02,"Agents for preventing deposition on the paper mill equipment, e.g. pitch or slime control"
B24D7/06,"Bonded abrasive wheels, or wheels with inserted abrasive blocks, designed for acting otherwise than only by their periphery, e.g. by the front face; Bushings or mountings therefor with inserted abrasive blocks, e.g. segmental"
B24D7/06,"Bonded abrasive wheels, or wheels with inserted abrasive blocks, designed for acting o

2025-01-27 01:43:04 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:43:04 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:43:04 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:43:06 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:43:06 - snowflake.connector.connection - INFO - closed
2025-01-27 01:43:06 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:43:06 - root - INFO - SQL:
-- Corrected Query 7
SELECT YEAR(TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value:"code"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
WHERE TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
  AND f.value:"code"::STRING IS NOT NULL
  AND f.value:"code"::STRING <> ''
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year", "filing_count" DESC
LIMIT 100
Results:
filing_year,cpc_symbol,filing_count
1877,F01B25/10,1
1877,F01L15/06,1
1880,A01K13/006,2
1880,A01K13/008,2
1881,A63C1/04,1
1882,E04D1/2942,2
1882,E04D2001/3414,2
1882,E04D1/125,2
1882,E04D1/18,2
1882,E04D2001/3464,2
1883,G04B17/225,2
1885,H04N1/024,1
1885,B66F3/08,1
1885,F42B5/26,1
1887,E05C5/02,1
1888,A63H5/00,1
1889,G04B27/06,1
1889,G04C21/08,1
1890,G04B27/065,2
1890,G04B1/20,2
1890,G04B1/205,2
1891,A01D76/006,1
1891,G04B47/06,1
1892,F41A5/18,1
1892,G04B47/061,1
1892,F41A9/29,1
1892,F41A3/40,1
1892,F41A9/30,1
1892,F41A9/32,1
1893,F16H55/38,1
1894,B66B11/0492,2
1894,G04C13/0472,1
1894,G04C13/10,1
1894,G04B13/002,1
1894,C11D9/14,1
1894,G04B33/02,1
1894,C11D17/06,1
1894,F28D7/10,1
1894,F22B9/04,1
1894,A44B1/08,1
1895,A01K5/0275,2
1895,G06G3/00,1
1895,B23B5/168,1
1895,Y10T29/5134,1
1896,F23D91/02,2
1896,A41D25/027,1
1896,B65G7/12,1
1896,B01D5/0006,1
1896,B01D5/0012,1
1897,F41J7/00,1
1897,G04B45/0076,1
1897,B41F17/26,1
1897,F02D9/00,1
1897,D05B3/14,1
1897,F16D3/56,1
1897,A45C11/10,1
1898,B01J2208/00212,2
1898,A41C1/00,1
1898,B01J8/005,1
1898,B62D7/023,1
1898,H01R43/058,1
1898,C09D191/005,1
1898,F04B47/02,1
1898,Y10T137/7917,1
1898,Y10T74/18928,1
1898,F16K47/08,1
1898,E04F21/08,1
1898,D21H5/0062,1
1898,Y10T137/7847,1
1898,H02M1/22,1
1898,B21D1/06,1
1898,F16N7/32,1
1898,B62L5/04,1
1898,B63B59/08,1
1899,C25B9/70,2
1899,Y10S411/924,2
1899,C25B11/033,2
1899,Y10T74/20882,2
1899,A47B37/00,2
1899,Y10S411/925,2
1899,C25B9/303,2
1899,F16B39/04,2
1899,B61H13/24,2
1899,A47J43/26,1
1899,Y10S16/27,1
1899,C09B1/521,1
1899,E06B3/5454,1
1899,B60C7/24,1
1899,F23H7/06,1
1899,A44B3/02,1
1899,C03B9/165,1
1899,B65D85/02,1
1899,Y10T83/8804,1
1899,B62M17/00,1
1899,Y10T29/483,1
1899,Y10T24/3613,1
1899,F04B53/00,1
1899,B22D27/04,1
1899,G01R11/56,1
1899,B68G7/08,1

2025-01-27 01:43:06 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:43:06 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:43:06 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:43:21 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-27 01:43:21 - snowflake.connector.connection - INFO - closed
2025-01-27 01:43:21 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:43:49 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:43:49 - root - INFO - ```sql
SELECT YEAR(TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value:"code"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year" DESC, "filing_count" DESC
LIMIT 100;
```
2025-01-27 01:43:49 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:43:49 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:43:49 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:43:51 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:43:51 - snowflake.connector.connection - INFO - closed
2025-01-27 01:43:51 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:44:40 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:44:40 - root - INFO - SQL:
SELECT YEAR(TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value:"code"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year" DESC, "filing_count" DESC
LIMIT 100;
Results:
filing_year,cpc_symbol,filing_count
,B65H2701/31,14
,C08F10/00,13
,F23D11/44,11
,Y02E30/30,10
,Y02E10/20,10
,B29C48/03,10
,B62C5/04,9
,Y02E10/72,8
,Y02E60/10,8
,F23D3/00,8
,F02M1/00,8
,Y10S411/983,8
,F16H21/40,7
,H04Q3/00,7
,F03B3/00,7
,B61G1/06,7
,H04Q3/42,6
,H01L21/00,6
,B60L2200/26,6
,C10J3/00,6
,H01L29/00,6
,B29C43/00,6
,Y10T74/18184,6
,F16B39/32,6
,B60R21/34,6
,F16B39/10,6
,B61F15/22,6
,H03K21/00,6
,B65G2201/02,6
,F24B15/007,6
,F23D91/02,5
,G06C23/04,5
,B62C5/00,5
,B27F5/02,5
,E06B7/20,5
,D05B3/02,5
,A01L7/04,5
,B32B27/00,5
,F23D11/10,5
,F16G11/00,5
,G09F3/0352,5
,C10G9/00,5
,A01C7/08,5
,C08K5/098,5
,G08B13/08,5
,B29C48/345,4
,B60N2/847,4
,D06B5/00,4
,B07B1/00,4
,B61G1/40,4
,C07F9/005,4
,C10N2040/20,4
,B31B50/00,4
,B60B33/0002,4
,C10M2207/282,4
,B29C48/32,4
,G11C11/22,4
,B65D2203/00,4
,B67B7/24,4
,D06B2700/18,4
,H01L2924/01013,4
,B24D15/08,4
,C07C2531/24,4
,B60S1/166,4
,A45B21/00,4
,H01L2924/01074,4
,Y10T74/18144,4
,F24B5/04,4
,C07C2/465,4
,C10M2207/023,4
,A63C17/02,4
,C07F15/02,4
,C07C2/406,4
,B31B2160/10,4
,B05B11/06,4
,G01S1/02,4
,Y10S411/988,4
,D06F45/22,4
,B01J31/2404,4
,B01J31/2291,4
,A47L13/60,4
,B60B33/0042,4
,C10N2040/16,4
,B01J2531/847,4
,C08G2110/0058,4
,F04B47/00,4
,D03D49/06,4
,C10M2207/34,4
,D01D5/04,4
,B42F17/00,4
,E21B27/00,4
,C01B2203/0465,4
,E01D15/133,4
,C07F17/00,4
,B66C7/00,4
,A61M1/08,4
,C25D3/22,4
,A01B59/02,4
,H01R13/432,4
,Y02T10/12,4

2025-01-27 01:44:40 - root - INFO - itercount: 0
2025-01-27 01:44:40 - root - INFO - Database Name: PATENTS
Schema Name: PATENTS
DDL describes table information.
,0
table_name,DISCLOSURES_13
description,
DDL,"create or replace TABLE DISCLOSURES_13 (
	""family_id"" VARCHAR(16777216),
	""record_id"" VARCHAR(16777216),
	""disclosure_event"" VARCHAR(16777216),
	""sso"" VARCHAR(16777216),
	""patent_owner_harmonized"" VARCHAR(16777216),
	""patent_owner_unharmonized"" VARCHAR(16777216),
	""date"" NUMBER(38,0),
	""standard"" VARCHAR(16777216),
	""committee_project"" VARCHAR(16777216),
	""tc_name"" VARCHAR(16777216),
	""sc_name"" VARCHAR(16777216),
	""wg_name"" VARCHAR(16777216),
	""licensing_commitment"" VARCHAR(16777216),
	""copyright"" VARCHAR(16777216),
	""blanket_type"" VARCHAR(16777216),
	""blanket_scope"" VARCHAR(16777216),
	""third_party"" VARCHAR(16777216),
	""reciprocity"" VARCHAR(16777216),
	""serial_cleaned"" VARCHAR(16777216),
	""pub_cleaned"" VARCHAR(16777216)
);"

,1
table_name,PUBLICATIONS
description,
DDL,"create or replace TABLE PUBLICATIONS (
	""publication_number"" VARCHAR(16777216),
	""application_number"" VARCHAR(16777216),
	""country_code"" VARCHAR(16777216),
	""kind_code"" VARCHAR(16777216),
	""application_kind"" VARCHAR(16777216),
	""application_number_formatted"" VARCHAR(16777216),
	""pct_number"" VARCHAR(16777216),
	""family_id"" VARCHAR(16777216),
	""spif_publication_number"" VARCHAR(16777216),
	""spif_application_number"" VARCHAR(16777216),
	""title_localized"" VARIANT,
	""abstract_localized"" VARIANT,
	""claims_localized"" VARIANT,
	""claims_localized_html"" VARIANT,
	""description_localized"" VARIANT,
	""description_localized_html"" VARIANT,
	""publication_date"" NUMBER(38,0),
	""filing_date"" NUMBER(38,0),
	""grant_date"" NUMBER(38,0),
	""priority_date"" NUMBER(38,0),
	""priority_claim"" VARIANT,
	""inventor"" VARIANT,
	""inventor_harmonized"" VARIANT,
	""assignee"" VARIANT,
	""assignee_harmonized"" VARIANT,
	""examiner"" VARIANT,
	""uspc"" VARIANT,
	""ipc"" VARIANT,
	""cpc"" VARIANT,
	""fi"" VARIANT,
	""fterm"" VARIANT,
	""locarno"" VARIANT,
	""citation"" VARIANT,
	""parent"" VARIANT,
	""child"" VARIANT,
	""entity_status"" VARCHAR(16777216),
	""art_unit"" VARCHAR(16777216)
);"

,2
table_name,CPC_DEFINITION
description,
DDL,"create or replace TABLE CPC_DEFINITION (
	""applicationReferences"" VARIANT,
	""breakdownCode"" BOOLEAN,
	""childGroups"" VARIANT,
	""children"" VARIANT,
	""dateRevised"" FLOAT,
	""definition"" VARIANT,
	""glossary"" VARIANT,
	""informativeReferences"" VARIANT,
	""ipcConcordant"" VARCHAR(16777216),
	""level"" FLOAT,
	""limitingReferences"" VARIANT,
	""notAllocatable"" BOOLEAN,
	""parents"" VARIANT,
	""precedenceLimitingReferences"" VARIANT,
	""residualReferences"" VARIANT,
	""rules"" VARIANT,
	""scopeLimitingReferences"" VARIANT,
	""status"" VARCHAR(16777216),
	""symbol"" VARCHAR(16777216),
	""synonyms"" VARIANT,
	""titleFull"" VARCHAR(16777216),
	""titlePart"" VARIANT
);"

External knowledge that might be helpful: 
None
The table structure information is ({database name: {schema name: {table name}}}): 
{'PATENTS': {'PATENTS': ['CPC_DEFINITION', 'DISCLOSURES_13', 'PUBLICATIONS']}}
Begin Exploring Related Columns
**Relevant Tables and Columns:**

- **PUBLICATIONS**:
  - `"filing_date"`: Potential usage - To extract the year of patent filings.
  - `"cpc"`: Potential usage - Contains CPC codes associated with each publication; needs to be flattened to extract individual CPC codes.
  - `"publication_number"`: Potential usage - Unique identifier for each patent publication.

- **CPC_DEFINITION**:
  - `"symbol"`: Potential usage - CPC code symbol to match with the codes in PUBLICATIONS.
  - `"titleFull"`: Potential usage - Full title of the CPC code.
  - `"level"`: Potential usage - To filter CPC codes at level 5.

**Conditions that may be used:**

- Filtering `"level"` = 5 in `CPC_DEFINITION` to get CPC codes at level 5.
- Extracting the year from `"filing_date"` in `PUBLICATIONS`.
- Flattening the `"cpc"` column in `PUBLICATIONS` to extract individual CPC codes linked to each publication.

---

```sql
-- Query 1: Retrieve distinct filing years from PUBLICATIONS
SELECT DISTINCT YEAR(TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year"
FROM PATENTS.PATENTS.PUBLICATIONS
LIMIT 100;

-- Query 2: Extract CPC symbols from PUBLICATIONS by flattening the "cpc" column
SELECT f.value::VARIANT:"symbol"::STRING AS "cpc_symbol"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
LIMIT 100;

-- Query 3: Select CPC definitions at level 5
SELECT "symbol", "titleFull", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "level" = 5
LIMIT 100;

-- Query 4: List publication numbers with their filing dates
SELECT "publication_number", "filing_date"
FROM PATENTS.PATENTS.PUBLICATIONS
LIMIT 100;

-- Query 5: Retrieve all CPC symbols and their full titles
SELECT "symbol", "titleFull"
FROM PATENTS.PATENTS.CPC_DEFINITION
LIMIT 100;

-- Query 6: Count patents filed each year
SELECT YEAR(TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       COUNT(*) AS "patent_count"
FROM PATENTS.PATENTS.PUBLICATIONS
GROUP BY "filing_year"
ORDER BY "filing_year"
LIMIT 100;

-- Query 7: Retrieve CPC symbols along with their levels
SELECT "symbol", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
LIMIT 100;

-- Query 8: Join CPC codes from PUBLICATIONS with their definitions
SELECT f.value::VARIANT:"symbol"::STRING AS "cpc_symbol", d."titleFull"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
JOIN PATENTS.PATENTS.CPC_DEFINITION d
  ON f.value::VARIANT:"symbol"::STRING = d."symbol"
LIMIT 100;

-- Query 9: Count filings per CPC symbol per year
SELECT YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value::VARIANT:"symbol"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year", "filing_count" DESC
LIMIT 100;

-- Query 10: Count filings per CPC symbol at level 5 per year
SELECT YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value::VARIANT:"symbol"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
JOIN PATENTS.PATENTS.CPC_DEFINITION d
  ON f.value::VARIANT:"symbol"::STRING = d."symbol"
WHERE d."level" = 5
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year", "filing_count" DESC
LIMIT 100;
```Query:
SELECT DISTINCT YEAR(TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
LIMIT 100;
Answer:
filing_year
2017
1899
1962
2019
1934
1988
1998
1885
1960
1903
1985
1888
1944
1880
1902
2001
1980
1947
1952
1992
1955
1919
1909
1882
1928
2004
1983
1937
1964
2008
1895
1993
1974
1916
2014
1853
1911
1940
1939
1967
1984
1904
1877
1860
1914
1936
1990
1966
1886
1986
1997
1981
1931
1945
1912
1961
2007
1890
1915
1970
1976
2005
1953
1907
2009
1995
1918
1999
1972
1982
1846
1929
1991
1938
1969
1977
1979
1898
1978
1956
1933
1958
1913
2002
1948
1910
1946
1949
1942
1963
1905
1921
2015
2022
1950
2011
1989
1971
1975
1889
Query:
SELECT f.value::STRING AS "cpc_symbol"
FROM PATENTS.PATENTS.PUBLICATIONS t,
LATERAL FLATTEN(input => t."cpc") f
LIMIT 100;
Answer:
Too long, hard cut:
cpc_symbol
"{""code"":""B62K11/007"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62M23/00"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K1/00"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""B62M23/00"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K21/12"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K11/007"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K21/12"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B62K1/00"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61B3/103"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/0025"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61B3/0008"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G02B27/0068"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/12"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61B3/14"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G02B7/09"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M1/4225"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M1/4225"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""Y02B70/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M1/42"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""Y02B70/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H02M3/1584"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M3/1584"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H02M1/42"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/0637"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0662"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/064"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0659"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N5/0616"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/064"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0662"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N2005/0659"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""A61N5/0616"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""A61N2005/0637"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/137"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/1399"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/027"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M10/0525"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/623"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/625"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/606"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/021"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M2004/021"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/623"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/625"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M4/137"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/606"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M4/1399"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H01M2004/027"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""H01M10/0525"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""Y02E60/10"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G06Q10/107"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""H04L51/212"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""H04L51/212"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G06Q10/107"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""G06F3/0481"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""G06F3/013"",""first"":true,""inventive"":true,""tree"":[]}"
"{""code"":""B60K2350/1068"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G02B27/01"",""first"":false,""inventive"":true,""tree"":[]}"
"{""code"":""B60K2350/352"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""B60K2350/2052"",""first"":false,""inventive"":false,""tree"":[]}"
"{""code"":""G02B2027/0187"",
Query:
-- Corrected Query 1
SELECT "symbol", "titleFull", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "level" = '5'
LIMIT 100
Answer:
Too long, hard cut:
symbol,titleFull,level
A01H,NEW PLANTS OR NON-TRANSGENIC PROCESSES FOR OBTAINING THEM; PLANT REPRODUCTION BY TISSUE CULTURE TECHNIQUES,5.0
A01F,PROCESSING OF HARVESTED PRODUCE; HAY OR STRAW PRESSES; DEVICES FOR STORING AGRICULTURAL OR HORTICULTURAL PRODUCE,5.0
A01C,PLANTING; SOWING; FERTILISING,5.0
A01G,"HORTICULTURE; CULTIVATION OF VEGETABLES, FLOWERS, RICE, FRUIT, VINES, HOPS OR SEAWEED; FORESTRY; WATERING",5.0
A01N,"PRESERVATION OF BODIES OF HUMANS OR ANIMALS OR PLANTS OR PARTS THEREOF; BIOCIDES, e.g. AS DISINFECTANTS, AS PESTICIDES OR AS HERBICIDES; PEST REPELLANTS OR ATTRACTANTS; PLANT GROWTH REGULATORS",5.0
A01P,"BIOCIDAL, PEST REPELLANT, PEST ATTRACTANT OR PLANT GROWTH REGULATORY ACTIVITY OF CHEMICAL COMPOUNDS OR PREPARATIONS",5.0
A01D,HARVESTING; MOWING,5.0
A01L,SHOEING OF ANIMALS,5.0
A01K,"ANIMAL HUSBANDRY; AVICULTURE; APICULTURE; PISCICULTURE; FISHING; REARING OR BREEDING ANIMALS, NOT OTHERWISE PROVIDED FOR; NEW BREEDS OF ANIMALS",5.0
A01M,"CATCHING, TRAPPING OR SCARING OF ANIMALS; APPARATUS FOR THE DESTRUCTION OF NOXIOUS ANIMALS OR NOXIOUS PLANTS",5.0
A01J,MANUFACTURE OF DAIRY PRODUCTS,5.0
A01B,"SOIL WORKING IN AGRICULTURE OR FORESTRY; PARTS, DETAILS, OR ACCESSORIES OF AGRICULTURAL MACHINES OR IMPLEMENTS, IN GENERAL",5.0
A21D,"TREATMENT, e.g. PRESERVATION, OF FLOUR OR DOUGH, e.g. BY ADDITION OF MATERIALS; BAKING; BAKERY PRODUCTS; PRESERVATION THEREOF",5.0
A21C,MACHINES OR EQUIPMENT FOR MAKING OR PROCESSING DOUGHS; HANDLING BAKED ARTICLES MADE FROM DOUGH,5.0
A21B,BAKERS' OVENS; MACHINES OR EQUIPMENT FOR BAKING,5.0
A22B,SLAUGHTERING,5.0
A22C,"PROCESSING MEAT, POULTRY, OR FISH",5.0
A23P,"SHAPING OR WORKING OF FOODSTUFFS, NOT FULLY COVERED BY A SINGLE OTHER SUBCLASS",5.0
A23C,"DAIRY PRODUCTS, e.g. MILK, BUTTER OR CHEESE; MILK OR CHEESE SUBSTITUTES; MAKING THEREOF",5.0
A23J,PROTEIN COMPOSITIONS FOR FOODSTUFFS; WORKING-UP PROTEINS FOR FOODSTUFFS; PHOSPHATIDE COMPOSITIONS FOR FOODSTUFFS,5.0
A23K,FODDER,5.0
A23L,"FOODS, FOODSTUFFS, OR NON-ALCOHOLIC BEVERAGES, NOT COVERED BY SUBCLASSES A21D OR A23B-A23J; THEIR PREPARATION OR TREATMENT, e.g. COOKING, MODIFICATION OF NUTRITIVE QUALITIES, PHYSICAL TREATMENT; PRESERVATION OF FOODS OR FOODSTUFFS, IN GENERAL",5.0
A23N,"MACHINES OR APPARATUS FOR TREATING HARVESTED FRUIT, VEGETABLES OR FLOWER BULBS IN BULK, NOT OTHERWISE PROVIDED FOR; PEELING VEGETABLES OR FRUIT IN BULK; APPARATUS FOR PREPARING ANIMAL FEEDING- STUFFS",5.0
A23V,"INDEXING SCHEME RELATING TO FOODS, FOODSTUFFS OR NON-ALCOHOLIC BEVERAGES AND LACTIC OR PROPIONIC ACID BACTERIA USED IN FOODSTUFFS OR FOOD PREPARATION",5.0
A23F,"COFFEE; TEA; THEIR SUBSTITUTES; MANUFACTURE, PREPARATION, OR INFUSION THEREOF",5.0
A23G,"COCOA; COCOA PRODUCTS, e.g. CHOCOLATE; SUBSTITUTES FOR COCOA OR COCOA PRODUCTS; CONFECTIONERY; CHEWING GUM; ICE-CREAM; PREPARATION THEREOF",5.0
A23B,"PRESERVING, e.g. BY CANNING, MEAT, FISH, EGGS, FRUIT, VEGETABLES, EDIBLE SEEDS; CHEMICAL RIPENING OF FRUIT OR VEGETABLES; THE PRESERVED, RIPENED, OR CANNED PRODUCTS",5.0
A23D,"EDIBLE OILS OR FATS, e.g. MARGARINES, SHORTENINGS, COOKING OILS",5.0
A24C,MACHINES FOR MAKING CIGARS OR CIGARETTES,5.0
A24D,CIGARS; CIGARETTES; TOBACCO SMOKE FILTERS; MOUTHPIECES FOR CIGARS OR CIGARETTES; MANUFACTURE OF TOBACCO SMOKE FILTERS OR MOUTHPIECES,5.0
A24F,SMOKERS' REQUISITES; MATCH BOXES; SIMULATED SMOKING DEVICES,5.0
A24B,MANUFACTURE OR PREPARATION OF TOBACCO FOR SMOKING OR CHEWING; TOBACCO; SNUFF,5.0
A41F,GARMENT FASTENINGS; SUSPENDERS,5.0
A41G,ARTIFICIAL FLOWERS; WIGS; MASKS; FEATHERS,5.0
A41B,SHIRTS; UNDERWEAR; BABY LINEN; HANDKERCHIEFS,5.0
A41D,OUTERWEAR; PROTECTIVE GARMENTS; ACCESSORIES,5.0
A41C,CORSETS; BRASSIERES,5.0
A41H,"APPLIANCES OR METHODS FOR MAKING CLOTHES, e.g. FOR DRESS-MAKING OR FOR TAILORING, NOT OTHERWISE PROVIDED FOR",5.0
A42B,HATS; HEAD COVERINGS,5.0
A42C,"MANUFACTURING OR TRIMMING HEAD COVERINGS, e.g. HATS",5.0
A43B,CHARACTERISTIC FEATURES OF FOOTWEAR; PARTS OF FOOTWEAR,5.0
A43C,FASTENINGS OR ATTACHMENTS OF FOOTWEAR; LACES IN GENERAL,5.0
A43D,"MACHINES, TOOLS, EQUIPMENT OR METHODS FOR MANUFACTURING OR REPAIRING FOOTWEAR",5.0
A44D,"INDEXING SCHEME RELATING TO BUTTONS, PINS, BUCKLES OR SLIDE FASTENERS, AND TO JEWELLERY, BRACELETS OR OTHER PERSONAL ADORNMENTS",5.0
A44B,"BUTTONS, PINS, BUCKLES, SLIDE FASTENERS, OR THE LIKE",5.0
A44C,"PERSONAL ADORNMENTS, e.g. JEWELLERY; COINS",5.0
A45F,TRAVELLING OR CAMP EQUIPMENT: SACKS OR PACKS CARRIED ON THE BODY,5.0
A45C,PURSES; LUGGAGE; HAND CARRIED BAGS,5.0
A45D,"HAIRDRESSING OR SHAVING EQUIPMENT; EQUIPMENT FOR COSMETICS OR COSMETIC TREATMENTS, e.g. FOR MANICURING OR PEDICURING",5.0
A45B,WALKING STICKS; UMBRELLAS; LADIES' OR LIKE FANS,5.0
A46D,MANUFACTURE OF BRUSHES,5.0
A46B,BRUSHES,5.0
A47L,DOMESTIC WASHING OR CLEANING; SUCTION CLEANERS IN GENERAL,5.0
A47F,"SPECIAL FURNITURE, FITTINGS, OR ACCESSORIES FOR SHOPS, STOREHOUSES, BARS, RESTAURANTS OR THE LIKE; PAYING COUNTERS",5.0
A47D,FURNITURE SPECIALLY ADAPTED FOR CHILDREN,5.0
A47G,HOUSEHOLD OR TABLE EQUIPMENT,5.0
A47K,SANITARY EQUIPMENT NOT OTHERWISE PROVIDE
Query:
-- Corrected Query 2
SELECT "publication_number", "filing_date"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "filing_date" IS NOT NULL
  AND "filing_date" <> '0'
  AND LENGTH(TRIM("filing_date")) = 8
LIMIT 100
Answer:
publication_number,filing_date
WO-2017120317-A1,20170105
WO-2017127291-A1,20170113
WO-2017127659-A1,20170120
WO-2017136263-A1,20170130
WO-2017142834-A1,20170213
WO-2018169530-A1,20170316
WO-2017205009-A1,20170501
WO-2017214099-A1,20170606
WO-2017218485-A1,20170613
WO-2017223041-A1,20170620
WO-2018017413-A1,20170714
WO-2019040086-A1,20170829
WO-2018048690-A1,20170830
WO-2018075308-A1,20171011
WO-2018075529-A1,20171017
WO-2018085047-A1,20171018
WO-2018085600-A1,20171102
WO-2018111462-A1,20171109
WO-2018128713-A1,20171110
WO-2018106970-A1,20171207
WO-2018132427-A1,20180110
WO-2018148325-A1,20180207
WO-2018183768-A1,20180329
WO-2018204491-A1,20180502
WO-2018217638-A1,20180521
WO-2019067408-A1,20180925
WO-2019068025-A1,20180928
WO-2019084454-A1,20181026
WO-2019094412-A1,20181107
WO-2019099661-A1,20181115
WO-2019161308-A1,20190215
WO-2019173059-A1,20190221
WO-2019165335-A1,20190225
WO-2019168898-A1,20190227
WO-2019209905-A1,20190424
WO-2019212894-A1,20190426
WO-2019227040-A1,20190524
WO-2021021211-A1,20190801
WO-2020046846-A1,20190826
WO-2020060742-A1,20190829
WO-2021045721-A1,20190903
WO-2020073035-A1,20191007
WO-2020102388-A1,20191113
WO-2020163193-A1,20200203
WO-2020172380-A1,20200220
WO-2020236362-A1,20200416
WO-2020226939-A1,20200428
WO-2021045884-A1,20200814
WO-2021086822-A1,20201027
WO-2021092233-A1,20201105
WO-2022125064-A1,20201208
WO-2021225636-A1,20201222
WO-2021158942-A1,20210205
WO-2021168036-A1,20210218
WO-2021202049-A1,20210304
WO-2021188558-A1,20210316
WO-2021188756-A1,20210318
WO-2021202695-A1,20210331
WO-2021236703-A1,20210519
WO-2021262857-A1,20210623
WO-2022032197-A1,20210806
WO-2022072910-A1,20211002
WO-2022125386-A1,20211203
WO-2022120146-A1,20211203
WO-2022125499-A1,20211207
WO-2022133129-A1,20211216
WO-2022191895-A1,20211222
WO-2023121705-A1,20220517
WO-2022271473-A1,20220613
WO-2023034099-A1,20220824
WO-2023039176-A1,20220909
WO-2023043940-A1,20220915
WO-2022174216-A1,20220207
WO-2022213072-A1,20220329
WO-2023064808-A1,20221012
WO-2023069868-A1,20221014
WO-2023211611-A1,20230329
WO-2023196189-A1,20230331
WO-2023212035-A1,20230426
WO-2023244710-A1,20230615
WO-2024030444-A1,20230801
WO-2024072645-A1,20230915
WO-2024129224-A1,20230717
WO-2024112568-A1,20231116
WO-2024155399-A1,20231215
WO-2024151607-A1,20240109
PH-12014501678-A1,20140723
PH-12015500830-A1,20150415
PH-12018502292-A1,20181029
DE-102004001953-A1,20040113
DE-102004017082-A1,20040407
DE-102004020690-A1,20040428
DE-102004022424-A1,20040506
DE-102004030135-A1,20040622
DE-102004042100-A1,20040830
DE-102005009678-A1,20050228
DE-102005019774-A1,20050428
DE-102005021735-A1,20050511
DE-102005042868-A1,20050908
DE-102005043940-A1,20050915
Query:
-- Corrected Query 3
SELECT "symbol", "titleFull"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "symbol" IS NOT NULL
  AND "symbol" <> ''
  AND "titleFull" IS NOT NULL
  AND "titleFull" <> ''
LIMIT 100
Answer:
Too long, hard cut:
symbol,titleFull
B,PERFORMING OPERATIONS; TRANSPORTING
H,ELECTRICITY
Y,GENERAL TAGGING OF NEW TECHNOLOGICAL DEVELOPMENTS; GENERAL TAGGING OF CROSS-SECTIONAL TECHNOLOGIES SPANNING OVER SEVERAL SECTIONS OF THE IPC; TECHNICAL SUBJECTS COVERED BY FORMER USPC CROSS-REFERENCE ART COLLECTIONS [XRACs] AND DIGESTS
D,TEXTILES; PAPER
F,MECHANICAL ENGINEERING; LIGHTING; HEATING; WEAPONS; BLASTING
E,FIXED CONSTRUCTIONS
C,CHEMISTRY; METALLURGY
G,PHYSICS
A,HUMAN NECESSITIES
A45,HAND OR TRAVELLING ARTICLES
A24,TOBACCO; CIGARS; CIGARETTES; SIMULATED SMOKING DEVICES; SMOKERS' REQUISITES
A61,MEDICAL OR VETERINARY SCIENCE; HYGIENE
A63,SPORTS; GAMES; AMUSEMENTS
A22,BUTCHERING; MEAT TREATMENT; PROCESSING POULTRY OR FISH
A42,HEADWEAR
A99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
A43,FOOTWEAR
A01,AGRICULTURE; FORESTRY; ANIMAL HUSBANDRY; HUNTING; TRAPPING; FISHING
A62,LIFE-SAVING; FIRE-FIGHTING
A23,"FOODS OR FOODSTUFFS; TREATMENT THEREOF, NOT COVERED BY OTHER CLASSES"
A47,FURNITURE; DOMESTIC ARTICLES OR APPLIANCES; COFFEE MILLS; SPICE MILLS; SUCTION CLEANERS IN GENERAL
A46,BRUSHWARE
A44,HABERDASHERY; JEWELLERY
A21,BAKING; EDIBLE DOUGHS
A41,WEARING APPAREL
B27,WORKING OR PRESERVING WOOD OR SIMILAR MATERIAL; NAILING OR STAPLING MACHINES IN GENERAL
B68,SADDLERY; UPHOLSTERY
B04,CENTRIFUGAL APPARATUS OR MACHINES FOR CARRYING-OUT PHYSICAL OR CHEMICAL PROCESSES
B23,MACHINE TOOLS; METAL-WORKING NOT OTHERWISE PROVIDED FOR
B30,PRESSES
B21,MECHANICAL METAL-WORKING WITHOUT ESSENTIALLY REMOVING MATERIAL; PUNCHING METAL
B25,HAND TOOLS; PORTABLE POWER-DRIVEN TOOLS; MANIPULATORS
B99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
B29,WORKING OF PLASTICS; WORKING OF SUBSTANCES IN A PLASTIC STATE IN GENERAL
B31,"MAKING ARTICLES OF PAPER, CARDBOARD OR MATERIAL WORKED IN A MANNER ANALOGOUS TO PAPER; WORKING PAPER, CARDBOARD OR MATERIAL WORKED IN A MANNER ANALOGOUS TO PAPER"
B26,HAND CUTTING TOOLS; CUTTING; SEVERING
B66,HOISTING; LIFTING; HAULING
B02,"CRUSHING, PULVERISING, OR DISINTEGRATING; PREPARATORY TREATMENT OF GRAIN FOR MILLING"
B65,CONVEYING; PACKING; STORING; HANDLING THIN OR FILAMENTARY MATERIAL
B61,RAILWAYS
B24,GRINDING; POLISHING
B06,GENERATING OR TRANSMITTING MECHANICAL VIBRATIONS IN GENERAL
B43,WRITING OR DRAWING IMPLEMENTS; BUREAU ACCESSORIES
B62,LAND VEHICLES FOR TRAVELLING OTHERWISE THAN ON RAILS
B64,AIRCRAFT; AVIATION; COSMONAUTICS
B22,CASTING; POWDER METALLURGY
B28,"WORKING CEMENT, CLAY, OR STONE"
B09,DISPOSAL OF SOLID WASTE; RECLAMATION OF CONTAMINATED SOIL
B01,PHYSICAL OR CHEMICAL PROCESSES OR APPARATUS IN GENERAL
B63,SHIPS OR OTHER WATERBORNE VESSELS; RELATED EQUIPMENT
B60,VEHICLES IN GENERAL
B44,DECORATIVE ARTS
B07,SEPARATING SOLIDS FROM SOLIDS; SORTING
B08,CLEANING
B82,NANOTECHNOLOGY
B42,BOOKBINDING; ALBUMS; FILES; SPECIAL PRINTED MATTER
B32,LAYERED PRODUCTS
B81,MICROSTRUCTURAL TECHNOLOGY
B05,"SPRAYING OR ATOMISING IN GENERAL; APPLYING FLUENT MATERIALS TO SURFACES, IN GENERAL"
B41,PRINTING; LINING MACHINES; TYPEWRITERS; STAMPS
B03,SEPARATION OF SOLID MATERIALS USING LIQUIDS OR USING PNEUMATIC TABLES OR JIGS; MAGNETIC OR ELECTROSTATIC SEPARATION OF SOLID MATERIALS FROM SOLID MATERIALS OR FLUIDS; SEPARATION BY HIGH-VOLTAGE ELECTRIC FIELDS
B67,"OPENING, CLOSING OR CLEANING BOTTLES, JARS OR SIMILAR CONTAINERS; LIQUID HANDLING"
B33,ADDITIVE MANUFACTURING TECHNOLOGY
C22,METALLURGY; FERROUS OR NON-FERROUS ALLOYS; TREATMENT OF ALLOYS OR NON-FERROUS METALS
C23,"COATING METALLIC MATERIAL; COATING MATERIAL WITH METALLIC MATERIAL; CHEMICAL SURFACE TREATMENT; DIFFUSION TREATMENT OF METALLIC MATERIAL; COATING BY VACUUM EVAPORATION, BY SPUTTERING, BY ION IMPLANTATION OR BY CHEMICAL VAPOUR DEPOSITION, IN GENERAL; INHIBITING CORROSION OF METALLIC MATERIAL OR INCRUSTATION IN GENERAL"
C06,EXPLOSIVES; MATCHES
C02,"TREATMENT OF WATER, WASTE WATER, SEWAGE, OR SLUDGE"
C07,ORGANIC CHEMISTRY
C25,ELECTROLYTIC OR ELECTROPHORETIC PROCESSES; APPARATUS THEREFOR
C30,CRYSTAL GROWTH
C12,BIOCHEMISTRY; BEER; SPIRITS; WINE; VINEGAR; MICROBIOLOGY; ENZYMOLOGY; MUTATION OR GENETIC ENGINEERING
C99,SUBJECT MATTER NOT OTHERWISE PROVIDED FOR IN THIS SECTION
C05,FERTILISERS; MANUFACTURE THEREOF
C40,COMBINATORIAL TECHNOLOGY
C11,"ANIMAL OR VEGETABLE OILS, FATS, FATTY SUBSTANCES OR WAXES; FATTY ACIDS THEREFROM; DETERGENTS; CANDLES"
C08,ORGANIC MACROMOLECULAR COMPOUNDS; THEIR PREPARATION OR CHEMICAL WORKING-UP; COMPOSITIONS BASED THEREON
C10,"PETROLEUM, GAS OR COKE INDUSTRIES; TECHNICAL GASES CONTAINING CARBON MONOXIDE; FUELS; LUBRICANTS; PEAT"
C21,METALLURGY OF IRON
C04,CEMENTS; CONCRETE; ARTIFICIAL STONE; CERAMICS; REFRACTORIES
C09,DYES; PAINTS; POLISHES; NATURAL RESINS; ADHESIVES; COMPOSITIONS NOT OTHERWISE PROVIDED FOR; APPLICATIONS OF MATERIALS NOT OTHERWISE PROVIDED FOR
C03,GLASS; MINERAL OR SLAG WOOL
C13,SUGAR INDUSTRY
C14,SKINS; HIDES; PELTS; LEATHER
C01,INORGANIC CHEMISTRY
D02,YARNS; MECHANICAL FINISHING OF YARNS OR ROPES; WARPING OR BEAMING
D21,PAPER-MAKING; PRODUCTION OF CELLULOSE
D04,BRAIDING; LACE-MAKING; KNITTING; TRIMMINGS; NON-WOVEN F
Query:
-- Corrected Query 4
SELECT YEAR(TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       COUNT(*) AS "patent_count"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE TRY_TO_DATE("filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
GROUP BY "filing_year"
ORDER BY "filing_year"
LIMIT 100
Answer:
filing_year,patent_count
1846,1
1853,1
1860,1
1867,1
1877,4
1880,1
1881,2
1882,3
1883,2
1885,4
1886,3
1887,3
1888,3
1889,10
1890,4
1891,9
1892,10
1893,18
1894,34
1895,28
1896,44
1897,44
1898,51
1899,110
1900,81
1901,91
1902,100
1903,111
1904,136
1905,149
1906,189
1907,197
1908,160
1909,155
1910,164
1911,228
1912,276
1913,275
1914,197
1915,171
1916,173
1917,143
1918,111
1919,149
1920,173
1921,208
1922,159
1923,166
1924,174
1925,203
1926,214
1927,211
1928,243
1929,264
1930,272
1931,263
1932,219
1933,236
1934,298
1935,314
1936,335
1937,295
1938,346
1939,309
1940,289
1941,288
1942,211
1943,270
1944,248
1945,256
1946,302
1947,327
1948,300
1949,329
1950,357
1951,354
1952,382
1953,387
1954,478
1955,472
1956,519
1957,493
1958,514
1959,575
1960,552
1961,566
1962,573
1963,544
1964,857
1965,942
1966,1036
1967,1011
1968,1085
1969,1427
1970,1478
1971,2192
1972,2741
1973,3017
1974,3091
1975,3236
Query:
SELECT "symbol", "level"
FROM PATENTS.PATENTS.CPC_DEFINITION
WHERE "symbol" IS NOT NULL
  AND "symbol" <> ''
  AND "level" IS NOT NULL
LIMIT 100;
Answer:
symbol,level
B,2.0
H,2.0
Y,2.0
D,2.0
F,2.0
E,2.0
C,2.0
G,2.0
A,2.0
A45,4.0
A24,4.0
A61,4.0
A63,4.0
A22,4.0
A42,4.0
A99,4.0
A43,4.0
A01,4.0
A62,4.0
A23,4.0
A47,4.0
A46,4.0
A44,4.0
A21,4.0
A41,4.0
B27,4.0
B68,4.0
B04,4.0
B23,4.0
B30,4.0
B21,4.0
B25,4.0
B99,4.0
B29,4.0
B31,4.0
B26,4.0
B66,4.0
B02,4.0
B65,4.0
B61,4.0
B24,4.0
B06,4.0
B43,4.0
B62,4.0
B64,4.0
B22,4.0
B28,4.0
B09,4.0
B01,4.0
B63,4.0
B60,4.0
B44,4.0
B07,4.0
B08,4.0
B82,4.0
B42,4.0
B32,4.0
B81,4.0
B05,4.0
B41,4.0
B03,4.0
B67,4.0
B33,4.0
C22,4.0
C23,4.0
C06,4.0
C02,4.0
C07,4.0
C25,4.0
C30,4.0
C12,4.0
C99,4.0
C05,4.0
C40,4.0
C11,4.0
C08,4.0
C10,4.0
C21,4.0
C04,4.0
C09,4.0
C03,4.0
C13,4.0
C14,4.0
C01,4.0
D02,4.0
D21,4.0
D04,4.0
D07,4.0
D01,4.0
D10,4.0
D99,4.0
D06,4.0
D03,4.0
D05,4.0
E05,4.0
E21,4.0
E04,4.0
E99,4.0
E06,4.0
E02,4.0
Query:
-- Corrected Query 6
SELECT f.value:"code"::STRING AS "cpc_symbol", d."titleFull"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
JOIN PATENTS.PATENTS.CPC_DEFINITION d
  ON f.value:"code"::STRING = d."symbol"
WHERE t."cpc" IS NOT NULL
  AND f.value:"code"::STRING IS NOT NULL
  AND f.value:"code"::STRING <> ''
LIMIT 100
Answer:
Too long, hard cut:
cpc_symbol,titleFull
B08B15/04,"Preventing escape of dirt or fumes from the area where they are produced; Collecting or removing dirt or fumes from that area from a small area, e.g. a tool"
B01D9/0013,Crystallisation cooling by heat exchange by indirect heat exchange
A61B2017/1157,Staplers for performing anastomosis in a single operation applying the staples radially
A61B2017/1157,Staplers for performing anastomosis in a single operation applying the staples radially
A61B17/1155,Circular staplers comprising a plurality of staples
A61B17/1155,Circular staplers comprising a plurality of staples
A61B17/1155,Circular staplers comprising a plurality of staples
A61B2017/07257,Stapler heads characterised by its anvil
A61B2017/07257,Stapler heads characterised by its anvil
G01N27/301,Reference electrodes
C08J2367/03,Polyesters derived from dicarboxylic acids and dihydroxy compounds the dicarboxylic acids and dihydroxy compounds having the hydroxy and the carboxyl groups directly linked to aromatic rings
F15C1/12,"Multiple arrangements thereof for performing operations of the same kind, e.g. majority gates, identity gates ; Counting circuits; Sliding registers"
E01B3/24,Slabs; Blocks; Pot sleepers; Fastening tie-rods to them
A61B18/085,"Forceps, scissors"
B27M1/02,"Working of wood not provided for in subclasses B27B - B27L, e.g. by stretching by compressing"
Y02W30/50,"Reuse, recycling or recovery technologies"
H10B12/373,DRAM devices comprising one-transistor - one-capacitor [1T-1C] memory cells the capacitor being at least partially in a trench in the substrate the capacitor extending under or around the transistor
H10B12/373,DRAM devices comprising one-transistor - one-capacitor [1T-1C] memory cells the capacitor being at least partially in a trench in the substrate the capacitor extending under or around the transistor
F16M13/02,"Other supports for positioning apparatus or articles; Means for steadying hand-held apparatus or articles for supporting on, or attaching to, an object, e.g. tree, gate, window-frame, cycle"
G10D13/08,"Multi-toned musical instruments with sonorous bars, blocks, forks, gongs, plates, rods or teeth"
G10D13/08,"Multi-toned musical instruments with sonorous bars, blocks, forks, gongs, plates, rods or teeth"
C13B30/023,"Continuous processes, apparatus therefor having rotatable means for agitation or transportation"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
H01L21/0214,"Forming insulating materials on a substrate characterised by the type of layer, e.g. type of material, porous/non-porous, pre-cursors, mixtures or laminates characterised by the material of the layer the material containing silicon the material containing Si, O, and at least one of H, N, C, F, or other non-metal elements, e.g. SiOC, SiOC:H or SiONC the material being a silicon oxynitride, e.g. SiON or SiON:H"
G06F13/1663,Access to shared memory
G06F13/1663,Access to shared memory
F01L2001/34473,Lock movement perpendicular to camshaft axis
F01L2001/34473,Lock movement perpendicular to camshaft axis
F01L2001/34426,Oil control valves
F01L2001/34426,Oil control valves
E21B29/02,"Cutting or destroying pipes, packers, plugs or wire lines, located in boreholes or wells, e.g. cutting of damaged pipes, of windows; Deforming of pipes in boreholes or wells; Reconditioning of well casings while in the ground by explosives or by thermal or chemical means"
G06K15/12,"Arrangements for producing a permanent visual presentation of the output data, e.g. computer output printers using printers by photographic printing, e.g. by laser printers"
G06K15/12,"Arrangements for producing a permanent visual presentation of the output data, e.g. computer output printers using printers by photographic printing, e.g. by laser printers"
D21H21/02,"Agents for preventing deposition on the paper mill equipment, e.g. pitch or slime control"
B24D7/06,"Bonded abrasive wheels, or wheels with inserted abrasive blocks, designed for acting otherwise than only by their periphery, e.g. by the front face; Bushings or mountings therefor with inserted abrasive blocks, e.g. segmental"
B24D7/06,"Bonded abrasive wheels, or wheels with inserted abrasive blocks, designed for acting o
Query:
-- Corrected Query 7
SELECT YEAR(TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value:"code"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
WHERE TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
  AND f.value:"code"::STRING IS NOT NULL
  AND f.value:"code"::STRING <> ''
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year", "filing_count" DESC
LIMIT 100
Answer:
filing_year,cpc_symbol,filing_count
1877,F01B25/10,1
1877,F01L15/06,1
1880,A01K13/006,2
1880,A01K13/008,2
1881,A63C1/04,1
1882,E04D1/2942,2
1882,E04D2001/3414,2
1882,E04D1/125,2
1882,E04D1/18,2
1882,E04D2001/3464,2
1883,G04B17/225,2
1885,H04N1/024,1
1885,B66F3/08,1
1885,F42B5/26,1
1887,E05C5/02,1
1888,A63H5/00,1
1889,G04B27/06,1
1889,G04C21/08,1
1890,G04B27/065,2
1890,G04B1/20,2
1890,G04B1/205,2
1891,A01D76/006,1
1891,G04B47/06,1
1892,F41A5/18,1
1892,G04B47/061,1
1892,F41A9/29,1
1892,F41A3/40,1
1892,F41A9/30,1
1892,F41A9/32,1
1893,F16H55/38,1
1894,B66B11/0492,2
1894,G04C13/0472,1
1894,G04C13/10,1
1894,G04B13/002,1
1894,C11D9/14,1
1894,G04B33/02,1
1894,C11D17/06,1
1894,F28D7/10,1
1894,F22B9/04,1
1894,A44B1/08,1
1895,A01K5/0275,2
1895,G06G3/00,1
1895,B23B5/168,1
1895,Y10T29/5134,1
1896,F23D91/02,2
1896,A41D25/027,1
1896,B65G7/12,1
1896,B01D5/0006,1
1896,B01D5/0012,1
1897,F41J7/00,1
1897,G04B45/0076,1
1897,B41F17/26,1
1897,F02D9/00,1
1897,D05B3/14,1
1897,F16D3/56,1
1897,A45C11/10,1
1898,B01J2208/00212,2
1898,A41C1/00,1
1898,B01J8/005,1
1898,B62D7/023,1
1898,H01R43/058,1
1898,C09D191/005,1
1898,F04B47/02,1
1898,Y10T137/7917,1
1898,Y10T74/18928,1
1898,F16K47/08,1
1898,E04F21/08,1
1898,D21H5/0062,1
1898,Y10T137/7847,1
1898,H02M1/22,1
1898,B21D1/06,1
1898,F16N7/32,1
1898,B62L5/04,1
1898,B63B59/08,1
1899,C25B9/70,2
1899,Y10S411/924,2
1899,C25B11/033,2
1899,Y10T74/20882,2
1899,A47B37/00,2
1899,Y10S411/925,2
1899,C25B9/303,2
1899,F16B39/04,2
1899,B61H13/24,2
1899,A47J43/26,1
1899,Y10S16/27,1
1899,C09B1/521,1
1899,E06B3/5454,1
1899,B60C7/24,1
1899,F23H7/06,1
1899,A44B3/02,1
1899,C03B9/165,1
1899,B65D85/02,1
1899,Y10T83/8804,1
1899,B62M17/00,1
1899,Y10T29/483,1
1899,Y10T24/3613,1
1899,F04B53/00,1
1899,B22D27/04,1
1899,G01R11/56,1
1899,B68G7/08,1
Query:
SELECT YEAR(TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
       f.value:"code"::STRING AS "cpc_symbol",
       COUNT(*) AS "filing_count"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."cpc") f
GROUP BY "filing_year", "cpc_symbol"
ORDER BY "filing_year" DESC, "filing_count" DESC
LIMIT 100;
Answer:
filing_year,cpc_symbol,filing_count
,B65H2701/31,14
,C08F10/00,13
,F23D11/44,11
,Y02E30/30,10
,Y02E10/20,10
,B29C48/03,10
,B62C5/04,9
,Y02E10/72,8
,Y02E60/10,8
,F23D3/00,8
,F02M1/00,8
,Y10S411/983,8
,F16H21/40,7
,H04Q3/00,7
,F03B3/00,7
,B61G1/06,7
,H04Q3/42,6
,H01L21/00,6
,B60L2200/26,6
,C10J3/00,6
,H01L29/00,6
,B29C43/00,6
,Y10T74/18184,6
,F16B39/32,6
,B60R21/34,6
,F16B39/10,6
,B61F15/22,6
,H03K21/00,6
,B65G2201/02,6
,F24B15/007,6
,F23D91/02,5
,G06C23/04,5
,B62C5/00,5
,B27F5/02,5
,E06B7/20,5
,D05B3/02,5
,A01L7/04,5
,B32B27/00,5
,F23D11/10,5
,F16G11/00,5
,G09F3/0352,5
,C10G9/00,5
,A01C7/08,5
,C08K5/098,5
,G08B13/08,5
,B29C48/345,4
,B60N2/847,4
,D06B5/00,4
,B07B1/00,4
,B61G1/40,4
,C07F9/005,4
,C10N2040/20,4
,B31B50/00,4
,B60B33/0002,4
,C10M2207/282,4
,B29C48/32,4
,G11C11/22,4
,B65D2203/00,4
,B67B7/24,4
,D06B2700/18,4
,H01L2924/01013,4
,B24D15/08,4
,C07C2531/24,4
,B60S1/166,4
,A45B21/00,4
,H01L2924/01074,4
,Y10T74/18144,4
,F24B5/04,4
,C07C2/465,4
,C10M2207/023,4
,A63C17/02,4
,C07F15/02,4
,C07C2/406,4
,B31B2160/10,4
,B05B11/06,4
,G01S1/02,4
,Y10S411/988,4
,D06F45/22,4
,B01J31/2404,4
,B01J31/2291,4
,A47L13/60,4
,B60B33/0042,4
,C10N2040/16,4
,B01J2531/847,4
,C08G2110/0058,4
,F04B47/00,4
,D03D49/06,4
,C10M2207/34,4
,D01D5/04,4
,B42F17/00,4
,E21B27/00,4
,C01B2203/0465,4
,E01D15/133,4
,C07F17/00,4
,B66C7/00,4
,A61M1/08,4
,C25D3/22,4
,A01B59/02,4
,H01R13/432,4
,Y02T10/12,4
End Exploring Related Columns
Task: Identify the CPC technology areas with the highest exponential moving average of patent filings each year (smoothing factor 0.2), and provide the full title and the best year for each CPC group at level 5.

Please answer only one complete SQL in snowflake dialect in ```sql``` format.
Usage example: ```sql
SELECT "COLUMN_NAME" FROM DATABASE.SCHEMA.TABLE WHERE ... ``` (Adjust "DATABASE", "SCHEMA", and "TABLE" to match actual names, ensure all column names are enclosed in double quotations)
Follow the answer format like: ```csv
CPC_Symbol,Full_Title,Best_Year
symbol1:str,titleFull1:str,year1:int
symbol2:str,titleFull2:str,year2:int
...
```

The table above lists the CPC technology areas at level 5 with the highest exponential moving average (EMA) of patent filings each year, using a smoothing factor of 0.2. For each CPC group, we've provided the symbol, the full title, and the best year—that is, the year with the highest number of patent filings in that group..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'PATENTS': {'PATENTS': ['CPC_DEFINITION', 'DISCLOSURES_13', 'PUBLICATIONS']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY xxx DESC, add NULLS LAST to exclude null records: ORDER BY xxx DESC NULLS LAST.
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.Keep all decimals to four decimal places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-27 01:45:55 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:45:55 - root - INFO - ```sql
WITH filings_per_year AS (
    SELECT
        c."symbol",
        c."titleFull",
        p."filing_year",
        COUNT(*) AS "filing_count"
    FROM
        (
            SELECT
                YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
                f.value:"code"::STRING AS "cpc_symbol"
            FROM
                PATENTS.PATENTS.PUBLICATIONS t,
                LATERAL FLATTEN(input => t."cpc") f
            WHERE
                TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
                AND f.value:"code"::STRING IS NOT NULL
        ) p
    JOIN PATENTS.PATENTS.CPC_DEFINITION c
        ON p."cpc_symbol" = c."symbol"
    WHERE c."level" = 5
    GROUP BY c."symbol", c."titleFull", p."filing_year"
),
current_year_cte AS (
    SELECT MAX("filing_year") AS "current_year" FROM filings_per_year
),
ema_per_symbol AS (
    SELECT
        p."symbol",
        p."titleFull",
        SUM(
            p."filing_count" * POWER(0.8::FLOAT, current_year_cte."current_year" - p."filing_year")
        ) * 0.2 AS "EMA"
    FROM
        filings_per_year p
    CROSS JOIN
        current_year_cte
    GROUP BY p."symbol", p."titleFull"
),
best_year_per_symbol AS (
    SELECT
        p."symbol",
        p."filing_year" AS "Best_Year",
        ROW_NUMBER() OVER (
            PARTITION BY p."symbol"
            ORDER BY p."filing_count" DESC, p."filing_year" DESC
        ) AS rn
    FROM
        filings_per_year p
)
SELECT
    e."symbol" AS "CPC_Symbol",
    e."titleFull" AS "Full_Title",
    b."Best_Year"
FROM
    ema_per_symbol e
JOIN best_year_per_symbol b
    ON e."symbol" = b."symbol" AND b.rn = 1
ORDER BY e."EMA" DESC NULLS LAST
LIMIT 100;
```
2025-01-27 01:45:55 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:45:55 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:45:55 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:45:56 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-27 01:45:56 - snowflake.connector.connection - INFO - closed
2025-01-27 01:45:56 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:45:57 - root - INFO - itercount: 1
2025-01-27 01:45:57 - root - INFO - No data found for the specified query.

2025-01-27 01:45:57 - root - INFO - Input sql:
WITH filings_per_year AS (
    SELECT
        c."symbol",
        c."titleFull",
        p."filing_year",
        COUNT(*) AS "filing_count"
    FROM
        (
            SELECT
                YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
                f.value:"code"::STRING AS "cpc_symbol"
            FROM
                PATENTS.PATENTS.PUBLICATIONS t,
                LATERAL FLATTEN(input => t."cpc") f
            WHERE
                TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
                AND f.value:"code"::STRING IS NOT NULL
        ) p
    JOIN PATENTS.PATENTS.CPC_DEFINITION c
        ON p."cpc_symbol" = c."symbol"
    WHERE c."level" = 5
    GROUP BY c."symbol", c."titleFull", p."filing_year"
),
current_year_cte AS (
    SELECT MAX("filing_year") AS "current_year" FROM filings_per_year
),
ema_per_symbol AS (
    SELECT
        p."symbol",
        p."titleFull",
        SUM(
            p."filing_count" * POWER(0.8::FLOAT, current_year_cte."current_year" - p."filing_year")
        ) * 0.2 AS "EMA"
    FROM
        filings_per_year p
    CROSS JOIN
        current_year_cte
    GROUP BY p."symbol", p."titleFull"
),
best_year_per_symbol AS (
    SELECT
        p."symbol",
        p."filing_year" AS "Best_Year",
        ROW_NUMBER() OVER (
            PARTITION BY p."symbol"
            ORDER BY p."filing_count" DESC, p."filing_year" DESC
        ) AS rn
    FROM
        filings_per_year p
)
SELECT
    e."symbol" AS "CPC_Symbol",
    e."titleFull" AS "Full_Title",
    b."Best_Year"
FROM
    ema_per_symbol e
JOIN best_year_per_symbol b
    ON e."symbol" = b."symbol" AND b.rn = 1
ORDER BY e."EMA" DESC NULLS LAST
LIMIT 100;
The error information is:
 No data found for the specified query.

2025-01-27 01:47:06 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:47:06 - root - INFO - I apologize for the inconvenience. The error occurs because the CPC symbols in the `PUBLICATIONS` table are more granular than those in the `CPC_DEFINITION` table at level 5. Specifically, the `CPC_DEFINITION` table contains CPC codes at higher levels (e.g., sections, classes, subclasses), whereas the `PUBLICATIONS` table contains full CPC codes, including groups and subgroups.

To correctly match the CPC codes from `PUBLICATIONS` with those in `CPC_DEFINITION` at level 5, we need to extract the section, class, and subclass from the CPC codes in the `PUBLICATIONS` table. This can be done by taking the first four characters of the CPC code (which correspond to the section, class, and subclass) and matching them with the symbols in the `CPC_DEFINITION` table.

Here is the corrected SQL query:

```sql
WITH filings_per_year AS (
    SELECT
        c."symbol",
        c."titleFull",
        p."filing_year",
        COUNT(*) AS "filing_count"
    FROM
        (
            SELECT
                YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
                SUBSTRING(f.value:"code"::STRING, 1, 4) AS "cpc_symbol"
            FROM
                PATENTS.PATENTS.PUBLICATIONS t,
                LATERAL FLATTEN(input => t."cpc") f
            WHERE
                TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
                AND f.value:"code"::STRING IS NOT NULL
        ) p
    JOIN PATENTS.PATENTS.CPC_DEFINITION c
        ON p."cpc_symbol" = c."symbol"
    WHERE c."level" = 5
    GROUP BY c."symbol", c."titleFull", p."filing_year"
),
current_year_cte AS (
    SELECT MAX("filing_year") AS "current_year" FROM filings_per_year
),
ema_per_symbol AS (
    SELECT
        p."symbol",
        p."titleFull",
        SUM(
            p."filing_count" * POWER(0.8::FLOAT, current_year_cte."current_year" - p."filing_year")
        ) * 0.2 AS "EMA"
    FROM
        filings_per_year p
    CROSS JOIN
        current_year_cte
    GROUP BY p."symbol", p."titleFull"
),
best_year_per_symbol AS (
    SELECT
        p."symbol",
        p."filing_year" AS "Best_Year",
        ROW_NUMBER() OVER (
            PARTITION BY p."symbol"
            ORDER BY p."filing_count" DESC, p."filing_year" DESC
        ) AS rn
    FROM
        filings_per_year p
)
SELECT
    e."symbol" AS "CPC_Symbol",
    e."titleFull" AS "Full_Title",
    b."Best_Year"
FROM
    ema_per_symbol e
JOIN best_year_per_symbol b
    ON e."symbol" = b."symbol" AND b.rn = 1
ORDER BY e."EMA" DESC NULLS LAST
LIMIT 100;
```

This query adjusts how the CPC symbols are extracted from the `PUBLICATIONS` table:

- **Extraction of CPC Symbols**: We use `SUBSTRING(f.value:"code"::STRING, 1, 4)` to extract the first four characters of the CPC code, corresponding to the section, class, and subclass, which aligns with the level 5 codes in `CPC_DEFINITION`.

- **Matching CPC Symbols**: We then join these extracted symbols with the `CPC_DEFINITION` table on the `symbol` column, filtered to `level = 5`.

**Explanation of the Steps**:

1. **filings_per_year CTE**: Extracts the number of filings per year for each CPC symbol at level 5.

2. **current_year_cte**: Determines the most recent filing year in the data.

3. **ema_per_symbol CTE**: Calculates the Exponential Moving Average (EMA) of filings for each CPC symbol. The smoothing factor is 0.2, so the weighting factor is `0.8` for older years.

4. **best_year_per_symbol CTE**: Identifies the year with the highest number of filings (`Best_Year`) for each CPC symbol.

5. **Final SELECT**: Retrieves the CPC symbols with the highest EMAs, along with their full titles and best years, ordered by the EMA in descending order.

**Note**: Ensure that your data in the `CPC_DEFINITION` table aligns with this extraction method. If the symbols in `CPC_DEFINITION` are of different lengths, you may need to adjust the `SUBSTRING` length accordingly.
2025-01-27 01:47:06 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:47:06 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:47:06 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:47:10 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:47:10 - snowflake.connector.connection - INFO - closed
2025-01-27 01:47:10 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:47:10 - root - INFO - itercount: 2
2025-01-27 01:47:10 - root - INFO - 0
2025-01-27 01:47:10 - root - INFO - results: 
CPC_Symbol,Full_Title,Best_Year
H01L,SEMICONDUCTOR DEVICES NOT COVERED BY CLASS H10,2018
A61K,"PREPARATIONS FOR MEDICAL, DENTAL OR TOILETRY PURPOSES",2016
G06F,ELECTRIC DIGITAL DATA PROCESSING,2019
A61B,DIAGNOSIS; SURGERY; IDENTIFICATION,2017
H04L,"TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION",2017
H04W,WIRELESS COMMUNICATION NETWORKS,2020
H01M,"PROCESSES OR MEANS, e.g. BATTERIES, FOR THE DIRECT CONVERSION OF CHEMICAL ENERGY INTO ELECTRICAL ENERGY",2017
H04N,"PICTORIAL COMMUNICATION, e.g. TELEVISION",2020
A61P,SPECIFIC THERAPEUTIC ACTIVITY OF CHEMICAL COMPOUNDS OR MEDICINAL PREPARATIONS,2017
G01N,INVESTIGATING OR ANALYSING MATERIALS BY DETERMINING THEIR CHEMICAL OR PHYSICAL PROPERTIES,2017
C07K,PEPTIDES,2017
B32B,"LAYERED PRODUCTS, i.e. PRODUCTS BUILT-UP OF STRATA OF FLAT OR NON-FLAT, e.g. CELLULAR OR HONEYCOMB, FORM",2017
G06T,"IMAGE DATA PROCESSING OR GENERATION, IN GENERAL",2021
A61M,"DEVICES FOR INTRODUCING MEDIA INTO, OR ONTO, THE BODY; DEVICES FOR TRANSDUCING BODY MEDIA OR FOR TAKING MEDIA FROM THE BODY; DEVICES FOR PRODUCING OR ENDING SLEEP OR STUPOR",2019
G06Q,"INFORMATION AND COMMUNICATION TECHNOLOGY [ICT] SPECIALLY ADAPTED FOR ADMINISTRATIVE, COMMERCIAL, FINANCIAL, MANAGERIAL OR SUPERVISORY PURPOSES; SYSTEMS OR METHODS SPECIALLY ADAPTED FOR ADMINISTRATIVE, COMMERCIAL, FINANCIAL, MANAGERIAL OR SUPERVISORY PURPOSES, NOT OTHERWISE PROVIDED FOR",2020
C12N,"MICROORGANISMS OR ENZYMES; COMPOSITIONS THEREOF; PROPAGATING, PRESERVING, OR MAINTAINING MICROORGANISMS; MUTATION OR GENETIC ENGINEERING; CULTURE MEDIA",2018
C07D,HETEROCYCLIC COMPOUNDS,2015
B01D,SEPARATION,2017
G02B,"OPTICAL ELEMENTS, SYSTEMS OR APPARATUS",2018
B29C,"SHAPING OR JOINING OF PLASTICS; SHAPING OF MATERIAL IN A PLASTIC STATE, NOT OTHERWISE PROVIDED FOR; AFTER-TREATMENT OF THE SHAPED PRODUCTS, e.g. REPAIRING",2017
A61F,"FILTERS IMPLANTABLE INTO BLOOD VESSELS; PROSTHESES; DEVICES PROVIDING PATENCY TO, OR PREVENTING COLLAPSING OF, TUBULAR STRUCTURES OF THE BODY, e.g. STENTS; ORTHOPAEDIC, NURSING OR CONTRACEPTIVE DEVICES; FOMENTATION; TREATMENT OR PROTECTION OF EYES OR EARS; BANDAGES, DRESSINGS OR ABSORBENT PADS; FIRST-AID KITS",2017
Y02E,"REDUCTION OF GREENHOUSE GAS [GHG] EMISSIONS, RELATED TO ENERGY GENERATION, TRANSMISSION OR DISTRIBUTION",2021
G06V,IMAGE OR VIDEO RECOGNITION OR UNDERSTANDING,2020
B01J,"CHEMICAL OR PHYSICAL PROCESSES, e.g. CATALYSIS OR COLLOID CHEMISTRY; THEIR RELEVANT APPARATUS",2017
H10K,ORGANIC ELECTRIC SOLID-STATE DEVICES,2017
G06N,COMPUTING ARRANGEMENTS BASED ON SPECIFIC COMPUTATIONAL MODELS,2020
B60W,CONJOINT CONTROL OF VEHICLE SUB-UNITS OF DIFFERENT TYPE OR DIFFERENT FUNCTION; CONTROL SYSTEMS SPECIALLY ADAPTED FOR HYBRID VEHICLES; ROAD VEHICLE DRIVE CONTROL SYSTEMS FOR PURPOSES NOT RELATED TO THE CONTROL OF A PARTICULAR SUB-UNIT,2020
G09G,ARRANGEMENTS OR CIRCUITS FOR CONTROL OF INDICATING DEVICES USING STATIC MEANS TO PRESENT VARIABLE INFORMATION,2018
C04B,"LIME, MAGNESIA; SLAG; CEMENTS; COMPOSITIONS THEREOF, e.g. MORTARS, CONCRETE OR LIKE BUILDING MATERIALS; ARTIFICIAL STONE; CERAMICS; REFRACTORIES; TREATMENT OF NATURAL STONE",2017
H02J,CIRCUIT ARRANGEMENTS OR SYSTEMS FOR SUPPLYING OR DISTRIBUTING ELECTRIC POWER; SYSTEMS FOR STORING ELECTRIC ENERGY,2017
Y02P,CLIMATE CHANGE MITIGATION TECHNOLOGIES IN THE PRODUCTION OR PROCESSING OF GOODS,2022
C02F,"TREATMENT OF WATER, WASTE WATER, SEWAGE, OR SLUDGE",2017
H05K,PRINTED CIRCUITS; CASINGS OR CONSTRUCTIONAL DETAILS OF ELECTRIC APPARATUS; MANUFACTURE OF ASSEMBLAGES OF ELECTRICAL COMPONENTS,2017
G01S,RADIO DIRECTION-FINDING; RADIO NAVIGATION; DETERMINING DISTANCE OR VELOCITY BY USE OF RADIO WAVES; LOCATING OR PRESENCE-DETECTING BY USE OF THE REFLECTION OR RERADIATION OF RADIO WAVES; ANALOGOUS ARRANGEMENTS USING OTHER WAVES,2020
H04B,TRANSMISSION,2018
C08L,COMPOSITIONS OF MACROMOLECULAR COMPOUNDS,2016
C08G,MACROMOLECULAR COMPOUNDS OBTAINED OTHERWISE THAN BY REACTIONS ONLY INVOLVING UNSATURATED CARBON-TO-CARBON BONDS,2016
C08K,Use of inorganic or non-macromolecular organic substances as compounding ingredients,2017
A61L,"METHODS OR APPARATUS FOR STERILISING MATERIALS OR OBJECTS IN GENERAL; DISINFECTION, STERILISATION OR DEODORISATION OF AIR; CHEMICAL ASPECTS OF BANDAGES, DRESSINGS, ABSORBENT PADS OR SURGICAL ARTICLES; MATERIALS FOR BANDAGES, DRESSINGS, ABSORBENT PADS OR SURGICAL ARTICLES",2018
C22C,ALLOYS,2016
C07C,ACYCLIC OR CARBOCYCLIC COMPOUNDS,2015
C23C,"COATING METALLIC MATERIAL; COATING MATERIAL WITH METALLIC MATERIAL; SURFACE TREATMENT OF METALLIC MATERIAL BY DIFFUSION INTO THE SURFACE, BY CHEMICAL CONVERSION OR SUBSTITUTION; COATING BY VACUUM EVAPORATION, BY SPUTTERING, BY ION IMPLANTATION OR BY CHEMICAL VAPOUR DEPOSITION, IN GENERAL",2017
Y02T,CLIMATE CHANGE MITIGATION TECHNOLOGIES RELATED TO TRANSPORTATION,2018
G02F,OPTICAL DEVICES OR ARRANGEMENTS FOR THE CONTROL OF LIGHT BY MODIFICATION OF THE OPTICAL PROPERTIES OF THE MEDIA OF THE ELEMENTS INVOLVED THEREIN; NON-LINEAR OPTICS; FREQUENCY-CHANGING OF LIGHT; OPTICAL LOGIC ELEMENTS; OPTICAL ANALOGUE/DIGITAL CONVERTERS,2016
B65D,"CONTAINERS FOR STORAGE OR TRANSPORT OF ARTICLES OR MATERIALS, e.g. BAGS, BARRELS, BOTTLES, BOXES, CANS, CARTONS, CRATES, DRUMS, JARS, TANKS, HOPPERS, FORWARDING CONTAINERS; ACCESSORIES, CLOSURES, OR FITTINGS THEREFOR; PACKAGING ELEMENTS; PACKAGES",2017
B60L,PROPULSION OF ELECTRICALLY-PROPELLED VEHICLES; SUPPLYING ELECTRIC POWER FOR AUXILIARY EQUIPMENT OF ELECTRICALLY-PROPELLED VEHICLES; ELECTRODYNAMIC BRAKE SYSTEMS FOR VEHICLES IN GENERAL; MAGNETIC SUSPENSION OR LEVITATION FOR VEHICLES; MONITORING OPERATING VARIABLES OF ELECTRICALLY-PROPELLED VEHICLES; ELECTRIC SAFETY DEVICES FOR ELECTRICALLY-PROPELLED VEHICLES,2013
G11C,STATIC STORES,2020
C08J,"WORKING-UP; GENERAL PROCESSES OF COMPOUNDING; AFTER-TREATMENT NOT COVERED BY SUBCLASSES C08B, C08C, C08F, C08G or C08H",2017
A63B,"APPARATUS FOR PHYSICAL TRAINING, GYMNASTICS, SWIMMING, CLIMBING, OR FENCING; BALL GAMES; TRAINING EQUIPMENT",2017
G01R,MEASURING ELECTRIC VARIABLES; MEASURING MAGNETIC VARIABLES,2018
Y02A,TECHNOLOGIES FOR ADAPTATION TO CLIMATE CHANGE,2022
B23K,"SOLDERING OR UNSOLDERING; WELDING; CLADDING OR PLATING BY SOLDERING OR WELDING; CUTTING BY APPLYING HEAT LOCALLY, e.g. FLAME CUTTING; WORKING BY LASER BEAM",2016
C09D,"COATING COMPOSITIONS, e.g. PAINTS, VARNISHES OR LACQUERS; FILLING PASTES; CHEMICAL PAINT OR INK REMOVERS; INKS; CORRECTING FLUIDS; WOODSTAINS; PASTES OR SOLIDS FOR COLOURING OR PRINTING; USE OF MATERIALS THEREFOR",2018
H01R,ELECTRICALLY-CONDUCTIVE CONNECTIONS; STRUCTURAL ASSOCIATIONS OF A PLURALITY OF MUTUALLY-INSULATED ELECTRICAL CONNECTING ELEMENTS; COUPLING DEVICES; CURRENT COLLECTORS,2018
B60K,"ARRANGEMENT OR MOUNTING OF PROPULSION UNITS OR OF TRANSMISSIONS IN VEHICLES; ARRANGEMENT OR MOUNTING OF PLURAL DIVERSE PRIME-MOVERS IN VEHICLES; AUXILIARY DRIVES FOR VEHICLES; INSTRUMENTATION OR DASHBOARDS FOR VEHICLES; ARRANGEMENTS IN CONNECTION WITH COOLING, AIR INTAKE, GAS EXHAUST OR FUEL SUPPLY OF PROPULSION UNITS IN VEHICLES",2017
H02K,DYNAMO-ELECTRIC MACHINES,2017
H04R,"LOUDSPEAKERS, MICROPHONES, GRAMOPHONE PICK-UPS OR LIKE ACOUSTIC ELECTROMECHANICAL TRANSDUCERS; DEAF-AID SETS; PUBLIC ADDRESS SYSTEMS",2019
C09K,"MATERIALS FOR MISCELLANEOUS APPLICATIONS, NOT PROVIDED FOR ELSEWHERE",2017
A23L,"FOODS, FOODSTUFFS, OR NON-ALCOHOLIC BEVERAGES, NOT COVERED BY SUBCLASSES A21D OR A23B-A23J; THEIR PREPARATION OR TREATMENT, e.g. COOKING, MODIFICATION OF NUTRITIVE QUALITIES, PHYSICAL TREATMENT; PRESERVATION OF FOODS OR FOODSTUFFS, IN GENERAL",2018
G05B,CONTROL OR REGULATING SYSTEMS IN GENERAL; FUNCTIONAL ELEMENTS OF SUCH SYSTEMS; MONITORING OR TESTING ARRANGEMENTS FOR SUCH SYSTEMS OR ELEMENTS,2018
G16H,"HEALTHCARE INFORMATICS, i.e. INFORMATION AND COMMUNICATION TECHNOLOGY [ICT] SPECIALLY ADAPTED FOR THE HANDLING OR PROCESSING OF MEDICAL OR HEALTHCARE DATA",2020
E21B,"EARTH OR ROCK DRILLING; OBTAINING OIL, GAS, WATER, SOLUBLE OR MELTABLE MATERIALS OR A SLURRY OF MINERALS FROM WELLS",2016
F24F,AIR-CONDITIONING; AIR-HUMIDIFICATION; VENTILATION; USE OF AIR CURRENTS FOR SCREENING,2016
A61N,ELECTROTHERAPY; MAGNETOTHERAPY; RADIATION THERAPY; ULTRASOUND THERAPY,2017
C12Q,"MEASURING OR TESTING PROCESSES INVOLVING ENZYMES, NUCLEIC ACIDS OR MICROORGANISMS; COMPOSITIONS OR TEST PAPERS THEREFOR; PROCESSES OF PREPARING SUCH COMPOSITIONS; CONDITION-RESPONSIVE CONTROL IN MICROBIOLOGICAL OR ENZYMOLOGICAL PROCESSES",2017
B60R,"VEHICLES, VEHICLE FITTINGS, OR VEHICLE PARTS, NOT OTHERWISE PROVIDED FOR",2017
G10L,SPEECH ANALYSIS TECHNIQUES OR SPEECH SYNTHESIS; SPEECH RECOGNITION; SPEECH OR VOICE PROCESSING TECHNIQUES; SPEECH OR AUDIO CODING OR DECODING,2019
H01J,ELECTRIC DISCHARGE TUBES OR DISCHARGE LAMPS,2017
C08F,MACROMOLECULAR COMPOUNDS OBTAINED BY REACTIONS ONLY INVOLVING CARBON-TO-CARBON UNSATURATED BONDS,2017
B01L,CHEMICAL OR PHYSICAL LABORATORY APPARATUS FOR GENERAL USE,2017
B22F,WORKING METALLIC POWDER; MANUFACTURE OF ARTICLES FROM METALLIC POWDER; MAKING METALLIC POWDER; APPARATUS OR DEVICES SPECIALLY ADAPTED FOR METALLIC POWDER,2017
H02M,"APPARATUS FOR CONVERSION BETWEEN AC AND AC, BETWEEN AC AND DC, OR BETWEEN DC AND DC, AND FOR USE WITH MAINS OR SIMILAR POWER SUPPLY SYSTEMS; CONVERSION OF DC OR AC INPUT POWER INTO SURGE OUTPUT POWER; CONTROL OR REGULATION THEREOF",2019
H05B,"ELECTRIC HEATING; ELECTRIC LIGHT SOURCES NOT OTHERWISE PROVIDED FOR; CIRCUIT ARRANGEMENTS FOR ELECTRIC LIGHT SOURCES, IN GENERAL",2016
F16H,GEARING,2017
B65G,"TRANSPORT OR STORAGE DEVICES, e.g. CONVEYORS FOR LOADING OR TIPPING, SHOP CONVEYOR SYSTEMS OR PNEUMATIC TUBE CONVEYORS",2018
H04M,TELEPHONIC COMMUNICATION,2018
H01Q,"ANTENNAS, i.e. RADIO AERIALS",2018
C09J,ADHESIVES; NON-MECHANICAL ASPECTS OF ADHESIVE PROCESSES IN GENERAL; ADHESIVE PROCESSES NOT PROVIDED FOR ELSEWHERE; USE OF MATERIALS AS ADHESIVES,2016
A61H,"PHYSICAL THERAPY APPARATUS, e.g. DEVICES FOR LOCATING OR STIMULATING REFLEX POINTS IN THE BODY; ARTIFICIAL RESPIRATION; MASSAGE; BATHING DEVICES FOR SPECIAL THERAPEUTIC OR HYGIENIC PURPOSES OR SPECIFIC PARTS OF THE BODY",2018
H01F,MAGNETS; INDUCTANCES; TRANSFORMERS; SELECTION OF MATERIALS FOR THEIR MAGNETIC PROPERTIES,2018
B25J,MANIPULATORS; CHAMBERS PROVIDED WITH MANIPULATION DEVICES,2018
G03F,"PHOTOMECHANICAL PRODUCTION OF TEXTURED OR PATTERNED SURFACES, e.g. FOR PRINTING, FOR PROCESSING OF SEMICONDUCTOR DEVICES; MATERIALS THEREFOR; ORIGINALS THEREFOR; APPARATUS SPECIALLY ADAPTED THEREFOR",2017
Y10T,TECHNICAL SUBJECTS COVERED BY FORMER US CLASSIFICATION,2005
C21D,"MODIFYING THE PHYSICAL STRUCTURE OF FERROUS METALS; GENERAL DEVICES FOR HEAT TREATMENT OF FERROUS OR NON-FERROUS METALS OR ALLOYS; MAKING METAL MALLEABLE, e.g. BY DECARBURISATION OR TEMPERING",2016
B41J,"TYPEWRITERS; SELECTIVE PRINTING MECHANISMS, i.e. MECHANISMS PRINTING OTHERWISE THAN FROM A FORME; CORRECTION OF TYPOGRAPHICAL ERRORS",2018
A01N,"PRESERVATION OF BODIES OF HUMANS OR ANIMALS OR PLANTS OR PARTS THEREOF; BIOCIDES, e.g. AS DISINFECTANTS, AS PESTICIDES OR AS HERBICIDES; PEST REPELLANTS OR ATTRACTANTS; PLANT GROWTH REGULATORS",2018
B65H,"HANDLING THIN OR FILAMENTARY MATERIAL, e.g. SHEETS, WEBS, CABLES",2020
C01B,NON-METALLIC ELEMENTS; COMPOUNDS THEREOF; METALLOIDS OR COMPOUNDS THEREOF NOT COVERED BY SUBCLASS C01C,2018
F17C,"VESSELS FOR CONTAINING OR STORING COMPRESSED, LIQUEFIED OR SOLIDIFIED GASES; FIXED-CAPACITY GAS-HOLDERS; FILLING VESSELS WITH, OR DISCHARGING FROM VESSELS, COMPRESSED, LIQUEFIED, OR SOLIDIFIED GASES",2021
G05D,SYSTEMS FOR CONTROLLING OR REGULATING NON-ELECTRIC VARIABLES,2019
G08G,TRAFFIC CONTROL SYSTEMS,2019
G06K,GRAPHICAL DATA READING; PRESENTATION OF DATA; RECORD CARRIERS; HANDLING RECORD CARRIERS,2020
A63F,"CARD, BOARD, OR ROULETTE GAMES; INDOOR GAMES USING SMALL MOVING PLAYING BODIES; VIDEO GAMES; GAMES NOT OTHERWISE PROVIDED FOR",2021
A24F,SMOKERS' REQUISITES; MATCH BOXES; SIMULATED SMOKING DEVICES,2021
A47L,DOMESTIC WASHING OR CLEANING; SUCTION CLEANERS IN GENERAL,2018
B62D,MOTOR VEHICLES; TRAILERS,2017
F21V,"FUNCTIONAL FEATURES OR DETAILS OF LIGHTING DEVICES OR SYSTEMS THEREOF; STRUCTURAL COMBINATIONS OF LIGHTING DEVICES WITH OTHER ARTICLES, NOT OTHERWISE PROVIDED FOR",2016
F16C,SHAFTS; FLEXIBLE SHAFTS; ELEMENTS OR CRANKSHAFT MECHANISMS; ROTARY BODIES OTHER THAN GEARING ELEMENTS; BEARINGS,2018
B01F,"MIXING, e.g. DISSOLVING, EMULSIFYING OR DISPERSING",2020
H10B,ELECTRONIC MEMORY DEVICES,2020


2025-01-27 01:47:10 - root - INFO - Please check the answer again by reviewing Identify the CPC technology areas with the highest exponential moving average of patent filings each year (smoothing factor 0.2), and provide the full title and the best year for each CPC group at level 5., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: ```csv
CPC_Symbol,Full_Title,Best_Year
symbol1:str,titleFull1:str,year1:int
symbol2:str,titleFull2:str,year2:int
...
```

The table above lists the CPC technology areas at level 5 with the highest exponential moving average (EMA) of patent filings each year, using a smoothing factor of 0.2. For each CPC group, we've provided the symbol, the full title, and the best year—that is, the year with the highest number of patent filings in that group. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Too long, hard cut:
CPC_Symbol,Full_Title,Best_Year
H01L,SEMICONDUCTOR DEVICES NOT COVERED BY CLASS H10,2018
A61K,"PREPARATIONS FOR MEDICAL, DENTAL OR TOILETRY PURPOSES",2016
G06F,ELECTRIC DIGITAL DATA PROCESSING,2019
A61B,DIAGNOSIS; SURGERY; IDENTIFICATION,2017
H04L,"TRANSMISSION OF DIGITAL INFORMATION, e.g. TELEGRAPHIC COMMUNICATION",2017
H04W,WIRELESS COMMUNICATION NETWORKS,2020
H01M,"PROCESSES OR MEANS, e.g. BATTERIES, FOR THE DIRECT CONVERSION OF CHEMICAL ENERGY INTO ELECTRICAL ENERGY",2017
H04N,"PICTORIAL COMMUNICATION, e.g. TELEVISION",2020
A61P,SPECIFIC THERAPEUTIC ACTIVITY OF CHEMICAL COMPOUNDS OR MEDICINAL PREPARATIONS,2017
G01N,INVESTIGATING OR ANALYSING MATERIALS BY DETERMINING THEIR CHEMICAL OR PHYSICAL PROPERTIES,2017
C07K,PEPTIDES,2017
B32B,"LAYERED PRODUCTS, i.e. PRODUCTS BUILT-UP OF STRATA OF FLAT OR NON-FLAT, e.g. CELLULAR OR HONEYCOMB, FORM",2017
G06T,"IMAGE DATA PROCESSING OR GENERATION, IN GENERAL",2021
A61M,"DEVICES FOR INTRODUCING MEDIA INTO, OR ONTO, THE BODY; DEVICES FOR TRANSDUCING BODY MEDIA OR FOR TAKING MEDIA FROM THE BODY; DEVICES FOR PRODUCING OR ENDING SLEEP OR STUPOR",2019
G06Q,"INFORMATION AND COMMUNICATION TECHNOLOGY [ICT] SPECIALLY ADAPTED FOR ADMINISTRATIVE, COMMERCIAL, FINANCIAL, MANAGERIAL OR SUPERVISORY PURPOSES; SYSTEMS OR METHODS SPECIALLY ADAPTED FOR ADMINISTRATIVE, COMMERCIAL, FINANCIAL, MANAGERIAL OR SUPERVISORY PURPOSES, NOT OTHERWISE PROVIDED FOR",2020
C12N,"MICROORGANISMS OR ENZYMES; COMPOSITIONS THEREOF; PROPAGATING, PRESERVING, OR MAINTAINING MICROORGANISMS; MUTATION OR GENETIC ENGINEERING; CULTURE MEDIA",2018
C07D,HETEROCYCLIC COMPOUNDS,2015
B01D,SEPARATION,2017
G02B,"OPTICAL ELEMENTS, SYSTEMS OR APPARATUS",2018
B29C,"SHAPING OR JOINING OF PLASTICS; SHAPING OF MATERIAL IN A PLASTIC STATE, NOT OTHERWISE PROVIDED FOR; AFTER-TREATMENT OF THE SHAPED PRODUCTS, e.g. REPAIRING",2017
A61F,"FILTERS IMPLANTABLE INTO BLOOD VESSELS; PROSTHESES; DEVICES PROVIDING PATENCY TO, OR PREVENTING COLLAPSING OF, TUBULAR STRUCTURES OF THE BODY, e.g. STENTS; ORTHOPAEDIC, NURSING OR CONTRACEPTIVE DEVICES; FOMENTATION; TREATMENT OR PROTECTION OF EYES OR EARS; BANDAGES, DRESSINGS OR ABSORBENT PADS; FIRST-AID KITS",2017
Y02E,"REDUCTION OF GREENHOUSE GAS [GHG] EMISSIONS, RELATED TO ENERGY GENERATION, TRANSMISSION OR DISTRIBUTION",2021
G06V,IMAGE OR VIDEO RECOGNITION OR UNDERSTANDING,2020
B01J,"CHEMICAL OR PHYSICAL PROCESSES, e.g. CATALYSIS OR COLLOID CHEMISTRY; THEIR RELEVANT APPARATUS",2017
H10K,ORGANIC ELECTRIC SOLID-STATE DEVICES,2017
G06N,COMPUTING ARRANGEMENTS BASED ON SPECIFIC COMPUTATIONAL MODELS,2020
B60W,CONJOINT CONTROL OF VEHICLE SUB-UNITS OF DIFFERENT TYPE OR DIFFERENT FUNCTION; CONTROL SYSTEMS SPECIALLY ADAPTED FOR HYBRID VEHICLES; ROAD VEHICLE DRIVE CONTROL SYSTEMS FOR PURPOSES NOT RELATED TO THE CONTROL OF A PARTICULAR SUB-UNIT,2020
G09G,ARRANGEMENTS OR CIRCUITS FOR CONTROL OF INDICATING DEVICES USING STATIC MEANS TO PRESENT VARIABLE INFORMATION,2018
C04B,"LIME, MAGNESIA; SLAG; CEMENTS; COMPOSITIONS THEREOF, e.g. MORTARS, CONCRETE OR LIKE BUILDING MATERIALS; ARTIFICIAL STONE; CERAMICS; REFRACTORIES; TREATMENT OF NATURAL STONE",2017
H02J,CIRCUIT ARRANGEMENTS OR SYSTEMS FOR SUPPLYING OR DISTRIBUTING ELECTRIC POWER; SYSTEMS FOR STORING ELECTRIC ENERGY,2017
Y02P,CLIMATE CHANGE MITIGATION TECHNOLOGIES IN THE PRODUCTION OR PROCESSING OF GOODS,2022
C02F,"TREATMENT OF WATER, WASTE WATER, SEWAGE, OR SLUDGE",2017
H05K,PRINTED CIRCUITS; CASINGS OR CONSTRUCTIONAL DETAILS OF ELECTRIC APPARATUS; MANUFACTURE OF ASSEMBLAGES OF ELECTRICAL COMPONENTS,2017
G01S,RADIO DIRECTION-FINDING; RADIO NAVIGATION; DETERMINING DISTANCE OR VELOCITY BY USE OF RADIO WAVES; LOCATING OR PRESENCE-DETECTING BY USE OF THE REFLECTION OR RERADIATION OF RADIO WAVES; ANALOGOUS ARRANGEMENTS USING OTHER WAVES,2020
H04B,TRANSMISSION,2018
C08L,COMPOSITIONS OF MACROMOLECULAR COMPOUNDS,2016
C08G,MACROMOLECULAR COMPOUNDS OBTAINED OTHERWISE THAN BY REACTIONS ONLY INVOLVING UNSATURATED CARBON-TO-CARBON BONDS,2016
C08K,Use of inorganic or non-macromolecular organic substances as compounding ingredients,2017
A61L,"METHODS OR APPARATUS FOR STERILISING MATERIALS OR OBJECTS IN GENERAL; DISINFECTION, STERILISATION OR DEODORISATION OF AIR; CHEMICAL ASPECTS OF BANDAGES, DRESSINGS, ABSORBENT PADS OR SURGICAL ARTICLES; MATERIALS FOR BANDAGES, DRESSINGS, ABSORBENT PADS OR SURGICAL ARTICLES",2018
C22C,ALLOYS,2016
C07C,ACYCLIC OR CARBOCYCLIC COMPOUNDS,2015
C23C,"COATING METALLIC MATERIAL; COATING MATERIAL WITH METALLIC MATERIAL; SURFACE TREATMENT OF METALLIC MATERIAL BY DIFFUSION INTO THE SURFACE, BY CHEMICAL CONVERSION OR SUBSTITUTION; COATING BY VACUUM EVAPORATION, BY SPUTTERING, BY ION IMPLANTATION OR BY CHEMICAL VAPOUR DEPOSITION, IN GENERAL",2017
Y02T,CLIMATE CHANGE MITIGATION TECHNOLOGIES RELATED TO TRANSPORTATION,2018
G02F,OPTICAL DEVICES OR ARRANGEMENTS FOR THE CONTROL OF LIGHT BY MODIFICATION OF THE OPTICAL PROPERTIES OF THE MEDIA OF THE ELEMENTS INVOLVED THEREIN; NON-LINEAR OPTICS; FREQUENCY-CHANGING OF LIGHT; OPTICAL LOGIC ELEMENTS; OPTICAL ANALOGUE/DIGITAL CONVERTERS,2016
B65D,"CONTAINERS FOR STORAGE OR TRANSPORT OF ARTICLES OR MATERIALS, e.g. BAGS, BARRELS, BOTTLES, BOXES, CANS, CARTONS, CRATES, DRUMS, JARS, TANKS, HOPPERS, FORWARDING CONTAINERS; ACCESSORIES, CLOSURES, OR FITTINGS THEREFOR; PACKAGING ELEMENTS; PACKAGES",2017
B60L,PROPULSION OF ELECTRICALLY-PROPELLED VEHICLES; SUPPLYING ELECTRIC POWER FOR AUXILIARY EQUIPMENT OF ELECTRICALLY-PROPELLED VEHICLES; ELECTRODYNAMIC BRAKE SYSTEMS FOR VEHICLES IN GENERAL; MAGNETIC SUSPENSION OR LEVITATION FOR VEHICLES; MONITORING OPERATING VARIABLES OF ELECTRICALLY-PROPELLED VEHICLES; ELECTRIC SAFETY DEVICES FOR ELECTRICALLY-PROPELLED VEHICLES,2013
G11C,STATIC STORES,2020
C08J,"WORKING-UP; GENERAL PROCESSES OF COMPOUNDING; AFTER-TREATMENT NOT COVERED BY SUBCLASSES C08B, C08C, C08F, C08G or C08H",2017
A63B,"APPARATUS FOR PHYSICAL TRAINING, GYMNASTICS, SWIMMING, CLIMBING, OR FENCING; BALL GAMES; TRAINING EQUIPMENT",2017
G01R,MEASURING ELECTRIC VARIABLES; MEASURING MAGNETIC VARIABLES,2018
Y02A,TECHNOLOGIES FOR ADAPTATION TO CLIMATE CHANGE,2022
B23K,"SOLDERING OR UNSOLDERING; WELDING; CLADDING OR PLATING BY SOLDERING OR WELDING; CUTTING BY APPLYING HEAT LOCALLY, e.g. FLAME CUTTING; WORKING BY LASER BEAM",2016
C09D,"COATING COMPOSITIONS, e.g. PAINTS, VARNISHES OR LACQUERS; FILLING PASTES; CHEMICAL PAINT OR INK REMOVERS; INKS; CORRECTING FLUIDS; WOODSTAINS; PASTES OR SOLIDS FOR COLOURING OR PRINTING; USE OF MATERIALS THEREFOR",2018
H01R,ELECTRICALLY-CONDUCTIVE CONNECTIONS; STRUCTURAL ASSOCIATIONS OF A PLURALITY OF MUTUALLY-INSULATED ELECTRICAL CONNECTING ELEMENTS; COUPLING DEVICES; CURRENT COLLECTORS,2018
B60K,"ARRANGEMENT OR MOUNTING OF PROPULSION UNITS OR OF TRANSMISSIONS IN VEHICLES; ARRANGEMENT OR MOUNTING OF PLURAL DIVERSE PRIME-MOVERS IN VEHICLES; AUXILIARY DRIVES FOR VEHICLES; INSTRUMENTATION OR DASHBOARDS FOR VEHICLES; ARRANGEMENTS IN CONNECTION WITH COOLING, AIR INTAKE, GAS EXHAUST OR FUEL SUPPLY OF PROPULSION UNITS IN VEHICLES",2017
H02K,DYNAMO-ELECTRIC MACHINES,2017
H04R,"LOUDSPEAKERS, MICROPHONES, GRAMOPHONE PICK-UPS OR LIKE ACOUSTIC ELECTROMECHANICAL TRANSDUCERS; DEAF-AID SETS; PUBLIC ADDRESS SYSTEMS",2019
C09K,"MATERIALS FOR MISCELLANEOUS APPLICATIONS, NOT PROVIDED FOR ELSEWHERE",2017
A23L,"FOODS, FOODSTUFFS, OR NON-ALCOHOLIC BEVERAGES, NOT COVERED BY SUBCLASSES A21D OR A23B-A23J; THEIR PREPARATION OR TREATMENT, e.g. COOKING, MODIFICATION OF NUTRITIVE QUALITIES, PHYSICAL TREATMENT; PRESERVATION OF FOODS OR FOODSTUFFS, IN GENERAL",2018
G05B,CONTROL OR REGULATING SYSTEMS IN GENERAL; FUNCTIONAL ELEMENTS OF SUCH SYSTEMS; MONITORING OR TESTING ARRANGEMENTS FOR SUCH SYSTEMS OR ELEMENTS,2018
G16H,"HEALTHCARE INFORMATICS, i.e. INFORMATION AND COMMUNICATION TECHNOLOGY [ICT] SPECIALLY ADAPTED FOR THE HANDLING OR PROCESSING OF MEDICAL OR HEALTHCARE DATA",2020
E21B,"EARTH OR ROCK DRILLING; OBTAINING OIL, GAS, WATER, SOLUBLE OR MELTABLE MATERIALS OR A SLURRY OF MINERALS FROM WELLS",2016
F24F,AIR-CONDITIONING; AIR-HUMIDIFICATION; VENTILATION; USE OF AIR CURRENTS FOR SCREENING,2016
A61N,ELECTROTHERAPY; MAGNETOTHERAPY; RADIATION THERAPY; ULTRASOUND THERAPY,2017
C12Q,"MEASURING OR TESTING PROCESSES INVOLVING ENZYMES, NUCLEIC ACIDS OR MICROORGANISMS; COMPOSITIONS OR TEST PAPERS THEREFOR; PROCESSES OF PREPARING SUCH COMPOSITIONS; CONDITION-RESPONSIVE CONTROL IN MICROBIOLOGICAL OR ENZYMOLOGICAL PROCESSES",2017
B60R,"VEHICLES, VEHICLE FITTINGS, OR VEHICLE PARTS, NOT OTHERWISE PROVIDED FOR",2017
G10L,SPEECH ANALYSIS TECHNIQUES OR SPEECH SYNTHESIS; SPEECH RECOGNITION; SPEECH OR VOICE PROCESSING TECHNIQUES; SPEECH OR AUDIO CODING OR DECODING,2019
H01J,ELECTRIC DISCHARGE TUBES OR DISCHARGE LAMPS,2017
C08F,MACROMOLECULAR COMPOUNDS OBTAINED BY REACTIONS ONLY INVOLVING CARBON-TO-CARBON UNSATURATED BONDS,2017
B01L,CHEMICAL OR PHYSICAL LABORATORY APPARATUS FOR GENERAL USE,2017
B22F,WORKING METALLIC POWDER; MANUFACTURE OF ARTICLES FROM METALLIC POWDER; MAKING METALLIC POWDER; APPARATUS OR DEVICES SPECIALLY ADAPTED FOR METALLIC POWDER,2017
H02M,"APPARATUS FOR CONVERSION BETWEEN AC AND AC, BETWEEN AC AND DC, OR BETWEEN DC AND DC, AND FOR USE WITH MAINS OR SIMILAR POWER SUPPLY SYSTEMS; CONVERSION OF DC OR AC INPUT POWER INTO SURGE OUTPUT POWER; CONTROL OR REGULATION THEREOF",2019
H05B,"ELECTRIC HEATING; ELECTRIC LIGHT SOURCES NOT OTHERWISE PROVIDED FOR; CIRCUIT ARRANGEMENTS FOR ELECTRIC LIGHT SOURCES, IN GENERAL",2016
F16H,GEARING,2017
B65G,"TRANSPORT OR STORAGE DEVICES, e.g. CONVEYORS FOR LOADING OR TIPPING, SHOP CONVEYOR SYSTEMS OR PNEUMATIC TUBE CONVEYORS",2018
H04M,TELEPHONIC COMMUNICATION,2018
H01Q,"ANTENNAS, i.e. RADIO AERIALS",2018
C09J,ADHESIVES; NON-MECHANICAL ASPECTS OF ADHESIVE PROCESSES IN GENERAL; ADHESIVE PROCESSES NOT PROVIDED FOR ELSEWHERE; USE OF MATERIALS AS ADHESIVES,2016
A61H,"PHYSICAL THERAPY APPARATUS, e.g. DEVICES FOR LOCATING OR STIMULATING REFLEX POINTS IN THE BODY; ARTIFICIAL RESPIRATION; MASSAGE; BATHING DEVICES FOR SPECIAL THERAPEUTIC OR HYGIENIC PURPOSES OR SPECIFIC PARTS OF THE BODY",2018
H01F,MAGNE
Current sql:
WITH filings_per_year AS (
    SELECT
        c."symbol",
        c."titleFull",
        p."filing_year",
        COUNT(*) AS "filing_count"
    FROM
        (
            SELECT
                YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
                SUBSTRING(f.value:"code"::STRING, 1, 4) AS "cpc_symbol"
            FROM
                PATENTS.PATENTS.PUBLICATIONS t,
                LATERAL FLATTEN(input => t."cpc") f
            WHERE
                TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
                AND f.value:"code"::STRING IS NOT NULL
        ) p
    JOIN PATENTS.PATENTS.CPC_DEFINITION c
        ON p."cpc_symbol" = c."symbol"
    WHERE c."level" = 5
    GROUP BY c."symbol", c."titleFull", p."filing_year"
),
current_year_cte AS (
    SELECT MAX("filing_year") AS "current_year" FROM filings_per_year
),
ema_per_symbol AS (
    SELECT
        p."symbol",
        p."titleFull",
        SUM(
            p."filing_count" * POWER(0.8::FLOAT, current_year_cte."current_year" - p."filing_year")
        ) * 0.2 AS "EMA"
    FROM
        filings_per_year p
    CROSS JOIN
        current_year_cte
    GROUP BY p."symbol", p."titleFull"
),
best_year_per_symbol AS (
    SELECT
        p."symbol",
        p."filing_year" AS "Best_Year",
        ROW_NUMBER() OVER (
            PARTITION BY p."symbol"
            ORDER BY p."filing_count" DESC, p."filing_year" DESC
        ) AS rn
    FROM
        filings_per_year p
)
SELECT
    e."symbol" AS "CPC_Symbol",
    e."titleFull" AS "Full_Title",
    b."Best_Year"
FROM
    ema_per_symbol e
JOIN best_year_per_symbol b
    ON e."symbol" = b."symbol" AND b.rn = 1
ORDER BY e."EMA" DESC NULLS LAST
LIMIT 100;
2025-01-27 01:48:25 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 01:48:25 - root - INFO - ```sql
WITH filings_per_year AS (
    SELECT
        c."symbol" AS "symbol",
        c."titleFull" AS "titleFull",
        YEAR(TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD')) AS "filing_year",
        COUNT(*) AS "filing_count"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."cpc") f
    JOIN PATENTS.PATENTS.CPC_DEFINITION c
        ON c."level" = 5
        AND c."symbol" = LEFT(f.value:"code"::STRING, LENGTH(c."symbol"))
    WHERE
        TRY_TO_DATE(t."filing_date"::VARCHAR, 'YYYYMMDD') IS NOT NULL
        AND f.value:"code"::STRING IS NOT NULL
    GROUP BY c."symbol", c."titleFull", "filing_year"
),
current_year_cte AS (
    SELECT MAX("filing_year") AS "current_year" FROM filings_per_year
),
ema_per_symbol AS (
    SELECT
        p."symbol",
        p."titleFull",
        ROUND(SUM(
            p."filing_count" * POWER(0.8::FLOAT, current_year_cte."current_year" - p."filing_year")
        ) * 0.2, 4) AS "EMA"
    FROM
        filings_per_year p
    CROSS JOIN
        current_year_cte
    GROUP BY p."symbol", p."titleFull"
),
best_year_per_symbol AS (
    SELECT
        p."symbol",
        p."filing_year" AS "Best_Year",
        ROW_NUMBER() OVER (
            PARTITION BY p."symbol"
            ORDER BY p."filing_count" DESC, p."filing_year" DESC
        ) AS rn
    FROM
        filings_per_year p
)
SELECT
    e."symbol" AS "CPC_Symbol",
    e."titleFull" AS "Full_Title",
    b."Best_Year"
FROM
    ema_per_symbol e
JOIN best_year_per_symbol b
    ON e."symbol" = b."symbol" AND b.rn = 1
ORDER BY e."EMA" DESC NULLS LAST
LIMIT 100;
```
2025-01-27 01:48:25 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-27 01:48:25 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-27 01:48:25 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-27 01:48:50 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-27 01:48:50 - snowflake.connector.connection - INFO - closed
2025-01-27 01:48:50 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-27 01:48:51 - root - INFO - itercount: 3
2025-01-27 01:48:51 - root - INFO - 0
2025-01-27 01:48:51 - root - INFO - Total iteration counts: 3
