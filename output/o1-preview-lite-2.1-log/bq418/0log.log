2025-01-26 20:33:32 - openai._base_client - INFO - Retrying request to /chat/completions in 0.386462 seconds
2025-01-26 20:34:57 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:35:40 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:35:40 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  WHERE i.drugName = 'sorafenib'
    AND i.targetSpecies = 'homo sapiens'
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE pw.species = 'Homo sapiens'
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.targetID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE i.drugName = 'sorafenib'
      AND i.targetSpecies = 'homo sapiens'
    GROUP BY pw.stable_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND i.drugName = 'sorafenib'
    AND i.targetSpecies = 'homo sapiens'
)
SELECT
  CASE WHEN t.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS Group,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_data t
GROUP BY 1, 2
UNION ALL
SELECT
  CASE WHEN nt.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS Group,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
) nt
WHERE nt.targetID NOT IN (SELECT targetID FROM target_data)
GROUP BY 1, 2;
```
2025-01-26 20:37:12 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:37:12 - root - INFO - ```sql
SELECT DISTINCT i.targetID, i.targetName, i.target_uniprotID
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
WHERE LOWER(ds.synonym) = 'sorafenib' AND LOWER(i.targetSpecies) = 'homo sapiens'
LIMIT 100;
```
2025-01-26 20:40:48 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:40:48 - root - INFO - SQL:
SELECT DISTINCT i.targetID, i.targetName, i.target_uniprotID
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
WHERE LOWER(ds.synonym) = 'sorafenib' AND LOWER(i.targetSpecies) = 'homo sapiens'
LIMIT 100;
Results:
targetID,targetName,target_uniprotID
3,ABL1,P00519
5,ALK,Q9UM73
10,BLK,P51451
11,BMX,P51813
12,BRAF,P15056
13,BTK,Q06187
14,CAMK1D,Q8IU85
15,CAMK2G,Q13555
24,CSF1R,P07333
27,CDK19,Q9BWU1
28,CDK4,P11802
30,CDK8,P49336
32,CYP19A1,P11511
35,DDR2,Q16832
36,EGFR,P00533
37,ERBB2,P04626
42,FGFR1,P11362
43,FGFR2,P21802
44,FLT1,P17948
45,FLT3,P36888
46,FLT4,P35916
48,FYN,P06241
49,FRK,P42685
69,IGF1R,P08069
70,INSR,P06213
73,JAK1,P23458
74,JAK2,O60674
75,JAK3,P52333
76,KDR,P35968
77,KIT,P10721
78,LYN,P07948
79,MTOR,P42345
80,MET,P08581
82,MAP2K1,Q02750
83,MAP2K2,P36507
84,MAP2K7,O14733
85,MAP4K5,Q9Y4K4
90,PIK3CA,P42336
91,PIK3CB,P42338
92,PIK3CD,O00329
93,PIK3CG,P48736
95,PDGFRB,P09619
97,PLK4,O00444
104,RAF1,P04049
109,RET,P07949
112,STK10,O94804
113,STK24,Q9Y6E0
114,STK4,Q13043
116,SRC,P12931
125,TSSK1B,Q9BXA7
132,TXK,P42681
133,TYK2,P29597
134,TNK2,Q07912
153,FGFR4,P22455
154,FGFR3,P22607
195,NTRK1,P04629
196,PDGFRA,P16234
197,DDR1,Q08345
212,HTR1A,P08908
222,IKBKB,O14920
225,MAPK3,P27361
226,MAPK1,P28482
227,AKT1,P31749
236,EPHA2,P29317
237,LCK,P06239
238,YES1,P07947
240,ABL2,P42684
250,PTK6,Q13882
251,TEK,Q02763
252,ITK,Q08881
256,HCK,P08631
257,CDK2,P24941
258,MAP3K2,Q9Y2U5

2025-01-26 20:41:52 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:41:52 - root - INFO - ```sql
SELECT i.targetID, i.targetName, e.exp_assayValueMedian, e.exp_assayValueLow, e.exp_assayValueHigh
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian IS NOT NULL
  AND e.exp_assayValueLow IS NOT NULL
  AND e.exp_assayValueHigh IS NOT NULL
LIMIT 100;
```

This query selects targets associated with 'sorafenib' for the species 'homo sapiens', ensuring that the assay value columns (`exp_assayValueMedian`, `exp_assayValueLow`, and `exp_assayValueHigh`) are not empty by adding `IS NOT NULL` conditions. This should provide records where all these columns have non-empty values.
2025-01-26 20:42:42 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:42:42 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens'
),
target_pathways AS (
  SELECT DISTINCT i.targetID, pw.pathway_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pathway_id, COUNT(DISTINCT targetID) AS target_count
    FROM target_pathways
    GROUP BY pathway_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
targets_in_top3 AS (
  SELECT DISTINCT targetID
  FROM target_pathways
  WHERE pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT DISTINCT targetID
  FROM target_data
  WHERE targetID NOT IN (SELECT targetID FROM targets_in_top3)
),
non_targets AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_in_top3 AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_outside_top3 AS (
  SELECT targetID
  FROM non_targets
  WHERE targetID NOT IN (SELECT targetID FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_outside_top3;
```

This simplified query gathers the counts of targets and non-targets within and outside the top 3 pathways associated with 'sorafenib' for the species 'homo sapiens', without the assay value conditions and other restrictive filters to ensure that data is returned.
2025-01-26 20:44:11 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:44:11 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens'
),
target_pathways AS (
  SELECT DISTINCT i.targetID, pw.pathway_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pathway_id, COUNT(DISTINCT targetID) AS target_count
    FROM target_pathways
    GROUP BY pathway_id
    ORDER BY target_count DESC
    LIMIT 3
  ) AS tp
),
targets_in_top3 AS (
  SELECT DISTINCT targetID
  FROM target_pathways
  WHERE pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT DISTINCT targetID
  FROM target_data
  WHERE targetID NOT IN (SELECT targetID FROM targets_in_top3)
),
non_targets AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_in_top3 AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_outside_top3 AS (
  SELECT targetID
  FROM non_targets
  WHERE targetID NOT IN (SELECT targetID FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_outside_top3;
```
2025-01-26 20:44:12 - root - INFO - SQL:
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens'
),
target_pathways AS (
  SELECT DISTINCT i.targetID, pw.pathway_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pathway_id, COUNT(DISTINCT targetID) AS target_count
    FROM target_pathways
    GROUP BY pathway_id
    ORDER BY target_count DESC
    LIMIT 3
  ) AS tp
),
targets_in_top3 AS (
  SELECT DISTINCT targetID
  FROM target_pathways
  WHERE pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT DISTINCT targetID
  FROM target_data
  WHERE targetID NOT IN (SELECT targetID FROM targets_in_top3)
),
non_targets AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_in_top3 AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_outside_top3 AS (
  SELECT targetID
  FROM non_targets
  WHERE targetID NOT IN (SELECT targetID FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_outside_top3;
Results:
400 Syntax error: Unexpected keyword GROUP at [63:30]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword GROUP at [63:30]

Location: US
Job ID: 21b71240-426c-4a49-88c1-eead04a4793b

2025-01-26 20:44:14 - root - INFO - SQL:
-- Corrected Query 2
SELECT i.targetID, i.targetName, e.exp_assayValueMedian
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
LIMIT 100
Results:
targetID,targetName,exp_assayValueMedian
3,ABL1,48.0
3,ABL1,48.0
3,ABL1,48.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,68.0
3,ABL1,68.0
3,ABL1,68.0
3,ABL1,39.0
3,ABL1,39.0
3,ABL1,39.0
3,ABL1,25.0
3,ABL1,25.0
3,ABL1,25.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,16.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,3.0
12,BRAF,3.0
12,BRAF,3.0
12,BRAF,54.0
12,BRAF,54.0
12,BRAF,54.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,26.0
12,BRAF,26.0
12,BRAF,26.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,46.0
12,BRAF,46.0
12,BRAF,46.0
12,BRAF,76.2
12,BRAF,76.2
12,BRAF,76.2
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,15.0
12,BRAF,15.0
12,BRAF,15.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,3.0
12,BRAF,3.0

2025-01-26 20:44:16 - root - INFO - SQL:
-- Corrected Query 3
SELECT DISTINCT i.targetID, i.targetName, p.stable_id AS pe_stable_id
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
WHERE LOWER(ds.synonym) = 'sorafenib' AND LOWER(i.targetSpecies) = 'homo sapiens'
LIMIT 100
Results:
targetID,targetName,pe_stable_id
3,ABL1,R-HSA-375987
3,ABL1,R-HSA-5686576
3,ABL1,R-HSA-5686579
3,ABL1,R-HSA-8942610
3,ABL1,R-HSA-8985251
5,ALK,R-HSA-201502
5,ALK,R-HSA-201535
5,ALK,R-HSA-9699794
5,ALK,R-HSA-9699797
5,ALK,R-HSA-9699800
5,ALK,R-HSA-9699801
5,ALK,R-HSA-9699802
5,ALK,R-HSA-9699818
5,ALK,R-HSA-9699821
5,ALK,R-HSA-9699826
5,ALK,R-HSA-9699828
5,ALK,R-HSA-9699831
5,ALK,R-HSA-9699836
5,ALK,R-HSA-9699838
5,ALK,R-HSA-9699840
5,ALK,R-HSA-9699841
5,ALK,R-HSA-9699853
5,ALK,R-HSA-9699880
5,ALK,R-HSA-9699882
5,ALK,R-HSA-9699891
5,ALK,R-HSA-9699902
5,ALK,R-HSA-9699906
5,ALK,R-HSA-9699908
5,ALK,R-HSA-9699910
5,ALK,R-HSA-9699913
5,ALK,R-HSA-9699915
5,ALK,R-HSA-9699916
5,ALK,R-HSA-9699921
5,ALK,R-HSA-9700435
5,ALK,R-HSA-9700462
5,ALK,R-HSA-9700464
5,ALK,R-HSA-9700465
5,ALK,R-HSA-9700466
5,ALK,R-HSA-9700470
5,ALK,R-HSA-9700472
5,ALK,R-HSA-9700473
5,ALK,R-HSA-9700476
5,ALK,R-HSA-9700477
5,ALK,R-HSA-9700480
5,ALK,R-HSA-9700482
5,ALK,R-HSA-9700484
5,ALK,R-HSA-9700486
5,ALK,R-HSA-9700489
5,ALK,R-HSA-9701418
5,ALK,R-HSA-9701426
5,ALK,R-HSA-9701427
5,ALK,R-HSA-9701428
5,ALK,R-HSA-9701433
5,ALK,R-HSA-9701434
5,ALK,R-HSA-9701818
5,ALK,R-HSA-9701826
5,ALK,R-HSA-9701835
5,ALK,R-HSA-9701836
5,ALK,R-HSA-9701838
5,ALK,R-HSA-9701841
5,ALK,R-HSA-9701842
5,ALK,R-HSA-9701860
5,ALK,R-HSA-9701868
5,ALK,R-HSA-9701883
5,ALK,R-HSA-9714054
5,ALK,R-HSA-9714063
5,ALK,R-HSA-9715260
5,ALK,R-HSA-9715261
5,ALK,R-HSA-9715262
5,ALK,R-HSA-9715263
5,ALK,R-HSA-9715265
5,ALK,R-HSA-9715266
5,ALK,R-HSA-9715267

2025-01-26 20:44:18 - root - INFO - SQL:
-- Corrected Query 4
SELECT DISTINCT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Results:
targetID,targetName,pathway_id,pathway_name
104,RAF1,R-HSA-5673000,RAF activation
104,RAF1,R-HSA-9726840,SHOC2 M1731 mutant abolishes MRAS complex function
104,RAF1,R-HSA-9726842,Gain-of-function MRAS complexes activate RAF signaling
82,MAP2K1,R-HSA-5684264,MAP3K8 (TPL2)-dependent MAPK1/3 activation
82,MAP2K1,R-HSA-110056,MAPK3 (ERK1) activation
82,MAP2K1,R-HSA-170968,Frs2-mediated activation
82,MAP2K1,R-HSA-445144,Signal transduction by L1
82,MAP2K1,R-HSA-5673000,RAF activation
82,MAP2K1,R-HSA-5674135,MAP2K and MAPK activation
82,MAP2K1,R-HSA-5674499,Negative feedback regulation of MAPK pathway
82,MAP2K1,R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants
82,MAP2K1,R-HSA-6802948,Signaling by high-kinase activity BRAF mutants
82,MAP2K1,R-HSA-6802952,Signaling by BRAF and RAF1 fusions
82,MAP2K1,R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF
82,MAP2K1,R-HSA-9649948,Signaling downstream of RAS mutants
82,MAP2K1,R-HSA-9656223,Signaling by RAF1 mutants
225,MAPK3,R-HSA-444257,RSK activation
225,MAPK3,R-HSA-110056,MAPK3 (ERK1) activation
225,MAPK3,R-HSA-170968,Frs2-mediated activation
225,MAPK3,R-HSA-445144,Signal transduction by L1
225,MAPK3,R-HSA-456926,Thrombin signalling through proteinase activated receptors (PARs)
225,MAPK3,R-HSA-982772,Growth hormone receptor signaling
225,MAPK3,R-HSA-1295596,Spry regulation of FGF signaling
225,MAPK3,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
225,MAPK3,R-HSA-3371453,Regulation of HSF1-mediated heat shock response
225,MAPK3,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
225,MAPK3,R-HSA-5668599,RHO GTPases Activate NADPH Oxidases
225,MAPK3,R-HSA-5674135,MAP2K and MAPK activation
225,MAPK3,R-HSA-5674499,Negative feedback regulation of MAPK pathway
225,MAPK3,R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants
225,MAPK3,R-HSA-6802948,Signaling by high-kinase activity BRAF mutants
225,MAPK3,R-HSA-6802952,Signaling by BRAF and RAF1 fusions
225,MAPK3,R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF
225,MAPK3,R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling"
225,MAPK3,R-HSA-8943724,Regulation of PTEN gene transcription
225,MAPK3,R-HSA-9627069,Regulation of the apoptosome activity
225,MAPK3,R-HSA-9649948,Signaling downstream of RAS mutants
225,MAPK3,R-HSA-9652169,Signaling by MAP2K mutants
225,MAPK3,R-HSA-9656223,Signaling by RAF1 mutants
225,MAPK3,R-HSA-9664422,FCGR3A-mediated phagocytosis

2025-01-26 20:44:20 - root - INFO - SQL:
-- Corrected Query 5
SELECT DISTINCT pp.pathway_stable_id, pw.name AS pathway_name
FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Results:
pathway_stable_id,pathway_name
R-HSA-68616,Assembly of the ORC complex at the origin of replication
R-HSA-68689,CDC6 association with the ORC:origin complex
R-HSA-68827,CDT1 association with the CDC6:ORC:origin complex
R-HSA-68881,Mitotic Metaphase/Anaphase Transition
R-HSA-68911,G2 Phase
R-HSA-68949,Orc1 removal from chromatin
R-HSA-68952,DNA replication initiation
R-HSA-68962,Activation of the pre-replicative complex
R-HSA-69017,CDK-mediated phosphorylation and removal of Cdc6
R-HSA-69091,Polymerase switching
R-HSA-69166,Removal of the Flap Intermediate
R-HSA-69200,Phosphorylation of proteins involved in G1/S transition by active Cyclin E:Cdk2 complexes
R-HSA-69205,G1/S-Specific Transcription
R-HSA-69231,Cyclin D associated events in G1
R-HSA-69416,Dimerization of procaspase-8
R-HSA-69478,G2/M DNA replication checkpoint
R-HSA-69601,Ubiquitin Mediated Degradation of Phosphorylated Cdc25A
R-HSA-69895,Transcriptional  activation of  cell cycle inhibitor p21 
R-HSA-70221,Glycogen breakdown (glycogenolysis)
R-HSA-70263,Gluconeogenesis
R-HSA-70350,Fructose catabolism
R-HSA-70370,Galactose catabolism
R-HSA-70635,Urea cycle
R-HSA-70688,Proline catabolism
R-HSA-70895,Branched-chain amino acid catabolism
R-HSA-70921,Histidine catabolism
R-HSA-71032,Propionyl-CoA catabolism
R-HSA-71064,Lysine catabolism
R-HSA-71240,Tryptophan catabolism
R-HSA-71262,Carnitine synthesis
R-HSA-71288,Creatine metabolism
R-HSA-71384,Ethanol oxidation
R-HSA-71403,Citric acid cycle (TCA cycle)
R-HSA-71737,Pyrophosphate hydrolysis
R-HSA-72086,mRNA Capping
R-HSA-72163,mRNA Splicing - Major Pathway
R-HSA-72165,mRNA Splicing - Minor Pathway
R-HSA-72187,mRNA 3'-end processing
R-HSA-72649,Translation initiation complex formation
R-HSA-72689,Formation of a pool of free 40S subunits
R-HSA-72695,"Formation of the ternary complex, and subsequently, the 43S complex"
R-HSA-72702,Ribosomal scanning and start codon recognition
R-HSA-72706,GTP hydrolysis and joining of the 60S ribosomal subunit
R-HSA-72731,Recycling of eIF2:GDP
R-HSA-72764,Eukaryotic Translation Termination
R-HSA-73614,Pyrimidine salvage
R-HSA-73621,Pyrimidine catabolism
R-HSA-73728,RNA Polymerase I Promoter Opening
R-HSA-73762,RNA Polymerase I Transcription Initiation
R-HSA-73772,RNA Polymerase I Promoter Escape
R-HSA-73776,RNA Polymerase II Promoter Escape
R-HSA-73779,RNA Polymerase II Transcription Pre-Initiation And Promoter Opening
R-HSA-73817,Purine ribonucleoside monophosphate biosynthesis
R-HSA-73843,5-Phosphoribose 1-diphosphate biosynthesis
R-HSA-73856,RNA Polymerase II Transcription Termination
R-HSA-73863,RNA Polymerase I Transcription Termination

2025-01-26 20:44:22 - root - INFO - SQL:
-- Corrected Query 6
SELECT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
  AND LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Results:
targetID,targetName,pathway_id,pathway_name
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)

2025-01-26 20:44:24 - root - INFO - SQL:
-- Corrected Query 7
SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
  AND LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
GROUP BY pw.stable_id, pw.name
ORDER BY target_count DESC
LIMIT 100
Results:
pathway_id,pathway_name,target_count
R-HSA-2219530,Constitutive Signaling by Aberrant PI3K in Cancer,6
R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling",6
R-HSA-195399,VEGF binds to VEGFR leading to receptor dimerization,3
R-HSA-444257,RSK activation,3
R-HSA-199920,CREB phosphorylation,3
R-HSA-186763,Downstream signal transduction,3
R-HSA-6804756,Regulation of TP53 Activity through Phosphorylation,3
R-HSA-1236382,Constitutive Signaling by Ligand-Responsive EGFR Cancer Variants,2
R-HSA-5637810,Constitutive Signaling by EGFRvIII,2
R-HSA-6802952,Signaling by BRAF and RAF1 fusions,2
R-HSA-9726842,Gain-of-function MRAS complexes activate RAF signaling,2
R-HSA-9664565,Signaling by ERBB2 KD Mutants,2
R-HSA-8866910,TFAP2 (AP-2) family regulates transcription of growth factors and their receptors,2
R-HSA-9673770,Signaling by PDGFRA extracellular domain mutants,2
R-HSA-6802948,Signaling by high-kinase activity BRAF mutants,2
R-HSA-180292,GAB1 signalosome,2
R-HSA-1963642,PI3K events in ERBB2 signaling,2
R-HSA-194306,Neurophilin interactions with VEGF and VEGFR,2
R-HSA-2559582,Senescence-Associated Secretory Phenotype (SASP),2
R-HSA-9670439,"Signaling by phosphorylated juxtamembrane, extracellular and kinase domain KIT mutants",2
R-HSA-5673000,RAF activation,2
R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF,2
R-HSA-9649948,Signaling downstream of RAS mutants,2
R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants,2
R-HSA-9673767,"Signaling by PDGFRA transmembrane, juxtamembrane and kinase domain mutants",2
R-HSA-9656223,Signaling by RAF1 mutants,2
R-HSA-8853659,RET signaling,2
R-HSA-9665348,Signaling by ERBB2 ECD mutants,2
R-HSA-9726840,SHOC2 M1731 mutant abolishes MRAS complex function,2
R-HSA-525793,Myogenesis,2
R-HSA-5621575,CD209 (DC-SIGN) signaling,2
R-HSA-5674135,MAP2K and MAPK activation,2
R-HSA-8853334,Signaling by FGFR3 fusions in cancer,2
R-HSA-5674499,Negative feedback regulation of MAPK pathway,2
R-HSA-5578775,Ion homeostasis,1
R-HSA-141444,Amplification  of signal from unattached  kinetochores via a MAD2  inhibitory signal,1
R-HSA-445144,Signal transduction by L1,1
R-HSA-2173796,SMAD2/SMAD3:SMAD4 heterotrimer regulates transcription,1
R-HSA-1989781,PPARA activates gene expression,1
R-HSA-381340,Transcriptional regulation of white adipocyte differentiation,1
R-HSA-8857538,PTK6 promotes HIF1A stabilization,1
R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks,1
R-HSA-8853884,Transcriptional Regulation by VENTX,1
R-HSA-449836,Other interleukin signaling,1
R-HSA-2644606,Constitutive Signaling by NOTCH1 PEST Domain Mutants,1

2025-01-26 20:44:26 - root - INFO - SQL:
-- Corrected Query 8
SELECT pathway_id, pathway_name, target_count
FROM (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
    AND LOWER(pw.species) = 'homo sapiens'
    AND pw.lowest_level = TRUE
  GROUP BY pw.stable_id, pw.name
  ORDER BY target_count DESC
  LIMIT 3
)
LIMIT 100
Results:
pathway_id,pathway_name,target_count
R-HSA-2219530,Constitutive Signaling by Aberrant PI3K in Cancer,6
R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling",6
R-HSA-195399,VEGF binds to VEGFR leading to receptor dimerization,3

2025-01-26 20:45:48 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:45:48 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens' AND pw.lowest_level = TRUE
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.targetID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
    JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE LOWER(ds.synonym) = 'sorafenib'
      AND LOWER(i.targetSpecies) = 'homo sapiens'
      AND e.exp_assayValueMedian <= 100
      AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
      AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
      AND LOWER(pp.evidence_code) = 'tas'
    GROUP BY pw.stable_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
),
non_target_ids AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_in_top3 AS (
  SELECT DISTINCT nt.targetID
  FROM non_target_ids nt
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON nt.targetID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT nt.targetID
  FROM non_target_ids nt
  WHERE nt.targetID NOT IN (SELECT targetID FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT targetID
  FROM target_data
  WHERE targetID NOT IN (SELECT targetID FROM target_in_top3)
) t
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM non_targets_outside_top3
LIMIT 100;
```
2025-01-26 20:47:10 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:47:10 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens' AND pw.lowest_level = TRUE
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.pathway_id, COUNT(DISTINCT i.targetID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
    JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE LOWER(ds.synonym) = 'sorafenib'
      AND LOWER(i.targetSpecies) = 'homo sapiens'
      AND e.exp_assayValueMedian <= 100
      AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
      AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
      AND LOWER(pp.evidence_code) = 'tas'
    GROUP BY pw.pathway_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
)
SELECT
  CASE WHEN t.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_data t
GROUP BY 1, 2
UNION ALL
SELECT
  CASE WHEN nt.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
) nt
WHERE nt.targetID NOT IN (SELECT targetID FROM target_data)
GROUP BY 1, 2
LIMIT 100;
```
2025-01-26 20:48:07 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:48:07 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens' AND pw.lowest_level = TRUE
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.target_uniprotID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
    JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE LOWER(ds.synonym) = 'sorafenib'
      AND LOWER(i.targetSpecies) = 'homo sapiens'
      AND e.exp_assayValueMedian <= 100
      AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
      AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
      AND LOWER(pp.evidence_code) = 'tas'
    GROUP BY pw.stable_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
)
SELECT
  CASE WHEN t.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_data t
GROUP BY 1, 2
UNION ALL
SELECT
  CASE WHEN nt.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT DISTINCT p.uniprot_id AS target_uniprotID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
) nt
WHERE nt.target_uniprotID NOT IN (SELECT target_uniprotID FROM target_data)
GROUP BY 1, 2
LIMIT 100;
```
2025-01-26 20:48:08 - root - INFO - SQL:
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens' AND pw.lowest_level = TRUE
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.target_uniprotID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
    JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE LOWER(ds.synonym) = 'sorafenib'
      AND LOWER(i.targetSpecies) = 'homo sapiens'
      AND e.exp_assayValueMedian <= 100
      AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
      AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
      AND LOWER(pp.evidence_code) = 'tas'
    GROUP BY pw.stable_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
)
SELECT
  CASE WHEN t.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_data t
GROUP BY 1, 2
UNION ALL
SELECT
  CASE WHEN nt.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT DISTINCT p.uniprot_id AS target_uniprotID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
) nt
WHERE nt.target_uniprotID NOT IN (SELECT target_uniprotID FROM target_data)
GROUP BY 1, 2
LIMIT 100;
Results:
400 Name stable_id not found inside pw at [20:15]; reason: invalidQuery, location: query, message: Name stable_id not found inside pw at [20:15]

Location: US
Job ID: 817527ed-bdd6-412c-9f56-6c89b4c020ff

2025-01-26 20:48:08 - root - INFO - itercount: 0
2025-01-26 20:48:08 - root - INFO - Database Name: isb-cgc-bq
Schema Name: reactome_versioned
DDL describes table information.
,0
table_name,pathway_hierarchy_v77
ddl,"CREATE TABLE `isb-cgc-bq.reactome_versioned.pathway_hierarchy_v77`
(
  parent_id STRING OPTIONS(description=""Reactome pathway stable identifier associated with 'child' pathways""),
  child_id STRING OPTIONS(description=""Reactome pathway stable identifier associated with 'parent' pathways"")
)
OPTIONS(
  friendly_name=""REACTOME PATHWAYS HIERARCHY V77 VERSIONED"",
  description=""Reactome pathways parent to child hierarchy downloaded from https://reactome.org/download-data/ on 08/2021 and filtered to only include human pathways (i.e., species = 'Homo sapiens'). This data is part of the version 77 release of Reactome. Additional information and the Creative Commons license agreement can be found here: https://reactome.org/license"",
  labels=[(""access"", ""open""), (""source"", ""reactome""), (""category"", ""reference_database""), (""status"", ""current""), (""data_type"", ""pathway_annotations"")]
);"

,1
table_name,pe_to_pathway_v77
ddl,"CREATE TABLE `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
(
  pe_stable_id STRING OPTIONS(description=""Reactome physical entity stable identifier""),
  pathway_stable_id STRING OPTIONS(description=""Reactome pathway stable identifier""),
  evidence_code STRING OPTIONS(description=""Code that indicates the type of evidence supporting physical entity relation to pathway"")
)
OPTIONS(
  friendly_name=""REACTOME PHYSICAL ENTITIES TO PATHWAY MAPPING V77 VERSIONED"",
  description=""External protein, gene, or small molecules mapped to Reactome pathways. This data was downloaded from https://reactome.org/download-data on 8/2021 and filtered to include only human physical entities and pathways. This data is part of the version 77 release of Reactome. Additional information and the Creative Commons license agreement can be found here: https://reactome.org/license"",
  labels=[(""access"", ""open""), (""source"", ""reactome""), (""category"", ""reference_database""), (""status"", ""current""), (""data_type"", ""pathway_annotations"")]
);"

,2
table_name,physical_entity_v77
ddl,"CREATE TABLE `isb-cgc-bq.reactome_versioned.physical_entity_v77`
(
  ensembl_id STRING OPTIONS(description=""Ensembl database identifier""),
  uniprot_id STRING OPTIONS(description=""UniProt database identifier""),
  stable_id STRING OPTIONS(description=""Reactome physical entity stable identifier""),
  name STRING OPTIONS(description=""Reactome physical entity name""),
  location STRING OPTIONS(description=""Reactome physical entity location"")
)
OPTIONS(
  friendly_name=""REACTOME PHYSICAL ENTITIES V77 VERSIONED"",
  description=""External protein, gene, or small molecule identifiers that have been mapped to Reactome physical entities. This data was downloaded from https://reactome.org/download-data on 8/2021 and filtered to include only human physical entities. This data is part of the version 77 release of Reactome. Additional information and the Creative Commons license agreement can be found here: https://reactome.org/license"",
  labels=[(""access"", ""open""), (""source"", ""reactome""), (""category"", ""reference_database""), (""status"", ""current""), (""data_type"", ""pathway_annotations"")]
);"

,3
table_name,pathway_v77
ddl,"CREATE TABLE `isb-cgc-bq.reactome_versioned.pathway_v77`
(
  stable_id STRING OPTIONS(description=""Reactome pathway stable identifier""),
  url STRING OPTIONS(description=""URL to pathway on the Reactome website""),
  name STRING OPTIONS(description=""Reactome pathway name""),
  species STRING OPTIONS(description=""Reactome pathway species""),
  lowest_level BOOL OPTIONS(description=""Indicates if pathway is at the lowest level in the hierarchy, i.e., not a parent"")
)
OPTIONS(
  friendly_name=""REACTOME PATHWAYS V77 VERSIONED"",
  description=""Reactome pathways downloaded from https://reactome.org/download-data/ on 08/2021 and filtered to only include human pathways (i.e., species = 'Homo sapiens'). This data is part of the version 77 release of Reactome. Additional information and the Creative Commons license agreement can be found here: https://reactome.org/license"",
  labels=[(""access"", ""open""), (""source"", ""reactome""), (""category"", ""reference_database""), (""status"", ""current""), (""data_type"", ""pathway_annotations"")]
);"

Database Name: isb-cgc-bq
Schema Name: targetome_versioned
DDL describes table information.
,0
table_name,target_synonyms_v1
ddl,"CREATE TABLE `isb-cgc-bq.targetome_versioned.target_synonyms_v1`
(
  targetID INT64 OPTIONS(description=""ID for Targetome target""),
  synonym STRING OPTIONS(description=""Synonym or alias for Targetome target"")
)
OPTIONS(
  friendly_name=""TARGETOME TARGET SYNONYMS V1 VERSIONED"",
  description=""Synonyms for targets involved in Targetome interactions. More information can be found here: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5759325/. Data was downloaded from the Targetome Git repository (https://github.com/ablucher/The-Cancer-Targetome) in July 2021."",
  labels=[(""access"", ""open""), (""data_type"", ""drug_target_interactions""), (""source"", ""targetome""), (""category"", ""reference_database""), (""status"", ""current"")]
);"

,1
table_name,sources_v1
ddl,"CREATE TABLE `isb-cgc-bq.targetome_versioned.sources_v1`
(
  sourceID INT64 OPTIONS(description=""ID for source supporting Targetome interaction""),
  PubMedID STRING OPTIONS(description=""PubMedID identifying literature""),
  databaseName STRING OPTIONS(description=""Name of database from which supporting evidence and literature are obtained""),
  db_version STRING OPTIONS(description=""Database version""),
  db_downloadURL STRING OPTIONS(description=""URL from which database was downloaded""),
  db_downloadDate STRING OPTIONS(description=""Date on which database was downloaded"")
)
OPTIONS(
  friendly_name=""TARGETOME SOURCES V1 VERSIONED"",
  description=""Targetome literature evidence table, providing support for Targetome interactions. More information can be found here: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5759325/. Data was downloaded from the Targetome Git repository (https://github.com/ablucher/The-Cancer-Targetome) in July 2021."",
  labels=[(""access"", ""open""), (""data_type"", ""drug_target_interactions""), (""source"", ""targetome""), (""category"", ""reference_database""), (""status"", ""current"")]
);"

,2
table_name,interactions_v1
ddl,"CREATE TABLE `isb-cgc-bq.targetome_versioned.interactions_v1`
(
  interactionID INT64 OPTIONS(description=""ID for Targetome drug to target interaction""),
  drugID INT64 OPTIONS(description=""ID of drug involved in interaction""),
  targetID INT64 OPTIONS(description=""ID of target (e.g., protein, DNA, RNA) involved in interaction""),
  interactionType STRING OPTIONS(description=""Type of Targetome interaction, e.g., Antagonist, Inhibition, etc.""),
  drugName STRING OPTIONS(description=""Name of the Targetome drug""),
  drug_approvalDate STRING OPTIONS(description=""Date drug was approved for use""),
  drug_atcClassID STRING OPTIONS(description=""Anatomical Therapeutic Chemical (ATC) drug classification ID""),
  drug_atcClassName STRING OPTIONS(description=""Anatomical Therapeutic Chemical (ATC) drug classification name""),
  drug_atcClassStatus STRING OPTIONS(description=""Anatomical Therapeutic Chemical (ATC) approval status""),
  drug_epcClassID STRING OPTIONS(description=""FDA Established Pharmacologic Class (EPC) drug classification ID""),
  drug_epcClassName STRING OPTIONS(description=""FDA Established Pharmacologic Class (EPC) drug classification name""),
  targetName STRING OPTIONS(description=""Name of Targetome target""),
  targetType STRING OPTIONS(description=""Type of Targetome target (e.g., protein, DNA, or RNA)""),
  target_uniprotID STRING OPTIONS(description=""Uniprot ID of Targetome target""),
  targetSpecies STRING OPTIONS(description=""Species of Targetome target""),
  sourceID INT64 OPTIONS(description=""ID for source supporting Targetome interaction""),
  expID INT64 OPTIONS(description=""ID for experimental evidence supporting Targetome interaction"")
)
OPTIONS(
  friendly_name=""TARGETOME INTERACTIONS V1 VERSIONED"",
  description=""Targetome interactions table linking drugs to targets, supported by experimental or literature evidence. This table is part of a database that aggregates drug-target interaction and bioactivity information for FDA-approved antineoplastic drugs across four publicly available resources. It includes putative target interactions encompassing multiple targets for each antineoplastic drug and introduces a framework for categorizing the supporting evidence behind each drug-target interaction. More information can be found here: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5759325/. Data was downloaded from the Targetome Git repository (https://github.com/ablucher/The-Cancer-Targetome) in July 2021."",
  labels=[(""access"", ""open""), (""data_type"", ""drug_target_interactions""), (""source"", ""targetome""), (""category"", ""reference_database""), (""status"", ""current"")]
);"

,3
table_name,experiments_v1
ddl,"CREATE TABLE `isb-cgc-bq.targetome_versioned.experiments_v1`
(
  expID INT64 OPTIONS(description=""ID for experimental evidence supporting Targetome interactions""),
  exp_assayType STRING OPTIONS(description=""Assay type used for experimental evidence""),
  exp_assayValueLow FLOAT64 OPTIONS(description=""Low value for experimental assay""),
  exp_assayValueMedian FLOAT64 OPTIONS(description=""Median value for experimental assay""),
  exp_assayValueHigh FLOAT64 OPTIONS(description=""High value for experimental assay""),
  exp_assayUnits STRING OPTIONS(description=""Units of measurement for experimental assay""),
  exp_assayRelation STRING OPTIONS(description=""Relation of values for experimental assay""),
  exp_assayDescription STRING OPTIONS(description=""Experimental assay description""),
  exp_assaySpecies STRING OPTIONS(description=""Species used in experimental assay""),
  exp_parentSource STRING OPTIONS(description=""Source from which experimental assay was obtained""),
  sourceID INT64 OPTIONS(description=""ID for source of supporting Targetome evidence""),
  PubMedID STRING OPTIONS(description=""PubMedID identifying literature""),
  databaseName STRING OPTIONS(description=""Name of database from which supporting evidence and literature are obtained""),
  db_version STRING OPTIONS(description=""Database version""),
  db_downloadURL STRING OPTIONS(description=""URL from which database was downloaded""),
  db_downloadDate STRING OPTIONS(description=""Date on which database was downloaded"")
)
OPTIONS(
  friendly_name=""TARGETOME EXPERIMENTAL EVIDENCE V1 VERSIONED"",
  description=""Targetome experimental evidence table, providing experimental support for Targetome interactions. More information can be found here: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5759325/. Data was downloaded from the Targetome Git repository (https://github.com/ablucher/The-Cancer-Targetome) in July 2021."",
  labels=[(""access"", ""open""), (""data_type"", ""drug_target_interactions""), (""source"", ""targetome""), (""category"", ""reference_database""), (""status"", ""current"")]
);"

,4
table_name,drug_synonyms_v1
ddl,"CREATE TABLE `isb-cgc-bq.targetome_versioned.drug_synonyms_v1`
(
  drugID INT64 OPTIONS(description=""Unique ID of the Targetome drug""),
  synonym STRING OPTIONS(description=""Synonym or alias for the Targetome drug"")
)
OPTIONS(
  friendly_name=""TARGETOME DRUG SYNONYMS V1 VERSIONED"",
  description=""Synonyms for drugs involved in Targetome interactions. More information can be found here: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5759325/. Data was downloaded from the Targetome Git repository (https://github.com/ablucher/The-Cancer-Targetome) in July 2021."",
  labels=[(""access"", ""open""), (""data_type"", ""drug_target_interactions""), (""source"", ""targetome""), (""category"", ""reference_database""), (""status"", ""current"")]
);"

External knowledge that might be helpful: 
None
The table structure information is ({database name: {schema name: {table name}}}): 
{'isb-cgc-bq': {'reactome_versioned': ['pathway_hierarchy_v77', 'pathway_v77', 'pe_to_pathway_v77', 'physical_entity_v77'], 'targetome_versioned': ['drug_synonyms_v1', 'experiments_v1', 'interactions_v1', 'sources_v1', 'target_synonyms_v1']}}
Begin Exploring Related Columns
**Relevant Columns and Potential Usage:**

From `isb-cgc-bq.targetome_versioned.interactions_v1`:
- `drugName`: Filter to 'sorafenib'
- `targetID`: Identifier for targets
- `targetSpecies`: Filter to 'homo sapiens'
- `expID`: Join with `experiments_v1` to get assay values
- `target_uniprotID`: Used to join with Reactome physical entities

From `isb-cgc-bq.targetome_versioned.experiments_v1`:
- `expID`: Join with `interactions_v1`
- `exp_assayValueMedian`: Filter where median assay value  100
- `exp_assayValueLow`: Filter where value  100 or NULL
- `exp_assayValueHigh`: Filter where value  100 or NULL

From `isb-cgc-bq.reactome_versioned.physical_entity_v77`:
- `uniprot_id`: Join with `target_uniprotID` to map targets to physical entities
- `stable_id`: Reactome physical entity stable identifier

From `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`:
- `pe_stable_id`: Join with `stable_id` to map physical entities to pathways
- `pathway_stable_id`: Maps physical entities to pathways
- `evidence_code`: Filter to 'TAS'

From `isb-cgc-bq.reactome_versioned.pathway_v77`:
- `stable_id`: Join with `pathway_stable_id`
- `name`: Pathway name
- `species`: Filter to 'Homo sapiens'
- `lowest_level`: Filter to `TRUE` for lowest-level pathways

**Conditions that May Be Used:**
- `drugName = 'sorafenib'`
- `targetSpecies = 'homo sapiens'`
- `exp_assayValueMedian  100`
- `exp_assayValueLow  100 OR exp_assayValueLow IS NULL`
- `exp_assayValueHigh  100 OR exp_assayValueHigh IS NULL`
- `species = 'Homo sapiens'`
- `lowest_level = TRUE`
- `evidence_code = 'TAS'`

---

**SQL Queries:**

1. **List all targets for 'sorafenib'.**

   ```sql
   SELECT DISTINCT targetID, targetName, target_uniprotID
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1`
   WHERE drugName = 'sorafenib' AND targetSpecies = 'homo sapiens'
   LIMIT 100;
   ```

2. **Check assay values for targets associated with 'sorafenib'.**

   ```sql
   SELECT i.targetID, i.targetName, e.exp_assayValueMedian, e.exp_assayValueLow, e.exp_assayValueHigh
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
   WHERE i.drugName = 'sorafenib' AND i.targetSpecies = 'homo sapiens'
   LIMIT 100;
   ```

3. **Filter targets meeting assay conditions.**

   ```sql
   SELECT i.targetID, i.targetName, e.exp_assayValueMedian
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
   WHERE i.drugName = 'sorafenib'
     AND i.targetSpecies = 'homo sapiens'
     AND e.exp_assayValueMedian <= 100
     AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
     AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
   LIMIT 100;
   ```

4. **Map targets to Reactome physical entities using UniProt IDs.**

   ```sql
   SELECT DISTINCT i.targetID, i.targetName, p.stable_id AS pe_stable_id
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
   WHERE i.drugName = 'sorafenib' AND i.targetSpecies = 'homo sapiens'
   LIMIT 100;
   ```

5. **Find pathways associated with targets.**

   ```sql
   SELECT DISTINCT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
   JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
   JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
   WHERE i.drugName = 'sorafenib'
     AND i.targetSpecies = 'homo sapiens'
     AND pw.species = 'Homo sapiens'
     AND pw.lowest_level = TRUE
   LIMIT 100;
   ```

6. **Filter pathways with TAS evidence code.**

   ```sql
   SELECT DISTINCT pp.pathway_stable_id, pw.name AS pathway_name
   FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp
   JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
   WHERE pp.evidence_code = 'TAS'
     AND pw.species = 'Homo sapiens'
     AND pw.lowest_level = TRUE
   LIMIT 100;
   ```

7. **Combine targets, assay conditions, and pathways with TAS evidence.**

   ```sql
   SELECT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
   JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
   JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
   JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
   WHERE i.drugName = 'sorafenib'
     AND i.targetSpecies = 'homo sapiens'
     AND e.exp_assayValueMedian <= 100
     AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
     AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
     AND pp.evidence_code = 'TAS'
     AND pw.species = 'Homo sapiens'
     AND pw.lowest_level = TRUE
   LIMIT 100;
   ```

8. **Calculate counts of targets per pathway.**

   ```sql
   SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
   FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
   JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
   JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
   JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
   JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
   WHERE i.drugName = 'sorafenib'
     AND i.targetSpecies = 'homo sapiens'
     AND e.exp_assayValueMedian <= 100
     AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
     AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
     AND pp.evidence_code = 'TAS'
     AND pw.species = 'Homo sapiens'
     AND pw.lowest_level = TRUE
   GROUP BY pw.stable_id, pw.name
   ORDER BY target_count DESC
   LIMIT 100;
   ```

9. **Identify top 3 pathways with the highest target counts.**

   ```sql
   SELECT pathway_id, pathway_name, target_count
   FROM (
     SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
     FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
     JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
     JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
     JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
     JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
     WHERE i.drugName = 'sorafenib'
       AND i.targetSpecies = 'homo sapiens'
       AND e.exp_assayValueMedian <= 100
       AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
       AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
       AND pp.evidence_code = 'TAS'
       AND pw.species = 'Homo sapiens'
       AND pw.lowest_level = TRUE
     GROUP BY pw.stable_id, pw.name
     ORDER BY target_count DESC
     LIMIT 3
   )
   LIMIT 100;
   ```

10. **Compute counts of targets and non-targets within and outside top 3 pathways.**

    ```sql
    WITH target_data AS (
      SELECT DISTINCT i.targetID
      FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
      JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
      WHERE i.drugName = 'sorafenib'
        AND i.targetSpecies = 'homo sapiens'
        AND e.exp_assayValueMedian <= 100
        AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
        AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    ),
    pathways AS (
      SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
      FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
      WHERE pw.species = 'Homo sapiens' AND pw.lowest_level = TRUE
    ),
    top3_pathways AS (
      SELECT pathway_id
      FROM (
        SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.targetID) AS target_count
        FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
        JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
        JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
        JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
        JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
        WHERE i.drugName = 'sorafenib'
          AND i.targetSpecies = 'homo sapiens'
          AND e.exp_assayValueMedian <= 100
          AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
          AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
          AND pp.evidence_code = 'TAS'
        GROUP BY pw.stable_id
        ORDER BY target_count DESC
        LIMIT 3
      )
    ),
    target_in_top3 AS (
      SELECT DISTINCT i.targetID
      FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
      JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
      JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
      JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
      WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
        AND i.drugName = 'sorafenib'
        AND i.targetSpecies = 'homo sapiens'
        AND e.exp_assayValueMedian <= 100
        AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
        AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
        AND pp.evidence_code = 'TAS'
    )
    SELECT
      CASE WHEN t.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS Group,
      'Yes' AS IsTarget,
      COUNT(*) AS Count
    FROM target_data t
    GROUP BY 1, 2
    UNION ALL
    SELECT
      CASE WHEN nt.targetID IN (SELECT targetID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS Group,
      'No' AS IsTarget,
      COUNT(*) AS Count
    FROM (
      SELECT DISTINCT p.uniprot_id AS targetID
      FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
      WHERE p.uniprot_id IS NOT NULL
    ) nt
    WHERE nt.targetID NOT IN (SELECT targetID FROM target_data)
    GROUP BY 1, 2
    LIMIT 100;
    ```

These queries progressively explore the data to understand the relationships between drugs, targets, experiments, and pathways, applying the specified conditions to filter the data accordingly.Query:
SELECT DISTINCT i.targetID, i.targetName, i.target_uniprotID
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
WHERE LOWER(ds.synonym) = 'sorafenib' AND LOWER(i.targetSpecies) = 'homo sapiens'
LIMIT 100;
Answer:
targetID,targetName,target_uniprotID
3,ABL1,P00519
5,ALK,Q9UM73
10,BLK,P51451
11,BMX,P51813
12,BRAF,P15056
13,BTK,Q06187
14,CAMK1D,Q8IU85
15,CAMK2G,Q13555
24,CSF1R,P07333
27,CDK19,Q9BWU1
28,CDK4,P11802
30,CDK8,P49336
32,CYP19A1,P11511
35,DDR2,Q16832
36,EGFR,P00533
37,ERBB2,P04626
42,FGFR1,P11362
43,FGFR2,P21802
44,FLT1,P17948
45,FLT3,P36888
46,FLT4,P35916
48,FYN,P06241
49,FRK,P42685
69,IGF1R,P08069
70,INSR,P06213
73,JAK1,P23458
74,JAK2,O60674
75,JAK3,P52333
76,KDR,P35968
77,KIT,P10721
78,LYN,P07948
79,MTOR,P42345
80,MET,P08581
82,MAP2K1,Q02750
83,MAP2K2,P36507
84,MAP2K7,O14733
85,MAP4K5,Q9Y4K4
90,PIK3CA,P42336
91,PIK3CB,P42338
92,PIK3CD,O00329
93,PIK3CG,P48736
95,PDGFRB,P09619
97,PLK4,O00444
104,RAF1,P04049
109,RET,P07949
112,STK10,O94804
113,STK24,Q9Y6E0
114,STK4,Q13043
116,SRC,P12931
125,TSSK1B,Q9BXA7
132,TXK,P42681
133,TYK2,P29597
134,TNK2,Q07912
153,FGFR4,P22455
154,FGFR3,P22607
195,NTRK1,P04629
196,PDGFRA,P16234
197,DDR1,Q08345
212,HTR1A,P08908
222,IKBKB,O14920
225,MAPK3,P27361
226,MAPK1,P28482
227,AKT1,P31749
236,EPHA2,P29317
237,LCK,P06239
238,YES1,P07947
240,ABL2,P42684
250,PTK6,Q13882
251,TEK,Q02763
252,ITK,Q08881
256,HCK,P08631
257,CDK2,P24941
258,MAP3K2,Q9Y2U5
Query:
WITH target_data AS (
  SELECT DISTINCT i.targetID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens'
),
target_pathways AS (
  SELECT DISTINCT i.targetID, pw.pathway_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pathway_id, COUNT(DISTINCT targetID) AS target_count
    FROM target_pathways
    GROUP BY pathway_id
    ORDER BY target_count DESC
    LIMIT 3
  ) AS tp
),
targets_in_top3 AS (
  SELECT DISTINCT targetID
  FROM target_pathways
  WHERE pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT DISTINCT targetID
  FROM target_data
  WHERE targetID NOT IN (SELECT targetID FROM targets_in_top3)
),
non_targets AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_in_top3 AS (
  SELECT DISTINCT p.uniprot_id AS targetID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND p.uniprot_id IS NOT NULL
    AND p.uniprot_id NOT IN (SELECT DISTINCT i.target_uniprotID FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i)
),
non_targets_outside_top3 AS (
  SELECT targetID
  FROM non_targets
  WHERE targetID NOT IN (SELECT targetID FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'Yes' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS Group,
  'No' AS IsTarget,
  COUNT(DISTINCT targetID) AS Count
FROM non_targets_outside_top3;
Answer:
400 Syntax error: Unexpected keyword GROUP at [63:30]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword GROUP at [63:30]

Location: US
Job ID: 21b71240-426c-4a49-88c1-eead04a4793b
Query:
-- Corrected Query 2
SELECT i.targetID, i.targetName, e.exp_assayValueMedian
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
LIMIT 100
Answer:
targetID,targetName,exp_assayValueMedian
3,ABL1,48.0
3,ABL1,48.0
3,ABL1,48.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,68.0
3,ABL1,68.0
3,ABL1,68.0
3,ABL1,39.0
3,ABL1,39.0
3,ABL1,39.0
3,ABL1,25.0
3,ABL1,25.0
3,ABL1,25.0
3,ABL1,16.0
3,ABL1,16.0
3,ABL1,16.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,3.0
12,BRAF,3.0
12,BRAF,3.0
12,BRAF,54.0
12,BRAF,54.0
12,BRAF,54.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,26.0
12,BRAF,26.0
12,BRAF,26.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,12.0
12,BRAF,46.0
12,BRAF,46.0
12,BRAF,46.0
12,BRAF,76.2
12,BRAF,76.2
12,BRAF,76.2
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,15.0
12,BRAF,15.0
12,BRAF,15.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,22.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,38.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,43.0
12,BRAF,3.0
12,BRAF,3.0
Query:
-- Corrected Query 3
SELECT DISTINCT i.targetID, i.targetName, p.stable_id AS pe_stable_id
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
WHERE LOWER(ds.synonym) = 'sorafenib' AND LOWER(i.targetSpecies) = 'homo sapiens'
LIMIT 100
Answer:
targetID,targetName,pe_stable_id
3,ABL1,R-HSA-375987
3,ABL1,R-HSA-5686576
3,ABL1,R-HSA-5686579
3,ABL1,R-HSA-8942610
3,ABL1,R-HSA-8985251
5,ALK,R-HSA-201502
5,ALK,R-HSA-201535
5,ALK,R-HSA-9699794
5,ALK,R-HSA-9699797
5,ALK,R-HSA-9699800
5,ALK,R-HSA-9699801
5,ALK,R-HSA-9699802
5,ALK,R-HSA-9699818
5,ALK,R-HSA-9699821
5,ALK,R-HSA-9699826
5,ALK,R-HSA-9699828
5,ALK,R-HSA-9699831
5,ALK,R-HSA-9699836
5,ALK,R-HSA-9699838
5,ALK,R-HSA-9699840
5,ALK,R-HSA-9699841
5,ALK,R-HSA-9699853
5,ALK,R-HSA-9699880
5,ALK,R-HSA-9699882
5,ALK,R-HSA-9699891
5,ALK,R-HSA-9699902
5,ALK,R-HSA-9699906
5,ALK,R-HSA-9699908
5,ALK,R-HSA-9699910
5,ALK,R-HSA-9699913
5,ALK,R-HSA-9699915
5,ALK,R-HSA-9699916
5,ALK,R-HSA-9699921
5,ALK,R-HSA-9700435
5,ALK,R-HSA-9700462
5,ALK,R-HSA-9700464
5,ALK,R-HSA-9700465
5,ALK,R-HSA-9700466
5,ALK,R-HSA-9700470
5,ALK,R-HSA-9700472
5,ALK,R-HSA-9700473
5,ALK,R-HSA-9700476
5,ALK,R-HSA-9700477
5,ALK,R-HSA-9700480
5,ALK,R-HSA-9700482
5,ALK,R-HSA-9700484
5,ALK,R-HSA-9700486
5,ALK,R-HSA-9700489
5,ALK,R-HSA-9701418
5,ALK,R-HSA-9701426
5,ALK,R-HSA-9701427
5,ALK,R-HSA-9701428
5,ALK,R-HSA-9701433
5,ALK,R-HSA-9701434
5,ALK,R-HSA-9701818
5,ALK,R-HSA-9701826
5,ALK,R-HSA-9701835
5,ALK,R-HSA-9701836
5,ALK,R-HSA-9701838
5,ALK,R-HSA-9701841
5,ALK,R-HSA-9701842
5,ALK,R-HSA-9701860
5,ALK,R-HSA-9701868
5,ALK,R-HSA-9701883
5,ALK,R-HSA-9714054
5,ALK,R-HSA-9714063
5,ALK,R-HSA-9715260
5,ALK,R-HSA-9715261
5,ALK,R-HSA-9715262
5,ALK,R-HSA-9715263
5,ALK,R-HSA-9715265
5,ALK,R-HSA-9715266
5,ALK,R-HSA-9715267
Query:
-- Corrected Query 4
SELECT DISTINCT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Answer:
targetID,targetName,pathway_id,pathway_name
104,RAF1,R-HSA-5673000,RAF activation
104,RAF1,R-HSA-9726840,SHOC2 M1731 mutant abolishes MRAS complex function
104,RAF1,R-HSA-9726842,Gain-of-function MRAS complexes activate RAF signaling
82,MAP2K1,R-HSA-5684264,MAP3K8 (TPL2)-dependent MAPK1/3 activation
82,MAP2K1,R-HSA-110056,MAPK3 (ERK1) activation
82,MAP2K1,R-HSA-170968,Frs2-mediated activation
82,MAP2K1,R-HSA-445144,Signal transduction by L1
82,MAP2K1,R-HSA-5673000,RAF activation
82,MAP2K1,R-HSA-5674135,MAP2K and MAPK activation
82,MAP2K1,R-HSA-5674499,Negative feedback regulation of MAPK pathway
82,MAP2K1,R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants
82,MAP2K1,R-HSA-6802948,Signaling by high-kinase activity BRAF mutants
82,MAP2K1,R-HSA-6802952,Signaling by BRAF and RAF1 fusions
82,MAP2K1,R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF
82,MAP2K1,R-HSA-9649948,Signaling downstream of RAS mutants
82,MAP2K1,R-HSA-9656223,Signaling by RAF1 mutants
225,MAPK3,R-HSA-444257,RSK activation
225,MAPK3,R-HSA-110056,MAPK3 (ERK1) activation
225,MAPK3,R-HSA-170968,Frs2-mediated activation
225,MAPK3,R-HSA-445144,Signal transduction by L1
225,MAPK3,R-HSA-456926,Thrombin signalling through proteinase activated receptors (PARs)
225,MAPK3,R-HSA-982772,Growth hormone receptor signaling
225,MAPK3,R-HSA-1295596,Spry regulation of FGF signaling
225,MAPK3,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
225,MAPK3,R-HSA-3371453,Regulation of HSF1-mediated heat shock response
225,MAPK3,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
225,MAPK3,R-HSA-5668599,RHO GTPases Activate NADPH Oxidases
225,MAPK3,R-HSA-5674135,MAP2K and MAPK activation
225,MAPK3,R-HSA-5674499,Negative feedback regulation of MAPK pathway
225,MAPK3,R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants
225,MAPK3,R-HSA-6802948,Signaling by high-kinase activity BRAF mutants
225,MAPK3,R-HSA-6802952,Signaling by BRAF and RAF1 fusions
225,MAPK3,R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF
225,MAPK3,R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling"
225,MAPK3,R-HSA-8943724,Regulation of PTEN gene transcription
225,MAPK3,R-HSA-9627069,Regulation of the apoptosome activity
225,MAPK3,R-HSA-9649948,Signaling downstream of RAS mutants
225,MAPK3,R-HSA-9652169,Signaling by MAP2K mutants
225,MAPK3,R-HSA-9656223,Signaling by RAF1 mutants
225,MAPK3,R-HSA-9664422,FCGR3A-mediated phagocytosis
Query:
-- Corrected Query 5
SELECT DISTINCT pp.pathway_stable_id, pw.name AS pathway_name
FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Answer:
pathway_stable_id,pathway_name
R-HSA-68616,Assembly of the ORC complex at the origin of replication
R-HSA-68689,CDC6 association with the ORC:origin complex
R-HSA-68827,CDT1 association with the CDC6:ORC:origin complex
R-HSA-68881,Mitotic Metaphase/Anaphase Transition
R-HSA-68911,G2 Phase
R-HSA-68949,Orc1 removal from chromatin
R-HSA-68952,DNA replication initiation
R-HSA-68962,Activation of the pre-replicative complex
R-HSA-69017,CDK-mediated phosphorylation and removal of Cdc6
R-HSA-69091,Polymerase switching
R-HSA-69166,Removal of the Flap Intermediate
R-HSA-69200,Phosphorylation of proteins involved in G1/S transition by active Cyclin E:Cdk2 complexes
R-HSA-69205,G1/S-Specific Transcription
R-HSA-69231,Cyclin D associated events in G1
R-HSA-69416,Dimerization of procaspase-8
R-HSA-69478,G2/M DNA replication checkpoint
R-HSA-69601,Ubiquitin Mediated Degradation of Phosphorylated Cdc25A
R-HSA-69895,Transcriptional  activation of  cell cycle inhibitor p21 
R-HSA-70221,Glycogen breakdown (glycogenolysis)
R-HSA-70263,Gluconeogenesis
R-HSA-70350,Fructose catabolism
R-HSA-70370,Galactose catabolism
R-HSA-70635,Urea cycle
R-HSA-70688,Proline catabolism
R-HSA-70895,Branched-chain amino acid catabolism
R-HSA-70921,Histidine catabolism
R-HSA-71032,Propionyl-CoA catabolism
R-HSA-71064,Lysine catabolism
R-HSA-71240,Tryptophan catabolism
R-HSA-71262,Carnitine synthesis
R-HSA-71288,Creatine metabolism
R-HSA-71384,Ethanol oxidation
R-HSA-71403,Citric acid cycle (TCA cycle)
R-HSA-71737,Pyrophosphate hydrolysis
R-HSA-72086,mRNA Capping
R-HSA-72163,mRNA Splicing - Major Pathway
R-HSA-72165,mRNA Splicing - Minor Pathway
R-HSA-72187,mRNA 3'-end processing
R-HSA-72649,Translation initiation complex formation
R-HSA-72689,Formation of a pool of free 40S subunits
R-HSA-72695,"Formation of the ternary complex, and subsequently, the 43S complex"
R-HSA-72702,Ribosomal scanning and start codon recognition
R-HSA-72706,GTP hydrolysis and joining of the 60S ribosomal subunit
R-HSA-72731,Recycling of eIF2:GDP
R-HSA-72764,Eukaryotic Translation Termination
R-HSA-73614,Pyrimidine salvage
R-HSA-73621,Pyrimidine catabolism
R-HSA-73728,RNA Polymerase I Promoter Opening
R-HSA-73762,RNA Polymerase I Transcription Initiation
R-HSA-73772,RNA Polymerase I Promoter Escape
R-HSA-73776,RNA Polymerase II Promoter Escape
R-HSA-73779,RNA Polymerase II Transcription Pre-Initiation And Promoter Opening
R-HSA-73817,Purine ribonucleoside monophosphate biosynthesis
R-HSA-73843,5-Phosphoribose 1-diphosphate biosynthesis
R-HSA-73856,RNA Polymerase II Transcription Termination
R-HSA-73863,RNA Polymerase I Transcription Termination
Query:
-- Corrected Query 6
SELECT i.targetID, i.targetName, pw.stable_id AS pathway_id, pw.name AS pathway_name
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
  AND LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
LIMIT 100
Answer:
targetID,targetName,pathway_id,pathway_name
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-428890,Role of ABL in ROBO-SLIT signaling
3,ABL1,R-HSA-525793,Myogenesis
3,ABL1,R-HSA-2029482,Regulation of actin dynamics for phagocytic cup formation
3,ABL1,R-HSA-5663213,RHO GTPases Activate WASPs and WAVEs
3,ABL1,R-HSA-9664422,FCGR3A-mediated phagocytosis
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
3,ABL1,R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks
3,ABL1,R-HSA-8939236,RUNX1 regulates transcription of genes involved in differentiation of HSCs
3,ABL1,R-HSA-5685938,HDR through Single Strand Annealing (SSA)
Query:
-- Corrected Query 7
SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
WHERE LOWER(ds.synonym) = 'sorafenib'
  AND LOWER(i.targetSpecies) = 'homo sapiens'
  AND e.exp_assayValueMedian <= 100
  AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
  AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
  AND LOWER(pp.evidence_code) = 'tas'
  AND LOWER(pw.species) = 'homo sapiens'
  AND pw.lowest_level = TRUE
GROUP BY pw.stable_id, pw.name
ORDER BY target_count DESC
LIMIT 100
Answer:
pathway_id,pathway_name,target_count
R-HSA-2219530,Constitutive Signaling by Aberrant PI3K in Cancer,6
R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling",6
R-HSA-195399,VEGF binds to VEGFR leading to receptor dimerization,3
R-HSA-444257,RSK activation,3
R-HSA-199920,CREB phosphorylation,3
R-HSA-186763,Downstream signal transduction,3
R-HSA-6804756,Regulation of TP53 Activity through Phosphorylation,3
R-HSA-1236382,Constitutive Signaling by Ligand-Responsive EGFR Cancer Variants,2
R-HSA-5637810,Constitutive Signaling by EGFRvIII,2
R-HSA-6802952,Signaling by BRAF and RAF1 fusions,2
R-HSA-9726842,Gain-of-function MRAS complexes activate RAF signaling,2
R-HSA-9664565,Signaling by ERBB2 KD Mutants,2
R-HSA-8866910,TFAP2 (AP-2) family regulates transcription of growth factors and their receptors,2
R-HSA-9673770,Signaling by PDGFRA extracellular domain mutants,2
R-HSA-6802948,Signaling by high-kinase activity BRAF mutants,2
R-HSA-180292,GAB1 signalosome,2
R-HSA-1963642,PI3K events in ERBB2 signaling,2
R-HSA-194306,Neurophilin interactions with VEGF and VEGFR,2
R-HSA-2559582,Senescence-Associated Secretory Phenotype (SASP),2
R-HSA-9670439,"Signaling by phosphorylated juxtamembrane, extracellular and kinase domain KIT mutants",2
R-HSA-5673000,RAF activation,2
R-HSA-6802955,Paradoxical activation of RAF signaling by kinase inactive BRAF,2
R-HSA-9649948,Signaling downstream of RAS mutants,2
R-HSA-6802946,Signaling by moderate kinase activity BRAF mutants,2
R-HSA-9673767,"Signaling by PDGFRA transmembrane, juxtamembrane and kinase domain mutants",2
R-HSA-9656223,Signaling by RAF1 mutants,2
R-HSA-8853659,RET signaling,2
R-HSA-9665348,Signaling by ERBB2 ECD mutants,2
R-HSA-9726840,SHOC2 M1731 mutant abolishes MRAS complex function,2
R-HSA-525793,Myogenesis,2
R-HSA-5621575,CD209 (DC-SIGN) signaling,2
R-HSA-5674135,MAP2K and MAPK activation,2
R-HSA-8853334,Signaling by FGFR3 fusions in cancer,2
R-HSA-5674499,Negative feedback regulation of MAPK pathway,2
R-HSA-5578775,Ion homeostasis,1
R-HSA-141444,Amplification  of signal from unattached  kinetochores via a MAD2  inhibitory signal,1
R-HSA-445144,Signal transduction by L1,1
R-HSA-2173796,SMAD2/SMAD3:SMAD4 heterotrimer regulates transcription,1
R-HSA-1989781,PPARA activates gene expression,1
R-HSA-381340,Transcriptional regulation of white adipocyte differentiation,1
R-HSA-8857538,PTK6 promotes HIF1A stabilization,1
R-HSA-5693565,Recruitment and ATM-mediated phosphorylation of repair and signaling proteins at DNA double strand breaks,1
R-HSA-8853884,Transcriptional Regulation by VENTX,1
R-HSA-449836,Other interleukin signaling,1
R-HSA-2644606,Constitutive Signaling by NOTCH1 PEST Domain Mutants,1
Query:
-- Corrected Query 8
SELECT pathway_id, pathway_name, target_count
FROM (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, COUNT(DISTINCT i.targetID) AS target_count
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  JOIN `isb-cgc-bq.reactome_versioned.pathway_v77` pw ON pp.pathway_stable_id = pw.stable_id
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
    AND LOWER(pw.species) = 'homo sapiens'
    AND pw.lowest_level = TRUE
  GROUP BY pw.stable_id, pw.name
  ORDER BY target_count DESC
  LIMIT 3
)
LIMIT 100
Answer:
pathway_id,pathway_name,target_count
R-HSA-2219530,Constitutive Signaling by Aberrant PI3K in Cancer,6
R-HSA-6811558,"PI5P, PP2A and IER3 Regulate PI3K/AKT Signaling",6
R-HSA-195399,VEGF binds to VEGFR leading to receptor dimerization,3
Query:
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
),
pathways AS (
  SELECT pw.stable_id AS pathway_id, pw.name AS pathway_name, pw.url
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77` pw
  WHERE LOWER(pw.species) = 'homo sapiens' AND pw.lowest_level = TRUE
),
top3_pathways AS (
  SELECT pathway_id
  FROM (
    SELECT pw.stable_id AS pathway_id, COUNT(DISTINCT i.target_uniprotID) AS target_count
    FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
    JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
    JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
    JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
    JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
    JOIN pathways pw ON pp.pathway_stable_id = pw.pathway_id
    WHERE LOWER(ds.synonym) = 'sorafenib'
      AND LOWER(i.targetSpecies) = 'homo sapiens'
      AND e.exp_assayValueMedian <= 100
      AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
      AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
      AND LOWER(pp.evidence_code) = 'tas'
    GROUP BY pw.stable_id
    ORDER BY target_count DESC
    LIMIT 3
  )
),
target_in_top3 AS (
  SELECT DISTINCT i.target_uniprotID
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  JOIN `isb-cgc-bq.reactome_versioned.physical_entity_v77` p ON i.target_uniprotID = p.uniprot_id
  JOIN `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77` pp ON p.stable_id = pp.pe_stable_id
  WHERE pp.pathway_stable_id IN (SELECT pathway_id FROM top3_pathways)
    AND LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND LOWER(pp.evidence_code) = 'tas'
)
SELECT
  CASE WHEN t.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'Yes' AS IsTarget,
  COUNT(*) AS Count
FROM target_data t
GROUP BY 1, 2
UNION ALL
SELECT
  CASE WHEN nt.target_uniprotID IN (SELECT target_uniprotID FROM target_in_top3) THEN 'Within Top 3 Pathways' ELSE 'Outside Top 3 Pathways' END AS `Group`,
  'No' AS IsTarget,
  COUNT(*) AS Count
FROM (
  SELECT DISTINCT p.uniprot_id AS target_uniprotID
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77` p
  WHERE p.uniprot_id IS NOT NULL
) nt
WHERE nt.target_uniprotID NOT IN (SELECT target_uniprotID FROM target_data)
GROUP BY 1, 2
LIMIT 100;
Answer:
400 Name stable_id not found inside pw at [20:15]; reason: invalidQuery, location: query, message: Name stable_id not found inside pw at [20:15]

Location: US
Job ID: 817527ed-bdd6-412c-9f56-6c89b4c020ff
End Exploring Related Columns
Task: What are the counts of targets and non-targets within and outside the top 3 pathways with the highest chi-squared statistic for target species 'homo sapiens' associated with 'sorafenib' only? The targets should meet specific assay conditions (median assay value  100, with assay values below and above also  100 or NULL if not applicable), and only pathways with TAS evidence at the lowest level should be considered.

Please answer only one complete SQL in bigquery dialect in ```sql``` format.
Usage example: ```sql
SELECT `column_name` FROM `database.schema.table` WHERE ... ``` (Replace `database`, `schema`, and `table` with actual names. Enclose column names and table identifiers with backticks.)
Follow the answer format like: ```csv
Group,IsTarget,Count
Within Top 3 Pathways,Yes,count1:int
Within Top 3 Pathways,No,count2:int
Outside Top 3 Pathways,Yes,count3:int
Outside Top 3 Pathways,No,count4:int
```

This table shows the counts of targets and non-targets within and outside the top 3 pathways with the highest chi-squared statistic for target species 'homo sapiens' associated with 'sorafenib' only. The targets meet the specific assay conditions (median assay value  100, with assay values below and above also  100 or NULL if not applicable), and only pathways with TAS evidence at the lowest level are considered..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'isb-cgc-bq': {'reactome_versioned': ['pathway_hierarchy_v77', 'pathway_v77', 'pe_to_pathway_v77', 'physical_entity_v77'], 'targetome_versioned': ['drug_synonyms_v1', 'experiments_v1', 'interactions_v1', 'sources_v1', 'target_synonyms_v1']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.If the task description does not specify the number of decimal places, retain all decimals to four places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-26 20:49:42 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:49:42 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID AS uniprot_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND i.target_uniprotID IS NOT NULL
),
all_uniprot_ids AS (
  SELECT DISTINCT uniprot_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
physical_entities AS (
  SELECT DISTINCT uniprot_id, stable_id AS pe_stable_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
pe_to_pathways AS (
  SELECT pe_stable_id, pathway_stable_id AS pathway_id
  FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
  WHERE LOWER(evidence_code) = 'tas'
),
pathways AS (
  SELECT stable_id AS pathway_id, name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77`
  WHERE LOWER(species) = 'homo sapiens'
    AND lowest_level = TRUE
),
entity_pathways AS (
  SELECT DISTINCT pe.uniprot_id, pt.pathway_id
  FROM physical_entities pe
  JOIN pe_to_pathways pt ON pe.pe_stable_id = pt.pe_stable_id
),
pathway_counts AS (
  SELECT
    ep.pathway_id,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NOT NULL THEN ep.uniprot_id END) AS target_in_pathway,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NULL THEN ep.uniprot_id END) AS non_target_in_pathway
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  GROUP BY ep.pathway_id
),
total_counts AS (
  SELECT
    (SELECT COUNT(DISTINCT uniprot_id) FROM target_data) AS total_targets,
    (SELECT COUNT(DISTINCT uniprot_id) FROM all_uniprot_ids WHERE uniprot_id NOT IN (SELECT uniprot_id FROM target_data)) AS total_non_targets
),
chi_squared AS (
  SELECT
    pc.pathway_id,
    pw.pathway_name,
    pc.target_in_pathway,
    pc.non_target_in_pathway,
    total_counts.total_targets AS total_targets,
    total_counts.total_non_targets AS total_non_targets,
    (total_counts.total_targets - pc.target_in_pathway) AS target_out_pathway,
    (total_counts.total_non_targets - pc.non_target_in_pathway) AS non_target_out_pathway,
    -- N is total_targets + total_non_targets
    (total_counts.total_targets + total_counts.total_non_targets) AS N,
    -- Compute chi-squared statistic
    (
     (
      (pc.target_in_pathway * (total_counts.total_non_targets - pc.non_target_in_pathway) - 
       (total_counts.total_targets - pc.target_in_pathway) * pc.non_target_in_pathway
      ) ^ 2
     ) * (total_counts.total_targets + total_counts.total_non_targets)
     /
     (
       NULLIF((pc.target_in_pathway + (total_counts.total_targets - pc.target_in_pathway)) *
       (pc.non_target_in_pathway + (total_counts.total_non_targets - pc.non_target_in_pathway)) *
       (pc.target_in_pathway + pc.non_target_in_pathway) *
       ((total_counts.total_targets - pc.target_in_pathway) + (total_counts.total_non_targets - pc.non_target_in_pathway)), 0)
     )
    ) AS chi_squared
  FROM pathway_counts pc
  CROSS JOIN total_counts
  JOIN pathways pw ON pc.pathway_id = pw.pathway_id
  WHERE pc.target_in_pathway > 0
),
top3_pathways AS (
  SELECT pathway_id, pathway_name
  FROM chi_squared
  WHERE chi_squared IS NOT NULL
  ORDER BY chi_squared DESC
  LIMIT 3
),
targets_in_top3 AS (
  SELECT DISTINCT td.uniprot_id
  FROM target_data td
  JOIN entity_pathways ep ON td.uniprot_id = ep.uniprot_id
  WHERE ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT td.uniprot_id
  FROM target_data td
  WHERE td.uniprot_id NOT IN (SELECT uniprot_id FROM targets_in_top3)
),
non_targets_in_top3 AS (
  SELECT DISTINCT ep.uniprot_id
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  WHERE td.uniprot_id IS NULL
    AND ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT au.uniprot_id
  FROM all_uniprot_ids au
  WHERE au.uniprot_id NOT IN (SELECT uniprot_id FROM target_data)
    AND au.uniprot_id NOT IN (SELECT uniprot_id FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_outside_top3;
```
2025-01-26 20:49:43 - root - INFO - itercount: 1
2025-01-26 20:49:43 - root - INFO - 400 ORDER BY does not support expressions of type STRUCT<pathway_id STRING, pathway_name STRING, target_in_pathway INT64, ...> at [89:12]; reason: invalidQuery, location: query, message: ORDER BY does not support expressions of type STRUCT<pathway_id STRING, pathway_name STRING, target_in_pathway INT64, ...> at [89:12]

Location: US
Job ID: 3ad67cab-684e-4c36-9ce3-ba7c698526a1

2025-01-26 20:49:43 - root - INFO - Input sql:
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID AS uniprot_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND i.target_uniprotID IS NOT NULL
),
all_uniprot_ids AS (
  SELECT DISTINCT uniprot_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
physical_entities AS (
  SELECT DISTINCT uniprot_id, stable_id AS pe_stable_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
pe_to_pathways AS (
  SELECT pe_stable_id, pathway_stable_id AS pathway_id
  FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
  WHERE LOWER(evidence_code) = 'tas'
),
pathways AS (
  SELECT stable_id AS pathway_id, name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77`
  WHERE LOWER(species) = 'homo sapiens'
    AND lowest_level = TRUE
),
entity_pathways AS (
  SELECT DISTINCT pe.uniprot_id, pt.pathway_id
  FROM physical_entities pe
  JOIN pe_to_pathways pt ON pe.pe_stable_id = pt.pe_stable_id
),
pathway_counts AS (
  SELECT
    ep.pathway_id,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NOT NULL THEN ep.uniprot_id END) AS target_in_pathway,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NULL THEN ep.uniprot_id END) AS non_target_in_pathway
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  GROUP BY ep.pathway_id
),
total_counts AS (
  SELECT
    (SELECT COUNT(DISTINCT uniprot_id) FROM target_data) AS total_targets,
    (SELECT COUNT(DISTINCT uniprot_id) FROM all_uniprot_ids WHERE uniprot_id NOT IN (SELECT uniprot_id FROM target_data)) AS total_non_targets
),
chi_squared AS (
  SELECT
    pc.pathway_id,
    pw.pathway_name,
    pc.target_in_pathway,
    pc.non_target_in_pathway,
    total_counts.total_targets AS total_targets,
    total_counts.total_non_targets AS total_non_targets,
    (total_counts.total_targets - pc.target_in_pathway) AS target_out_pathway,
    (total_counts.total_non_targets - pc.non_target_in_pathway) AS non_target_out_pathway,
    -- N is total_targets + total_non_targets
    (total_counts.total_targets + total_counts.total_non_targets) AS N,
    -- Compute chi-squared statistic
    (
     (
      (pc.target_in_pathway * (total_counts.total_non_targets - pc.non_target_in_pathway) - 
       (total_counts.total_targets - pc.target_in_pathway) * pc.non_target_in_pathway
      ) ^ 2
     ) * (total_counts.total_targets + total_counts.total_non_targets)
     /
     (
       NULLIF((pc.target_in_pathway + (total_counts.total_targets - pc.target_in_pathway)) *
       (pc.non_target_in_pathway + (total_counts.total_non_targets - pc.non_target_in_pathway)) *
       (pc.target_in_pathway + pc.non_target_in_pathway) *
       ((total_counts.total_targets - pc.target_in_pathway) + (total_counts.total_non_targets - pc.non_target_in_pathway)), 0)
     )
    ) AS chi_squared
  FROM pathway_counts pc
  CROSS JOIN total_counts
  JOIN pathways pw ON pc.pathway_id = pw.pathway_id
  WHERE pc.target_in_pathway > 0
),
top3_pathways AS (
  SELECT pathway_id, pathway_name
  FROM chi_squared
  WHERE chi_squared IS NOT NULL
  ORDER BY chi_squared DESC
  LIMIT 3
),
targets_in_top3 AS (
  SELECT DISTINCT td.uniprot_id
  FROM target_data td
  JOIN entity_pathways ep ON td.uniprot_id = ep.uniprot_id
  WHERE ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT td.uniprot_id
  FROM target_data td
  WHERE td.uniprot_id NOT IN (SELECT uniprot_id FROM targets_in_top3)
),
non_targets_in_top3 AS (
  SELECT DISTINCT ep.uniprot_id
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  WHERE td.uniprot_id IS NULL
    AND ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT au.uniprot_id
  FROM all_uniprot_ids au
  WHERE au.uniprot_id NOT IN (SELECT uniprot_id FROM target_data)
    AND au.uniprot_id NOT IN (SELECT uniprot_id FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_outside_top3;
The error information is:
400 ORDER BY does not support expressions of type STRUCT<pathway_id STRING, pathway_name STRING, target_in_pathway INT64, ...> at [89:12]; reason: invalidQuery, location: query, message: ORDER BY does not support expressions of type STRUCT<pathway_id STRING, pathway_name STRING, target_in_pathway INT64, ...> at [89:12]

Location: US
Job ID: 3ad67cab-684e-4c36-9ce3-ba7c698526a1

Please correct it and output only 1 complete SQL query.
2025-01-26 20:50:27 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:50:27 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID AS uniprot_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND i.target_uniprotID IS NOT NULL
),
all_uniprot_ids AS (
  SELECT DISTINCT uniprot_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
physical_entities AS (
  SELECT DISTINCT uniprot_id, stable_id AS pe_stable_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
pe_to_pathways AS (
  SELECT pe_stable_id, pathway_stable_id AS pathway_id
  FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
  WHERE LOWER(evidence_code) = 'tas'
),
pathways AS (
  SELECT stable_id AS pathway_id, name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77`
  WHERE LOWER(species) = 'homo sapiens'
    AND lowest_level = TRUE
),
entity_pathways AS (
  SELECT DISTINCT pe.uniprot_id, pt.pathway_id
  FROM physical_entities pe
  JOIN pe_to_pathways pt ON pe.pe_stable_id = pt.pe_stable_id
),
pathway_counts AS (
  SELECT
    ep.pathway_id,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NOT NULL THEN ep.uniprot_id END) AS target_in_pathway,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NULL THEN ep.uniprot_id END) AS non_target_in_pathway
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  GROUP BY ep.pathway_id
),
total_counts AS (
  SELECT
    (SELECT COUNT(DISTINCT uniprot_id) FROM target_data) AS total_targets,
    (SELECT COUNT(DISTINCT uniprot_id) FROM all_uniprot_ids WHERE uniprot_id NOT IN (SELECT uniprot_id FROM target_data)) AS total_non_targets
),
chi_squared_calc AS (
  SELECT
    pc.pathway_id,
    pw.pathway_name,
    pc.target_in_pathway,
    pc.non_target_in_pathway,
    total_counts.total_targets AS total_targets,
    total_counts.total_non_targets AS total_non_targets,
    (total_counts.total_targets - pc.target_in_pathway) AS target_out_pathway,
    (total_counts.total_non_targets - pc.non_target_in_pathway) AS non_target_out_pathway,
    -- N is total_targets + total_non_targets
    (total_counts.total_targets + total_counts.total_non_targets) AS N,
    -- Compute chi-squared statistic
    (
     (
      (pc.target_in_pathway * (total_counts.total_non_targets - pc.non_target_in_pathway) - 
       (total_counts.total_targets - pc.target_in_pathway) * pc.non_target_in_pathway
      ) ^ 2
     ) * (total_counts.total_targets + total_counts.total_non_targets)
     /
     (
       NULLIF((pc.target_in_pathway + (total_counts.total_targets - pc.target_in_pathway)) *
       (pc.non_target_in_pathway + (total_counts.total_non_targets - pc.non_target_in_pathway)) *
       (pc.target_in_pathway + pc.non_target_in_pathway) *
       ((total_counts.total_targets - pc.target_in_pathway) + (total_counts.total_non_targets - pc.non_target_in_pathway)), 0)
     )
    ) AS chi_squared_value
  FROM pathway_counts pc
  CROSS JOIN total_counts
  JOIN pathways pw ON pc.pathway_id = pw.pathway_id
  WHERE pc.target_in_pathway > 0
),
top3_pathways AS (
  SELECT pathway_id, pathway_name
  FROM chi_squared_calc
  WHERE chi_squared_value IS NOT NULL
  ORDER BY chi_squared_value DESC
  LIMIT 3
),
targets_in_top3 AS (
  SELECT DISTINCT td.uniprot_id
  FROM target_data td
  JOIN entity_pathways ep ON td.uniprot_id = ep.uniprot_id
  WHERE ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT td.uniprot_id
  FROM target_data td
  WHERE td.uniprot_id NOT IN (SELECT uniprot_id FROM targets_in_top3)
),
non_targets_in_top3 AS (
  SELECT DISTINCT ep.uniprot_id
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  WHERE td.uniprot_id IS NULL
    AND ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT au.uniprot_id
  FROM all_uniprot_ids au
  WHERE au.uniprot_id NOT IN (SELECT uniprot_id FROM target_data)
    AND au.uniprot_id NOT IN (SELECT uniprot_id FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_outside_top3;
```
2025-01-26 20:50:32 - root - INFO - itercount: 2
2025-01-26 20:50:32 - root - INFO - 0
2025-01-26 20:50:32 - root - INFO - results: 
Group,IsTarget,Count
Outside Top 3 Pathways,Yes,37
Outside Top 3 Pathways,No,11131
Within Top 3 Pathways,No,0
Within Top 3 Pathways,Yes,3


2025-01-26 20:50:32 - root - INFO - Please check the answer again by reviewing What are the counts of targets and non-targets within and outside the top 3 pathways with the highest chi-squared statistic for target species 'homo sapiens' associated with 'sorafenib' only? The targets should meet specific assay conditions (median assay value  100, with assay values below and above also  100 or NULL if not applicable), and only pathways with TAS evidence at the lowest level should be considered., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: ```csv
Group,IsTarget,Count
Within Top 3 Pathways,Yes,count1:int
Within Top 3 Pathways,No,count2:int
Outside Top 3 Pathways,Yes,count3:int
Outside Top 3 Pathways,No,count4:int
```

This table shows the counts of targets and non-targets within and outside the top 3 pathways with the highest chi-squared statistic for target species 'homo sapiens' associated with 'sorafenib' only. The targets meet the specific assay conditions (median assay value  100, with assay values below and above also  100 or NULL if not applicable), and only pathways with TAS evidence at the lowest level are considered. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Group,IsTarget,Count
Outside Top 3 Pathways,Yes,37
Outside Top 3 Pathways,No,11131
Within Top 3 Pathways,No,0
Within Top 3 Pathways,Yes,3
Current sql:
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID AS uniprot_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND i.target_uniprotID IS NOT NULL
),
all_uniprot_ids AS (
  SELECT DISTINCT uniprot_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
physical_entities AS (
  SELECT DISTINCT uniprot_id, stable_id AS pe_stable_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
pe_to_pathways AS (
  SELECT pe_stable_id, pathway_stable_id AS pathway_id
  FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
  WHERE LOWER(evidence_code) = 'tas'
),
pathways AS (
  SELECT stable_id AS pathway_id, name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77`
  WHERE LOWER(species) = 'homo sapiens'
    AND lowest_level = TRUE
),
entity_pathways AS (
  SELECT DISTINCT pe.uniprot_id, pt.pathway_id
  FROM physical_entities pe
  JOIN pe_to_pathways pt ON pe.pe_stable_id = pt.pe_stable_id
),
pathway_counts AS (
  SELECT
    ep.pathway_id,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NOT NULL THEN ep.uniprot_id END) AS target_in_pathway,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NULL THEN ep.uniprot_id END) AS non_target_in_pathway
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  GROUP BY ep.pathway_id
),
total_counts AS (
  SELECT
    (SELECT COUNT(DISTINCT uniprot_id) FROM target_data) AS total_targets,
    (SELECT COUNT(DISTINCT uniprot_id) FROM all_uniprot_ids WHERE uniprot_id NOT IN (SELECT uniprot_id FROM target_data)) AS total_non_targets
),
chi_squared_calc AS (
  SELECT
    pc.pathway_id,
    pw.pathway_name,
    pc.target_in_pathway,
    pc.non_target_in_pathway,
    total_counts.total_targets AS total_targets,
    total_counts.total_non_targets AS total_non_targets,
    (total_counts.total_targets - pc.target_in_pathway) AS target_out_pathway,
    (total_counts.total_non_targets - pc.non_target_in_pathway) AS non_target_out_pathway,
    -- N is total_targets + total_non_targets
    (total_counts.total_targets + total_counts.total_non_targets) AS N,
    -- Compute chi-squared statistic
    (
     (
      (pc.target_in_pathway * (total_counts.total_non_targets - pc.non_target_in_pathway) - 
       (total_counts.total_targets - pc.target_in_pathway) * pc.non_target_in_pathway
      ) ^ 2
     ) * (total_counts.total_targets + total_counts.total_non_targets)
     /
     (
       NULLIF((pc.target_in_pathway + (total_counts.total_targets - pc.target_in_pathway)) *
       (pc.non_target_in_pathway + (total_counts.total_non_targets - pc.non_target_in_pathway)) *
       (pc.target_in_pathway + pc.non_target_in_pathway) *
       ((total_counts.total_targets - pc.target_in_pathway) + (total_counts.total_non_targets - pc.non_target_in_pathway)), 0)
     )
    ) AS chi_squared_value
  FROM pathway_counts pc
  CROSS JOIN total_counts
  JOIN pathways pw ON pc.pathway_id = pw.pathway_id
  WHERE pc.target_in_pathway > 0
),
top3_pathways AS (
  SELECT pathway_id, pathway_name
  FROM chi_squared_calc
  WHERE chi_squared_value IS NOT NULL
  ORDER BY chi_squared_value DESC
  LIMIT 3
),
targets_in_top3 AS (
  SELECT DISTINCT td.uniprot_id
  FROM target_data td
  JOIN entity_pathways ep ON td.uniprot_id = ep.uniprot_id
  WHERE ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT td.uniprot_id
  FROM target_data td
  WHERE td.uniprot_id NOT IN (SELECT uniprot_id FROM targets_in_top3)
),
non_targets_in_top3 AS (
  SELECT DISTINCT ep.uniprot_id
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  WHERE td.uniprot_id IS NULL
    AND ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT au.uniprot_id
  FROM all_uniprot_ids au
  WHERE au.uniprot_id NOT IN (SELECT uniprot_id FROM target_data)
    AND au.uniprot_id NOT IN (SELECT uniprot_id FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_outside_top3;
2025-01-26 20:51:04 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-26 20:51:04 - root - INFO - ```sql
WITH target_data AS (
  SELECT DISTINCT i.target_uniprotID AS uniprot_id
  FROM `isb-cgc-bq.targetome_versioned.interactions_v1` i
  JOIN `isb-cgc-bq.targetome_versioned.drug_synonyms_v1` ds ON i.drugID = ds.drugID
  JOIN `isb-cgc-bq.targetome_versioned.experiments_v1` e ON i.expID = e.expID
  WHERE LOWER(ds.synonym) = 'sorafenib'
    AND LOWER(i.targetSpecies) = 'homo sapiens'
    AND e.exp_assayValueMedian <= 100
    AND (e.exp_assayValueLow <= 100 OR e.exp_assayValueLow IS NULL)
    AND (e.exp_assayValueHigh <= 100 OR e.exp_assayValueHigh IS NULL)
    AND i.target_uniprotID IS NOT NULL
),
all_uniprot_ids AS (
  SELECT DISTINCT uniprot_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
physical_entities AS (
  SELECT DISTINCT uniprot_id, stable_id AS pe_stable_id
  FROM `isb-cgc-bq.reactome_versioned.physical_entity_v77`
  WHERE uniprot_id IS NOT NULL
),
pe_to_pathways AS (
  SELECT pe_stable_id, pathway_stable_id AS pathway_id
  FROM `isb-cgc-bq.reactome_versioned.pe_to_pathway_v77`
  WHERE LOWER(evidence_code) = 'tas'
),
pathways AS (
  SELECT stable_id AS pathway_id, name AS pathway_name
  FROM `isb-cgc-bq.reactome_versioned.pathway_v77`
  WHERE LOWER(species) = 'homo sapiens'
    AND lowest_level = TRUE
),
entity_pathways AS (
  SELECT DISTINCT pe.uniprot_id, pt.pathway_id
  FROM physical_entities pe
  JOIN pe_to_pathways pt ON pe.pe_stable_id = pt.pe_stable_id
),
pathway_counts AS (
  SELECT
    ep.pathway_id,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NOT NULL THEN ep.uniprot_id END) AS target_in_pathway,
    COUNT(DISTINCT CASE WHEN td.uniprot_id IS NULL THEN ep.uniprot_id END) AS non_target_in_pathway
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  GROUP BY ep.pathway_id
),
total_counts AS (
  SELECT
    (SELECT COUNT(DISTINCT uniprot_id) FROM target_data) AS total_targets,
    (SELECT COUNT(DISTINCT uniprot_id) FROM all_uniprot_ids WHERE uniprot_id NOT IN (SELECT uniprot_id FROM target_data)) AS total_non_targets
),
chi_squared_calc AS (
  SELECT
    pc.pathway_id,
    pw.pathway_name,
    pc.target_in_pathway,
    pc.non_target_in_pathway,
    total_counts.total_targets AS total_targets,
    total_counts.total_non_targets AS total_non_targets,
    (total_counts.total_targets - pc.target_in_pathway) AS target_out_pathway,
    (total_counts.total_non_targets - pc.non_target_in_pathway) AS non_target_out_pathway,
    -- N is total_targets + total_non_targets
    (total_counts.total_targets + total_counts.total_non_targets) AS N,
    -- Compute chi-squared statistic
    (
     (
      (pc.target_in_pathway * (total_counts.total_non_targets - pc.non_target_in_pathway) - 
       (total_counts.total_targets - pc.target_in_pathway) * pc.non_target_in_pathway
      ) ^ 2
     ) * (total_counts.total_targets + total_counts.total_non_targets)
     /
     (
       NULLIF((pc.target_in_pathway + (total_counts.total_targets - pc.target_in_pathway)) *
       (pc.non_target_in_pathway + (total_counts.total_non_targets - pc.non_target_in_pathway)) *
       (pc.target_in_pathway + pc.non_target_in_pathway) *
       ((total_counts.total_targets - pc.target_in_pathway) + (total_counts.total_non_targets - pc.non_target_in_pathway)), 0)
     )
    ) AS chi_squared_value
  FROM pathway_counts pc
  CROSS JOIN total_counts
  JOIN pathways pw ON pc.pathway_id = pw.pathway_id
  WHERE pc.target_in_pathway > 0
),
top3_pathways AS (
  SELECT pathway_id, pathway_name
  FROM chi_squared_calc
  WHERE chi_squared_value IS NOT NULL
  ORDER BY chi_squared_value DESC
  LIMIT 3
),
targets_in_top3 AS (
  SELECT DISTINCT td.uniprot_id
  FROM target_data td
  JOIN entity_pathways ep ON td.uniprot_id = ep.uniprot_id
  WHERE ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
targets_outside_top3 AS (
  SELECT td.uniprot_id
  FROM target_data td
  WHERE td.uniprot_id NOT IN (SELECT uniprot_id FROM targets_in_top3)
),
non_targets_in_top3 AS (
  SELECT DISTINCT ep.uniprot_id
  FROM entity_pathways ep
  LEFT JOIN target_data td ON ep.uniprot_id = td.uniprot_id
  WHERE td.uniprot_id IS NULL
    AND ep.pathway_id IN (SELECT pathway_id FROM top3_pathways)
),
non_targets_outside_top3 AS (
  SELECT au.uniprot_id
  FROM all_uniprot_ids au
  WHERE au.uniprot_id NOT IN (SELECT uniprot_id FROM target_data)
    AND au.uniprot_id NOT IN (SELECT uniprot_id FROM non_targets_in_top3)
)
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'Yes' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM targets_outside_top3
UNION ALL
SELECT
  'Within Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_in_top3
UNION ALL
SELECT
  'Outside Top 3 Pathways' AS `Group`,
  'No' AS IsTarget,
  COUNT(DISTINCT uniprot_id) AS Count
FROM non_targets_outside_top3;
```
2025-01-26 20:51:06 - root - INFO - itercount: 3
2025-01-26 20:51:06 - root - INFO - 0
2025-01-26 20:51:06 - root - INFO - Total iteration counts: 3
