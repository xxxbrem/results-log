2025-01-27 21:32:25 - openai._base_client - INFO - Retrying request to /chat/completions in 0.389448 seconds
2025-01-27 21:33:09 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 21:33:11 - root - INFO - SQL:
SELECT DISTINCT `category`, `category_name`
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    LIMIT 100;
Results:
category,category_name
1012100.0,CANADIAN WHISKIES
1052100.0,IMPORTED BRANDIES
1081900.0,MISC. AMERICAN CORDIALS & LIQUEURS
1081250.0,WHITE CREME DE MENTHE
1081340.0,ROOT BEER SCHNAPPS
1082010.0,AMARETTO - IMPORTED
1071100,COCKTAILS/RTD
1022300.0,
1081000,AMERICAN CORDIALS & LIQUEURS
1031100.0,AMERICAN VODKAS
1071100.0,COCKTAILS/RTD
1011600.0,STRAIGHT RYE WHISKIES
1062200,WHITE RUM
1082200.0,IMPORTED SCHNAPPS
1041100,AMERICAN DRY GINS
1011300.0,TENNESSEE WHISKIES
1081010.0,AMERICAN AMARETTO
1081100,COFFEE LIQUEURS
1011400.0,BOTTLED IN BOND BOURBON
1081312.0,BUTTERSCOTCH SCHNAPPS
1091000.0,AMERICAN DISTILLED SPIRITS SPECIALTY
1092100.0,
1091300.0,
1900000.0,DELISTED / SPECIAL ORDER ITEMS
1032200,IMPORTED VODKA - MISC
1062300,FLAVORED RUM
1022200,100% AGAVE TEQUILA
1091100,AMERICAN DISTILLED SPIRITS SPECIALTY
1022100.0,MIXTO TEQUILA
1701100,TEMPORARY & SPECIALTY PACKAGES
1032200.0,IMPORTED FLAVORED VODKA
1062500.0,FLAVORED RUM
1012200.0,SCOTCH WHISKIES
1082100.0,IMPORTED CORDIALS & LIQUEURS
1081200,CREAM LIQUEURS
1081400,AMERICAN SCHNAPPS
1041200,FLAVORED GIN
1022200.0,
1031200,VODKA FLAVORED
1032080,IMPORTED VODKAS
1051100.0,AMERICAN BRANDIES
1062100.0,GOLD RUM
1042100,IMPORTED DRY GINS
,
1081100.0,
1042100.0,IMPORTED DRY GINS
1081600,WHISKEY LIQUEUR
1032100,IMPORTED VODKAS
1031200,AMERICAN FLAVORED VODKA
1081100.0,COFFEE LIQUEURS
1091200,NEUTRAL GRAIN SPIRITS
1062300.0,FLAVORED RUM
1071100.0,AMERICAN COCKTAILS
1081330.0,PEACH SCHNAPPS
1070000.0,COCKTAILS/RTD
1012210.0,SINGLE MALT SCOTCH
1081220.0,DARK CREME DE CACAO
1042000.0,IMPORTED GINS
1031080,VODKA 80 PROOF
1011300,SINGLE BARREL BOURBON WHISKIES
1700000.0,TEMPORARY & SPECIALTY PACKAGES
1012100,CANADIAN WHISKIES
1032000.0,IMPORTED VODKAS
1082000,IMPORTED CORDIALS & LIQUEURS
1022300.0,MEZCAL
1012400.0,JAPANESE WHISKY
1011250.0,SINGLE BARREL BOURBON WHISKIES
1901000.0,SPECIAL ORDER ITEMS
1032100.0,
1082200.0,
1070100.0,TEMPORARY & SPECIALTY PACKAGES
1012000.0,IMPORTED WHISKIES
1011400,TENNESSEE WHISKIES
1082100,IMPORTED CORDIALS & LIQUEURS
1701100.0,DECANTERS & SPECIALTY PACKAGES
1081305.0,APPLE SCHNAPPS
1012300,SINGLE MALT SCOTCH
1081380.0,MISCELLANEOUS SCHNAPPS
1011500.0,STRAIGHT RYE WHISKIES
1081317.0,GRAPE SCHNAPPS

2025-01-27 21:33:12 - root - INFO - SQL:
SELECT *
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    LIMIT 100;
Results:
invoice_and_item_number,date,store_number,store_name,address,city,zip_code,store_location,county_number,county,category,category_name,vendor_number,vendor_name,item_number,item_description,pack,bottle_volume_ml,state_bottle_cost,state_bottle_retail,bottles_sold,sale_dollars,volume_sold_liters,volume_sold_gallons
INV-40274700028,2021-09-21,3723,J D SPIRITS LIQUOR,1023  9TH ST,ONAWA,51040.0,POINT(-96.095845 42.025841),67,MONONA,1082100.0,IMPORTED CORDIALS & LIQUEURS,192,"MAST-JAGERMEISTER US, INC",65259,JAGERMEISTER LIQUEUR MINI MEISTERS,12,20,4.93,7.4,1,7.4,0.02,0.0
INV-35760000007,2021-04-13,5956,BP FUEL / DUBUQUE,1450 LORAS BLVD,DUBUQUE,52001.0,POINT(-90.687255 42.500724),31,DUBUQUE,1081600.0,WHISKEY LIQUEUR,421.0,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-37574100077,2021-06-17,2642,HY-VEE WINE AND SPIRITS / PELLA,512 E OSKALOOSA,PELLA,50219.0,POINT(-92.899277 41.396961),63,MARION,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-36439300012,2021-05-07,4823,CASEY'S GENERAL STORE #3223 / CRESTON,903 N SUMNER AVE,CRESTON,50801.0,POINT(-94.372568 41.066824),88,UNION,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-41582800061,2021-11-02,6173,MINI-MART / INDEPENDENCE,709 1ST STREET WEST,INDEPENDENCE,50644.0,POINT(-91.901687 42.468633),10,BUCHANAN,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-37726900001,2021-06-22,4506,CASEY'S GENERAL STORE #2667 / TIFFIN,403 STEPHENS ST,TIFFIN,52340.0,POINT(-91.660199 41.707316),52,JOHNSON,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-42023000023,2021-11-16,2619,HY-VEE WINE AND SPIRITS / WDM,1725  74TH ST,WEST DES MOINES,50266.0,POINT(-93.808855 41.598515),77,POLK,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01

2025-01-27 21:33:14 - root - INFO - SQL:
SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
Results:
category_name,total_sales,total_volume_liters
BLENDED WHISKIES,12635514.850000016,848135.8600000002
AMERICAN BRANDIES,5216033.319999998,416447.8600000001
IRISH WHISKIES,9238465.82999999,301769.6300000001
GOLD RUM,1162585.6700000002,100701.62
AMERICAN DISTILLED SPIRITS SPECIALTY,1497977.379999999,55730.35000000004
CREAM LIQUEURS,8860918.940000001,375998.50999999995
SINGLE MALT SCOTCH,4454879.36,73168.09999999996
IMPORTED VODKAS,14556785.38000001,815542.7699999999
SPICED RUM,23123177.070000023,1482216.2799999998
COCKTAILS/RTD,8692059.710000003,1103047.59
IMPORTED GINS,3186.72,108.0
AMERICAN WHISKIES,1881.0,49.5
CORN WHISKIES,442212.52000000037,10279.0
MEZCAL,430727.72999999975,9980.25
TEMPORARY & SPECIALTY PACKAGES,10174030.039999992,342307.04000000015
STRAIGHT RYE WHISKIES,4793496.380000002,114997.06000000001
IMPORTED DRY GINS,5602434.379999996,218495.6099999999
STRAIGHT BOURBON WHISKIES,34498254.83000001,1341916.9500000007
AMERICAN SCHNAPPS,6561224.370000011,525463.45
IMPORTED FLAVORED VODKA,5785184.289999995,267295.33999999985
TRIPLE SEC,848208.0199999999,208774.0
AMERICAN VODKAS,61440411.23999981,5697648.87
IMPORTED DISTILLED SPIRITS SPECIALTY,2198562.0699999984,265133.22999999986
WHISKEY LIQUEUR,24665650.709999982,1154025.0599999991
FLAVORED RUM,9023511.589999994,583419.1300000004
IMPORTED SCHNAPPS,6637742.61,349768.04999999993
100% AGAVE TEQUILA,23915928.889999986,618136.8100000002
AMERICAN SLOE GINS,31666.349999999995,3895.0
CANADIAN WHISKIES,47392655.6699998,3028926.9
AGED DARK RUM,1073387.5300000003,42201.200000000004
IMPORTED WHISKIES,5518.799999999999,45.0
SPECIAL ORDER ITEMS,1523594.6000000003,125307.64999999995
DISTILLED SPIRITS SPECIALTY,28070.0,601.5
TENNESSEE WHISKIES,16276000.050000023,525973.8
WHITE RUM,6709359.5900000045,611902.5399999998
IMPORTED CORDIALS & LIQUEURS,11206838.640000006,363732.5099999999
MIXTO TEQUILA,10668562.360000003,639032.7999999999
NEUTRAL GRAIN SPIRITS,642212.9200000004,37928.84
AMERICAN FLAVORED VODKA,10537284.849999988,713027.9300000002
AMERICAN CORDIALS & LIQUEURS,4293640.0699999975,252516.25000000023
COFFEE LIQUEURS,2126049.5400000005,96073.67
BOTTLED IN BOND BOURBON,694701.2700000001,22162.0
AMERICAN DRY GINS,3712780.8,348315.9799999999
FLAVORED GIN,388056.54,13611.949999999997
SCOTCH WHISKIES,5719870.5699999975,235825.11000000007
SINGLE BARREL BOURBON WHISKIES,1066574.4600000002,23573.25

2025-01-27 21:33:16 - root - INFO - SQL:
SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
Results:
category_name,avg_price_per_liter
BLENDED WHISKIES,14.897984445558059
AMERICAN BRANDIES,12.525057326504212
AMERICAN VODKAS,10.783467469100078
IMPORTED DISTILLED SPIRITS SPECIALTY,8.292291652766421
IMPORTED BRANDIES,48.25868371964293
NEUTRAL GRAIN SPIRITS FLAVORED,26.749903417553686
AMERICAN DISTILLED SPIRITS SPECIALTY,26.879023368774792
AMERICAN FLAVORED VODKA,14.77822173108982
AMERICAN CORDIALS & LIQUEURS,17.00342084915324
COFFEE LIQUEURS,22.129367390670104
BOTTLED IN BOND BOURBON,31.34650618175255
IMPORTED VODKAS,17.849199227160096
SPICED RUM,15.600406892036046
COCKTAILS/RTD,7.880040524815431
IMPORTED GINS,29.506666666666664
SPECIAL ORDER ITEMS,12.158831483951692
DISTILLED SPIRITS SPECIALTY,46.666666666666664
TEMPORARY & SPECIALTY PACKAGES,29.721942148779622
STRAIGHT RYE WHISKIES,41.683642868782925
IMPORTED DRY GINS,25.640947111019756
TENNESSEE WHISKIES,30.94450721689944
WHITE RUM,10.964751984850409
IMPORTED CORDIALS & LIQUEURS,30.810659844510514
MIXTO TEQUILA,16.694858792850702
NEUTRAL GRAIN SPIRITS,16.932047486820057
CREAM LIQUEURS,23.56636716459328
SINGLE MALT SCOTCH,60.88554110329501
CORN WHISKIES,43.02096702013817
MEZCAL,43.158010069888036
STRAIGHT BOURBON WHISKIES,25.708189191588943
AMERICAN SCHNAPPS,12.486547580045784
IMPORTED FLAVORED VODKA,21.643416192740236
TRIPLE SEC,4.062804851178784
CANADIAN WHISKIES,15.646681889219506
AGED DARK RUM,25.435000189568054
IMPORTED WHISKIES,122.63999999999999
AMERICAN WHISKIES,38.0
AMERICAN DRY GINS,10.659231884796101
FLAVORED GIN,28.50851935248071
SCOTCH WHISKIES,24.254713885217726
SINGLE BARREL BOURBON WHISKIES,45.2451172409405
WHISKEY LIQUEUR,21.37358326516758
FLAVORED RUM,15.466602183579408
IMPORTED SCHNAPPS,18.97755558290702
100% AGAVE TEQUILA,38.69034896983404
AMERICAN SLOE GINS,8.129999999999999
IRISH WHISKIES,30.61429949064123
GOLD RUM,11.544855683553054

2025-01-27 21:33:18 - root - INFO - SQL:
SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2019
    GROUP BY `category_name`
    LIMIT 100;
Results:
category_name,total_sales,total_volume_liters
BLENDED WHISKIES,9611134.78000002,817091.6600000001
AMERICAN BRANDIES,5257186.579999993,425535.0899999996
IMPORTED VODKAS,16172742.560000004,905641.8900000006
SPICED RUM,21474888.770000048,1392099.1100000008
COCKTAILS/RTD,5507831.270000004,783310.1700000005
AMERICAN VODKAS,51742838.88999996,5223817.869999997
IMPORTED DISTILLED SPIRITS SPECIALTY,1478086.3300000005,187347.85999999996
CREAM LIQUEURS,6548226.790000001,305370.40000000014
SINGLE MALT SCOTCH,3720672.7099999995,65092.369999999995
SPECIAL ORDER ITEMS,1912236.03,168706.69
AMERICAN FLAVORED VODKA,8887524.400000013,641610.4399999996
COFFEE LIQUEURS,1857033.5399999996,88121.37999999999
AMERICAN CORDIALS & LIQUEURS,2781196.369999996,201257.69
BOTTLED IN BOND BOURBON,192165.09000000005,6843.75
WHISKEY LIQUEUR,19786836.119999982,1111827.2399999993
100% AGAVE TEQUILA,12823526.709999993,367782.11
FLAVORED RUM,7134344.709999995,474148.55000000005
IMPORTED SCHNAPPS,5349283.099999998,282217.27999999997
AMERICAN SLOE GINS,29358.93,3441.0
STRAIGHT BOURBON WHISKIES,23988780.33999999,1073887.7700000003
IMPORTED FLAVORED VODKA,6396746.07,284351.76999999996
AMERICAN SCHNAPPS,5510241.980000009,489022.59000000014
TRIPLE SEC,755213.0300000003,184869.5
CANADIAN WHISKIES,42556225.01999995,2866738.4299999992
AGED DARK RUM,711047.6600000001,31512.75
,340400.0800000001,14629.840000000007
AMERICAN DISTILLED SPIRITS SPECIALTY,342341.3299999997,14896.48
IRISH WHISKIES,7914793.199999994,260449.57
GOLD RUM,1177615.9300000006,107731.52
IMPORTED CORDIALS & LIQUEURS,8384195.830000001,297531.7700000001
TENNESSEE WHISKIES,14565908.80000002,488277.76000000024
WHITE RUM,6475953.400000008,614028.4099999998
MIXTO TEQUILA,8961340.519999994,560709.1400000001
NEUTRAL GRAIN SPIRITS,569230.4400000001,33451.79
CORN WHISKIES,235620.28999999992,6445.5
MEZCAL,167404.53000000003,4260.0
NEUTRAL GRAIN SPIRITS FLAVORED,430607.45999999985,17490.299999999996
IMPORTED BRANDIES,11903676.89999998,273398.35999999975
TEMPORARY & SPECIALTY PACKAGES,8144156.410000005,328411.0900000001
IMPORTED DRY GINS,4689169.109999997,186488.8799999997
STRAIGHT RYE WHISKIES,3245327.4900000007,86737.01999999997
IOWA DISTILLERY WHISKIES,188730.89999999997,4195.5
AMERICAN DRY GINS,3477650.1400000015,357933.88
SCOTCH WHISKIES,5220195.939999996,243341.24999999997
SINGLE BARREL BOURBON WHISKIES,491434.03000000026,12518.25

2025-01-27 21:33:20 - root - INFO - SQL:
SELECT
      EXTRACT(YEAR FROM `date`) AS year,
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) IN (2019, 2020, 2021)
    GROUP BY year, `category_name`
    LIMIT 100;
Results:
year,category_name,avg_price_per_liter
2020,IRISH WHISKIES,30.626024569553664
2020,STRAIGHT RYE WHISKIES,39.89246488782914
2020,AMERICAN DRY GINS,10.617011590200837
2021,IMPORTED BRANDIES,48.258683719642924
2020,AMERICAN BRANDIES,12.511142937266218
2020,IMPORTED SCHNAPPS,19.25455518897707
2021,COFFEE LIQUEURS,22.1293673906701
2021,IMPORTED FLAVORED VODKA,21.643416192740226
2021,SINGLE BARREL BOURBON WHISKIES,45.24511724094048
2021,NEUTRAL GRAIN SPIRITS,16.932047486820064
2019,AMERICAN DISTILLED SPIRITS SPECIALTY,22.981357340794595
2019,IMPORTED FLAVORED VODKA,22.495889756550486
2020,AMERICAN FLAVORED VODKA,14.37529719912237
2021,AMERICAN FLAVORED VODKA,14.77822173108981
2019,SPICED RUM,15.426264276542812
2019,SINGLE BARREL BOURBON WHISKIES,39.25740658638389
2020,IMPORTED DRY GINS,25.539127017730863
2021,AGED DARK RUM,25.43500018956806
2021,DISTILLED SPIRITS SPECIALTY,46.666666666666664
2019,MEZCAL,39.29683802816902
2021,AMERICAN SLOE GINS,8.129999999999995
2020,WHISKEY LIQUEUR,20.73035191736055
2020,BLENDED WHISKIES,14.177418874399729
2021,AMERICAN VODKAS,10.783467469100078
2019,CREAM LIQUEURS,21.443554417847952
2020,AMERICAN DISTILLED SPIRITS SPECIALTY,26.451632087413692
2021,MIXTO TEQUILA,16.694858792850713
2020,DISTILLED SPIRITS SPECIALTY,41.00539396078036
2019,IMPORTED CORDIALS & LIQUEURS,28.179161606842857
2021,TEMPORARY & SPECIALTY PACKAGES,29.72194214877963
2020,CANADIAN WHISKIES,14.945131655072599
2021,IMPORTED VODKAS,17.849199227160092
2019,FLAVORED RUM,15.046644580058286
2021,GOLD RUM,11.544855683553061
2019,AMERICAN BRANDIES,12.35429628141827
2020,IMPORTED CORDIALS & LIQUEURS,30.195326536840927
2021,IMPORTED CORDIALS & LIQUEURS,30.810659844510504
2019,IMPORTED BRANDIES,43.539679243138096
2021,BOTTLED IN BOND BOURBON,31.34650618175255
2020,BOTTLED IN BOND BOURBON,29.575726763855567
2021,IMPORTED GINS,29.506666666666664
2019,CANADIAN WHISKIES,14.844823153258499
2020,IMPORTED VODKAS,16.914344925388168
2020,IMPORTED FLAVORED VODKA,21.571944764231887
2020,SPICED RUM,15.345321660461234
2019,WHITE RUM,10.5466673765144
2020,CREAM LIQUEURS,22.742294325622776
2020,SCOTCH WHISKIES,22.53605727632423
2020,GOLD RUM,11.352277433620918
2019,AGED DARK RUM,22.56380861714704
2021,CORN WHISKIES,43.02096702013817
2019,SINGLE MALT SCOTCH,57.15989001475903

2025-01-27 21:33:22 - root - INFO - SQL:
SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    ORDER BY avg_price_per_liter DESC
    LIMIT 10;
Results:
category_name,avg_price_per_liter
IMPORTED WHISKIES,122.63999999999999
SINGLE MALT SCOTCH,60.88554110329501
IMPORTED BRANDIES,48.258683719642896
DISTILLED SPIRITS SPECIALTY,46.666666666666664
SINGLE BARREL BOURBON WHISKIES,45.24511724094051
MEZCAL,43.158010069888014
CORN WHISKIES,43.02096702013819
STRAIGHT RYE WHISKIES,41.68364286878289
100% AGAVE TEQUILA,38.690348969834034
AMERICAN WHISKIES,38.0

2025-01-27 21:33:24 - root - INFO - SQL:
SELECT
      `category_name`,
      EXTRACT(YEAR FROM `date`) AS year,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`, year
    ORDER BY `category_name`, year
    LIMIT 100;
Results:
category_name,year,avg_price_per_liter
,2019,23.267518988587714
,2020,31.71592960640305
100% AGAVE TEQUILA,2019,34.86718456751473
100% AGAVE TEQUILA,2020,34.80330108401572
100% AGAVE TEQUILA,2021,38.69034896983405
AGED DARK RUM,2019,22.563808617147036
AGED DARK RUM,2020,23.9692682995854
AGED DARK RUM,2021,25.43500018956806
AMERICAN BRANDIES,2019,12.354296281418277
AMERICAN BRANDIES,2020,12.511142937266218
AMERICAN BRANDIES,2021,12.525057326504204
AMERICAN CORDIALS & LIQUEURS,2019,13.819081248522716
AMERICAN CORDIALS & LIQUEURS,2020,15.93246725400036
AMERICAN CORDIALS & LIQUEURS,2021,17.003420849153247
AMERICAN DISTILLED SPIRITS SPECIALTY,2019,22.98135734079461
AMERICAN DISTILLED SPIRITS SPECIALTY,2020,26.451632087413707
AMERICAN DISTILLED SPIRITS SPECIALTY,2021,26.8790233687748
AMERICAN DRY GINS,2019,9.715900992663798
AMERICAN DRY GINS,2020,10.617011590200836
AMERICAN DRY GINS,2021,10.659231884796101
AMERICAN FLAVORED VODKA,2019,13.851901162954903
AMERICAN FLAVORED VODKA,2020,14.37529719912236
AMERICAN FLAVORED VODKA,2021,14.778221731089817
AMERICAN SCHNAPPS,2019,11.267867973133935
AMERICAN SCHNAPPS,2020,12.309911189230489
AMERICAN SCHNAPPS,2021,12.486547580045785
AMERICAN SLOE GINS,2019,8.532092414995644
AMERICAN SLOE GINS,2020,8.129999999999995
AMERICAN SLOE GINS,2021,8.129999999999999
AMERICAN VODKAS,2019,9.905176669185815
AMERICAN VODKAS,2020,10.371592670487642
AMERICAN VODKAS,2021,10.783467469100081
AMERICAN WHISKIES,2021,38.0
BLENDED WHISKIES,2019,11.762615200355878
BLENDED WHISKIES,2020,14.177418874399724
BLENDED WHISKIES,2021,14.897984445558071
BOTTLED IN BOND BOURBON,2019,28.078917260273965
BOTTLED IN BOND BOURBON,2020,29.575726763855563
BOTTLED IN BOND BOURBON,2021,31.346506181752535
CANADIAN WHISKIES,2019,14.844823153258515
CANADIAN WHISKIES,2020,14.945131655072585
CANADIAN WHISKIES,2021,15.64668188921952
COCKTAILS/RTD,2019,7.031481884117501
COCKTAILS/RTD,2020,7.201814574552641
COCKTAILS/RTD,2021,7.880040524815437
COFFEE LIQUEURS,2019,21.073586682369243
COFFEE LIQUEURS,2020,20.975750359383508
COFFEE LIQUEURS,2021,22.129367390670097
CORN WHISKIES,2019,36.5557815530215
CORN WHISKIES,2020,43.98408575207071
CORN WHISKIES,2021,43.02096702013817
CREAM LIQUEURS,2019,21.443554417847952
CREAM LIQUEURS,2020,22.742294325622776

2025-01-27 21:33:25 - root - INFO - SQL:
SELECT
      `category_name`,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2019,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2020,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2021
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`
    HAVING avg_price_2019 < avg_price_2020 AND avg_price_2020 < avg_price_2021
    LIMIT 100;
Results:
category_name,avg_price_2019,avg_price_2020,avg_price_2021
CREAM LIQUEURS,21.44,22.74,23.57
SINGLE MALT SCOTCH,57.16,60.72,60.89
GOLD RUM,10.93,11.35,11.54
BLENDED WHISKIES,11.76,14.18,14.9
AMERICAN BRANDIES,12.35,12.51,12.53
AMERICAN FLAVORED VODKA,13.85,14.38,14.78
AMERICAN CORDIALS & LIQUEURS,13.82,15.93,17.0
BOTTLED IN BOND BOURBON,28.08,29.58,31.35
AMERICAN DISTILLED SPIRITS SPECIALTY,22.98,26.45,26.88
COCKTAILS/RTD,7.03,7.2,7.88
WHISKEY LIQUEUR,17.8,20.73,21.37
FLAVORED RUM,15.05,15.2,15.47
TEMPORARY & SPECIALTY PACKAGES,24.8,28.02,29.72
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
IMPORTED DRY GINS,25.14,25.54,25.64
IMPORTED BRANDIES,43.54,44.21,48.26
NEUTRAL GRAIN SPIRITS FLAVORED,24.62,25.3,26.75
CANADIAN WHISKIES,14.84,14.95,15.65
AGED DARK RUM,22.56,23.97,25.44
IMPORTED CORDIALS & LIQUEURS,28.18,30.2,30.81
TENNESSEE WHISKIES,29.83,30.67,30.94
AMERICAN DRY GINS,9.72,10.62,10.66
FLAVORED GIN,15.94,17.05,28.51
SCOTCH WHISKIES,21.45,22.54,24.25
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
AMERICAN VODKAS,9.91,10.37,10.78
IMPORTED DISTILLED SPIRITS SPECIALTY,7.89,8.22,8.29
STRAIGHT BOURBON WHISKIES,22.34,23.93,25.71
AMERICAN SCHNAPPS,11.27,12.31,12.49

2025-01-27 21:33:27 - root - INFO - SQL:
SELECT
      t.`category_name`,
      ROUND(t.avg_price_2019, 2) AS avg_price_2019,
      ROUND(t.avg_price_2020, 2) AS avg_price_2020,
      ROUND(t.avg_price_2021, 2) AS avg_price_2021
    FROM (
      SELECT
        `category_name`,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
      FROM `bigquery-public-data.iowa_liquor_sales.sales`
      WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
      GROUP BY `category_name`
    ) AS t
    ORDER BY t.avg_price_2021 DESC
    LIMIT 10;
Results:
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.16,60.72,60.89
IMPORTED BRANDIES,43.54,44.21,48.26
DISTILLED SPIRITS SPECIALTY,,41.01,46.67
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
MEZCAL,39.3,39.04,43.16
CORN WHISKIES,36.56,43.98,43.02
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
100% AGAVE TEQUILA,34.87,34.8,38.69
AMERICAN WHISKIES,,,38.0

2025-01-27 21:33:27 - root - INFO - itercount: 0
2025-01-27 21:33:27 - root - INFO - Database Name: bigquery-public-data
Schema Name: iowa_liquor_sales
DDL describes table information.
,0
table_name,sales
ddl,"CREATE TABLE `bigquery-public-data.iowa_liquor_sales.sales`
(
  invoice_and_item_number STRING OPTIONS(description=""Concatenated invoice and line number associated with the liquor order. This provides a unique identifier for the individual liquor products included in the store order.""),
  date DATE OPTIONS(description=""Date of order""),
  store_number STRING OPTIONS(description=""Unique number assigned to the store who ordered the liquor.""),
  store_name STRING OPTIONS(description=""Name of store who ordered the liquor.""),
  address STRING OPTIONS(description=""Address of store who ordered the liquor.""),
  city STRING OPTIONS(description=""City where the store who ordered the liquor is located""),
  zip_code STRING OPTIONS(description=""Zip code where the store who ordered the liquor is located""),
  store_location GEOGRAPHY OPTIONS(description=""Location of store who ordered the liquor. The Address, City, State and Zip Code are geocoded to provide geographic coordinates. Accuracy of geocoding is dependent on how well the address is interpreted and the completeness of the reference data used.""),
  county_number STRING OPTIONS(description=""Iowa county number for the county where store who ordered the liquor is located""),
  county STRING OPTIONS(description=""County where the store who ordered the liquor is located""),
  category STRING OPTIONS(description=""Category code associated with the liquor ordered""),
  category_name STRING OPTIONS(description=""Category of the liquor ordered.""),
  vendor_number STRING OPTIONS(description=""The vendor number of the company for the brand of liquor ordered""),
  vendor_name STRING OPTIONS(description=""The vendor name of the company for the brand of liquor ordered""),
  item_number STRING OPTIONS(description=""Item number for the individual liquor product ordered.""),
  item_description STRING OPTIONS(description=""Description of the individual liquor product ordered.""),
  pack INT64 OPTIONS(description=""The number of bottles in a case for the liquor ordered""),
  bottle_volume_ml INT64 OPTIONS(description=""Volume of each liquor bottle ordered in milliliters.""),
  state_bottle_cost FLOAT64 OPTIONS(description=""The amount that Alcoholic Beverages Division paid for each bottle of liquor ordered""),
  state_bottle_retail FLOAT64 OPTIONS(description=""The amount the store paid for each bottle of liquor ordered""),
  bottles_sold INT64 OPTIONS(description=""The number of bottles of liquor ordered by the store""),
  sale_dollars FLOAT64 OPTIONS(description=""Total cost of liquor order (number of bottles multiplied by the state bottle retail)""),
  volume_sold_liters FLOAT64 OPTIONS(description=""Total volume of liquor ordered in liters. (i.e. (Bottle Volume (ml) x Bottles Sold)/1,000)\""""),
  volume_sold_gallons FLOAT64 OPTIONS(description=""Total volume of liquor ordered in gallons. (i.e. (Bottle Volume (ml) x Bottles Sold)/3785.411784)\"""")
)
OPTIONS(
  description=""Sales Dataset""
);"

External knowledge that might be helpful: 
None
The table structure information is ({database name: {schema name: {table name}}}): 
{'bigquery-public-data': {'iowa_liquor_sales': ['sales']}}
Begin Exploring Related Columns
**Relevant Columns and Their Potential Usage:**

- **`date`**: Used to filter records by year (2019, 2020, 2021).
- **`category`**: Category code associated with the liquor ordered; useful for grouping.
- **`category_name`**: Name of the liquor category; used for display and grouping.
- **`sale_dollars`**: Total sales amount; used to calculate total revenue.
- **`volume_sold_liters`**: Total volume sold in liters; essential for calculating the average price per liter.
- **`bottle_volume_ml`**: Volume of each bottle; may aid in validating volume calculations.
- **`bottles_sold`**: Number of bottles sold; could be used in detailed sales analysis.
- **`state_bottle_retail`**: Retail price per bottle; may be used to calculate expected sales.
  
**Conditions That May Be Used:**

- Filter records for the years **2019**, **2020**, and **2021**.
- Group data by **`category`** or **`category_name`**.
- Calculate **average price per liter** for each category.
- Order results to identify top categories.
  
**SQL Queries:**

1. **Select distinct liquor categories:**

    ```sql
    SELECT DISTINCT `category`, `category_name`
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    LIMIT 100;
    ```

2. **Retrieve sales records for the year 2021:**

    ```sql
    SELECT *
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    LIMIT 100;
    ```

3. **Calculate total sales and volume for each category in 2021:**

    ```sql
    SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
    ```

4. **Compute average price per liter for each category in 2021:**

    ```sql
    SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
    ```

5. **List total sales and volume for categories in 2019:**

    ```sql
    SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2019
    GROUP BY `category_name`
    LIMIT 100;
    ```

6. **Calculate average price per liter by category for each year:**

    ```sql
    SELECT
      EXTRACT(YEAR FROM `date`) AS year,
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) IN (2019, 2020, 2021)
    GROUP BY year, `category_name`
    LIMIT 100;
    ```

7. **Identify top 10 categories by average price per liter in 2021:**

    ```sql
    SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    ORDER BY avg_price_per_liter DESC
    LIMIT 10;
    ```

8. **Compare average price per liter for categories across 2019, 2020, and 2021:**

    ```sql
    SELECT
      `category_name`,
      EXTRACT(YEAR FROM `date`) AS year,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`, year
    ORDER BY `category_name`, year
    LIMIT 100;
    ```

9. **Find categories with increasing average price per liter over the years:**

    ```sql
    SELECT
      `category_name`,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2019,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2020,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2021
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`
    HAVING avg_price_2019 < avg_price_2020 AND avg_price_2020 < avg_price_2021
    LIMIT 100;
    ```

10. **Compute average price per liter for top 10 categories in 2021 and display their prices for all three years:**

    ```sql
    SELECT
      t.`category_name`,
      ROUND(t.avg_price_2019, 2) AS avg_price_2019,
      ROUND(t.avg_price_2020, 2) AS avg_price_2020,
      ROUND(t.avg_price_2021, 2) AS avg_price_2021
    FROM (
      SELECT
        `category_name`,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
      FROM `bigquery-public-data.iowa_liquor_sales.sales`
      WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
      GROUP BY `category_name`
    ) AS t
    ORDER BY t.avg_price_2021 DESC
    LIMIT 10;
    ```

These queries progressively build upon each other, starting from basic data retrieval to more complex aggregations and calculations required to solve the original task.Query:
SELECT DISTINCT `category`, `category_name`
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    LIMIT 100;
Answer:
category,category_name
1012100.0,CANADIAN WHISKIES
1052100.0,IMPORTED BRANDIES
1081900.0,MISC. AMERICAN CORDIALS & LIQUEURS
1081250.0,WHITE CREME DE MENTHE
1081340.0,ROOT BEER SCHNAPPS
1082010.0,AMARETTO - IMPORTED
1071100,COCKTAILS/RTD
1022300.0,
1081000,AMERICAN CORDIALS & LIQUEURS
1031100.0,AMERICAN VODKAS
1071100.0,COCKTAILS/RTD
1011600.0,STRAIGHT RYE WHISKIES
1062200,WHITE RUM
1082200.0,IMPORTED SCHNAPPS
1041100,AMERICAN DRY GINS
1011300.0,TENNESSEE WHISKIES
1081010.0,AMERICAN AMARETTO
1081100,COFFEE LIQUEURS
1011400.0,BOTTLED IN BOND BOURBON
1081312.0,BUTTERSCOTCH SCHNAPPS
1091000.0,AMERICAN DISTILLED SPIRITS SPECIALTY
1092100.0,
1091300.0,
1900000.0,DELISTED / SPECIAL ORDER ITEMS
1032200,IMPORTED VODKA - MISC
1062300,FLAVORED RUM
1022200,100% AGAVE TEQUILA
1091100,AMERICAN DISTILLED SPIRITS SPECIALTY
1022100.0,MIXTO TEQUILA
1701100,TEMPORARY & SPECIALTY PACKAGES
1032200.0,IMPORTED FLAVORED VODKA
1062500.0,FLAVORED RUM
1012200.0,SCOTCH WHISKIES
1082100.0,IMPORTED CORDIALS & LIQUEURS
1081200,CREAM LIQUEURS
1081400,AMERICAN SCHNAPPS
1041200,FLAVORED GIN
1022200.0,
1031200,VODKA FLAVORED
1032080,IMPORTED VODKAS
1051100.0,AMERICAN BRANDIES
1062100.0,GOLD RUM
1042100,IMPORTED DRY GINS
,
1081100.0,
1042100.0,IMPORTED DRY GINS
1081600,WHISKEY LIQUEUR
1032100,IMPORTED VODKAS
1031200,AMERICAN FLAVORED VODKA
1081100.0,COFFEE LIQUEURS
1091200,NEUTRAL GRAIN SPIRITS
1062300.0,FLAVORED RUM
1071100.0,AMERICAN COCKTAILS
1081330.0,PEACH SCHNAPPS
1070000.0,COCKTAILS/RTD
1012210.0,SINGLE MALT SCOTCH
1081220.0,DARK CREME DE CACAO
1042000.0,IMPORTED GINS
1031080,VODKA 80 PROOF
1011300,SINGLE BARREL BOURBON WHISKIES
1700000.0,TEMPORARY & SPECIALTY PACKAGES
1012100,CANADIAN WHISKIES
1032000.0,IMPORTED VODKAS
1082000,IMPORTED CORDIALS & LIQUEURS
1022300.0,MEZCAL
1012400.0,JAPANESE WHISKY
1011250.0,SINGLE BARREL BOURBON WHISKIES
1901000.0,SPECIAL ORDER ITEMS
1032100.0,
1082200.0,
1070100.0,TEMPORARY & SPECIALTY PACKAGES
1012000.0,IMPORTED WHISKIES
1011400,TENNESSEE WHISKIES
1082100,IMPORTED CORDIALS & LIQUEURS
1701100.0,DECANTERS & SPECIALTY PACKAGES
1081305.0,APPLE SCHNAPPS
1012300,SINGLE MALT SCOTCH
1081380.0,MISCELLANEOUS SCHNAPPS
1011500.0,STRAIGHT RYE WHISKIES
1081317.0,GRAPE SCHNAPPS
Query:
SELECT *
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    LIMIT 100;
Answer:
invoice_and_item_number,date,store_number,store_name,address,city,zip_code,store_location,county_number,county,category,category_name,vendor_number,vendor_name,item_number,item_description,pack,bottle_volume_ml,state_bottle_cost,state_bottle_retail,bottles_sold,sale_dollars,volume_sold_liters,volume_sold_gallons
INV-40274700028,2021-09-21,3723,J D SPIRITS LIQUOR,1023  9TH ST,ONAWA,51040.0,POINT(-96.095845 42.025841),67,MONONA,1082100.0,IMPORTED CORDIALS & LIQUEURS,192,"MAST-JAGERMEISTER US, INC",65259,JAGERMEISTER LIQUEUR MINI MEISTERS,12,20,4.93,7.4,1,7.4,0.02,0.0
INV-35760000007,2021-04-13,5956,BP FUEL / DUBUQUE,1450 LORAS BLVD,DUBUQUE,52001.0,POINT(-90.687255 42.500724),31,DUBUQUE,1081600.0,WHISKEY LIQUEUR,421.0,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-37574100077,2021-06-17,2642,HY-VEE WINE AND SPIRITS / PELLA,512 E OSKALOOSA,PELLA,50219.0,POINT(-92.899277 41.396961),63,MARION,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-36439300012,2021-05-07,4823,CASEY'S GENERAL STORE #3223 / CRESTON,903 N SUMNER AVE,CRESTON,50801.0,POINT(-94.372568 41.066824),88,UNION,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-41582800061,2021-11-02,6173,MINI-MART / INDEPENDENCE,709 1ST STREET WEST,INDEPENDENCE,50644.0,POINT(-91.901687 42.468633),10,BUCHANAN,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-37726900001,2021-06-22,4506,CASEY'S GENERAL STORE #2667 / TIFFIN,403 STEPHENS ST,TIFFIN,52340.0,POINT(-91.660199 41.707316),52,JOHNSON,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
INV-42023000023,2021-11-16,2619,HY-VEE WINE AND SPIRITS / WDM,1725  74TH ST,WEST DES MOINES,50266.0,POINT(-93.808855 41.598515),77,POLK,1081600.0,WHISKEY LIQUEUR,421,SAZERAC COMPANY  INC,100413,FIREBALL CINNAMON WHISKEY PARTY BUCKET,1,50,51.6,77.4,1,77.4,0.05,0.01
Query:
SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
Answer:
category_name,total_sales,total_volume_liters
BLENDED WHISKIES,12635514.850000016,848135.8600000002
AMERICAN BRANDIES,5216033.319999998,416447.8600000001
IRISH WHISKIES,9238465.82999999,301769.6300000001
GOLD RUM,1162585.6700000002,100701.62
AMERICAN DISTILLED SPIRITS SPECIALTY,1497977.379999999,55730.35000000004
CREAM LIQUEURS,8860918.940000001,375998.50999999995
SINGLE MALT SCOTCH,4454879.36,73168.09999999996
IMPORTED VODKAS,14556785.38000001,815542.7699999999
SPICED RUM,23123177.070000023,1482216.2799999998
COCKTAILS/RTD,8692059.710000003,1103047.59
IMPORTED GINS,3186.72,108.0
AMERICAN WHISKIES,1881.0,49.5
CORN WHISKIES,442212.52000000037,10279.0
MEZCAL,430727.72999999975,9980.25
TEMPORARY & SPECIALTY PACKAGES,10174030.039999992,342307.04000000015
STRAIGHT RYE WHISKIES,4793496.380000002,114997.06000000001
IMPORTED DRY GINS,5602434.379999996,218495.6099999999
STRAIGHT BOURBON WHISKIES,34498254.83000001,1341916.9500000007
AMERICAN SCHNAPPS,6561224.370000011,525463.45
IMPORTED FLAVORED VODKA,5785184.289999995,267295.33999999985
TRIPLE SEC,848208.0199999999,208774.0
AMERICAN VODKAS,61440411.23999981,5697648.87
IMPORTED DISTILLED SPIRITS SPECIALTY,2198562.0699999984,265133.22999999986
WHISKEY LIQUEUR,24665650.709999982,1154025.0599999991
FLAVORED RUM,9023511.589999994,583419.1300000004
IMPORTED SCHNAPPS,6637742.61,349768.04999999993
100% AGAVE TEQUILA,23915928.889999986,618136.8100000002
AMERICAN SLOE GINS,31666.349999999995,3895.0
CANADIAN WHISKIES,47392655.6699998,3028926.9
AGED DARK RUM,1073387.5300000003,42201.200000000004
IMPORTED WHISKIES,5518.799999999999,45.0
SPECIAL ORDER ITEMS,1523594.6000000003,125307.64999999995
DISTILLED SPIRITS SPECIALTY,28070.0,601.5
TENNESSEE WHISKIES,16276000.050000023,525973.8
WHITE RUM,6709359.5900000045,611902.5399999998
IMPORTED CORDIALS & LIQUEURS,11206838.640000006,363732.5099999999
MIXTO TEQUILA,10668562.360000003,639032.7999999999
NEUTRAL GRAIN SPIRITS,642212.9200000004,37928.84
AMERICAN FLAVORED VODKA,10537284.849999988,713027.9300000002
AMERICAN CORDIALS & LIQUEURS,4293640.0699999975,252516.25000000023
COFFEE LIQUEURS,2126049.5400000005,96073.67
BOTTLED IN BOND BOURBON,694701.2700000001,22162.0
AMERICAN DRY GINS,3712780.8,348315.9799999999
FLAVORED GIN,388056.54,13611.949999999997
SCOTCH WHISKIES,5719870.5699999975,235825.11000000007
SINGLE BARREL BOURBON WHISKIES,1066574.4600000002,23573.25
Query:
SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    LIMIT 100;
Answer:
category_name,avg_price_per_liter
BLENDED WHISKIES,14.897984445558059
AMERICAN BRANDIES,12.525057326504212
AMERICAN VODKAS,10.783467469100078
IMPORTED DISTILLED SPIRITS SPECIALTY,8.292291652766421
IMPORTED BRANDIES,48.25868371964293
NEUTRAL GRAIN SPIRITS FLAVORED,26.749903417553686
AMERICAN DISTILLED SPIRITS SPECIALTY,26.879023368774792
AMERICAN FLAVORED VODKA,14.77822173108982
AMERICAN CORDIALS & LIQUEURS,17.00342084915324
COFFEE LIQUEURS,22.129367390670104
BOTTLED IN BOND BOURBON,31.34650618175255
IMPORTED VODKAS,17.849199227160096
SPICED RUM,15.600406892036046
COCKTAILS/RTD,7.880040524815431
IMPORTED GINS,29.506666666666664
SPECIAL ORDER ITEMS,12.158831483951692
DISTILLED SPIRITS SPECIALTY,46.666666666666664
TEMPORARY & SPECIALTY PACKAGES,29.721942148779622
STRAIGHT RYE WHISKIES,41.683642868782925
IMPORTED DRY GINS,25.640947111019756
TENNESSEE WHISKIES,30.94450721689944
WHITE RUM,10.964751984850409
IMPORTED CORDIALS & LIQUEURS,30.810659844510514
MIXTO TEQUILA,16.694858792850702
NEUTRAL GRAIN SPIRITS,16.932047486820057
CREAM LIQUEURS,23.56636716459328
SINGLE MALT SCOTCH,60.88554110329501
CORN WHISKIES,43.02096702013817
MEZCAL,43.158010069888036
STRAIGHT BOURBON WHISKIES,25.708189191588943
AMERICAN SCHNAPPS,12.486547580045784
IMPORTED FLAVORED VODKA,21.643416192740236
TRIPLE SEC,4.062804851178784
CANADIAN WHISKIES,15.646681889219506
AGED DARK RUM,25.435000189568054
IMPORTED WHISKIES,122.63999999999999
AMERICAN WHISKIES,38.0
AMERICAN DRY GINS,10.659231884796101
FLAVORED GIN,28.50851935248071
SCOTCH WHISKIES,24.254713885217726
SINGLE BARREL BOURBON WHISKIES,45.2451172409405
WHISKEY LIQUEUR,21.37358326516758
FLAVORED RUM,15.466602183579408
IMPORTED SCHNAPPS,18.97755558290702
100% AGAVE TEQUILA,38.69034896983404
AMERICAN SLOE GINS,8.129999999999999
IRISH WHISKIES,30.61429949064123
GOLD RUM,11.544855683553054
Query:
SELECT
      `category_name`,
      SUM(`sale_dollars`) AS total_sales,
      SUM(`volume_sold_liters`) AS total_volume_liters
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2019
    GROUP BY `category_name`
    LIMIT 100;
Answer:
category_name,total_sales,total_volume_liters
BLENDED WHISKIES,9611134.78000002,817091.6600000001
AMERICAN BRANDIES,5257186.579999993,425535.0899999996
IMPORTED VODKAS,16172742.560000004,905641.8900000006
SPICED RUM,21474888.770000048,1392099.1100000008
COCKTAILS/RTD,5507831.270000004,783310.1700000005
AMERICAN VODKAS,51742838.88999996,5223817.869999997
IMPORTED DISTILLED SPIRITS SPECIALTY,1478086.3300000005,187347.85999999996
CREAM LIQUEURS,6548226.790000001,305370.40000000014
SINGLE MALT SCOTCH,3720672.7099999995,65092.369999999995
SPECIAL ORDER ITEMS,1912236.03,168706.69
AMERICAN FLAVORED VODKA,8887524.400000013,641610.4399999996
COFFEE LIQUEURS,1857033.5399999996,88121.37999999999
AMERICAN CORDIALS & LIQUEURS,2781196.369999996,201257.69
BOTTLED IN BOND BOURBON,192165.09000000005,6843.75
WHISKEY LIQUEUR,19786836.119999982,1111827.2399999993
100% AGAVE TEQUILA,12823526.709999993,367782.11
FLAVORED RUM,7134344.709999995,474148.55000000005
IMPORTED SCHNAPPS,5349283.099999998,282217.27999999997
AMERICAN SLOE GINS,29358.93,3441.0
STRAIGHT BOURBON WHISKIES,23988780.33999999,1073887.7700000003
IMPORTED FLAVORED VODKA,6396746.07,284351.76999999996
AMERICAN SCHNAPPS,5510241.980000009,489022.59000000014
TRIPLE SEC,755213.0300000003,184869.5
CANADIAN WHISKIES,42556225.01999995,2866738.4299999992
AGED DARK RUM,711047.6600000001,31512.75
,340400.0800000001,14629.840000000007
AMERICAN DISTILLED SPIRITS SPECIALTY,342341.3299999997,14896.48
IRISH WHISKIES,7914793.199999994,260449.57
GOLD RUM,1177615.9300000006,107731.52
IMPORTED CORDIALS & LIQUEURS,8384195.830000001,297531.7700000001
TENNESSEE WHISKIES,14565908.80000002,488277.76000000024
WHITE RUM,6475953.400000008,614028.4099999998
MIXTO TEQUILA,8961340.519999994,560709.1400000001
NEUTRAL GRAIN SPIRITS,569230.4400000001,33451.79
CORN WHISKIES,235620.28999999992,6445.5
MEZCAL,167404.53000000003,4260.0
NEUTRAL GRAIN SPIRITS FLAVORED,430607.45999999985,17490.299999999996
IMPORTED BRANDIES,11903676.89999998,273398.35999999975
TEMPORARY & SPECIALTY PACKAGES,8144156.410000005,328411.0900000001
IMPORTED DRY GINS,4689169.109999997,186488.8799999997
STRAIGHT RYE WHISKIES,3245327.4900000007,86737.01999999997
IOWA DISTILLERY WHISKIES,188730.89999999997,4195.5
AMERICAN DRY GINS,3477650.1400000015,357933.88
SCOTCH WHISKIES,5220195.939999996,243341.24999999997
SINGLE BARREL BOURBON WHISKIES,491434.03000000026,12518.25
Query:
SELECT
      EXTRACT(YEAR FROM `date`) AS year,
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) IN (2019, 2020, 2021)
    GROUP BY year, `category_name`
    LIMIT 100;
Answer:
year,category_name,avg_price_per_liter
2020,IRISH WHISKIES,30.626024569553664
2020,STRAIGHT RYE WHISKIES,39.89246488782914
2020,AMERICAN DRY GINS,10.617011590200837
2021,IMPORTED BRANDIES,48.258683719642924
2020,AMERICAN BRANDIES,12.511142937266218
2020,IMPORTED SCHNAPPS,19.25455518897707
2021,COFFEE LIQUEURS,22.1293673906701
2021,IMPORTED FLAVORED VODKA,21.643416192740226
2021,SINGLE BARREL BOURBON WHISKIES,45.24511724094048
2021,NEUTRAL GRAIN SPIRITS,16.932047486820064
2019,AMERICAN DISTILLED SPIRITS SPECIALTY,22.981357340794595
2019,IMPORTED FLAVORED VODKA,22.495889756550486
2020,AMERICAN FLAVORED VODKA,14.37529719912237
2021,AMERICAN FLAVORED VODKA,14.77822173108981
2019,SPICED RUM,15.426264276542812
2019,SINGLE BARREL BOURBON WHISKIES,39.25740658638389
2020,IMPORTED DRY GINS,25.539127017730863
2021,AGED DARK RUM,25.43500018956806
2021,DISTILLED SPIRITS SPECIALTY,46.666666666666664
2019,MEZCAL,39.29683802816902
2021,AMERICAN SLOE GINS,8.129999999999995
2020,WHISKEY LIQUEUR,20.73035191736055
2020,BLENDED WHISKIES,14.177418874399729
2021,AMERICAN VODKAS,10.783467469100078
2019,CREAM LIQUEURS,21.443554417847952
2020,AMERICAN DISTILLED SPIRITS SPECIALTY,26.451632087413692
2021,MIXTO TEQUILA,16.694858792850713
2020,DISTILLED SPIRITS SPECIALTY,41.00539396078036
2019,IMPORTED CORDIALS & LIQUEURS,28.179161606842857
2021,TEMPORARY & SPECIALTY PACKAGES,29.72194214877963
2020,CANADIAN WHISKIES,14.945131655072599
2021,IMPORTED VODKAS,17.849199227160092
2019,FLAVORED RUM,15.046644580058286
2021,GOLD RUM,11.544855683553061
2019,AMERICAN BRANDIES,12.35429628141827
2020,IMPORTED CORDIALS & LIQUEURS,30.195326536840927
2021,IMPORTED CORDIALS & LIQUEURS,30.810659844510504
2019,IMPORTED BRANDIES,43.539679243138096
2021,BOTTLED IN BOND BOURBON,31.34650618175255
2020,BOTTLED IN BOND BOURBON,29.575726763855567
2021,IMPORTED GINS,29.506666666666664
2019,CANADIAN WHISKIES,14.844823153258499
2020,IMPORTED VODKAS,16.914344925388168
2020,IMPORTED FLAVORED VODKA,21.571944764231887
2020,SPICED RUM,15.345321660461234
2019,WHITE RUM,10.5466673765144
2020,CREAM LIQUEURS,22.742294325622776
2020,SCOTCH WHISKIES,22.53605727632423
2020,GOLD RUM,11.352277433620918
2019,AGED DARK RUM,22.56380861714704
2021,CORN WHISKIES,43.02096702013817
2019,SINGLE MALT SCOTCH,57.15989001475903
Query:
SELECT
      `category_name`,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) = 2021
    GROUP BY `category_name`
    ORDER BY avg_price_per_liter DESC
    LIMIT 10;
Answer:
category_name,avg_price_per_liter
IMPORTED WHISKIES,122.63999999999999
SINGLE MALT SCOTCH,60.88554110329501
IMPORTED BRANDIES,48.258683719642896
DISTILLED SPIRITS SPECIALTY,46.666666666666664
SINGLE BARREL BOURBON WHISKIES,45.24511724094051
MEZCAL,43.158010069888014
CORN WHISKIES,43.02096702013819
STRAIGHT RYE WHISKIES,41.68364286878289
100% AGAVE TEQUILA,38.690348969834034
AMERICAN WHISKIES,38.0
Query:
SELECT
      `category_name`,
      EXTRACT(YEAR FROM `date`) AS year,
      SUM(`sale_dollars`) / SUM(`volume_sold_liters`) AS avg_price_per_liter
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`, year
    ORDER BY `category_name`, year
    LIMIT 100;
Answer:
category_name,year,avg_price_per_liter
,2019,23.267518988587714
,2020,31.71592960640305
100% AGAVE TEQUILA,2019,34.86718456751473
100% AGAVE TEQUILA,2020,34.80330108401572
100% AGAVE TEQUILA,2021,38.69034896983405
AGED DARK RUM,2019,22.563808617147036
AGED DARK RUM,2020,23.9692682995854
AGED DARK RUM,2021,25.43500018956806
AMERICAN BRANDIES,2019,12.354296281418277
AMERICAN BRANDIES,2020,12.511142937266218
AMERICAN BRANDIES,2021,12.525057326504204
AMERICAN CORDIALS & LIQUEURS,2019,13.819081248522716
AMERICAN CORDIALS & LIQUEURS,2020,15.93246725400036
AMERICAN CORDIALS & LIQUEURS,2021,17.003420849153247
AMERICAN DISTILLED SPIRITS SPECIALTY,2019,22.98135734079461
AMERICAN DISTILLED SPIRITS SPECIALTY,2020,26.451632087413707
AMERICAN DISTILLED SPIRITS SPECIALTY,2021,26.8790233687748
AMERICAN DRY GINS,2019,9.715900992663798
AMERICAN DRY GINS,2020,10.617011590200836
AMERICAN DRY GINS,2021,10.659231884796101
AMERICAN FLAVORED VODKA,2019,13.851901162954903
AMERICAN FLAVORED VODKA,2020,14.37529719912236
AMERICAN FLAVORED VODKA,2021,14.778221731089817
AMERICAN SCHNAPPS,2019,11.267867973133935
AMERICAN SCHNAPPS,2020,12.309911189230489
AMERICAN SCHNAPPS,2021,12.486547580045785
AMERICAN SLOE GINS,2019,8.532092414995644
AMERICAN SLOE GINS,2020,8.129999999999995
AMERICAN SLOE GINS,2021,8.129999999999999
AMERICAN VODKAS,2019,9.905176669185815
AMERICAN VODKAS,2020,10.371592670487642
AMERICAN VODKAS,2021,10.783467469100081
AMERICAN WHISKIES,2021,38.0
BLENDED WHISKIES,2019,11.762615200355878
BLENDED WHISKIES,2020,14.177418874399724
BLENDED WHISKIES,2021,14.897984445558071
BOTTLED IN BOND BOURBON,2019,28.078917260273965
BOTTLED IN BOND BOURBON,2020,29.575726763855563
BOTTLED IN BOND BOURBON,2021,31.346506181752535
CANADIAN WHISKIES,2019,14.844823153258515
CANADIAN WHISKIES,2020,14.945131655072585
CANADIAN WHISKIES,2021,15.64668188921952
COCKTAILS/RTD,2019,7.031481884117501
COCKTAILS/RTD,2020,7.201814574552641
COCKTAILS/RTD,2021,7.880040524815437
COFFEE LIQUEURS,2019,21.073586682369243
COFFEE LIQUEURS,2020,20.975750359383508
COFFEE LIQUEURS,2021,22.129367390670097
CORN WHISKIES,2019,36.5557815530215
CORN WHISKIES,2020,43.98408575207071
CORN WHISKIES,2021,43.02096702013817
CREAM LIQUEURS,2019,21.443554417847952
CREAM LIQUEURS,2020,22.742294325622776
Query:
SELECT
      `category_name`,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2019,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2020,
      ROUND(SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END), 2) AS avg_price_2021
    FROM `bigquery-public-data.iowa_liquor_sales.sales`
    WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
    GROUP BY `category_name`
    HAVING avg_price_2019 < avg_price_2020 AND avg_price_2020 < avg_price_2021
    LIMIT 100;
Answer:
category_name,avg_price_2019,avg_price_2020,avg_price_2021
CREAM LIQUEURS,21.44,22.74,23.57
SINGLE MALT SCOTCH,57.16,60.72,60.89
GOLD RUM,10.93,11.35,11.54
BLENDED WHISKIES,11.76,14.18,14.9
AMERICAN BRANDIES,12.35,12.51,12.53
AMERICAN FLAVORED VODKA,13.85,14.38,14.78
AMERICAN CORDIALS & LIQUEURS,13.82,15.93,17.0
BOTTLED IN BOND BOURBON,28.08,29.58,31.35
AMERICAN DISTILLED SPIRITS SPECIALTY,22.98,26.45,26.88
COCKTAILS/RTD,7.03,7.2,7.88
WHISKEY LIQUEUR,17.8,20.73,21.37
FLAVORED RUM,15.05,15.2,15.47
TEMPORARY & SPECIALTY PACKAGES,24.8,28.02,29.72
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
IMPORTED DRY GINS,25.14,25.54,25.64
IMPORTED BRANDIES,43.54,44.21,48.26
NEUTRAL GRAIN SPIRITS FLAVORED,24.62,25.3,26.75
CANADIAN WHISKIES,14.84,14.95,15.65
AGED DARK RUM,22.56,23.97,25.44
IMPORTED CORDIALS & LIQUEURS,28.18,30.2,30.81
TENNESSEE WHISKIES,29.83,30.67,30.94
AMERICAN DRY GINS,9.72,10.62,10.66
FLAVORED GIN,15.94,17.05,28.51
SCOTCH WHISKIES,21.45,22.54,24.25
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
AMERICAN VODKAS,9.91,10.37,10.78
IMPORTED DISTILLED SPIRITS SPECIALTY,7.89,8.22,8.29
STRAIGHT BOURBON WHISKIES,22.34,23.93,25.71
AMERICAN SCHNAPPS,11.27,12.31,12.49
Query:
SELECT
      t.`category_name`,
      ROUND(t.avg_price_2019, 2) AS avg_price_2019,
      ROUND(t.avg_price_2020, 2) AS avg_price_2020,
      ROUND(t.avg_price_2021, 2) AS avg_price_2021
    FROM (
      SELECT
        `category_name`,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
        SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE 0 END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
      FROM `bigquery-public-data.iowa_liquor_sales.sales`
      WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
      GROUP BY `category_name`
    ) AS t
    ORDER BY t.avg_price_2021 DESC
    LIMIT 10;
Answer:
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.16,60.72,60.89
IMPORTED BRANDIES,43.54,44.21,48.26
DISTILLED SPIRITS SPECIALTY,,41.01,46.67
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
MEZCAL,39.3,39.04,43.16
CORN WHISKIES,36.56,43.98,43.02
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
100% AGAVE TEQUILA,34.87,34.8,38.69
AMERICAN WHISKIES,,,38.0
End Exploring Related Columns
Task: Identify the top 10 liquor categories in Iowa by average price per liter in 2021, and provide their average prices per liter for 2019, 2020, and 2021.

Please answer only one complete SQL in bigquery dialect in ```sql``` format.
Usage example: ```sql
SELECT `column_name` FROM `database.schema.table` WHERE ... ``` (Replace `database`, `schema`, and `table` with actual names. Enclose column names and table identifiers with backticks.)
Follow the answer format like: I'm unable to provide the exact average prices per liter for the top 10 liquor categories in Iowa for 2019, 2020, and 2021, as I don't have access to the data from the `bigquery-public-data.iowa_liquor_sales.sales` table needed to perform this analysis..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'bigquery-public-data': {'iowa_liquor_sales': ['sales']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.If the task description does not specify the number of decimal places, retain all decimals to four places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-27 21:34:00 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 21:34:00 - root - INFO - ```sql
SELECT
  t.`category_name`,
  ROUND(t.avg_price_2019, 2) AS avg_price_2019,
  ROUND(t.avg_price_2020, 2) AS avg_price_2020,
  ROUND(t.avg_price_2021, 2) AS avg_price_2021
FROM (
  SELECT
    `category_name`,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
  FROM `bigquery-public-data.iowa_liquor_sales.sales`
  WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
  GROUP BY `category_name`
) AS t
ORDER BY t.avg_price_2021 DESC
LIMIT 10;
```
2025-01-27 21:34:02 - root - INFO - itercount: 1
2025-01-27 21:34:02 - root - INFO - 0
2025-01-27 21:34:02 - root - INFO - results: 
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.16,60.72,60.89
IMPORTED BRANDIES,43.54,44.21,48.26
DISTILLED SPIRITS SPECIALTY,,41.01,46.67
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
MEZCAL,39.3,39.04,43.16
CORN WHISKIES,36.56,43.98,43.02
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
100% AGAVE TEQUILA,34.87,34.8,38.69
AMERICAN WHISKIES,,,38.0


2025-01-27 21:34:02 - root - INFO - Please check the answer again by reviewing Identify the top 10 liquor categories in Iowa by average price per liter in 2021, and provide their average prices per liter for 2019, 2020, and 2021., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: I'm unable to provide the exact average prices per liter for the top 10 liquor categories in Iowa for 2019, 2020, and 2021, as I don't have access to the data from the `bigquery-public-data.iowa_liquor_sales.sales` table needed to perform this analysis. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.16,60.72,60.89
IMPORTED BRANDIES,43.54,44.21,48.26
DISTILLED SPIRITS SPECIALTY,,41.01,46.67
SINGLE BARREL BOURBON WHISKIES,39.26,43.45,45.25
MEZCAL,39.3,39.04,43.16
CORN WHISKIES,36.56,43.98,43.02
STRAIGHT RYE WHISKIES,37.42,39.89,41.68
100% AGAVE TEQUILA,34.87,34.8,38.69
AMERICAN WHISKIES,,,38.0
Current sql:
SELECT
  t.`category_name`,
  ROUND(t.avg_price_2019, 2) AS avg_price_2019,
  ROUND(t.avg_price_2020, 2) AS avg_price_2020,
  ROUND(t.avg_price_2021, 2) AS avg_price_2021
FROM (
  SELECT
    `category_name`,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
  FROM `bigquery-public-data.iowa_liquor_sales.sales`
  WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
  GROUP BY `category_name`
) AS t
ORDER BY t.avg_price_2021 DESC
LIMIT 10;
2025-01-27 21:34:25 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 21:34:25 - root - INFO - ```sql
SELECT
  t.`category_name`,
  ROUND(t.avg_price_2019, 4) AS avg_price_2019,
  ROUND(t.avg_price_2020, 4) AS avg_price_2020,
  ROUND(t.avg_price_2021, 4) AS avg_price_2021
FROM (
  SELECT
    `category_name`,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
  FROM `bigquery-public-data.iowa_liquor_sales.sales`
  WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
  GROUP BY `category_name`
) AS t
ORDER BY t.avg_price_2021 DESC
LIMIT 10;
```
2025-01-27 21:34:27 - root - INFO - itercount: 2
2025-01-27 21:34:27 - root - INFO - 0
2025-01-27 21:34:27 - root - INFO - results: 
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.1599,60.7222,60.8855
IMPORTED BRANDIES,43.5397,44.2109,48.2587
DISTILLED SPIRITS SPECIALTY,,41.0054,46.6667
SINGLE BARREL BOURBON WHISKIES,39.2574,43.4544,45.2451
MEZCAL,39.2968,39.0424,43.158
CORN WHISKIES,36.5558,43.9841,43.021
STRAIGHT RYE WHISKIES,37.4157,39.8925,41.6836
100% AGAVE TEQUILA,34.8672,34.8033,38.6903
AMERICAN WHISKIES,,,38.0


2025-01-27 21:34:27 - root - INFO - Please check the answer again by reviewing Identify the top 10 liquor categories in Iowa by average price per liter in 2021, and provide their average prices per liter for 2019, 2020, and 2021., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: I'm unable to provide the exact average prices per liter for the top 10 liquor categories in Iowa for 2019, 2020, and 2021, as I don't have access to the data from the `bigquery-public-data.iowa_liquor_sales.sales` table needed to perform this analysis. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
category_name,avg_price_2019,avg_price_2020,avg_price_2021
IMPORTED WHISKIES,,,122.64
SINGLE MALT SCOTCH,57.1599,60.7222,60.8855
IMPORTED BRANDIES,43.5397,44.2109,48.2587
DISTILLED SPIRITS SPECIALTY,,41.0054,46.6667
SINGLE BARREL BOURBON WHISKIES,39.2574,43.4544,45.2451
MEZCAL,39.2968,39.0424,43.158
CORN WHISKIES,36.5558,43.9841,43.021
STRAIGHT RYE WHISKIES,37.4157,39.8925,41.6836
100% AGAVE TEQUILA,34.8672,34.8033,38.6903
AMERICAN WHISKIES,,,38.0
Current sql:
SELECT
  t.`category_name`,
  ROUND(t.avg_price_2019, 4) AS avg_price_2019,
  ROUND(t.avg_price_2020, 4) AS avg_price_2020,
  ROUND(t.avg_price_2021, 4) AS avg_price_2021
FROM (
  SELECT
    `category_name`,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
  FROM `bigquery-public-data.iowa_liquor_sales.sales`
  WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
  GROUP BY `category_name`
) AS t
ORDER BY t.avg_price_2021 DESC
LIMIT 10;
2025-01-27 21:34:59 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-27 21:34:59 - root - INFO - ```sql
SELECT
  t.`category_name`,
  ROUND(t.avg_price_2019, 4) AS avg_price_2019,
  ROUND(t.avg_price_2020, 4) AS avg_price_2020,
  ROUND(t.avg_price_2021, 4) AS avg_price_2021
FROM (
  SELECT
    `category_name`,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2019 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2019,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2020 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2020,
    SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `sale_dollars` ELSE NULL END) / SUM(CASE WHEN EXTRACT(YEAR FROM `date`) = 2021 THEN `volume_sold_liters` ELSE NULL END) AS avg_price_2021
  FROM `bigquery-public-data.iowa_liquor_sales.sales`
  WHERE EXTRACT(YEAR FROM `date`) BETWEEN 2019 AND 2021
  GROUP BY `category_name`
) AS t
ORDER BY t.avg_price_2021 DESC
LIMIT 10;
```
2025-01-27 21:35:00 - root - INFO - itercount: 3
2025-01-27 21:35:00 - root - INFO - 0
2025-01-27 21:35:00 - root - INFO - Total iteration counts: 3
