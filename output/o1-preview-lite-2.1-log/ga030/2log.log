2025-01-30 01:15:20 - openai._base_client - INFO - Retrying request to /chat/completions in 0.456003 seconds
2025-01-30 01:16:04 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:16:08 - root - INFO - SQL:
-- Query 1: Get distinct event names to understand available event types.
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
LIMIT 100
Results:
event_name
level_end
select_content
level_end_quickplay
app_exception
ad_reward
firebase_campaign
error
spend_virtual_currency
level_complete_quickplay
level_fail_quickplay
os_update
dynamic_link_app_open
challenge_accepted
notification_foreground
user_engagement
level_up
app_remove
post_score
session_start
use_extra_steps
level_retry_quickplay
in_app_purchase
first_open
level_complete
level_retry
level_start
level_start_quickplay
level_reset_quickplay
dynamic_link_first_open
level_reset
no_more_extra_steps
level_fail
screen_view
completed_5_levels
app_update
app_clear_data
challenge_a_friend

2025-01-30 01:16:13 - root - INFO - SQL:
-- Query 2: List user_pseudo_ids and their first event_date.
SELECT user_pseudo_id, MIN(event_date) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_event_date
2F0F260BD7B876C346B41977D0D03D62,20180706
54405BB87CA5EE368EB42F411323631F,20180712
570495249052C5E40EC34A2B054DA1A1,20180705
44A600997B9B6499325D518A19B51FEC,20180706
42B0EA9C46944FD3177C30038D4970B3,20180706
037DAC225F0C1E54657770CD201CDDA7,20180702
CCCE3FEE757EA8EE64506158ED6FF26C,20180723
56638C161E53327DFF2A4C3001968B70,20180727
05FB3382D94C7E963B408FD6CC357D33,20180702
E9B5EC78F1F4D6F90B5AFB34D09697F2,20180707
5194FBFDE04D7689AF2B1DB5C5EBF970,20180727
257D8B7A90ECCC1688EBCB4548D4C1AB,20180709
7C632AB83C2A58075244891518D3D415,20180727
D9563E61AC76501942B6B3B4EBA2BFE4,20180726
0B74484DD41F519B4810A14A953CAA18,20180726
F8676B20C2A1DA2B004C3257C3DA3E7E,20180727
FBF8A477CF09D5B499E8923A4D2A5102,20180727
B5F3D00E28A57C9522F2DEE3CB903DD1,20180702
472451071AED6FF801BC0FE66706FD27,20180702
CABE7E24215A5C36862658A36AE5CE12,20180702
3D9A1566A6D35AC1D20B7D125637B637,20180702
A618596C697C9F9FEBC2B022AFD4F7DD,20180727
B37D4AE829DE5D2E1B1EAC461FCC343A,20180727
D80119EBB2A670C29D0BB8F621CB1D3A,20180727
CFA0F8C5E25A71062E573EF8E6BC9F76,20180702
DA48D36D07835B1918BDF831AF83B5EF,20180702
BC6237C93B4F8F703C63757184B49DE6,20180705
55EEC95A163C7791E528B12D5FA32CA9,20180710
5634AE3A99BF07E5A6A687A0F9316D78,20180726
13E6C8A193FF140F7D4222B569DD5B50,20180702
84E491A60BE52A4C6A438A89FADE283C,20180702
26442439EB5455656AD4D2E1607252AD,20180713
96161BF2E55C7E32ED5F411432875ECB,20180702
5E09265F12D64B9FA85FF9427A0A7FB0,20180702
E83D14E125252A6E3AEB349FF07C7543,20180727
D4525427508986ADBEBB52D52D468D34,20180727
F17AC159F7AE3AA891CD260E027A3C49,20180727
303FD8B04DF295670F8CBE660723648A,20180713
EEBCB25D5F056CCF59DDE654388ACD2B,20180703
1C6A9F02E05398B13FBB2C403A1E1B0F,20180727
8D9D62A4402581BB1181D3AA73AD54E8,20180702
B3A9A38A561B3648D280614B8E2D8E07,20180702
2160984278981558F7929C07EB37E679,20180727
3B4A6FCA6DCB4C2749409DC4188A306E,20180703
90CC0C53AB8C20C6ACD31C2049FF1C03,20180831
1F54AC7A413B33C6023DA0AF8F489684,20180807
DA1D860E60FA463A80DBA293EABEE7A0,20180704
E4C6FF8288DD4BFCDE93E2218E20643B,20180702
359A34F575B808FEFE58BC5B40816F09,20180809
0B9739BFB4122E1863C894E34F812D56,20180721
C6D97C0D6DA580A6FDB44BB2C3015A85,20180811
532579121C1D62C00E6B3BE1108B2945,20180813
78AACFF53F639F8AF257183503EDA1A6,20180831
B2D359D114428D8DD085DFAFF11195CE,20180812
D8B8615DDE319FEBE0A2AC1364E2C2EC,20180831
AFF1262CCD472757FC92B2A93C75CD81,20180810
7E74A2BB6BBF4746DEE15F957B315401,20180830
0175F289F0878C46DCA6B0AF3C5677F1,20180817
50D529BFD3EFEB1C8216DF9A321A552A,20180828

2025-01-30 01:16:15 - root - INFO - SQL:
-- Query 3: Retrieve sample of user_first_touch_timestamp values.
SELECT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Results:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000

2025-01-30 01:16:21 - root - INFO - SQL:
-- Query 4: Get users who started sessions on or after July 2, 2018.
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date >= '20180702'
LIMIT 100
Results:
user_pseudo_id
295D9E24D8DE65A010313E667131EF19
4FBE02D401C1CB541103D24CF60494E0
3EF8FC940E379D53BBD3FEFDAF626BB2
0D9B1C51FA357A1A3487036AA037F7D0
38D65030548914B5E167CE85B035CA8F
DACD1498411E056455073E0371DF8EDE
7D613AF4DA0F508C7090E96FD73B7E6D
DAA3F353F320A717A0C418A8205292B2
3D7382CF3E5091189D2961E0EA3A2ACE
E8808298EB58EBCDBD87AC021925A5F9
03A9D32C44665A9E15CFCCEDC9F68EDB
F91F493916395FE4E16DE98B24388985
D842320AECB686B41C2F8E8876794D34
4B3CC3382387935EC4D2AB4F6EFC56FA
C639CACA07D03F536F537ED779CF6599
9DE945166BCD4709696C5836317DDE47
90D99AC8BC1551757037513287A3B8B4
E8AB792C0CBA5D7E4C9EF63F4BBF6628
372D9BB5088C4E9000C65B06459B403A
86F19DAB73E484FB7DD2F805DDD7957D
E66C3B8A38C424C7CBE0B5388EE5F77E
D35CA7CBB149B94C34D98A2D304D9AE7
B2ED849BBB2D152DF245B09A41687D4F
158D85747B252579015AE58305CBC8C1
DD766B6E5A2B12A2C7C52C11C8F81B00
449AE55152FD5964D7F41417567C804B
241293471505B5DFB907A2AFC5D26BC1
0AF862AFEB5358EBFDA7AFE3AC908844
186EF14CC97E86390BAE614FDAF4119D
B9DF3733E51CA1BB9A845EE00B36D1FE
53EF5C7357527DEFCBC722E886E242A5
0AFE3DE6A443BD660CDD5B1FA36686F6
45BDDEC4DF8773F88DC51D1AFD145521
938611E83B897B6F877992BF30D3E1FE
6B79073DC6A4D08D7718ABD38722ED70
359A34F575B808FEFE58BC5B40816F09
8912D1B887909C2FDE687B6782701503
0B427C5E490A982FADF586F82E797ACB
5E9BF00B469B284E028094EA15A9F1FE
4254BB9B56C28304B6478CCC78ABB053
96CCC44DF99B87D1450A966D355E4A16
EF0FBB41BE6F40A5CC1D68D8E1CD3591
B35F8E08962DDFFB2AAE7591699C908F
B087A865A90AD52D1864A36482983BD2
ECC6975EB9808FBB45390E3EDB75B2A1
40E48F9F86A546EF73EDE7855625E2B2
1D763A3E95386CEEF80C5174E6216F8C
A9C876F6262995184453B40AB7C5233C
D7EA8E3645EFFBD6443946179ED704A6
91D637F0D9FB259AD52773B1B20151BE
C302332F1B2DC5162E47913A708C479B
13AC12EF4C6A0EAF72795F720752AD98
A68C4D0A3F32C3F7621CA7675E9F39A6
66EE0DB049AA1A3B92B41375C1263B05
65D1701E5BA0070CCF15F0CB0E1CF750
C2F9C29AE66D5B80EBB2490AB11273B8
40A81A69B84A84C1E7577605FA47594C
F3779F2B0544630A7544BA7694CF3938
6C40A2B1B7C2336EDCE4B9F346682A72
964526CBEE730E91EB0A51E3E4B4BDB9
CDC9A224610417F5F1E97C8B96168950
B810EC88D69D961A2FA7ECC0F323D9EE
079FE8543EB46F5109283B58A75E8F3D
625CF86657E00A4629BCE49F5B31A144
FEC0B30EED7870C4D46230D73032E5CA
8B404ABBCDCF859DB2E5ABE00B482621
4EF964D59282E5A2C8692D30F011256B
273BECA0D1107657F707D82E5A2C4927
654F30C1312F6C1A26DFDA9F076A62D8
16DB8E847B4DDC16F3F250637F2D8C89
224C6AE85D60A605AC6164FA86738DF6
E343A4E35A813C92ECFD8C26B35E4474
ACB0CC9AC2138D424084DC1D8C18F077
498C29D342AF10C4A87FD312ACE1433A
01BE5107A02018738DED57597F10A916
E2372AFD5CBA85F1395201FB687AEC46
11A8D6037368A4C4508B11ADB4353BC4
FFA9AE78B23263835F8AAED57713EBE9
F9DAB66FDF60FD51DE5FF0BD0856E8C6
52EF42933AD38302C75702C3D38BFFAE
CA05F1C6A3827BC6EBCA6E949CAAF250
77BD91427F3805FD6A30F445FB0DC50B
2F71939D3C9E23EDC53AAAF004C762C1
2F04772FE46C17A90BCACEA9F09499FF
2941E920B4FD9CB80D870C3B78CC707D
712240BA0F93717BDA01B4FA84CD3616
C149C7D1FE5E8ABFB0806D55514CBC06
A37AD550BCBF8C8B1D5616BB5A47770D
5872E78AB7DA76D7176A8887BA4AA432
91FFEA4997DB9E39A944F4B23B6A3B24
BB4B254D4020E22E9CE5885C8AB28F87
475B281839C403CCF826D0D44890BFA5
EFD2CD7B7143AB00B21CE82E1C59FA25

2025-01-30 01:16:26 - root - INFO - SQL:
-- Query 5: Find the first session_start event_timestamp for each user.
SELECT user_pseudo_id, MIN(event_timestamp) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_session_timestamp
A7993B3D9E693DFD3EA57CF4D1B8D00F,1535008607327000
E069FDF17198500FCB6DDDF406ABA122,1532285882148000
9EBBDF6D1D91535F99C0BAD3C0EBDC73,1530989405437000
4BB019F8F6D1FE7BA78CA42A4698EF56,1532671454712000
F3917138A3D4B03ADA1C2E77E3B84649,1530601993400000
6CD2676098B3E076AD66D10BF4565BFA,1530654566826000
D5F9D9AF22EF5073E10342973D48FB2C,1530653883090000
31E8B3EB3D9167E813FDFB812898F2F6,1532925841236000
4662AAE1B5602A67BB168F37A9E961A6,1535496860273000
0DF6A14F536F6514A6F18BC12A532A82,1533345515042000
04F397E482E77FD2B7CAEB81E732790C,1533889531864000
03A9D32C44665A9E15CFCCEDC9F68EDB,1530523503754000
F1A4ACA5337DF6B0DAE14420BC457CE3,1532540440604000
635808C1DDFBC662DC3015097E26E62A,1532435820833000
D299D5763E03F1CC4DA8550AF1B4CEE4,1530622285969000
BBBB2C46108622C7B2A5444C3B823176,1530830842243000
A829171B86E4B3C3CD9191BED13833D6,1534831798579000
0CAAA1B6F161BA4D363EB7A2DEF64A08,1530567008479000
53A5A4C271525BAA74298747E100C376,1530556799714000
74375465CD17299EBC7C75A1B4047EE0,1530522381329000
951C483048D3CD18A7F27AC9C1B4DD0A,1531300471923000
E48A64DA907583189751D6FF988D14F6,1531181626910000
E102F19E39B32A45B7153A21B8F9A6FB,1535514759679035
40B501E0460E254E289A776CFC31DCF2,1530526869327000
29BC86DCA0D500C9410F392B57C28DD3,1530540082946000
9C8494CDC3107F7BE54CCF3E820252D6,1533414077528000
45A21F8198EC7C85F07611CE7FFB999D,1532871880083000
E643F6549E6C7EA0FD01EF4BF7A40F76,1530854521767000
55F9FB7C14AA4BAB066EA326D4A2221B,1530592857792000
BF709EB51D61C3A7BF68C4CFD7F236BE,1535456354986000
63DC7D4093165CA24BEDD80FD22B0DD0,1535041152650000
8EFA45B60DF34986EDC7C7CC0CD7CD69,1532224817538000
3875A92B5F5C2BBA1355CED06A986079,1530516068164000
65BF56455C9B2CAFE68AB07D23A7EFF1,1535521954211000
F2A1FD8B142EB4C6CAAE415FA1917F50,1530557922408000
E0664E9E7883956A6E3084FD68AA274B,1533864708142000
A0616D4E494DC3BCCB94B8B6E5B48380,1530549231978000
2125F29DF2FE82287BD647D543D652FC,1535495146219000
A82658237C6118780A6009C01F05DDEB,1531615943536000
E31617E878328B6183DE7A17DC743F16,1535486554197000
8210262F330052F441D2E2A2BCCA3E6A,1531985765486000
A19F659EA9BA36A3595F088F30A6B7E7,1530533003753000
75120F32A68A6C4FB643349E125D8C31,1531204070763000
7F089F4710219060252DB2AEF508A662,1531346141897000
9DB59A6220E6D63AE53FD08FDDB59602,1531153397976000
D8995B39CDB121EC37EC90025DB53B6D,1533446381873000
8211CABE9A3F1FE1BF3154E0C8D30368,1530519447632000
782CF1C08CCE9568816A007BEEC4E2F9,1535487931749000
58E204089E7397B4B3131D7232AA58C5,1530544696370000
0CF5644CEE7E80B439341E3C74DA73AB,1530546739332000
5FED8FE4B11878AAFC4E53BDA3FBB56D,1532848160283000

2025-01-30 01:16:32 - root - INFO - SQL:
-- Query 6: Count of session_start events per day.
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Results:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500
20180709,580
20180710,613
20180711,593
20180712,620
20180713,640
20180714,554
20180715,539
20180716,535
20180717,495
20180718,520
20180719,484
20180720,574
20180721,636
20180722,533
20180723,587
20180724,582
20180725,552
20180726,550
20180727,616
20180728,607
20180729,662
20180730,632
20180731,585
20180801,608
20180802,690
20180803,692
20180804,688
20180805,667
20180806,628
20180807,619
20180808,669
20180809,621
20180810,477
20180811,584
20180812,611
20180813,685
20180814,605
20180815,568
20180816,613
20180817,617
20180818,637
20180819,604
20180820,641
20180821,630
20180822,625
20180823,588
20180824,646
20180825,653
20180826,618
20180827,685
20180828,638
20180829,696
20180830,656
20180831,618
20180901,579
20180902,648
20180903,637
20180904,659
20180905,741
20180906,707
20180907,700
20180908,689
20180909,719
20180910,724
20180911,655
20180912,780
20180913,694
20180914,636
20180915,598
20180916,641
20180917,640
20180918,662
20180919,720
20180920,637
20180921,729
20180922,683
20180923,764
20180924,659
20180925,673
20180926,688
20180927,803
20180928,630
20180929,675
20180930,679
20181001,656
20181002,653

2025-01-30 01:16:37 - root - INFO - SQL:
-- Query 7: Get users and dates when they returned in the fourth week after first session.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT user_pseudo_id, DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
         DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
LIMIT 100
Results:
user_pseudo_id,event_date
4F7CAE5C86F09A791C3F9FA77C10E833,20180822
ED0AF1301B6404476B420A990B98ABD7,20181001
99C7EF05303C88ACFDE2A301AD578F59,20180913
023A2DB99CC3F70A4B71869C36952D74,20180825
B5FA3B0588C19181222FCE3135DB3452,20180825
50EA79F18D71071A63A27AA59A453D6E,20180825
EFB696A82D093B3AFBE92FF526DD5CEA,20180804
40B501E0460E254E289A776CFC31DCF2,20180804
BE36C49B1AB3968D420923AEC4FDD7AE,20180804
F1555004E0D95599AF2F2B8EA130A9C3,20180804
0B08423CCD5F1503B5A8B306FFED999C,20180804
5E9BF00B469B284E028094EA15A9F1FE,20180804
2B90CE94C6039DF03E72FE15B5320ABA,20180804
D3F06F9B7BD9D7FC8758BF78BF0705E9,20180804
BBBB2C46108622C7B2A5444C3B823176,20180804
05FB3382D94C7E963B408FD6CC357D33,20180804
A19F659EA9BA36A3595F088F30A6B7E7,20180804
AD99B4950F9D70E0FD5E8563F2A664FB,20180804
53CAAF361073109F66760692FA12673B,20180804
74253012A39B1F4DE53D4BFF1AB2B5DD,20180804
0A26E7281EC31038AD42F28C930FFF90,20180930
32B77CB85060150AF92F76E2745F2D7A,20180927
ECA7E21BD6A07DF07E8F9E1DCC040EC5,20180906
E1A3C786B2E4D56629EE808A3A174995,20180905
8942968E35FB64702050A08D544D2A4A,20180907
C57026026F451C8B63B19481023BE944,20180907
BCEC642620FB741AA4EE43E0FC6C7A05,20180806
959635567E419A061EECCCA478EDC718,20180806
44A600997B9B6499325D518A19B51FEC,20180806
FB98112938373BD2B844A8C15E40A539,20180806
AFA41EF5E9CDCC4DF87A199049813E45,20180806
A765E9F4A5AA993FF502965BF138AFCF,20180806
C74B58C4CD2770A1E97D6DC13D42CCAC,20180806
81F5705397CE9F0236B2B672AE113154,20180806
82486A3B62D50DB914F1C6857733DAB2,20180806
56B9CBB6CB58106DCCF3CAD660232CB2,20180806
4965FA5C2DC955BF49BD33BDB25EC127,20180806
17DC0E89E3ECED8B312BCC88BCE23548,20180828
186F51E5AACB37852E3650E7027E33B1,20180924
65D1701E5BA0070CCF15F0CB0E1CF750,20180924
F4A3B9F9F0D4555ADC48F7BCBD5BEE9C,20180914
734ADBB5D0874A5007E58B2F99625EE0,20180830
551130953A7F37F23035F9A91CA41C15,20180830
C164946D2A79F9A024EB96B6C555B29B,20180830
599F51830B4E8DCA85348F8BDAB96585,20180909
D21451ACF492761DBC86B3549AEA194A,20180909
3652784B7A0A13B4DBD91A10CCB72FA5,20180909
CF62C17E245938F28D9A86634660A2FD,20180811
D79D77E3F2698B89279D7C35AB034992,20180811
B8B20A9B77B516AC51BD7C96E3F1866C,20180821
C57026026F451C8B63B19481023BE944,20180908
8EDB9A9856CDB5AFC42546106EE46734,20180730
472451071AED6FF801BC0FE66706FD27,20180730
1B3AD9683D475EFB398E131DFE65AE61,20180730
3FC8ECFC8F2976C5B56D0D782F36BD7F,20180730
91814809BD9374D5CEDFC6A31727CC55,20180730
4D33ED6DCCD63BBED146B6060B307CAF,20180730
7ED8C235689771F6B0F29BBF295A346F,20180730
FC48EDE912EDD9F8D7ED45F697EE7193,20180730
A95BA9143018CA81430258E8A725C3E6,20180808
0A26E7281EC31038AD42F28C930FFF90,20180928
5C5D78DD8E3D3B7FFC9118D4511E76BF,20180928
5B333FE2BC3875C6C3882279B51B8BAF,20180928

2025-01-30 01:16:43 - root - INFO - SQL:
-- Query 8: List cohorts by week starting on Mondays and count users in each.
SELECT FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
       COUNT(DISTINCT user_pseudo_id) AS user_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start' AND event_date >= '20180702'
GROUP BY cohort_week
ORDER BY cohort_week
LIMIT 100
Results:
cohort_week,user_count
2018-07-02,1374
2018-07-09,1351
2018-07-16,1325
2018-07-23,1444
2018-07-30,1631
2018-08-06,1508
2018-08-13,1463
2018-08-20,1441
2018-08-27,1619
2018-09-03,1922
2018-09-10,2003
2018-09-17,1870
2018-09-24,2010
2018-10-01,898

2025-01-30 01:17:23 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:17:23 - root - INFO - **Explanation:**

The error message you're encountering:

```
400 Column name user_pseudo_id is ambiguous at [2:36]; reason: invalidQuery, location: query, message: Column name user_pseudo_id is ambiguous at [2:36]
```

indicates that the column `user_pseudo_id` is ambiguous in your query at line 2, character 36. This happens because both the `cohort` subquery and the `e` events table have a column named `user_pseudo_id`. When you reference `user_pseudo_id` in your `SELECT` statement without specifying which table it's from, BigQuery doesn't know which one you mean.

**Solution:**

To fix this, you need to explicitly specify the table alias for `user_pseudo_id` in your `SELECT` clause to remove the ambiguity.

Here's the corrected query:

```sql
-- Corrected Query 9: Get the number of users who returned in the fourth week for each cohort.
SELECT cohort.cohort_week, COUNT(DISTINCT e.user_pseudo_id) AS returned_users
FROM (
  SELECT 
    user_pseudo_id,
    FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
JOIN `firebase-public-project.analytics_153293282.events_*` e
ON cohort.user_pseudo_id = e.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
GROUP BY cohort.cohort_week
LIMIT 100;
```

**Explanation of Changes:**

- **Specify Table Aliases:**
  - In the `SELECT` clause, specify which `user_pseudo_id` you are referring to by adding the table alias `e.` before `user_pseudo_id`:
    ```sql
    COUNT(DISTINCT e.user_pseudo_id) AS returned_users
    ```
  - Also, specify the table alias for `cohort_week`:
    ```sql
    SELECT cohort.cohort_week, ...
    ```

By specifying `e.user_pseudo_id`, you tell BigQuery to count the distinct users from the events table `e` who returned in the fourth week.

**Additional Notes:**

- **Joins and Column Ambiguity:**
  - When you perform a `JOIN` between two tables that share column names (like `user_pseudo_id`), it's essential to prefix these columns with their respective table aliases in your `SELECT`, `WHERE`, and `GROUP BY` clauses to avoid ambiguity.

- **Consistency in Aliases:**
  - Ensure that you consistently use the table aliases (`cohort` and `e`) throughout your query wherever there might be ambiguity.

**Next Steps:**

- **Run the Corrected Query:**
  - Execute the corrected query in BigQuery. It should run without the ambiguity error and provide you with the number of users who returned in the fourth week for each cohort.

- **Proceed to Calculate Retention Rates:**
  - With the number of users who returned in the fourth week, you can calculate the retention rate by joining this result with the total number of users in each cohort (as done in your Query 10).

---

**Proceeding with Query 10:**

Now that we've fixed Query 9, you can use this corrected query to calculate the retention rate in the fourth week for each cohort.

```sql
-- Query 10: Calculate retention rate for each cohort.
SELECT 
  total.cohort_week,
  ROUND(SAFE_DIVIDE(returned.returned_users, total.total_users) * 100, 2) AS retention_rate_percentage
FROM (
  -- Total users in each cohort
  SELECT 
    cohort_week,
    COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' AND event_date >= '20180702'
    GROUP BY user_pseudo_id
  )
  GROUP BY cohort_week
) AS total
JOIN (
  -- Users who returned in the fourth week for each cohort
  SELECT 
    cohort.cohort_week,
    COUNT(DISTINCT e.user_pseudo_id) AS returned_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
      DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
      DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' AND event_date >= '20180702'
    GROUP BY user_pseudo_id
  ) AS cohort
  JOIN `firebase-public-project.analytics_153293282.events_*` e
  ON cohort.user_pseudo_id = e.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
  GROUP BY cohort.cohort_week
) AS returned
ON total.cohort_week = returned.cohort_week
ORDER BY retention_rate_percentage DESC
LIMIT 100;
```

**Understanding the Final Result:**

- This query calculates the retention rate for the fourth week for each cohort.
- The `retention_rate_percentage` is calculated by dividing the number of users who returned in the fourth week (`returned_users`) by the total number of users in the cohort (`total_users`), multiplied by 100.

**Identifying the Cohort with the Highest Retention Rate:**

- After executing the above query, you will get a list of cohorts with their corresponding retention rates.
- The cohort with the highest `retention_rate_percentage` is the one you're asked to identify.
- Return the result in the format `"YYYY-MM-DD"` corresponding to the Monday date of the cohort's first session week.

**Final Answer Format:**

```csv
YYYY-MM-DD
2018-07-16
(Attention: answer in one row)
```

**Explanation:**

Assuming the cohort starting on **2018-07-16** has the highest retention rate in the fourth week based on your calculations.

---

Let me know if you need further assistance with running these queries or interpreting the results.
2025-01-30 01:18:01 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:18:01 - root - INFO - SQL:
-- Corrected Query 9: Get the number of users who returned in the fourth week for each cohort.
SELECT cohort.cohort_week, COUNT(DISTINCT e.user_pseudo_id) AS returned_users
FROM (
  SELECT 
    user_pseudo_id,
    FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
JOIN `firebase-public-project.analytics_153293282.events_*` e
ON cohort.user_pseudo_id = e.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
GROUP BY cohort.cohort_week
LIMIT 100;
Results:
cohort_week,returned_users
2018-07-16,98
2018-07-09,132
2018-07-02,537
2018-08-20,37
2018-08-13,30
2018-08-27,64
2018-08-06,49
2018-07-23,75
2018-07-30,67
2018-09-03,11

2025-01-30 01:18:56 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:18:56 - root - INFO - ```sql
-- Corrected Query 10: Calculate retention rate for each cohort.
SELECT 
  total.cohort_week,
  ROUND(SAFE_DIVIDE(returned.returned_users, total.total_users) * 100, 2) AS retention_rate_percentage
FROM (
  -- Total users in each cohort
  SELECT cohort_week,
         COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS sub_total
  GROUP BY cohort_week
) AS total
JOIN (
  -- Users who returned in the fourth week for each cohort
  SELECT 
    cohort.cohort_week, 
    COUNT(DISTINCT cohort.user_pseudo_id) AS returned_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 28 DAY) AS fourth_week_start,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 34 DAY) AS fourth_week_end
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS cohort
  JOIN `firebase-public-project.analytics_153293282.events_*` e
  ON cohort.user_pseudo_id = e.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
    AND e.event_name = 'session_start'  -- Include this condition if you only consider 'session_start' events as returns
  GROUP BY cohort.cohort_week
) AS returned
ON total.cohort_week = returned.cohort_week
ORDER BY retention_rate_percentage DESC
LIMIT 100;
```

**Explanation:**

- **Removed Unnecessary GROUP BY Clauses:**
  - In the subqueries, the `GROUP BY` clauses were causing issues because `event_date` was being used in calculations but not included in the `GROUP BY`. By removing the `GROUP BY` clauses in the innermost subqueries (i.e., removing `GROUP BY user_pseudo_id` and `GROUP BY user_pseudo_id, event_date`), we allow all necessary columns to be available without aggregation errors.

- **Adjusted Column References:**
  - In the `returned` subquery, changed `COUNT(DISTINCT e.user_pseudo_id)` to `COUNT(DISTINCT cohort.user_pseudo_id)` since we're counting distinct users from the `cohort` table who have events in the fourth week.

- **Ensured All Columns Are Properly Aggregated or Grouped:**
  - In the `SELECT` statements, all columns either are aggregated (using `COUNT`) or are included in the `GROUP BY` clauses, resolving the error about columns not being grouped or aggregated.

- **Added Necessary Conditions:**
  - Included `AND e.event_name = 'session_start'` in the `WHERE` clause if you only want to consider `session_start` events as returns. If you wish to consider any event as a return, you can remove this condition.

By making these corrections, the query should run without errors and correctly calculate the retention rate in the fourth week for each cohort.
2025-01-30 01:19:57 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:19:57 - root - INFO - SQL:
-- Corrected Query 10: Calculate retention rate for each cohort.
SELECT 
  total.cohort_week,
  ROUND(SAFE_DIVIDE(returned.returned_users, total.total_users) * 100, 2) AS retention_rate_percentage
FROM (
  -- Total users in each cohort
  SELECT cohort_week,
         COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS sub_total
  GROUP BY cohort_week
) AS total
JOIN (
  -- Users who returned in the fourth week for each cohort
  SELECT 
    cohort.cohort_week, 
    COUNT(DISTINCT cohort.user_pseudo_id) AS returned_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 28 DAY) AS fourth_week_start,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 34 DAY) AS fourth_week_end
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS cohort
  JOIN `firebase-public-project.analytics_153293282.events_*` e
  ON cohort.user_pseudo_id = e.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
    AND e.event_name = 'session_start'  -- Include this condition if you only consider 'session_start' events as returns
  GROUP BY cohort.cohort_week
) AS returned
ON total.cohort_week = returned.cohort_week
ORDER BY retention_rate_percentage DESC
LIMIT 100;
Results:
cohort_week,retention_rate_percentage
2018-07-09,38.49
2018-07-02,38.36
2018-07-16,38.19
2018-07-23,36.15
2018-07-30,31.58
2018-08-27,31.25
2018-08-06,29.38
2018-08-20,29.01
2018-08-13,28.37
2018-09-03,11.39

2025-01-30 01:20:02 - root - INFO - SQL:
-- Original Query 2: List user_pseudo_ids and their first event_date.
SELECT user_pseudo_id, MIN(event_date) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_event_date
5E3CB701F06E57FB36C28741D182DDCE,20180912
D6CE2614AB26B05B94FC3840D08E91F0,20180721
EECDCA8076D5842922767F5C08957B17,20180702
59454BAC415BB1F18517C6FD2C023E49,20180702
49CF61B01BD5584B86EFC08E40F6EB03,20180912
C6DE585349744A40725DB0AB17041BA3,20180702
1D89281562AC3FEFB76A42ED406BF1B5,20180808
A5A56F3717C923CECBB9247595F6CA5F,20180902
89A5AD5EB82221A45F9766C77E471DFB,20180910
68EA8FDC3D7F8984530BB60FAE9A42FD,20180704
FE57181360ADCD86B7E09063DF2BBD2E,20180917
2AA7CE8A30BD25743594101C76B46A6B,20180917
F9C021D9A8B84158F73A8662D76E9EE9,20180721
D1C8EF768AA75348EE9EC5629903E194,20180905
7DAD0B52C6A70949182E0658E67CBF99,20180917
175AEE22E34051C883F76BD73422AC72,20180804
74C5538FA4F9984289F0088723F7B694,20180917
69495B8489F605F197D1E8697BCBF02B,20180722
A72750663D0181C7817F61B3DD2CA656,20180801
1748CF87FC0F4E9B3997E2D8AEB022E9,20180902
DA1D3A39658D50A5B0C7C7C28097FBA5,20180904
3082CDD760FB4C2F5BAE25E78DD0B000,20180913
8942968E35FB64702050A08D544D2A4A,20180804
45F9DF7016DA4536060707F1B04FE784,20180911
7D7B319DFFF03520EF50236B2C3FB008,20180710
03780EE9CFF9761E7D40266B65D30158,20180907
41A07F6F6C3756427B09AEF18204CA37,20180803
0B07B90485BF0E79B25DD61D07D12172,20180917
AE0B1CA04B5C91B08FE47466B38A1A6B,20180904
989D5092D062D1B432BEB9C618B21431,20180917
BE51B6A4C9E61DA82581F026ABAD0359,20180904
B1C11C1880C459CAF44FC8622DEB4716,20180905
79D16DA26AB14780B3F4723E0E57769F,20180902
9FE14774A6A768A1C1BEBCE0DE0669A5,20180904
C3751E5C501D7C729C8F3B49F20FB710,20180917
08362BC5AB07C0587FC4CDC22AD97252,20180831
DD9CB779BD294C2AAC7D2BDDEDD7A22D,20180917
8BD465AC77DC9D8B4C597BF35950FDA3,20180703
0129188FE90E57C0A94813F1919AB27D,20180830
205AE83B43BB3A54E25E55E605AF6431,20180804
51012EB79345170B6D17DCD2528288D3,20180904
BD2A511409EB3EBC45D4CEB4F876ED49,20180819
5A24FA671D66FF78C978D077245B4777,20180710
51C511BDA46B8307F21527B455A1A59F,20180904
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180703
B975974ADC622D45F681637DDAE2B116,20180910
279184552B138A74EE3B205BCDC55E15,20180917
724B99CB6F41846F3F6BB46C2F663F5E,20180704
FC3907C3039196E679F3C468FE5B1F9E,20180904
69599C9ED33015D6A6AEE16414074147,20180904
F7CB7FD4E78B203FB518F703DA8C7662,20180917
3A110988C8149D12D9F52341B8FDFFD2,20180906
FA81D490D1A951F746467DFC2953A915,20180904
23FF59A1CAB09E2822EA2F837CEFB246,20181001
DD0C9E0425155960EA9EC58314A22431,20180920
C28231099C78071ADF8D0BAEA7B9C1F2,20180804
EBC3581ADA874D494FBE2C7CCF53BF99,20180703
706C748E6D1E0768BFEFE6362B5D3F67,20180702
5B0F314F62B74CCD676776E6B51BF450,20180709

2025-01-30 01:20:08 - root - INFO - SQL:
-- Corrected Query 2: Parse event_date as DATE.
SELECT 
  user_pseudo_id, 
  MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_event_date
9F7B0D1BFB822F5E26E91E184E2E437C,2018-07-14
A976A39B8E08829A5BC5CD3827C942A2,2018-08-12
487DE902636DD8A9844A2D61FE7BD568,2018-07-02
0579CD8B9F2F5C48A5F1ACECF88750A7,2018-08-29
571B1FB7D9D44445BF25B75F0FD91660,2018-08-31
34CAF47105A2D9D0AC7464BB3AF8DB2A,2018-09-01
1B959D672ABAE4A3BFB9D720D415E064,2018-08-04
8065F8E98407106A65D35195984B2258,2018-07-06
D7EA8E3645EFFBD6443946179ED704A6,2018-07-02
6080ACBD76F27089523A73026969036D,2018-07-04
6E94F41FB1EB000C00CEAF43CF70938F,2018-09-01
2902E47E243769C20EEFACE79EB4ECB3,2018-09-01
5A66BC427F25EFFDFEDED4A07D8F9F91,2018-09-01
37EFBD2BA398148336F96B4347392A8D,2018-09-01
9373B5D36107012F6F9137090C523FA1,2018-07-08
387B532B7AF7A362DBF783E34C05BF54,2018-09-01
551B893D34A2A59971B8FF185C1CD0C8,2018-09-01
A6522F1A3180B75F091CEB712356A375,2018-09-01
3B049329E3090DA7A4339C4A46EF0763,2018-09-01
869CD665A9D52E3398754C8DACF4426D,2018-07-20
A305B55D5049F38F5139DA95B3DCE247,2018-09-01
ADB20527463A407E77162C54D30435F1,2018-09-01
B50E2B0888440679A84A3D861332531C,2018-08-31
DF08C4F0E5A855549CC953592EFE2731,2018-09-01
2B6D9C77F287F5C021EC7297203D412B,2018-09-01
F0FE3E7D8F5EF494C7D34AECB8D27951,2018-07-10
6A71951BC1C5F03C22E9E892AEB90B19,2018-07-02
9FD6E2CD74490F5DA5F52D249CBB750A,2018-09-01
F4A3B9F9F0D4555ADC48F7BCBD5BEE9C,2018-07-30
61BB31EC7781341B1D7B8D8A85688DA3,2018-09-01
81C75CB599BE7E11A66110C3FE9D0050,2018-07-12
CCE5E30054C510608589FA6240615B0A,2018-09-01
45116F98E0EE54636FE629BA54228131,2018-07-02
018D9A140B327998E49E56FF12ECE76D,2018-09-01
0DCD6B00CAB93941AA5EB18DE8C053EE,2018-08-31
625CF86657E00A4629BCE49F5B31A144,2018-08-22
7709833232AD9720F6DD21A2F5D8690A,2018-08-30
D963E509346C0E5358ECFE56AF3BB2ED,2018-09-01
2C15FFDEDDA69390B7A8EB5808FB7ED6,2018-09-01
5E4B8BBBE58491A3A1B462A95DC287E4,2018-07-07
229254D7C810F98F72C89A8060E194D4,2018-07-02
977CBDF2D7B65AC0FDC885F87117A7F2,2018-09-01
EFD6F768B28BA326FAEEB42728DF7360,2018-09-01
F5CA9C70FB5ACA0C36279A6FB407A7B7,2018-07-05
E84BFE62196E059C66D049BA9A14061C,2018-07-09
05407E04B9FA64CB63D8FA1D966AD6A2,2018-07-02
FFDDF354D9B9E851D2A62ABAEA17DA3E,2018-08-11
1CF315BC6864E7A71A81E47925E18A61,2018-07-02
D64DDC2439F7219840E0EEA2AC42CAB4,2018-07-03
3A1B5A55C33A7EF1A37C909A753606B8,2018-08-12

2025-01-30 01:20:10 - root - INFO - SQL:
-- Original Query 3: Retrieve sample of user_first_touch_timestamp values.
SELECT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Results:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000

2025-01-30 01:20:12 - root - INFO - SQL:
-- Corrected Query 3: Use DISTINCT to eliminate duplicates.
SELECT DISTINCT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Results:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
65D7715C409E6A38667447CE2B52AFFE,1528942159978000
B205B117C82A24AA95E663FFB7D04718,1469140986121000
EF9E8CCCCBBB015CAE0C334AB1745417,1529447876425000
83D8C7F90DAF2C832F05A9DDD8693135,1529819069374000
093642BD46204EB5F950303CE696BC18,1530385216083000
0F67E233B19D2898229CD156974A93AE,1473965741576000
5217AB1A454DAED6243E1C9818BE6A20,1529861553949000
C6EAD483A8AF7EE9B0ADE6D7CE5DD698,1530432632721000
58230465C695B0FDDDAE08A481FAEECC,1478537966449000
38D4084307B6D1CEA37A48981753428E,1471144513147000
0373DF7959F6867CDFB1C905D39CE67C,1529565444890000
5D5895B1267014C54ECBE08864420979,1519311576303000
D34924C19421D7E083FD387D97765F94,1511022914255000
C136A7CE1D0A52B8D4E5F144DF114EB7,1465988331737000
49309C5759610DBF6C829C0D4AB23943,1472075042638000
92B0B6F48ECE132C7E502F94798FE205,1480380027427000
4BF98D09CA8359FC59ADAF56D00338F8,1526162138359000
08D399C66188D9A356AFAD5E2B2BA45E,1529342141367000
909A16079F7183140ACF4C71A6CCDF3D,1499374796812000
3031EAD1E9D35306A37A0F3DC3B84A0A,1485186730422000
05407E04B9FA64CB63D8FA1D966AD6A2,1466371801749000
3A58859E074B02E8FB1CAEA291636112,1480644849973000
5CDFC86835249BE3DB5E9F6778E344AD,1488164439701000
706C748E6D1E0768BFEFE6362B5D3F67,1475151487594000
F815B0069F973BFA743EF90A85224109,1472922491594000
D0F280B12652EB0D74F6BC74AB13606F,1529344858634000
4D084D38156128AAA060303AA91E689D,1515971069994000
3EF8FC940E379D53BBD3FEFDAF626BB2,1528354153183000
DE4912FBC5F915C027000A8A6FF44F85,1528465321983000
E6FEE8B98E75EA5311FE004F98559A27,1521946646783000
E2D6E7FE36B7CDD0789CC8F03CC747E0,1530584740063000
48AB910A8DE8485D4C34238EA61F782C,1507142733492000
50FEAE9ECFE22E951E8810622A2E8F66,1527600773769000
4A47422A455E62E3529DE4F9F3BFAF66,1528883889417000
2F5B044B41268F6643EB4D0EF15D4E87,1530375954462000
E8710E77072D6674A93E46DFEF725587,1526591004638000
7101B4232F5B26A9C987C54F8717DCDC,1522655144019000
4948BEDE78FC6EBA9899F26BF5C53897,1515194342419000
88A41BFED275BB69125BE1F5524F3B42,1504797808179000
A064A84CD3CF7058F39333D6212E8615,1500906025256000
A87A30159D909E2356F72AAC76F26707,1530061109192000
7842C62D45ECE888132F21C9F4417B21,1515272726578000
672B24B51143CC66DCBAA0FA88C38D57,1520653057938000
7AE4084BAA29B1987E51BF2964646805,1530306423314000
2F8E2DBB938D2E43C2D171AF5F35EEF8,1530292083666000
29845B6298FB882DF53607D21F0E1DF7,1526399609287000
76BB576278338D2E508DE5D705241B47,1468719074983000
92BF054A90804B6D65F11D7CDFCDDEFC,1530499836284000
7207044281C74501C14233463AAD9A71,1529441927292000

2025-01-30 01:20:17 - root - INFO - SQL:
-- Original Query 5: Find the first session_start event_timestamp for each user.
SELECT user_pseudo_id, MIN(event_timestamp) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_session_timestamp
50FEAE9ECFE22E951E8810622A2E8F66,1530563006435000
2F5B044B41268F6643EB4D0EF15D4E87,1530524108918000
E50F7AC0680FD87AD6CE6B6700D209A7,1530551550900000
E2CD12EE286D97AF7174B8AB91391200,1530598383192000
E4D0CD43ECF1890C6D20D2EC09153E02,1530650253847000
35F14977E77C94FBCEF82E5524637F59,1530640436986000
05FB3382D94C7E963B408FD6CC357D33,1530540115036000
2D716CF5F646D5B95689EB06FE2B4724,1530661650597000
676BB63373E1F0AD33EE422E0D6D6184,1530649158419000
472451071AED6FF801BC0FE66706FD27,1530535176930000
A2B7DF97E146FC5AB4C8F89A94D85B4A,1530535699193000
48D0C822ACA6BD0B5FBA8ECD27CBB247,1530627162232000
CABE7E24215A5C36862658A36AE5CE12,1530517623955000
71D3B39420F99B336CDE2B934AE5D41B,1530680850116000
90661BFEBB42671421697F7DA63EC771,1530545648579000
3D9A1566A6D35AC1D20B7D125637B637,1530522596051000
E43D3AB2F9B9055C29373523FAF9DB9B,1530668437489000
CFA0F8C5E25A71062E573EF8E6BC9F76,1530559850933000
DA48D36D07835B1918BDF831AF83B5EF,1530525589484000
AFFBFB5A561C0DEA5ACAA4D33BC483A5,1530680311079000
54CA0B1CD95413DE6A18F9096B63FE1F,1530642295766000
E4C6FF8288DD4BFCDE93E2218E20643B,1530581654616000
BEF227E6B27B4FE07D5AA2754D1251A8,1530635599989000
C2C63C13ABABCABF76D52E91E64B44D2,1530639506651000
461EEAF2B9223AE1D44C0E8DCE64876C,1530656907952000
13E6C8A193FF140F7D4222B569DD5B50,1530526573156000
E4FAB1210B693B084CA6829A5EF59438,1530677465365000
981CA03B25810447E879E7E767499ABD,1530660039467000
C22A13E254C44E0ECD2864B4287E514C,1530647884027000
A279C431ACB82BFB2B7A234A6707BCFF,1530628462621000
760224DD438185D3F00938581C387090,1530656427865000
EEBCB25D5F056CCF59DDE654388ACD2B,1530636530211000
8D9D62A4402581BB1181D3AA73AD54E8,1530587329915013
B3A9A38A561B3648D280614B8E2D8E07,1530570416493000
B78DB4E683651327A612372A48B5734C,1530627210608000
3B4A6FCA6DCB4C2749409DC4188A306E,1530651304184000
BA6AC3E59787946CFE7804B39352E10F,1534803903814000
7E74A2BB6BBF4746DEE15F957B315401,1535646010829000
50D529BFD3EFEB1C8216DF9A321A552A,1535451557028000
3EDE8E7A50DE76AA2EC12DDD2AE3F9F4,1530554378710000
0150077AE685E3084E5DB84CF61CE383,1535899602546000
CF13213745D519874DC3AB772839C6AD,1535891064427000
89D57EAF8F7A4FF245A227FEE9AE9459,1535939539826000
CFF34B5186EB1563295F0058BBC7CC0B,1535873429671000
0808B3380E616BDF15E6F2FBAF38147F,1535940055197000
31334ECCEC5C9988469EAD462A6C4D47,1535927294569000
79B9A58A7EC56B4AF58F456B26F66862,1535933540965000
67D3D76504CC5C4CBFC78EE4FC397C8B,1534032761831000
1F54AC7A413B33C6023DA0AF8F489684,1533695455449000
BD2522100FDE854404F8DF2555188670,1535952388953000
8C2F7E36E43B986779452495F7536DCC,1535917382884000

2025-01-30 01:20:23 - root - INFO - SQL:
-- Corrected Query 5: Convert event_timestamp to TIMESTAMP.
SELECT 
  user_pseudo_id, 
  TIMESTAMP_MICROS(MIN(event_timestamp)) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Results:
user_pseudo_id,first_session_timestamp
094CDCB8EF23B9B55134A0B5E22DFFCB,2018-07-08 22:16:40.102000+00:00
177DA0D458131BC9CA84EAC2697BE14A,2018-07-16 18:11:49.172000+00:00
E84BFE62196E059C66D049BA9A14061C,2018-07-09 23:44:26.743000+00:00
476409D7DFD0B2B2B0AB11E5F6D7DDBE,2018-07-16 22:55:05.592000+00:00
D7EA8E3645EFFBD6443946179ED704A6,2018-07-02 14:04:01.341000+00:00
CD936C60130D12C06E388F8EDFEA7105,2018-07-03 15:30:19.992000+00:00
503AB1BC9E19C89B0425ED404E60F062,2018-07-16 21:03:55.100000+00:00
6CC135C2403667F8114096D6C0854286,2018-07-13 14:37:59.027000+00:00
9373B5D36107012F6F9137090C523FA1,2018-07-08 21:48:26.836000+00:00
F0FC99F563E1247AD70240E5AA132ABF,2018-07-03 12:47:25.321000+00:00
1CF315BC6864E7A71A81E47925E18A61,2018-07-02 12:40:06.203000+00:00
A74C05E503F6274BAA9457B2265471F5,2018-07-02 12:11:32.513000+00:00
E6B6CAE2D200FC3EACF21DDE75402DCD,2018-07-02 10:42:39.067000+00:00
D842320AECB686B41C2F8E8876794D34,2018-07-04 06:53:51.272000+00:00
F0FE3E7D8F5EF494C7D34AECB8D27951,2018-07-10 23:54:40.587000+00:00
229254D7C810F98F72C89A8060E194D4,2018-07-02 11:20:14.672000+00:00
F5234E286EEDAB7864E680AA874A2DC5,2018-07-11 23:17:35.975000+00:00
518DABD4A0DF4C41A6D811D6D45EB2B6,2018-07-05 02:40:19.256000+00:00
A1CCD9D935CD30A3A49B3A78204315BE,2018-07-17 02:29:33.304000+00:00
B3F87EC5102A3DC9F28543B25A7BD969,2018-07-17 03:13:32.417000+00:00
225638B28A80341EEB04F1DFC144F30E,2018-07-09 10:52:13.724000+00:00
6683CAFB77FB7B60C78CD233EB2B62F7,2018-07-02 13:50:58.095000+00:00
0D9DE32D08364277A3406C8107F5763F,2018-07-10 12:59:13.828000+00:00
9E8FED725DA53AE5AF06520FB4A0883C,2018-07-16 22:13:33.605000+00:00
5E4B8BBBE58491A3A1B462A95DC287E4,2018-07-07 22:16:16.995000+00:00
9BC12903974C904CC966F956702D361C,2018-07-16 07:04:46.086000+00:00
F4810B35D08410542741137BD5FD3326,2018-07-11 12:23:24.678000+00:00
05407E04B9FA64CB63D8FA1D966AD6A2,2018-07-03 02:59:04.627000+00:00
3EF8FC940E379D53BBD3FEFDAF626BB2,2018-07-02 21:02:17.475000+00:00
AB32482D193E2CE166B59F82EF78D8BB,2018-07-09 22:21:24.475000+00:00
C795AFA7F574C2BB09D3647AD90A9719,2018-07-02 09:09:39.747000+00:00

2025-01-30 01:20:30 - root - INFO - SQL:
-- Original Query 7: Get users and dates when they returned in the fourth week after first session.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT 
    user_pseudo_id, 
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
LIMIT 100
Results:
user_pseudo_id,event_date
6EBDDD1BC5E5489D7FF0B41B8DAA9D86,20181002
3B9DDD282F488869CFFCC057F70958B0,20181002
ECB676BED33FDF42E1B0DCF234E1344B,20180905
C28231099C78071ADF8D0BAEA7B9C1F2,20180905
175AEE22E34051C883F76BD73422AC72,20180905
186F51E5AACB37852E3650E7027E33B1,20180926
D41AA91B61872612B5F5F4E42870042C,20180831
E80C958E3C33898989A30B8F5A4514F0,20180831
9842E27FE3DF102CAC1B954D1D12B02C,20180823
82486A3B62D50DB914F1C6857733DAB2,20180809
95BC3B2233ECAE0717CC70A45315365B,20180809
51350F5497804E91C6311DC404F392DA,20180918
01C784BDB7AF4DC8DAD6DCD21AF56E25,20180731
E9DCE2D958652BD58E846DCE86BDD90A,20180731
EBB30E8C806A423B024E51AC32021A6A,20180731
17934EF7C1BC1CF2C7D942401FDE84CE,20180731
59454BAC415BB1F18517C6FD2C023E49,20180731
BE36C49B1AB3968D420923AEC4FDD7AE,20180731
4D33ED6DCCD63BBED146B6060B307CAF,20180731
229254D7C810F98F72C89A8060E194D4,20180731
98578513E0F25350F961CDCBA9D3656F,20180731
88E99CE30B65345ED0B118869B6AD035,20180912
1170309EA1D2309A158B8F6346AECE88,20180818
0B9739BFB4122E1863C894E34F812D56,20180818
0175F289F0878C46DCA6B0AF3C5677F1,20180916
68A9524E56BA07A82BBC48AE25F2C246,20180927
A7AAA5EF977926DBCF801D15F83EE4A5,20180808
E643F6549E6C7EA0FD01EF4BF7A40F76,20180808
CD93E1D286EC5C24E033D0D887133880,20180808
AC1B8C257039C7FB911CA9AE69D4C614,20180808
E415D4A90F9A9D8B784B3BCE2F5678B5,20180808
C74B58C4CD2770A1E97D6DC13D42CCAC,20180808
05F0FB18A61CCB1E2540F4D26721CCEC,20180808
D50D60807F5347EB64EF0CD5A3D4C4CD,20181003
1F85C1136C7E636D8565505BCAA75E8F,20181003
E458F1B823941D35957203CBF6610A33,20181003
4E0D2F7E40746B90029E4F4241F9ECA9,20181003
95E26DC518A7793A7E7C9D40BE914111,20180807
83B2810298A42907030999DED800A7D4,20180807
1B0397F7967E35746E7C3CBB652C0CE4,20180807
0046A2D1B1135C0AB4462B8FF036739E,20180807
B1D1ED35873581A23E48C4CD03DDFF81,20180807
95BC3B2233ECAE0717CC70A45315365B,20180807
B458770ED6E295374FEEB3A68902CC28,20180801
55BFC405FFA33C0781DE73101011E45B,20180801
AFA6BA99FB329CB459E8E57FDE1DF9AE,20180801
0F93A84CB0774C5BAB3E5FF8A72A694D,20180801
396CD60DADAB9CBA7DDCAF239B477135,20180801
7CA838857E3B7B8C9FC6A34E975FBF22,20180801
12E5626928FE0885DEEF068683E8BD63,20180801
81F5705397CE9F0236B2B672AE113154,20180801
8F6C5F7611B67A4A437FF283B6C10181,20180801
17934EF7C1BC1CF2C7D942401FDE84CE,20180801
F815B0069F973BFA743EF90A85224109,20180801
40B501E0460E254E289A776CFC31DCF2,20180801
89BD2B0E233951461CF06C9B4FDA0D81,20180801
7D613AF4DA0F508C7090E96FD73B7E6D,20180801
932AAF56DDE9C55359B9CCFA18E7FB95,20180801
19DEEA6B15B314DB0ED2A4936959D8F9,20180801
2741C47CC50AE98B39CC5B561BFEA504,20180801
0CAAA1B6F161BA4D363EB7A2DEF64A08,20180801
307AC87B6D76A6A1A19AC2B11E3FA4B5,20180824
938611E83B897B6F877992BF30D3E1FE,20180824

2025-01-30 01:20:35 - root - INFO - SQL:
-- Corrected Query 7: Ensure proper date parsing.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT 
    user_pseudo_id, 
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
  AND e.event_date >= '20180702'
LIMIT 100
Results:
user_pseudo_id,event_date
04104F6923B74F56CF20A9E0FC520C26,20180915
5341BD6A836D247A4B5CCDA5FB3BCC9D,20180922
17636078D57884AD7EA5406C60E2BD10,20180907
C28231099C78071ADF8D0BAEA7B9C1F2,20180907
2F48607C41ECC4015FA296500F0A2C4B,20180810
7F2B633C86B765201C93FDB6FF261143,20180810
3422CA1B4B6A9ACE78187868F362C3C7,20180810
75F979DE60C91A6631485A88457C108E,20180810
1F0D27B8A7E058446D4A6409E2E73B19,20180801
372D9BB5088C4E9000C65B06459B403A,20180801
01C784BDB7AF4DC8DAD6DCD21AF56E25,20180801
EEBCB25D5F056CCF59DDE654388ACD2B,20180801
706C748E6D1E0768BFEFE6362B5D3F67,20180801
FA30269453141794E79B8F15EE0BA5B9,20180801
4D33ED6DCCD63BBED146B6060B307CAF,20180801
53CAAF361073109F66760692FA12673B,20180801
FC48EDE912EDD9F8D7ED45F697EE7193,20180801
E4196C5E0A92A22F69DE4E3AA288D6EE,20180801
1213ED1E96B0A49B51C0F7683DB2ACCC,20180801
229254D7C810F98F72C89A8060E194D4,20180801
A19F659EA9BA36A3595F088F30A6B7E7,20180801
F2ACDC8D64D4218BA63EB8732C110BA5,20180801
B5F3D00E28A57C9522F2DEE3CB903DD1,20180801
1A7F253A85B952C329518608DEC20138,20180815
A82658237C6118780A6009C01F05DDEB,20180815
CE3148CA8DACC6B0D0C5D234186008BE,20180815
079A0986730A27E47BDE659B49D0F1FC,20180815
8E2CA56C1FD81A095DECAEDE6F2ED626,20180803
909A16079F7183140ACF4C71A6CCDF3D,20180803
DCEFBF52331910FC267F07111AD868F9,20180803
44A600997B9B6499325D518A19B51FEC,20180803
4BDC831A6940071E2461D0B5293A329E,20180803
7D613AF4DA0F508C7090E96FD73B7E6D,20180803
E4196C5E0A92A22F69DE4E3AA288D6EE,20180803
05FB3382D94C7E963B408FD6CC357D33,20180803
B5F3D00E28A57C9522F2DEE3CB903DD1,20180803
1213ED1E96B0A49B51C0F7683DB2ACCC,20180803
708E876A9807A8C1DBCA9A19BC35B702,20180803
487DE902636DD8A9844A2D61FE7BD568,20180803
E6B6CAE2D200FC3EACF21DDE75402DCD,20180803
1CF315BC6864E7A71A81E47925E18A61,20180803
81D3DD49AA2304FD1ED8C498747B5FC6,20180803
B63075B53A750A67A12F7F19ED5AA835,20180803
DA48D36D07835B1918BDF831AF83B5EF,20180803
223BF1D360715CB9BA85B0DDDE39D589,20180803
96161BF2E55C7E32ED5F411432875ECB,20180803
2E03DB1924573F3131EEC916E5444F56,20180803
2B90CE94C6039DF03E72FE15B5320ABA,20180803
8F6C5F7611B67A4A437FF283B6C10181,20180803
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180803
806B89C2F8514374D2F9F4DD50EA681A,20180803
136C3AB6E42E34223C8A7503EE355E12,20180803
00D49153E0790E34D76523EEBEF459B2,20180803
3B4A6FCA6DCB4C2749409DC4188A306E,20180803
0B74484DD41F519B4810A14A953CAA18,20180829
44561FB4558913850A7857FC521C1C42,20180829
CC62213661BE43BF92836F37DF9B3ADD,20180829
48C3F922E22657E619B06BE11763E782,20180829
9669A9911E183A5DCC390B981F20FE48,20180820
F34FF1C9F0C022B684BC885BA1DDC260,20180820
DBB995BF3A253CE1A68AF3B0B43C216D,20180820
5249B4686BC5038FBFE36A3E6CCA5B72,20180820
B234DE95E7BA43F7D422B2A2ED211629,20180914

2025-01-30 01:20:42 - root - INFO - SQL:
-- Original Query 8: List cohorts by week starting on Mondays and count users in each.
SELECT FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
       COUNT(DISTINCT user_pseudo_id) AS user_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start' AND event_date >= '20180702'
GROUP BY cohort_week
ORDER BY cohort_week
LIMIT 100
Results:
cohort_week,user_count
2018-07-02,1374
2018-07-09,1351
2018-07-16,1325
2018-07-23,1444
2018-07-30,1631
2018-08-06,1508
2018-08-13,1463
2018-08-20,1441
2018-08-27,1619
2018-09-03,1922
2018-09-10,2003
2018-09-17,1870
2018-09-24,2010
2018-10-01,898

2025-01-30 01:20:47 - root - INFO - SQL:
-- Original Query 6: Count of session_start events per day.
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Results:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500
20180709,580
20180710,613
20180711,593
20180712,620
20180713,640
20180714,554
20180715,539
20180716,535
20180717,495
20180718,520
20180719,484
20180720,574
20180721,636
20180722,533
20180723,587
20180724,582
20180725,552
20180726,550
20180727,616
20180728,607
20180729,662
20180730,632
20180731,585
20180801,608
20180802,690
20180803,692
20180804,688
20180805,667
20180806,628
20180807,619
20180808,669
20180809,621
20180810,477
20180811,584
20180812,611
20180813,685
20180814,605
20180815,568
20180816,613
20180817,617
20180818,637
20180819,604
20180820,641
20180821,630
20180822,625
20180823,588
20180824,646
20180825,653
20180826,618
20180827,685
20180828,638
20180829,696
20180830,656
20180831,618
20180901,579
20180902,648
20180903,637
20180904,659
20180905,741
20180906,707
20180907,700
20180908,689
20180909,719
20180910,724
20180911,655
20180912,780
20180913,694
20180914,636
20180915,598
20180916,641
20180917,640
20180918,662
20180919,720
20180920,637
20180921,729
20180922,683
20180923,764
20180924,659
20180925,673
20180926,688
20180927,803
20180928,630
20180929,675
20180930,679
20181001,656
20181002,653

2025-01-30 01:20:53 - root - INFO - SQL:
-- Corrected Query 6: Parse event_date as DATE for ordering.
SELECT 
  PARSE_DATE('%Y%m%d', event_date) AS event_date,
  COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Results:
event_date,session_start_count
2018-07-02,621
2018-07-03,596
2018-07-04,556
2018-07-05,548
2018-07-06,574
2018-07-07,615
2018-07-08,500
2018-07-09,580
2018-07-10,613
2018-07-11,593
2018-07-12,620
2018-07-13,640
2018-07-14,554
2018-07-15,539
2018-07-16,535
2018-07-17,495
2018-07-18,520
2018-07-19,484
2018-07-20,574
2018-07-21,636
2018-07-22,533
2018-07-23,587
2018-07-24,582
2018-07-25,552
2018-07-26,550
2018-07-27,616
2018-07-28,607
2018-07-29,662
2018-07-30,632
2018-07-31,585
2018-08-01,608
2018-08-02,690
2018-08-03,692
2018-08-04,688
2018-08-05,667
2018-08-06,628
2018-08-07,619
2018-08-08,669
2018-08-09,621
2018-08-10,477
2018-08-11,584
2018-08-12,611
2018-08-13,685
2018-08-14,605
2018-08-15,568
2018-08-16,613
2018-08-17,617
2018-08-18,637
2018-08-19,604
2018-08-20,641
2018-08-21,630
2018-08-22,625
2018-08-23,588
2018-08-24,646
2018-08-25,653
2018-08-26,618
2018-08-27,685
2018-08-28,638
2018-08-29,696
2018-08-30,656
2018-08-31,618
2018-09-01,579
2018-09-02,648
2018-09-03,637
2018-09-04,659
2018-09-05,741
2018-09-06,707
2018-09-07,700
2018-09-08,689
2018-09-09,719
2018-09-10,724
2018-09-11,655

2025-01-30 01:20:53 - root - INFO - itercount: 0
2025-01-30 01:20:53 - root - INFO - Database Name: firebase-public-project
Schema Name: analytics_153293282
DDL describes table information.
,0
table_name,events_20180801
ddl,"CREATE TABLE `firebase-public-project.analytics_153293282.events_20180801`
(
  event_date STRING,
  event_timestamp INT64,
  event_name STRING,
  event_params ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64>>>,
  event_previous_timestamp INT64,
  event_value_in_usd FLOAT64,
  event_bundle_sequence_id INT64,
  event_server_timestamp_offset INT64,
  user_id STRING,
  user_pseudo_id STRING,
  user_properties ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64, set_timestamp_micros INT64>>>,
  user_first_touch_timestamp INT64,
  user_ltv STRUCT<revenue FLOAT64, currency STRING>,
  device STRUCT<category STRING, mobile_brand_name STRING, mobile_model_name STRING, mobile_marketing_name STRING, mobile_os_hardware_model STRING, operating_system STRING, operating_system_version STRING, vendor_id STRING, advertising_id STRING, language STRING, is_limited_ad_tracking STRING, time_zone_offset_seconds INT64>,
  geo STRUCT<continent STRING, country STRING, region STRING, city STRING>,
  app_info STRUCT<id STRING, version STRING, install_store STRING, firebase_app_id STRING, install_source STRING>,
  traffic_source STRUCT<name STRING, medium STRING, source STRING>,
  stream_id STRING,
  platform STRING
);"

Some other tables have the similar structure: ['events_20180801', 'events_20180621', 'events_20180616', 'events_20180912', 'events_20180814', 'events_20180716', 'events_20181003', 'events_20180620', 'events_20180624', 'events_20180918', 'events_20180612', 'events_20180911', 'events_20180724', 'events_20180807', 'events_20180710', 'events_20180808', 'events_20180702', 'events_20180719', 'events_20180914', 'events_20180913', 'events_20180915', 'events_20180728', 'events_20180817', 'events_20180628', 'events_20180906', 'events_20180704', 'events_20180711', 'events_20180720', 'events_20180706', 'events_20180926', 'events_20180924', 'events_20180731', 'events_20180804', 'events_20180920', 'events_20180715', 'events_20180709', 'events_20180928', 'events_20180904', 'events_20180903', 'events_20180818', 'events_20180820', 'events_20180707', 'events_20180930', 'events_20180821', 'events_20180812', 'events_20180830', 'events_20180908', 'events_20180708', 'events_20180910', 'events_20180922', 'events_20180713', 'events_20180618', 'events_20180811', 'events_20181001', 'events_20180626', 'events_20180828', 'events_20180717', 'events_20180806', 'events_20180721', 'events_20180725', 'events_20180824', 'events_20180923', 'events_20180627', 'events_20180726', 'events_20180729', 'events_20180929', 'events_20180925', 'events_20180722', 'events_20180630', 'events_20180730', 'events_20180831', 'events_20180701', 'events_20180619', 'events_20180810', 'events_20180822', 'events_20180921', 'events_20180819', 'events_20180927', 'events_20180905', 'events_20180816', 'events_20180622', 'events_20180802', 'events_20180826', 'events_20180714', 'events_20180901', 'events_20180916', 'events_20180809', 'events_20181002', 'events_20180703', 'events_20180617', 'events_20180902', 'events_20180625', 'events_20180827', 'events_20180805', 'events_20180825', 'events_20180919', 'events_20180917', 'events_20180705', 'events_20180613', 'events_20180907', 'events_20180909', 'events_20180727', 'events_20180813', 'events_20180614', 'events_20180623', 'events_20180829', 'events_20180615', 'events_20180712', 'events_20180718', 'events_20180815', 'events_20180629', 'events_20180803', 'events_20180823', 'events_20180723']
External knowledge that might be helpful: 
How to Calculate User Retention in Big Query from Google Demo Game Analytics Data

As a Product / Website Analyst, I was pretty psyched to discover Googles public Google Analytics 4 (GA4) gaming event dataset called `firebase-public-project.analytics_153293282.events_*`. The table allows experienced developers and learners alike to experiment with raw GA4 data in Big Query for free. Event data is basically a log of user interactions with your product for analysis .For newbies interested in learning more about event data and GA4, visit my prior blog. This article provides SQL queries for a quick table overview and explains how to utilize Google Big Query to calculate user retention.


What is Retention?
User retention rates are key indicators for whether your product team meets user needs. Improving retention is often central to long term growth strategies.

**Retention measures how often and for how long users tend to return to your product.**

The metric can be a powerful proxy for product usefulness and user opinion. Its analysis can reveal critical information like how well your site converts new visitors to users and which items and features are associated with users coming back. If user data is available, retention can also help a business understand the profiles of its most active users (power users). Finally, retention is a great guardrail metric for A/B tests. Successful, product oriented companies prioritize a healthy user bases over short term profits.


**Common Retention Calculation Strategies**

Two common strategies to calculate retention are: 

a) N-Day retention

b) Unbounded Retention.


a) For N-Day retention, analysts calculate how many users with certain characteristics return over successive periods. It is called N days because we define the length of each period. For example, with N=7 day retention, if User A becomes part of our cohort of interest on day 0 and returns to the product day 5 and day 15, they are counted as retained for week 1 (17 days) and week 3 (1521 days) but not week 2 (814 days).


b) For Unbounded Retention, a user is counted as retained each week so long as their most recent product contact was after the week. For example, if User A becomes part of the cohort on day 0 and last returned to the site on day 21, they will be counted as retained in week 1 (17 days), week 2 (814 days), and week 3 (1521 days) but not week 4 (2228 days).

By calculating these metrics, companies can evaluate how well their products hold users interests. It also them closer to identifying the patterns that generate return users.



The table structure information is ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}
Begin Exploring Related Columns
**Relevant Tables:**

- All tables from `firebase-public-project.analytics_153293282.events_*` starting from July 2, 2018.

**Relevant Columns and Their Potential Usage:**

1. **`user_pseudo_id`**: Uniquely identifies users; used to group and track users across events.
2. **`event_name`**: Used to identify 'session_start' events indicating the beginning of a user session.
3. **`event_timestamp`**: Timestamp of the event; used to determine when events occurred.
4. **`event_date`**: Date of the event in the format 'YYYYMMDD'; used for date filtering and grouping.
5. **`user_first_touch_timestamp`**: Timestamp of the user's first interaction; can be used to determine the user's initial engagement date.

**Conditions That May Be Used:**

- `event_name = 'session_start'`: To filter for session start events.
- `event_date >= '20180702'`: To include events from July 2, 2018, onwards.
- Date calculations to assign users to cohorts based on the week of their first session.
- Calculations to determine if users returned in the fourth week after their first session.

---

**BigQuery SQL Queries:**

```sql
-- Query 1: Get distinct event names to understand available event types.
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
LIMIT 100;

-- Query 2: List user_pseudo_ids and their first event_date.
SELECT user_pseudo_id, MIN(event_date) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100;

-- Query 3: Retrieve sample of user_first_touch_timestamp values.
SELECT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100;

-- Query 4: Get users who started sessions on or after July 2, 2018.
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date >= '20180702'
LIMIT 100;

-- Query 5: Find the first session_start event_timestamp for each user.
SELECT user_pseudo_id, MIN(event_timestamp) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100;

-- Query 6: Count of session_start events per day.
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100;

-- Query 7: Get users and dates when they returned in the fourth week after first session.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT user_pseudo_id, DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
         DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
LIMIT 100;

-- Query 8: List cohorts by week starting on Mondays and count users in each.
SELECT FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
       COUNT(DISTINCT user_pseudo_id) AS user_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start' AND event_date >= '20180702'
GROUP BY cohort_week
ORDER BY cohort_week
LIMIT 100;

-- Query 9: Get the number of users who returned in the fourth week for each cohort.
SELECT cohort_week, COUNT(DISTINCT user_pseudo_id) AS returned_users
FROM (
  SELECT user_pseudo_id,
         FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
         DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
         DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
JOIN `firebase-public-project.analytics_153293282.events_*` e
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
GROUP BY cohort_week
LIMIT 100;

-- Query 10: Calculate retention rate for each cohort.
SELECT cohort_week,
       ROUND(SAFE_DIVIDE(returned_users, total_users) * 100, 2) AS retention_rate_percentage
FROM (
  SELECT cohort_week,
         COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM (
    SELECT user_pseudo_id,
           FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' AND event_date >= '20180702'
    GROUP BY user_pseudo_id
  )
  GROUP BY cohort_week
) AS total
JOIN (
  SELECT cohort_week, COUNT(DISTINCT user_pseudo_id) AS returned_users
  FROM (
    SELECT user_pseudo_id,
           FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
           DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
           DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' AND event_date >= '20180702'
    GROUP BY user_pseudo_id
  ) AS cohort
  JOIN `firebase-public-project.analytics_153293282.events_*` e
  ON e.user_pseudo_id = cohort.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
  GROUP BY cohort_week
) AS returned
ON total.cohort_week = returned.cohort_week
ORDER BY retention_rate_percentage DESC
LIMIT 100;
```

These queries help in:

- Understanding the available event types and data distribution.
- Identifying users' first session dates and assigning them to cohorts.
- Calculating the number of users who returned in the fourth week after their first session.
- Computing the retention rate for each cohort to identify the cohort with the highest retention rate.

**Note:** The wildcard '*' in the table names (`events_*`) allows querying across multiple event tables spanning different dates. The `_TABLE_SUFFIX` pseudo column in BigQuery refers to the suffix of the table names when using wildcard tables, enabling date range filtering.

---

By executing these queries, you can gain a comprehensive understanding of the data and proceed to calculate the retention rates as required by the task.Query:
-- Query 1: Get distinct event names to understand available event types.
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
LIMIT 100
Answer:
event_name
level_end
select_content
level_end_quickplay
app_exception
ad_reward
firebase_campaign
error
spend_virtual_currency
level_complete_quickplay
level_fail_quickplay
os_update
dynamic_link_app_open
challenge_accepted
notification_foreground
user_engagement
level_up
app_remove
post_score
session_start
use_extra_steps
level_retry_quickplay
in_app_purchase
first_open
level_complete
level_retry
level_start
level_start_quickplay
level_reset_quickplay
dynamic_link_first_open
level_reset
no_more_extra_steps
level_fail
screen_view
completed_5_levels
app_update
app_clear_data
challenge_a_friend
Query:
-- Query 2: List user_pseudo_ids and their first event_date.
SELECT user_pseudo_id, MIN(event_date) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_event_date
2F0F260BD7B876C346B41977D0D03D62,20180706
54405BB87CA5EE368EB42F411323631F,20180712
570495249052C5E40EC34A2B054DA1A1,20180705
44A600997B9B6499325D518A19B51FEC,20180706
42B0EA9C46944FD3177C30038D4970B3,20180706
037DAC225F0C1E54657770CD201CDDA7,20180702
CCCE3FEE757EA8EE64506158ED6FF26C,20180723
56638C161E53327DFF2A4C3001968B70,20180727
05FB3382D94C7E963B408FD6CC357D33,20180702
E9B5EC78F1F4D6F90B5AFB34D09697F2,20180707
5194FBFDE04D7689AF2B1DB5C5EBF970,20180727
257D8B7A90ECCC1688EBCB4548D4C1AB,20180709
7C632AB83C2A58075244891518D3D415,20180727
D9563E61AC76501942B6B3B4EBA2BFE4,20180726
0B74484DD41F519B4810A14A953CAA18,20180726
F8676B20C2A1DA2B004C3257C3DA3E7E,20180727
FBF8A477CF09D5B499E8923A4D2A5102,20180727
B5F3D00E28A57C9522F2DEE3CB903DD1,20180702
472451071AED6FF801BC0FE66706FD27,20180702
CABE7E24215A5C36862658A36AE5CE12,20180702
3D9A1566A6D35AC1D20B7D125637B637,20180702
A618596C697C9F9FEBC2B022AFD4F7DD,20180727
B37D4AE829DE5D2E1B1EAC461FCC343A,20180727
D80119EBB2A670C29D0BB8F621CB1D3A,20180727
CFA0F8C5E25A71062E573EF8E6BC9F76,20180702
DA48D36D07835B1918BDF831AF83B5EF,20180702
BC6237C93B4F8F703C63757184B49DE6,20180705
55EEC95A163C7791E528B12D5FA32CA9,20180710
5634AE3A99BF07E5A6A687A0F9316D78,20180726
13E6C8A193FF140F7D4222B569DD5B50,20180702
84E491A60BE52A4C6A438A89FADE283C,20180702
26442439EB5455656AD4D2E1607252AD,20180713
96161BF2E55C7E32ED5F411432875ECB,20180702
5E09265F12D64B9FA85FF9427A0A7FB0,20180702
E83D14E125252A6E3AEB349FF07C7543,20180727
D4525427508986ADBEBB52D52D468D34,20180727
F17AC159F7AE3AA891CD260E027A3C49,20180727
303FD8B04DF295670F8CBE660723648A,20180713
EEBCB25D5F056CCF59DDE654388ACD2B,20180703
1C6A9F02E05398B13FBB2C403A1E1B0F,20180727
8D9D62A4402581BB1181D3AA73AD54E8,20180702
B3A9A38A561B3648D280614B8E2D8E07,20180702
2160984278981558F7929C07EB37E679,20180727
3B4A6FCA6DCB4C2749409DC4188A306E,20180703
90CC0C53AB8C20C6ACD31C2049FF1C03,20180831
1F54AC7A413B33C6023DA0AF8F489684,20180807
DA1D860E60FA463A80DBA293EABEE7A0,20180704
E4C6FF8288DD4BFCDE93E2218E20643B,20180702
359A34F575B808FEFE58BC5B40816F09,20180809
0B9739BFB4122E1863C894E34F812D56,20180721
C6D97C0D6DA580A6FDB44BB2C3015A85,20180811
532579121C1D62C00E6B3BE1108B2945,20180813
78AACFF53F639F8AF257183503EDA1A6,20180831
B2D359D114428D8DD085DFAFF11195CE,20180812
D8B8615DDE319FEBE0A2AC1364E2C2EC,20180831
AFF1262CCD472757FC92B2A93C75CD81,20180810
7E74A2BB6BBF4746DEE15F957B315401,20180830
0175F289F0878C46DCA6B0AF3C5677F1,20180817
50D529BFD3EFEB1C8216DF9A321A552A,20180828
Query:
-- Query 3: Retrieve sample of user_first_touch_timestamp values.
SELECT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Answer:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
Query:
-- Query 4: Get users who started sessions on or after July 2, 2018.
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date >= '20180702'
LIMIT 100
Answer:
user_pseudo_id
295D9E24D8DE65A010313E667131EF19
4FBE02D401C1CB541103D24CF60494E0
3EF8FC940E379D53BBD3FEFDAF626BB2
0D9B1C51FA357A1A3487036AA037F7D0
38D65030548914B5E167CE85B035CA8F
DACD1498411E056455073E0371DF8EDE
7D613AF4DA0F508C7090E96FD73B7E6D
DAA3F353F320A717A0C418A8205292B2
3D7382CF3E5091189D2961E0EA3A2ACE
E8808298EB58EBCDBD87AC021925A5F9
03A9D32C44665A9E15CFCCEDC9F68EDB
F91F493916395FE4E16DE98B24388985
D842320AECB686B41C2F8E8876794D34
4B3CC3382387935EC4D2AB4F6EFC56FA
C639CACA07D03F536F537ED779CF6599
9DE945166BCD4709696C5836317DDE47
90D99AC8BC1551757037513287A3B8B4
E8AB792C0CBA5D7E4C9EF63F4BBF6628
372D9BB5088C4E9000C65B06459B403A
86F19DAB73E484FB7DD2F805DDD7957D
E66C3B8A38C424C7CBE0B5388EE5F77E
D35CA7CBB149B94C34D98A2D304D9AE7
B2ED849BBB2D152DF245B09A41687D4F
158D85747B252579015AE58305CBC8C1
DD766B6E5A2B12A2C7C52C11C8F81B00
449AE55152FD5964D7F41417567C804B
241293471505B5DFB907A2AFC5D26BC1
0AF862AFEB5358EBFDA7AFE3AC908844
186EF14CC97E86390BAE614FDAF4119D
B9DF3733E51CA1BB9A845EE00B36D1FE
53EF5C7357527DEFCBC722E886E242A5
0AFE3DE6A443BD660CDD5B1FA36686F6
45BDDEC4DF8773F88DC51D1AFD145521
938611E83B897B6F877992BF30D3E1FE
6B79073DC6A4D08D7718ABD38722ED70
359A34F575B808FEFE58BC5B40816F09
8912D1B887909C2FDE687B6782701503
0B427C5E490A982FADF586F82E797ACB
5E9BF00B469B284E028094EA15A9F1FE
4254BB9B56C28304B6478CCC78ABB053
96CCC44DF99B87D1450A966D355E4A16
EF0FBB41BE6F40A5CC1D68D8E1CD3591
B35F8E08962DDFFB2AAE7591699C908F
B087A865A90AD52D1864A36482983BD2
ECC6975EB9808FBB45390E3EDB75B2A1
40E48F9F86A546EF73EDE7855625E2B2
1D763A3E95386CEEF80C5174E6216F8C
A9C876F6262995184453B40AB7C5233C
D7EA8E3645EFFBD6443946179ED704A6
91D637F0D9FB259AD52773B1B20151BE
C302332F1B2DC5162E47913A708C479B
13AC12EF4C6A0EAF72795F720752AD98
A68C4D0A3F32C3F7621CA7675E9F39A6
66EE0DB049AA1A3B92B41375C1263B05
65D1701E5BA0070CCF15F0CB0E1CF750
C2F9C29AE66D5B80EBB2490AB11273B8
40A81A69B84A84C1E7577605FA47594C
F3779F2B0544630A7544BA7694CF3938
6C40A2B1B7C2336EDCE4B9F346682A72
964526CBEE730E91EB0A51E3E4B4BDB9
CDC9A224610417F5F1E97C8B96168950
B810EC88D69D961A2FA7ECC0F323D9EE
079FE8543EB46F5109283B58A75E8F3D
625CF86657E00A4629BCE49F5B31A144
FEC0B30EED7870C4D46230D73032E5CA
8B404ABBCDCF859DB2E5ABE00B482621
4EF964D59282E5A2C8692D30F011256B
273BECA0D1107657F707D82E5A2C4927
654F30C1312F6C1A26DFDA9F076A62D8
16DB8E847B4DDC16F3F250637F2D8C89
224C6AE85D60A605AC6164FA86738DF6
E343A4E35A813C92ECFD8C26B35E4474
ACB0CC9AC2138D424084DC1D8C18F077
498C29D342AF10C4A87FD312ACE1433A
01BE5107A02018738DED57597F10A916
E2372AFD5CBA85F1395201FB687AEC46
11A8D6037368A4C4508B11ADB4353BC4
FFA9AE78B23263835F8AAED57713EBE9
F9DAB66FDF60FD51DE5FF0BD0856E8C6
52EF42933AD38302C75702C3D38BFFAE
CA05F1C6A3827BC6EBCA6E949CAAF250
77BD91427F3805FD6A30F445FB0DC50B
2F71939D3C9E23EDC53AAAF004C762C1
2F04772FE46C17A90BCACEA9F09499FF
2941E920B4FD9CB80D870C3B78CC707D
712240BA0F93717BDA01B4FA84CD3616
C149C7D1FE5E8ABFB0806D55514CBC06
A37AD550BCBF8C8B1D5616BB5A47770D
5872E78AB7DA76D7176A8887BA4AA432
91FFEA4997DB9E39A944F4B23B6A3B24
BB4B254D4020E22E9CE5885C8AB28F87
475B281839C403CCF826D0D44890BFA5
EFD2CD7B7143AB00B21CE82E1C59FA25
Query:
-- Query 5: Find the first session_start event_timestamp for each user.
SELECT user_pseudo_id, MIN(event_timestamp) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_session_timestamp
A7993B3D9E693DFD3EA57CF4D1B8D00F,1535008607327000
E069FDF17198500FCB6DDDF406ABA122,1532285882148000
9EBBDF6D1D91535F99C0BAD3C0EBDC73,1530989405437000
4BB019F8F6D1FE7BA78CA42A4698EF56,1532671454712000
F3917138A3D4B03ADA1C2E77E3B84649,1530601993400000
6CD2676098B3E076AD66D10BF4565BFA,1530654566826000
D5F9D9AF22EF5073E10342973D48FB2C,1530653883090000
31E8B3EB3D9167E813FDFB812898F2F6,1532925841236000
4662AAE1B5602A67BB168F37A9E961A6,1535496860273000
0DF6A14F536F6514A6F18BC12A532A82,1533345515042000
04F397E482E77FD2B7CAEB81E732790C,1533889531864000
03A9D32C44665A9E15CFCCEDC9F68EDB,1530523503754000
F1A4ACA5337DF6B0DAE14420BC457CE3,1532540440604000
635808C1DDFBC662DC3015097E26E62A,1532435820833000
D299D5763E03F1CC4DA8550AF1B4CEE4,1530622285969000
BBBB2C46108622C7B2A5444C3B823176,1530830842243000
A829171B86E4B3C3CD9191BED13833D6,1534831798579000
0CAAA1B6F161BA4D363EB7A2DEF64A08,1530567008479000
53A5A4C271525BAA74298747E100C376,1530556799714000
74375465CD17299EBC7C75A1B4047EE0,1530522381329000
951C483048D3CD18A7F27AC9C1B4DD0A,1531300471923000
E48A64DA907583189751D6FF988D14F6,1531181626910000
E102F19E39B32A45B7153A21B8F9A6FB,1535514759679035
40B501E0460E254E289A776CFC31DCF2,1530526869327000
29BC86DCA0D500C9410F392B57C28DD3,1530540082946000
9C8494CDC3107F7BE54CCF3E820252D6,1533414077528000
45A21F8198EC7C85F07611CE7FFB999D,1532871880083000
E643F6549E6C7EA0FD01EF4BF7A40F76,1530854521767000
55F9FB7C14AA4BAB066EA326D4A2221B,1530592857792000
BF709EB51D61C3A7BF68C4CFD7F236BE,1535456354986000
63DC7D4093165CA24BEDD80FD22B0DD0,1535041152650000
8EFA45B60DF34986EDC7C7CC0CD7CD69,1532224817538000
3875A92B5F5C2BBA1355CED06A986079,1530516068164000
65BF56455C9B2CAFE68AB07D23A7EFF1,1535521954211000
F2A1FD8B142EB4C6CAAE415FA1917F50,1530557922408000
E0664E9E7883956A6E3084FD68AA274B,1533864708142000
A0616D4E494DC3BCCB94B8B6E5B48380,1530549231978000
2125F29DF2FE82287BD647D543D652FC,1535495146219000
A82658237C6118780A6009C01F05DDEB,1531615943536000
E31617E878328B6183DE7A17DC743F16,1535486554197000
8210262F330052F441D2E2A2BCCA3E6A,1531985765486000
A19F659EA9BA36A3595F088F30A6B7E7,1530533003753000
75120F32A68A6C4FB643349E125D8C31,1531204070763000
7F089F4710219060252DB2AEF508A662,1531346141897000
9DB59A6220E6D63AE53FD08FDDB59602,1531153397976000
D8995B39CDB121EC37EC90025DB53B6D,1533446381873000
8211CABE9A3F1FE1BF3154E0C8D30368,1530519447632000
782CF1C08CCE9568816A007BEEC4E2F9,1535487931749000
58E204089E7397B4B3131D7232AA58C5,1530544696370000
0CF5644CEE7E80B439341E3C74DA73AB,1530546739332000
5FED8FE4B11878AAFC4E53BDA3FBB56D,1532848160283000
Query:
-- Query 6: Count of session_start events per day.
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Answer:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500
20180709,580
20180710,613
20180711,593
20180712,620
20180713,640
20180714,554
20180715,539
20180716,535
20180717,495
20180718,520
20180719,484
20180720,574
20180721,636
20180722,533
20180723,587
20180724,582
20180725,552
20180726,550
20180727,616
20180728,607
20180729,662
20180730,632
20180731,585
20180801,608
20180802,690
20180803,692
20180804,688
20180805,667
20180806,628
20180807,619
20180808,669
20180809,621
20180810,477
20180811,584
20180812,611
20180813,685
20180814,605
20180815,568
20180816,613
20180817,617
20180818,637
20180819,604
20180820,641
20180821,630
20180822,625
20180823,588
20180824,646
20180825,653
20180826,618
20180827,685
20180828,638
20180829,696
20180830,656
20180831,618
20180901,579
20180902,648
20180903,637
20180904,659
20180905,741
20180906,707
20180907,700
20180908,689
20180909,719
20180910,724
20180911,655
20180912,780
20180913,694
20180914,636
20180915,598
20180916,641
20180917,640
20180918,662
20180919,720
20180920,637
20180921,729
20180922,683
20180923,764
20180924,659
20180925,673
20180926,688
20180927,803
20180928,630
20180929,675
20180930,679
20181001,656
20181002,653
Query:
-- Query 7: Get users and dates when they returned in the fourth week after first session.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT user_pseudo_id, DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
         DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
LIMIT 100
Answer:
user_pseudo_id,event_date
4F7CAE5C86F09A791C3F9FA77C10E833,20180822
ED0AF1301B6404476B420A990B98ABD7,20181001
99C7EF05303C88ACFDE2A301AD578F59,20180913
023A2DB99CC3F70A4B71869C36952D74,20180825
B5FA3B0588C19181222FCE3135DB3452,20180825
50EA79F18D71071A63A27AA59A453D6E,20180825
EFB696A82D093B3AFBE92FF526DD5CEA,20180804
40B501E0460E254E289A776CFC31DCF2,20180804
BE36C49B1AB3968D420923AEC4FDD7AE,20180804
F1555004E0D95599AF2F2B8EA130A9C3,20180804
0B08423CCD5F1503B5A8B306FFED999C,20180804
5E9BF00B469B284E028094EA15A9F1FE,20180804
2B90CE94C6039DF03E72FE15B5320ABA,20180804
D3F06F9B7BD9D7FC8758BF78BF0705E9,20180804
BBBB2C46108622C7B2A5444C3B823176,20180804
05FB3382D94C7E963B408FD6CC357D33,20180804
A19F659EA9BA36A3595F088F30A6B7E7,20180804
AD99B4950F9D70E0FD5E8563F2A664FB,20180804
53CAAF361073109F66760692FA12673B,20180804
74253012A39B1F4DE53D4BFF1AB2B5DD,20180804
0A26E7281EC31038AD42F28C930FFF90,20180930
32B77CB85060150AF92F76E2745F2D7A,20180927
ECA7E21BD6A07DF07E8F9E1DCC040EC5,20180906
E1A3C786B2E4D56629EE808A3A174995,20180905
8942968E35FB64702050A08D544D2A4A,20180907
C57026026F451C8B63B19481023BE944,20180907
BCEC642620FB741AA4EE43E0FC6C7A05,20180806
959635567E419A061EECCCA478EDC718,20180806
44A600997B9B6499325D518A19B51FEC,20180806
FB98112938373BD2B844A8C15E40A539,20180806
AFA41EF5E9CDCC4DF87A199049813E45,20180806
A765E9F4A5AA993FF502965BF138AFCF,20180806
C74B58C4CD2770A1E97D6DC13D42CCAC,20180806
81F5705397CE9F0236B2B672AE113154,20180806
82486A3B62D50DB914F1C6857733DAB2,20180806
56B9CBB6CB58106DCCF3CAD660232CB2,20180806
4965FA5C2DC955BF49BD33BDB25EC127,20180806
17DC0E89E3ECED8B312BCC88BCE23548,20180828
186F51E5AACB37852E3650E7027E33B1,20180924
65D1701E5BA0070CCF15F0CB0E1CF750,20180924
F4A3B9F9F0D4555ADC48F7BCBD5BEE9C,20180914
734ADBB5D0874A5007E58B2F99625EE0,20180830
551130953A7F37F23035F9A91CA41C15,20180830
C164946D2A79F9A024EB96B6C555B29B,20180830
599F51830B4E8DCA85348F8BDAB96585,20180909
D21451ACF492761DBC86B3549AEA194A,20180909
3652784B7A0A13B4DBD91A10CCB72FA5,20180909
CF62C17E245938F28D9A86634660A2FD,20180811
D79D77E3F2698B89279D7C35AB034992,20180811
B8B20A9B77B516AC51BD7C96E3F1866C,20180821
C57026026F451C8B63B19481023BE944,20180908
8EDB9A9856CDB5AFC42546106EE46734,20180730
472451071AED6FF801BC0FE66706FD27,20180730
1B3AD9683D475EFB398E131DFE65AE61,20180730
3FC8ECFC8F2976C5B56D0D782F36BD7F,20180730
91814809BD9374D5CEDFC6A31727CC55,20180730
4D33ED6DCCD63BBED146B6060B307CAF,20180730
7ED8C235689771F6B0F29BBF295A346F,20180730
FC48EDE912EDD9F8D7ED45F697EE7193,20180730
A95BA9143018CA81430258E8A725C3E6,20180808
0A26E7281EC31038AD42F28C930FFF90,20180928
5C5D78DD8E3D3B7FFC9118D4511E76BF,20180928
5B333FE2BC3875C6C3882279B51B8BAF,20180928
Query:
-- Query 8: List cohorts by week starting on Mondays and count users in each.
SELECT FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
       COUNT(DISTINCT user_pseudo_id) AS user_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start' AND event_date >= '20180702'
GROUP BY cohort_week
ORDER BY cohort_week
LIMIT 100
Answer:
cohort_week,user_count
2018-07-02,1374
2018-07-09,1351
2018-07-16,1325
2018-07-23,1444
2018-07-30,1631
2018-08-06,1508
2018-08-13,1463
2018-08-20,1441
2018-08-27,1619
2018-09-03,1922
2018-09-10,2003
2018-09-17,1870
2018-09-24,2010
2018-10-01,898
Query:
-- Corrected Query 9: Get the number of users who returned in the fourth week for each cohort.
SELECT cohort.cohort_week, COUNT(DISTINCT e.user_pseudo_id) AS returned_users
FROM (
  SELECT 
    user_pseudo_id,
    FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY))) AS cohort_week,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
JOIN `firebase-public-project.analytics_153293282.events_*` e
ON cohort.user_pseudo_id = e.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
GROUP BY cohort.cohort_week
LIMIT 100;
Answer:
cohort_week,returned_users
2018-07-16,98
2018-07-09,132
2018-07-02,537
2018-08-20,37
2018-08-13,30
2018-08-27,64
2018-08-06,49
2018-07-23,75
2018-07-30,67
2018-09-03,11
Query:
-- Corrected Query 10: Calculate retention rate for each cohort.
SELECT 
  total.cohort_week,
  ROUND(SAFE_DIVIDE(returned.returned_users, total.total_users) * 100, 2) AS retention_rate_percentage
FROM (
  -- Total users in each cohort
  SELECT cohort_week,
         COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS sub_total
  GROUP BY cohort_week
) AS total
JOIN (
  -- Users who returned in the fourth week for each cohort
  SELECT 
    cohort.cohort_week, 
    COUNT(DISTINCT cohort.user_pseudo_id) AS returned_users
  FROM (
    SELECT 
      user_pseudo_id,
      FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 28 DAY) AS fourth_week_start,
      DATE_ADD(PARSE_DATE('%Y%m%d', event_date), INTERVAL 34 DAY) AS fourth_week_end
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start' 
      AND event_date >= '20180702'
  ) AS cohort
  JOIN `firebase-public-project.analytics_153293282.events_*` e
  ON cohort.user_pseudo_id = e.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
    AND e.event_name = 'session_start'  -- Include this condition if you only consider 'session_start' events as returns
  GROUP BY cohort.cohort_week
) AS returned
ON total.cohort_week = returned.cohort_week
ORDER BY retention_rate_percentage DESC
LIMIT 100;
Answer:
cohort_week,retention_rate_percentage
2018-07-09,38.49
2018-07-02,38.36
2018-07-16,38.19
2018-07-23,36.15
2018-07-30,31.58
2018-08-27,31.25
2018-08-06,29.38
2018-08-20,29.01
2018-08-13,28.37
2018-09-03,11.39
Query:
-- Original Query 2: List user_pseudo_ids and their first event_date.
SELECT user_pseudo_id, MIN(event_date) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_event_date
5E3CB701F06E57FB36C28741D182DDCE,20180912
D6CE2614AB26B05B94FC3840D08E91F0,20180721
EECDCA8076D5842922767F5C08957B17,20180702
59454BAC415BB1F18517C6FD2C023E49,20180702
49CF61B01BD5584B86EFC08E40F6EB03,20180912
C6DE585349744A40725DB0AB17041BA3,20180702
1D89281562AC3FEFB76A42ED406BF1B5,20180808
A5A56F3717C923CECBB9247595F6CA5F,20180902
89A5AD5EB82221A45F9766C77E471DFB,20180910
68EA8FDC3D7F8984530BB60FAE9A42FD,20180704
FE57181360ADCD86B7E09063DF2BBD2E,20180917
2AA7CE8A30BD25743594101C76B46A6B,20180917
F9C021D9A8B84158F73A8662D76E9EE9,20180721
D1C8EF768AA75348EE9EC5629903E194,20180905
7DAD0B52C6A70949182E0658E67CBF99,20180917
175AEE22E34051C883F76BD73422AC72,20180804
74C5538FA4F9984289F0088723F7B694,20180917
69495B8489F605F197D1E8697BCBF02B,20180722
A72750663D0181C7817F61B3DD2CA656,20180801
1748CF87FC0F4E9B3997E2D8AEB022E9,20180902
DA1D3A39658D50A5B0C7C7C28097FBA5,20180904
3082CDD760FB4C2F5BAE25E78DD0B000,20180913
8942968E35FB64702050A08D544D2A4A,20180804
45F9DF7016DA4536060707F1B04FE784,20180911
7D7B319DFFF03520EF50236B2C3FB008,20180710
03780EE9CFF9761E7D40266B65D30158,20180907
41A07F6F6C3756427B09AEF18204CA37,20180803
0B07B90485BF0E79B25DD61D07D12172,20180917
AE0B1CA04B5C91B08FE47466B38A1A6B,20180904
989D5092D062D1B432BEB9C618B21431,20180917
BE51B6A4C9E61DA82581F026ABAD0359,20180904
B1C11C1880C459CAF44FC8622DEB4716,20180905
79D16DA26AB14780B3F4723E0E57769F,20180902
9FE14774A6A768A1C1BEBCE0DE0669A5,20180904
C3751E5C501D7C729C8F3B49F20FB710,20180917
08362BC5AB07C0587FC4CDC22AD97252,20180831
DD9CB779BD294C2AAC7D2BDDEDD7A22D,20180917
8BD465AC77DC9D8B4C597BF35950FDA3,20180703
0129188FE90E57C0A94813F1919AB27D,20180830
205AE83B43BB3A54E25E55E605AF6431,20180804
51012EB79345170B6D17DCD2528288D3,20180904
BD2A511409EB3EBC45D4CEB4F876ED49,20180819
5A24FA671D66FF78C978D077245B4777,20180710
51C511BDA46B8307F21527B455A1A59F,20180904
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180703
B975974ADC622D45F681637DDAE2B116,20180910
279184552B138A74EE3B205BCDC55E15,20180917
724B99CB6F41846F3F6BB46C2F663F5E,20180704
FC3907C3039196E679F3C468FE5B1F9E,20180904
69599C9ED33015D6A6AEE16414074147,20180904
F7CB7FD4E78B203FB518F703DA8C7662,20180917
3A110988C8149D12D9F52341B8FDFFD2,20180906
FA81D490D1A951F746467DFC2953A915,20180904
23FF59A1CAB09E2822EA2F837CEFB246,20181001
DD0C9E0425155960EA9EC58314A22431,20180920
C28231099C78071ADF8D0BAEA7B9C1F2,20180804
EBC3581ADA874D494FBE2C7CCF53BF99,20180703
706C748E6D1E0768BFEFE6362B5D3F67,20180702
5B0F314F62B74CCD676776E6B51BF450,20180709
Query:
-- Corrected Query 2: Parse event_date as DATE.
SELECT 
  user_pseudo_id, 
  MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_event_date
9F7B0D1BFB822F5E26E91E184E2E437C,2018-07-14
A976A39B8E08829A5BC5CD3827C942A2,2018-08-12
487DE902636DD8A9844A2D61FE7BD568,2018-07-02
0579CD8B9F2F5C48A5F1ACECF88750A7,2018-08-29
571B1FB7D9D44445BF25B75F0FD91660,2018-08-31
34CAF47105A2D9D0AC7464BB3AF8DB2A,2018-09-01
1B959D672ABAE4A3BFB9D720D415E064,2018-08-04
8065F8E98407106A65D35195984B2258,2018-07-06
D7EA8E3645EFFBD6443946179ED704A6,2018-07-02
6080ACBD76F27089523A73026969036D,2018-07-04
6E94F41FB1EB000C00CEAF43CF70938F,2018-09-01
2902E47E243769C20EEFACE79EB4ECB3,2018-09-01
5A66BC427F25EFFDFEDED4A07D8F9F91,2018-09-01
37EFBD2BA398148336F96B4347392A8D,2018-09-01
9373B5D36107012F6F9137090C523FA1,2018-07-08
387B532B7AF7A362DBF783E34C05BF54,2018-09-01
551B893D34A2A59971B8FF185C1CD0C8,2018-09-01
A6522F1A3180B75F091CEB712356A375,2018-09-01
3B049329E3090DA7A4339C4A46EF0763,2018-09-01
869CD665A9D52E3398754C8DACF4426D,2018-07-20
A305B55D5049F38F5139DA95B3DCE247,2018-09-01
ADB20527463A407E77162C54D30435F1,2018-09-01
B50E2B0888440679A84A3D861332531C,2018-08-31
DF08C4F0E5A855549CC953592EFE2731,2018-09-01
2B6D9C77F287F5C021EC7297203D412B,2018-09-01
F0FE3E7D8F5EF494C7D34AECB8D27951,2018-07-10
6A71951BC1C5F03C22E9E892AEB90B19,2018-07-02
9FD6E2CD74490F5DA5F52D249CBB750A,2018-09-01
F4A3B9F9F0D4555ADC48F7BCBD5BEE9C,2018-07-30
61BB31EC7781341B1D7B8D8A85688DA3,2018-09-01
81C75CB599BE7E11A66110C3FE9D0050,2018-07-12
CCE5E30054C510608589FA6240615B0A,2018-09-01
45116F98E0EE54636FE629BA54228131,2018-07-02
018D9A140B327998E49E56FF12ECE76D,2018-09-01
0DCD6B00CAB93941AA5EB18DE8C053EE,2018-08-31
625CF86657E00A4629BCE49F5B31A144,2018-08-22
7709833232AD9720F6DD21A2F5D8690A,2018-08-30
D963E509346C0E5358ECFE56AF3BB2ED,2018-09-01
2C15FFDEDDA69390B7A8EB5808FB7ED6,2018-09-01
5E4B8BBBE58491A3A1B462A95DC287E4,2018-07-07
229254D7C810F98F72C89A8060E194D4,2018-07-02
977CBDF2D7B65AC0FDC885F87117A7F2,2018-09-01
EFD6F768B28BA326FAEEB42728DF7360,2018-09-01
F5CA9C70FB5ACA0C36279A6FB407A7B7,2018-07-05
E84BFE62196E059C66D049BA9A14061C,2018-07-09
05407E04B9FA64CB63D8FA1D966AD6A2,2018-07-02
FFDDF354D9B9E851D2A62ABAEA17DA3E,2018-08-11
1CF315BC6864E7A71A81E47925E18A61,2018-07-02
D64DDC2439F7219840E0EEA2AC42CAB4,2018-07-03
3A1B5A55C33A7EF1A37C909A753606B8,2018-08-12
Query:
-- Original Query 3: Retrieve sample of user_first_touch_timestamp values.
SELECT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Answer:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
Query:
-- Corrected Query 3: Use DISTINCT to eliminate duplicates.
SELECT DISTINCT user_pseudo_id, user_first_touch_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE _TABLE_SUFFIX = '20180702'
LIMIT 100
Answer:
user_pseudo_id,user_first_touch_timestamp
654F30C1312F6C1A26DFDA9F076A62D8,1476908354977000
65D7715C409E6A38667447CE2B52AFFE,1528942159978000
B205B117C82A24AA95E663FFB7D04718,1469140986121000
EF9E8CCCCBBB015CAE0C334AB1745417,1529447876425000
83D8C7F90DAF2C832F05A9DDD8693135,1529819069374000
093642BD46204EB5F950303CE696BC18,1530385216083000
0F67E233B19D2898229CD156974A93AE,1473965741576000
5217AB1A454DAED6243E1C9818BE6A20,1529861553949000
C6EAD483A8AF7EE9B0ADE6D7CE5DD698,1530432632721000
58230465C695B0FDDDAE08A481FAEECC,1478537966449000
38D4084307B6D1CEA37A48981753428E,1471144513147000
0373DF7959F6867CDFB1C905D39CE67C,1529565444890000
5D5895B1267014C54ECBE08864420979,1519311576303000
D34924C19421D7E083FD387D97765F94,1511022914255000
C136A7CE1D0A52B8D4E5F144DF114EB7,1465988331737000
49309C5759610DBF6C829C0D4AB23943,1472075042638000
92B0B6F48ECE132C7E502F94798FE205,1480380027427000
4BF98D09CA8359FC59ADAF56D00338F8,1526162138359000
08D399C66188D9A356AFAD5E2B2BA45E,1529342141367000
909A16079F7183140ACF4C71A6CCDF3D,1499374796812000
3031EAD1E9D35306A37A0F3DC3B84A0A,1485186730422000
05407E04B9FA64CB63D8FA1D966AD6A2,1466371801749000
3A58859E074B02E8FB1CAEA291636112,1480644849973000
5CDFC86835249BE3DB5E9F6778E344AD,1488164439701000
706C748E6D1E0768BFEFE6362B5D3F67,1475151487594000
F815B0069F973BFA743EF90A85224109,1472922491594000
D0F280B12652EB0D74F6BC74AB13606F,1529344858634000
4D084D38156128AAA060303AA91E689D,1515971069994000
3EF8FC940E379D53BBD3FEFDAF626BB2,1528354153183000
DE4912FBC5F915C027000A8A6FF44F85,1528465321983000
E6FEE8B98E75EA5311FE004F98559A27,1521946646783000
E2D6E7FE36B7CDD0789CC8F03CC747E0,1530584740063000
48AB910A8DE8485D4C34238EA61F782C,1507142733492000
50FEAE9ECFE22E951E8810622A2E8F66,1527600773769000
4A47422A455E62E3529DE4F9F3BFAF66,1528883889417000
2F5B044B41268F6643EB4D0EF15D4E87,1530375954462000
E8710E77072D6674A93E46DFEF725587,1526591004638000
7101B4232F5B26A9C987C54F8717DCDC,1522655144019000
4948BEDE78FC6EBA9899F26BF5C53897,1515194342419000
88A41BFED275BB69125BE1F5524F3B42,1504797808179000
A064A84CD3CF7058F39333D6212E8615,1500906025256000
A87A30159D909E2356F72AAC76F26707,1530061109192000
7842C62D45ECE888132F21C9F4417B21,1515272726578000
672B24B51143CC66DCBAA0FA88C38D57,1520653057938000
7AE4084BAA29B1987E51BF2964646805,1530306423314000
2F8E2DBB938D2E43C2D171AF5F35EEF8,1530292083666000
29845B6298FB882DF53607D21F0E1DF7,1526399609287000
76BB576278338D2E508DE5D705241B47,1468719074983000
92BF054A90804B6D65F11D7CDFCDDEFC,1530499836284000
7207044281C74501C14233463AAD9A71,1529441927292000
Query:
-- Original Query 5: Find the first session_start event_timestamp for each user.
SELECT user_pseudo_id, MIN(event_timestamp) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_session_timestamp
50FEAE9ECFE22E951E8810622A2E8F66,1530563006435000
2F5B044B41268F6643EB4D0EF15D4E87,1530524108918000
E50F7AC0680FD87AD6CE6B6700D209A7,1530551550900000
E2CD12EE286D97AF7174B8AB91391200,1530598383192000
E4D0CD43ECF1890C6D20D2EC09153E02,1530650253847000
35F14977E77C94FBCEF82E5524637F59,1530640436986000
05FB3382D94C7E963B408FD6CC357D33,1530540115036000
2D716CF5F646D5B95689EB06FE2B4724,1530661650597000
676BB63373E1F0AD33EE422E0D6D6184,1530649158419000
472451071AED6FF801BC0FE66706FD27,1530535176930000
A2B7DF97E146FC5AB4C8F89A94D85B4A,1530535699193000
48D0C822ACA6BD0B5FBA8ECD27CBB247,1530627162232000
CABE7E24215A5C36862658A36AE5CE12,1530517623955000
71D3B39420F99B336CDE2B934AE5D41B,1530680850116000
90661BFEBB42671421697F7DA63EC771,1530545648579000
3D9A1566A6D35AC1D20B7D125637B637,1530522596051000
E43D3AB2F9B9055C29373523FAF9DB9B,1530668437489000
CFA0F8C5E25A71062E573EF8E6BC9F76,1530559850933000
DA48D36D07835B1918BDF831AF83B5EF,1530525589484000
AFFBFB5A561C0DEA5ACAA4D33BC483A5,1530680311079000
54CA0B1CD95413DE6A18F9096B63FE1F,1530642295766000
E4C6FF8288DD4BFCDE93E2218E20643B,1530581654616000
BEF227E6B27B4FE07D5AA2754D1251A8,1530635599989000
C2C63C13ABABCABF76D52E91E64B44D2,1530639506651000
461EEAF2B9223AE1D44C0E8DCE64876C,1530656907952000
13E6C8A193FF140F7D4222B569DD5B50,1530526573156000
E4FAB1210B693B084CA6829A5EF59438,1530677465365000
981CA03B25810447E879E7E767499ABD,1530660039467000
C22A13E254C44E0ECD2864B4287E514C,1530647884027000
A279C431ACB82BFB2B7A234A6707BCFF,1530628462621000
760224DD438185D3F00938581C387090,1530656427865000
EEBCB25D5F056CCF59DDE654388ACD2B,1530636530211000
8D9D62A4402581BB1181D3AA73AD54E8,1530587329915013
B3A9A38A561B3648D280614B8E2D8E07,1530570416493000
B78DB4E683651327A612372A48B5734C,1530627210608000
3B4A6FCA6DCB4C2749409DC4188A306E,1530651304184000
BA6AC3E59787946CFE7804B39352E10F,1534803903814000
7E74A2BB6BBF4746DEE15F957B315401,1535646010829000
50D529BFD3EFEB1C8216DF9A321A552A,1535451557028000
3EDE8E7A50DE76AA2EC12DDD2AE3F9F4,1530554378710000
0150077AE685E3084E5DB84CF61CE383,1535899602546000
CF13213745D519874DC3AB772839C6AD,1535891064427000
89D57EAF8F7A4FF245A227FEE9AE9459,1535939539826000
CFF34B5186EB1563295F0058BBC7CC0B,1535873429671000
0808B3380E616BDF15E6F2FBAF38147F,1535940055197000
31334ECCEC5C9988469EAD462A6C4D47,1535927294569000
79B9A58A7EC56B4AF58F456B26F66862,1535933540965000
67D3D76504CC5C4CBFC78EE4FC397C8B,1534032761831000
1F54AC7A413B33C6023DA0AF8F489684,1533695455449000
BD2522100FDE854404F8DF2555188670,1535952388953000
8C2F7E36E43B986779452495F7536DCC,1535917382884000
Query:
-- Corrected Query 5: Convert event_timestamp to TIMESTAMP.
SELECT 
  user_pseudo_id, 
  TIMESTAMP_MICROS(MIN(event_timestamp)) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY user_pseudo_id
LIMIT 100
Answer:
user_pseudo_id,first_session_timestamp
094CDCB8EF23B9B55134A0B5E22DFFCB,2018-07-08 22:16:40.102000+00:00
177DA0D458131BC9CA84EAC2697BE14A,2018-07-16 18:11:49.172000+00:00
E84BFE62196E059C66D049BA9A14061C,2018-07-09 23:44:26.743000+00:00
476409D7DFD0B2B2B0AB11E5F6D7DDBE,2018-07-16 22:55:05.592000+00:00
D7EA8E3645EFFBD6443946179ED704A6,2018-07-02 14:04:01.341000+00:00
CD936C60130D12C06E388F8EDFEA7105,2018-07-03 15:30:19.992000+00:00
503AB1BC9E19C89B0425ED404E60F062,2018-07-16 21:03:55.100000+00:00
6CC135C2403667F8114096D6C0854286,2018-07-13 14:37:59.027000+00:00
9373B5D36107012F6F9137090C523FA1,2018-07-08 21:48:26.836000+00:00
F0FC99F563E1247AD70240E5AA132ABF,2018-07-03 12:47:25.321000+00:00
1CF315BC6864E7A71A81E47925E18A61,2018-07-02 12:40:06.203000+00:00
A74C05E503F6274BAA9457B2265471F5,2018-07-02 12:11:32.513000+00:00
E6B6CAE2D200FC3EACF21DDE75402DCD,2018-07-02 10:42:39.067000+00:00
D842320AECB686B41C2F8E8876794D34,2018-07-04 06:53:51.272000+00:00
F0FE3E7D8F5EF494C7D34AECB8D27951,2018-07-10 23:54:40.587000+00:00
229254D7C810F98F72C89A8060E194D4,2018-07-02 11:20:14.672000+00:00
F5234E286EEDAB7864E680AA874A2DC5,2018-07-11 23:17:35.975000+00:00
518DABD4A0DF4C41A6D811D6D45EB2B6,2018-07-05 02:40:19.256000+00:00
A1CCD9D935CD30A3A49B3A78204315BE,2018-07-17 02:29:33.304000+00:00
B3F87EC5102A3DC9F28543B25A7BD969,2018-07-17 03:13:32.417000+00:00
225638B28A80341EEB04F1DFC144F30E,2018-07-09 10:52:13.724000+00:00
6683CAFB77FB7B60C78CD233EB2B62F7,2018-07-02 13:50:58.095000+00:00
0D9DE32D08364277A3406C8107F5763F,2018-07-10 12:59:13.828000+00:00
9E8FED725DA53AE5AF06520FB4A0883C,2018-07-16 22:13:33.605000+00:00
5E4B8BBBE58491A3A1B462A95DC287E4,2018-07-07 22:16:16.995000+00:00
9BC12903974C904CC966F956702D361C,2018-07-16 07:04:46.086000+00:00
F4810B35D08410542741137BD5FD3326,2018-07-11 12:23:24.678000+00:00
05407E04B9FA64CB63D8FA1D966AD6A2,2018-07-03 02:59:04.627000+00:00
3EF8FC940E379D53BBD3FEFDAF626BB2,2018-07-02 21:02:17.475000+00:00
AB32482D193E2CE166B59F82EF78D8BB,2018-07-09 22:21:24.475000+00:00
C795AFA7F574C2BB09D3647AD90A9719,2018-07-02 09:09:39.747000+00:00
Query:
-- Original Query 7: Get users and dates when they returned in the fourth week after first session.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT 
    user_pseudo_id, 
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
LIMIT 100
Answer:
user_pseudo_id,event_date
6EBDDD1BC5E5489D7FF0B41B8DAA9D86,20181002
3B9DDD282F488869CFFCC057F70958B0,20181002
ECB676BED33FDF42E1B0DCF234E1344B,20180905
C28231099C78071ADF8D0BAEA7B9C1F2,20180905
175AEE22E34051C883F76BD73422AC72,20180905
186F51E5AACB37852E3650E7027E33B1,20180926
D41AA91B61872612B5F5F4E42870042C,20180831
E80C958E3C33898989A30B8F5A4514F0,20180831
9842E27FE3DF102CAC1B954D1D12B02C,20180823
82486A3B62D50DB914F1C6857733DAB2,20180809
95BC3B2233ECAE0717CC70A45315365B,20180809
51350F5497804E91C6311DC404F392DA,20180918
01C784BDB7AF4DC8DAD6DCD21AF56E25,20180731
E9DCE2D958652BD58E846DCE86BDD90A,20180731
EBB30E8C806A423B024E51AC32021A6A,20180731
17934EF7C1BC1CF2C7D942401FDE84CE,20180731
59454BAC415BB1F18517C6FD2C023E49,20180731
BE36C49B1AB3968D420923AEC4FDD7AE,20180731
4D33ED6DCCD63BBED146B6060B307CAF,20180731
229254D7C810F98F72C89A8060E194D4,20180731
98578513E0F25350F961CDCBA9D3656F,20180731
88E99CE30B65345ED0B118869B6AD035,20180912
1170309EA1D2309A158B8F6346AECE88,20180818
0B9739BFB4122E1863C894E34F812D56,20180818
0175F289F0878C46DCA6B0AF3C5677F1,20180916
68A9524E56BA07A82BBC48AE25F2C246,20180927
A7AAA5EF977926DBCF801D15F83EE4A5,20180808
E643F6549E6C7EA0FD01EF4BF7A40F76,20180808
CD93E1D286EC5C24E033D0D887133880,20180808
AC1B8C257039C7FB911CA9AE69D4C614,20180808
E415D4A90F9A9D8B784B3BCE2F5678B5,20180808
C74B58C4CD2770A1E97D6DC13D42CCAC,20180808
05F0FB18A61CCB1E2540F4D26721CCEC,20180808
D50D60807F5347EB64EF0CD5A3D4C4CD,20181003
1F85C1136C7E636D8565505BCAA75E8F,20181003
E458F1B823941D35957203CBF6610A33,20181003
4E0D2F7E40746B90029E4F4241F9ECA9,20181003
95E26DC518A7793A7E7C9D40BE914111,20180807
83B2810298A42907030999DED800A7D4,20180807
1B0397F7967E35746E7C3CBB652C0CE4,20180807
0046A2D1B1135C0AB4462B8FF036739E,20180807
B1D1ED35873581A23E48C4CD03DDFF81,20180807
95BC3B2233ECAE0717CC70A45315365B,20180807
B458770ED6E295374FEEB3A68902CC28,20180801
55BFC405FFA33C0781DE73101011E45B,20180801
AFA6BA99FB329CB459E8E57FDE1DF9AE,20180801
0F93A84CB0774C5BAB3E5FF8A72A694D,20180801
396CD60DADAB9CBA7DDCAF239B477135,20180801
7CA838857E3B7B8C9FC6A34E975FBF22,20180801
12E5626928FE0885DEEF068683E8BD63,20180801
81F5705397CE9F0236B2B672AE113154,20180801
8F6C5F7611B67A4A437FF283B6C10181,20180801
17934EF7C1BC1CF2C7D942401FDE84CE,20180801
F815B0069F973BFA743EF90A85224109,20180801
40B501E0460E254E289A776CFC31DCF2,20180801
89BD2B0E233951461CF06C9B4FDA0D81,20180801
7D613AF4DA0F508C7090E96FD73B7E6D,20180801
932AAF56DDE9C55359B9CCFA18E7FB95,20180801
19DEEA6B15B314DB0ED2A4936959D8F9,20180801
2741C47CC50AE98B39CC5B561BFEA504,20180801
0CAAA1B6F161BA4D363EB7A2DEF64A08,20180801
307AC87B6D76A6A1A19AC2B11E3FA4B5,20180824
938611E83B897B6F877992BF30D3E1FE,20180824
Query:
-- Corrected Query 7: Ensure proper date parsing.
SELECT DISTINCT e.user_pseudo_id, e.event_date
FROM `firebase-public-project.analytics_153293282.events_*` e
JOIN (
  SELECT 
    user_pseudo_id, 
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 28 DAY) AS fourth_week_start,
    DATE_ADD(PARSE_DATE('%Y%m%d', MIN(event_date)), INTERVAL 34 DAY) AS fourth_week_end
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start' AND event_date >= '20180702'
  GROUP BY user_pseudo_id
) AS cohort
ON e.user_pseudo_id = cohort.user_pseudo_id
WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN cohort.fourth_week_start AND cohort.fourth_week_end
  AND e.event_date >= '20180702'
LIMIT 100
Answer:
user_pseudo_id,event_date
04104F6923B74F56CF20A9E0FC520C26,20180915
5341BD6A836D247A4B5CCDA5FB3BCC9D,20180922
17636078D57884AD7EA5406C60E2BD10,20180907
C28231099C78071ADF8D0BAEA7B9C1F2,20180907
2F48607C41ECC4015FA296500F0A2C4B,20180810
7F2B633C86B765201C93FDB6FF261143,20180810
3422CA1B4B6A9ACE78187868F362C3C7,20180810
75F979DE60C91A6631485A88457C108E,20180810
1F0D27B8A7E058446D4A6409E2E73B19,20180801
372D9BB5088C4E9000C65B06459B403A,20180801
01C784BDB7AF4DC8DAD6DCD21AF56E25,20180801
EEBCB25D5F056CCF59DDE654388ACD2B,20180801
706C748E6D1E0768BFEFE6362B5D3F67,20180801
FA30269453141794E79B8F15EE0BA5B9,20180801
4D33ED6DCCD63BBED146B6060B307CAF,20180801
53CAAF361073109F66760692FA12673B,20180801
FC48EDE912EDD9F8D7ED45F697EE7193,20180801
E4196C5E0A92A22F69DE4E3AA288D6EE,20180801
1213ED1E96B0A49B51C0F7683DB2ACCC,20180801
229254D7C810F98F72C89A8060E194D4,20180801
A19F659EA9BA36A3595F088F30A6B7E7,20180801
F2ACDC8D64D4218BA63EB8732C110BA5,20180801
B5F3D00E28A57C9522F2DEE3CB903DD1,20180801
1A7F253A85B952C329518608DEC20138,20180815
A82658237C6118780A6009C01F05DDEB,20180815
CE3148CA8DACC6B0D0C5D234186008BE,20180815
079A0986730A27E47BDE659B49D0F1FC,20180815
8E2CA56C1FD81A095DECAEDE6F2ED626,20180803
909A16079F7183140ACF4C71A6CCDF3D,20180803
DCEFBF52331910FC267F07111AD868F9,20180803
44A600997B9B6499325D518A19B51FEC,20180803
4BDC831A6940071E2461D0B5293A329E,20180803
7D613AF4DA0F508C7090E96FD73B7E6D,20180803
E4196C5E0A92A22F69DE4E3AA288D6EE,20180803
05FB3382D94C7E963B408FD6CC357D33,20180803
B5F3D00E28A57C9522F2DEE3CB903DD1,20180803
1213ED1E96B0A49B51C0F7683DB2ACCC,20180803
708E876A9807A8C1DBCA9A19BC35B702,20180803
487DE902636DD8A9844A2D61FE7BD568,20180803
E6B6CAE2D200FC3EACF21DDE75402DCD,20180803
1CF315BC6864E7A71A81E47925E18A61,20180803
81D3DD49AA2304FD1ED8C498747B5FC6,20180803
B63075B53A750A67A12F7F19ED5AA835,20180803
DA48D36D07835B1918BDF831AF83B5EF,20180803
223BF1D360715CB9BA85B0DDDE39D589,20180803
96161BF2E55C7E32ED5F411432875ECB,20180803
2E03DB1924573F3131EEC916E5444F56,20180803
2B90CE94C6039DF03E72FE15B5320ABA,20180803
8F6C5F7611B67A4A437FF283B6C10181,20180803
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180803
806B89C2F8514374D2F9F4DD50EA681A,20180803
136C3AB6E42E34223C8A7503EE355E12,20180803
00D49153E0790E34D76523EEBEF459B2,20180803
3B4A6FCA6DCB4C2749409DC4188A306E,20180803
0B74484DD41F519B4810A14A953CAA18,20180829
44561FB4558913850A7857FC521C1C42,20180829
CC62213661BE43BF92836F37DF9B3ADD,20180829
48C3F922E22657E619B06BE11763E782,20180829
9669A9911E183A5DCC390B981F20FE48,20180820
F34FF1C9F0C022B684BC885BA1DDC260,20180820
DBB995BF3A253CE1A68AF3B0B43C216D,20180820
5249B4686BC5038FBFE36A3E6CCA5B72,20180820
B234DE95E7BA43F7D422B2A2ED211629,20180914
Query:
-- Original Query 8: List cohorts by week starting on Mondays and count users in each.
SELECT FORMAT_DATE('%Y-%m-%d', DATE_TRUNC(PARSE_DATE('%Y%m%d', event_date), WEEK(MONDAY))) AS cohort_week,
       COUNT(DISTINCT user_pseudo_id) AS user_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start' AND event_date >= '20180702'
GROUP BY cohort_week
ORDER BY cohort_week
LIMIT 100
Answer:
cohort_week,user_count
2018-07-02,1374
2018-07-09,1351
2018-07-16,1325
2018-07-23,1444
2018-07-30,1631
2018-08-06,1508
2018-08-13,1463
2018-08-20,1441
2018-08-27,1619
2018-09-03,1922
2018-09-10,2003
2018-09-17,1870
2018-09-24,2010
2018-10-01,898
Query:
-- Original Query 6: Count of session_start events per day.
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Answer:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500
20180709,580
20180710,613
20180711,593
20180712,620
20180713,640
20180714,554
20180715,539
20180716,535
20180717,495
20180718,520
20180719,484
20180720,574
20180721,636
20180722,533
20180723,587
20180724,582
20180725,552
20180726,550
20180727,616
20180728,607
20180729,662
20180730,632
20180731,585
20180801,608
20180802,690
20180803,692
20180804,688
20180805,667
20180806,628
20180807,619
20180808,669
20180809,621
20180810,477
20180811,584
20180812,611
20180813,685
20180814,605
20180815,568
20180816,613
20180817,617
20180818,637
20180819,604
20180820,641
20180821,630
20180822,625
20180823,588
20180824,646
20180825,653
20180826,618
20180827,685
20180828,638
20180829,696
20180830,656
20180831,618
20180901,579
20180902,648
20180903,637
20180904,659
20180905,741
20180906,707
20180907,700
20180908,689
20180909,719
20180910,724
20180911,655
20180912,780
20180913,694
20180914,636
20180915,598
20180916,641
20180917,640
20180918,662
20180919,720
20180920,637
20180921,729
20180922,683
20180923,764
20180924,659
20180925,673
20180926,688
20180927,803
20180928,630
20180929,675
20180930,679
20181001,656
20181002,653
Query:
-- Corrected Query 6: Parse event_date as DATE for ordering.
SELECT 
  PARSE_DATE('%Y%m%d', event_date) AS event_date,
  COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
GROUP BY event_date
ORDER BY event_date
LIMIT 100
Answer:
event_date,session_start_count
2018-07-02,621
2018-07-03,596
2018-07-04,556
2018-07-05,548
2018-07-06,574
2018-07-07,615
2018-07-08,500
2018-07-09,580
2018-07-10,613
2018-07-11,593
2018-07-12,620
2018-07-13,640
2018-07-14,554
2018-07-15,539
2018-07-16,535
2018-07-17,495
2018-07-18,520
2018-07-19,484
2018-07-20,574
2018-07-21,636
2018-07-22,533
2018-07-23,587
2018-07-24,582
2018-07-25,552
2018-07-26,550
2018-07-27,616
2018-07-28,607
2018-07-29,662
2018-07-30,632
2018-07-31,585
2018-08-01,608
2018-08-02,690
2018-08-03,692
2018-08-04,688
2018-08-05,667
2018-08-06,628
2018-08-07,619
2018-08-08,669
2018-08-09,621
2018-08-10,477
2018-08-11,584
2018-08-12,611
2018-08-13,685
2018-08-14,605
2018-08-15,568
2018-08-16,613
2018-08-17,617
2018-08-18,637
2018-08-19,604
2018-08-20,641
2018-08-21,630
2018-08-22,625
2018-08-23,588
2018-08-24,646
2018-08-25,653
2018-08-26,618
2018-08-27,685
2018-08-28,638
2018-08-29,696
2018-08-30,656
2018-08-31,618
2018-09-01,579
2018-09-02,648
2018-09-03,637
2018-09-04,659
2018-09-05,741
2018-09-06,707
2018-09-07,700
2018-09-08,689
2018-09-09,719
2018-09-10,724
2018-09-11,655
End Exploring Related Columns
Task: Can you group users by the week of their first session start, starting from July 2, 2018? For each group, calculate the retention rate in the fourth week (i.e., the percentage of users from the original group who returned in the fourth week after their first session). Please identify the cohort with the highest retention rate in the fourth week, and name the group by the Monday date of the cohort's first session week. Return the result in the format "YYYY-MM-DD".

Please answer only one complete SQL in bigquery dialect in ```sql``` format.
Usage example: ```sql
SELECT `column_name` FROM `database.schema.table` WHERE ... ``` (Replace `database`, `schema`, and `table` with actual names. Enclose column names and table identifiers with backticks.)
Follow the answer format like: ```csv
YYYY-MM-DD
2018-07-16
(Attention: answer in one row)
```

**Explanation:**
By grouping users by the week of their first session starting from July 2, 2018, and calculating the retention rate in the fourth week for each cohort, we find that the cohort starting on **2018-07-16** had the highest retention rate in the fourth week. This means that a higher percentage of users who started their first session during the week of July 16, 2018, returned in their fourth week compared to cohorts from other weeks..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.If the task description does not specify the number of decimal places, retain all decimals to four places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-30 01:21:35 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:21:35 - root - INFO - ```sql
SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week_start) AS cohort_week_start
FROM (
  SELECT
    cs.cohort_week_start,
    cs.total_users,
    cr.returned_users,
    (cr.returned_users / cs.total_users) AS retention_rate
  FROM (
    SELECT 
      cohort_week_start,
      COUNT(DISTINCT user_pseudo_id) AS total_users
    FROM (
      SELECT
        user_pseudo_id,
        DATE_TRUNC(first_session_date, WEEK(MONDAY)) AS cohort_week_start
      FROM (
        SELECT
          user_pseudo_id,
          MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date
        FROM `firebase-public-project.analytics_153293282.events_*`
        WHERE event_name = 'session_start'
          AND PARSE_DATE('%Y%m%d', event_date) >= '2018-07-02'
          AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
        GROUP BY user_pseudo_id
      )
    )
    GROUP BY cohort_week_start
  ) cs
  LEFT JOIN (
    SELECT
      cohort_week_start,
      COUNT(DISTINCT user_pseudo_id) AS returned_users
    FROM (
      SELECT 
        uc.user_pseudo_id,
        uc.cohort_week_start
      FROM (
        SELECT
          user_pseudo_id,
          DATE_TRUNC(first_session_date, WEEK(MONDAY)) AS cohort_week_start,
          first_session_date
        FROM (
          SELECT
            user_pseudo_id,
            MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date
          FROM `firebase-public-project.analytics_153293282.events_*`
          WHERE event_name = 'session_start'
            AND PARSE_DATE('%Y%m%d', event_date) >= '2018-07-02'
            AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
          GROUP BY user_pseudo_id
        )
      ) uc
      JOIN `firebase-public-project.analytics_153293282.events_*` e
        ON uc.user_pseudo_id = e.user_pseudo_id
      WHERE 
        PARSE_DATE('%Y%m%d', e.event_date) BETWEEN DATE_ADD(uc.first_session_date, INTERVAL 28 DAY) AND DATE_ADD(uc.first_session_date, INTERVAL 34 DAY)
        AND _TABLE_SUFFIX BETWEEN '20180730' AND '20181003'
    )
    GROUP BY cohort_week_start
  ) cr
  ON cs.cohort_week_start = cr.cohort_week_start
)
ORDER BY retention_rate DESC, cohort_week_start
LIMIT 1
```
2025-01-30 01:21:42 - root - INFO - itercount: 1
2025-01-30 01:21:42 - root - INFO - 0
2025-01-30 01:21:42 - root - INFO - results: 
cohort_week_start
2018-07-02


2025-01-30 01:21:42 - root - INFO - Please check the answer again by reviewing Can you group users by the week of their first session start, starting from July 2, 2018? For each group, calculate the retention rate in the fourth week (i.e., the percentage of users from the original group who returned in the fourth week after their first session). Please identify the cohort with the highest retention rate in the fourth week, and name the group by the Monday date of the cohort's first session week. Return the result in the format "YYYY-MM-DD"., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: ```csv
YYYY-MM-DD
2018-07-16
(Attention: answer in one row)
```

**Explanation:**
By grouping users by the week of their first session starting from July 2, 2018, and calculating the retention rate in the fourth week for each cohort, we find that the cohort starting on **2018-07-16** had the highest retention rate in the fourth week. This means that a higher percentage of users who started their first session during the week of July 16, 2018, returned in their fourth week compared to cohorts from other weeks. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
cohort_week_start
2018-07-02
Current sql:
SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week_start) AS cohort_week_start
FROM (
  SELECT
    cs.cohort_week_start,
    cs.total_users,
    cr.returned_users,
    (cr.returned_users / cs.total_users) AS retention_rate
  FROM (
    SELECT 
      cohort_week_start,
      COUNT(DISTINCT user_pseudo_id) AS total_users
    FROM (
      SELECT
        user_pseudo_id,
        DATE_TRUNC(first_session_date, WEEK(MONDAY)) AS cohort_week_start
      FROM (
        SELECT
          user_pseudo_id,
          MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date
        FROM `firebase-public-project.analytics_153293282.events_*`
        WHERE event_name = 'session_start'
          AND PARSE_DATE('%Y%m%d', event_date) >= '2018-07-02'
          AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
        GROUP BY user_pseudo_id
      )
    )
    GROUP BY cohort_week_start
  ) cs
  LEFT JOIN (
    SELECT
      cohort_week_start,
      COUNT(DISTINCT user_pseudo_id) AS returned_users
    FROM (
      SELECT 
        uc.user_pseudo_id,
        uc.cohort_week_start
      FROM (
        SELECT
          user_pseudo_id,
          DATE_TRUNC(first_session_date, WEEK(MONDAY)) AS cohort_week_start,
          first_session_date
        FROM (
          SELECT
            user_pseudo_id,
            MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date
          FROM `firebase-public-project.analytics_153293282.events_*`
          WHERE event_name = 'session_start'
            AND PARSE_DATE('%Y%m%d', event_date) >= '2018-07-02'
            AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
          GROUP BY user_pseudo_id
        )
      ) uc
      JOIN `firebase-public-project.analytics_153293282.events_*` e
        ON uc.user_pseudo_id = e.user_pseudo_id
      WHERE 
        PARSE_DATE('%Y%m%d', e.event_date) BETWEEN DATE_ADD(uc.first_session_date, INTERVAL 28 DAY) AND DATE_ADD(uc.first_session_date, INTERVAL 34 DAY)
        AND _TABLE_SUFFIX BETWEEN '20180730' AND '20181003'
    )
    GROUP BY cohort_week_start
  ) cr
  ON cs.cohort_week_start = cr.cohort_week_start
)
ORDER BY retention_rate DESC, cohort_week_start
LIMIT 1
2025-01-30 01:22:14 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:22:14 - root - INFO - ```sql
WITH first_sessions AS (
  SELECT
    user_pseudo_id,
    MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
    AND PARSE_DATE('%Y%m%d', event_date) >= '2018-07-02'
    AND _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
  GROUP BY user_pseudo_id
),
user_cohorts AS (
  SELECT
    user_pseudo_id,
    first_session_date,
    DATE_TRUNC(first_session_date, WEEK(MONDAY)) AS cohort_week_start
  FROM first_sessions
),
cohort_sizes AS (
  SELECT
    cohort_week_start,
    COUNT(DISTINCT user_pseudo_id) AS total_users
  FROM user_cohorts
  GROUP BY cohort_week_start
),
week4_returns AS (
  SELECT
    u.cohort_week_start,
    u.user_pseudo_id
  FROM user_cohorts u
  JOIN `firebase-public-project.analytics_153293282.events_*` e
    ON u.user_pseudo_id = e.user_pseudo_id
  WHERE
    PARSE_DATE('%Y%m%d', e.event_date) BETWEEN DATE_ADD(u.first_session_date, INTERVAL 28 DAY) AND DATE_ADD(u.first_session_date, INTERVAL 34 DAY)
    AND _TABLE_SUFFIX BETWEEN FORMAT_DATE('%Y%m%d', DATE_ADD('2018-07-02', INTERVAL 28 DAY)) AND '20181003'
),
cohort_returns AS (
  SELECT
    cohort_week_start,
    COUNT(DISTINCT user_pseudo_id) AS returned_users
  FROM week4_returns
  GROUP BY cohort_week_start
),
cohort_retention AS (
  SELECT
    s.cohort_week_start,
    s.total_users,
    r.returned_users,
    SAFE_DIVIDE(r.returned_users, s.total_users) AS retention_rate
  FROM cohort_sizes s
  LEFT JOIN cohort_returns r USING(cohort_week_start)
)
SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week_start) AS cohort_week_start
FROM cohort_retention
ORDER BY retention_rate DESC, cohort_week_start
LIMIT 1
```
2025-01-30 01:22:21 - root - INFO - itercount: 2
2025-01-30 01:22:21 - root - INFO - 0
2025-01-30 01:22:21 - root - INFO - Total iteration counts: 2
