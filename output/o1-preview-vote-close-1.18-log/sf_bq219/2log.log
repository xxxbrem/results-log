2025-01-18 09:49:23 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-18 09:50:05 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-18 09:50:05 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:05 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:05 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:07 - snowflake.connector.cursor - INFO - Number of results in first chunk: 104
2025-01-18 09:50:07 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:07 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:07 - root - INFO - SQL:
-- 1. Get a list of all distinct liquor categories
SELECT DISTINCT "category_name"
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
Results:
category_name
IMPORTED WHISKIES
100 PROOF VODKA
WHITE CREME DE CACAO
COFFEE LIQUEURS
CREME DE ALMOND
HIGH PROOF BEER - AMERICAN
COCKTAILS/RTD
LOW PROOF VODKA
VODKA FLAVORED
DARK CREME DE CACAO
WATERMELON SCHNAPPS
CREAM LIQUEURS
BUTTERSCOTCH SCHNAPPS
SPECIAL ORDER ITEMS
APPLE SCHNAPPS
IMPORTED FLAVORED VODKA
NEUTRAL GRAIN SPIRITS FLAVORED
DELISTED ITEMS
TENNESSEE WHISKIES
IRISH WHISKIES
VODKA 80 PROOF
100% AGAVE TEQUILA
SCOTCH WHISKIES
SINGLE BARREL BOURBON WHISKIES
ROOT BEER SCHNAPPS
SPEARMINT SCHNAPPS
""
IMPORTED GRAPE BRANDIES
TEQUILA
BARBADOS RUM
CINNAMON SCHNAPPS
IMPORTED GINS
IMPORTED VODKAS
IMPORTED DRY GINS
AMERICAN COCKTAILS
BLACKBERRY BRANDIES
OTHER PROOF VODKA
GREEN CREME DE MENTHE
ANISETTE
IMPORTED VODKA - CHERRY
MISC. AMERICAN CORDIALS & LIQUEURS
DECANTERS & SPECIALTY PACKAGES
AMERICAN FLAVORED VODKA
AGED DARK RUM
FLAVORED RUM
IMPORTED CORDIALS & LIQUEURS
GRAPE SCHNAPPS
SCHNAPPS - IMPORTED
IMPORTED SCHNAPPS
SINGLE MALT SCOTCH
WHISKEY LIQUEUR
BOTTLED IN BOND BOURBON
PEACH BRANDIES
JAPANESE WHISKY
FLAVORED GIN
MIXTO TEQUILA
AMERICAN WHISKIES
IOWA DISTILLERY WHISKIES
AMERICAN ALCOHOL
PEACH SCHNAPPS
AMERICAN GRAPE BRANDIES
MEZCAL
TROPICAL FRUIT SCHNAPPS
SPICED RUM
PEPPERMINT SCHNAPPS
CORN WHISKIES
AMERICAN DISTILLED SPIRITS SPECIALTY
AMERICAN BRANDIES
CANADIAN WHISKIES
MISCELLANEOUS  BRANDIES
IMPORTED VODKA - MISC
BLENDED WHISKIES
APRICOT BRANDIES
FLAVORED GINS
AMERICAN SCHNAPPS
ROCK & RYE
AMERICAN CORDIALS & LIQUEURS
AMERICAN SLOE GINS
JAMAICA RUM
WHITE CREME DE MENTHE
AMERICAN DRY GINS
STRAWBERRY SCHNAPPS
AMERICAN VODKAS
IMPORTED AMARETTO
AMERICAN AMARETTO
AMARETTO - IMPORTED
IMPORTED DISTILLED SPIRITS SPECIALTY
TRIPLE SEC
MISC. IMPORTED CORDIALS & LIQUEURS
MISCELLANEOUS SCHNAPPS
GOLD RUM
IOWA DISTILLERIES
WHITE RUM
CHERRY BRANDIES
RASPBERRY SCHNAPPS
PUERTO RICO & VIRGIN ISLANDS RUM
IMPORTED BRANDIES
STRAIGHT BOURBON WHISKIES
STRAIGHT RYE WHISKIES
DELISTED / SPECIAL ORDER ITEMS
TEMPORARY & SPECIALTY PACKAGES
NEUTRAL GRAIN SPIRITS
DISTILLED SPIRITS SPECIALTY
HOLIDAY VAP

2025-01-18 09:50:07 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:07 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:07 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:08 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-18 09:50:08 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:09 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:09 - root - INFO - SQL:
-- 2. Get the total sales volume in liters over the last 24 months
SELECT SUM("volume_sold_liters") AS total_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
Results:
TOTAL_VOLUME_LITERS
39829762.65

2025-01-18 09:50:09 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:09 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:09 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:10 - snowflake.connector.cursor - INFO - Number of results in first chunk: 44
2025-01-18 09:50:10 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:10 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:10 - root - INFO - SQL:
-- 3. Get total sales volume per category over the last 24 months
SELECT "category_name", SUM("volume_sold_liters") AS category_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Results:
category_name,CATEGORY_VOLUME_LITERS
COFFEE LIQUEURS,135007.87
COCKTAILS/RTD,1600455.1300000001
CREAM LIQUEURS,524847.35
SPECIAL ORDER ITEMS,261204.81999999998
IMPORTED FLAVORED VODKA,338932.06
NEUTRAL GRAIN SPIRITS FLAVORED,179296.40000000008
IRISH WHISKIES,487476.2499999999
TENNESSEE WHISKIES,874965.7800000001
SCOTCH WHISKIES,339096.6500000001
100% AGAVE TEQUILA,1337976.1400000008
SINGLE BARREL BOURBON WHISKIES,66501.75
IMPORTED VODKAS,1236029.1200000003
IMPORTED DRY GINS,336467.80999999994
AMERICAN FLAVORED VODKA,1254337.0899999999
AGED DARK RUM,63850.75
IMPORTED CORDIALS & LIQUEURS,646662.8599999999
FLAVORED RUM,813367.3900000001
IMPORTED SCHNAPPS,514159.9400000001
SINGLE MALT SCOTCH,93558.3
WHISKEY LIQUEUR,1820371.08
BOTTLED IN BOND BOURBON,63004.8
FLAVORED GIN,54532.85000000001
MIXTO TEQUILA,1034184.4
MEZCAL,19429.250000000004
SPICED RUM,2355637.380000001
AMERICAN DISTILLED SPIRITS SPECIALTY,107465.63
CORN WHISKIES,9401.479999999998
CANADIAN WHISKIES,4920998.6899999995
AMERICAN BRANDIES,610242.59
BLENDED WHISKIES,1152212.41
AMERICAN SCHNAPPS,767670.3500000001
AMERICAN CORDIALS & LIQUEURS,306298.28999999986
AMERICAN SLOE GINS,5129.25
AMERICAN DRY GINS,491054.9700000001
AMERICAN VODKAS,9826611.110000001
IMPORTED DISTILLED SPIRITS SPECIALTY,525926.58
TRIPLE SEC,352120.0
GOLD RUM,136357.87
WHITE RUM,842697.1100000001
IMPORTED BRANDIES,359245.4999999999
STRAIGHT BOURBON WHISKIES,2295926.96
STRAIGHT RYE WHISKIES,167664.25000000003
TEMPORARY & SPECIALTY PACKAGES,451484.7899999999
NEUTRAL GRAIN SPIRITS,49901.599999999984

2025-01-18 09:50:10 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:10 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:10 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:12 - snowflake.connector.cursor - INFO - Number of results in first chunk: 924
2025-01-18 09:50:12 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:12 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:13 - root - INFO - SQL:
-- 4. Get monthly sales volume per category over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month, "category_name"
ORDER BY sales_month, "category_name"
Results:
Too long, hard cut:
SALES_MONTH,category_name,MONTHLY_VOLUME_LITERS
2023-01-01,100% AGAVE TEQUILA,23720.529999999995
2023-01-01,AGED DARK RUM,1777.0
2023-01-01,AMERICAN BRANDIES,14139.900000000001
2023-01-01,AMERICAN CORDIALS & LIQUEURS,6806.499999999999
2023-01-01,AMERICAN DISTILLED SPIRITS SPECIALTY,3177.700000000001
2023-01-01,AMERICAN DRY GINS,9967.150000000001
2023-01-01,AMERICAN FLAVORED VODKA,25656.18999999998
2023-01-01,AMERICAN SCHNAPPS,17000.71
2023-01-01,AMERICAN SLOE GINS,182.0
2023-01-01,AMERICAN VODKAS,184981.08999999994
2023-01-01,BLENDED WHISKIES,25856.21
2023-01-01,BOTTLED IN BOND BOURBON,1443.75
2023-01-01,CANADIAN WHISKIES,89047.12999999998
2023-01-01,COCKTAILS/RTD,25935.59
2023-01-01,COFFEE LIQUEURS,3905.69
2023-01-01,CORN WHISKIES,270.74
2023-01-01,CREAM LIQUEURS,12085.770000000002
2023-01-01,FLAVORED GIN,831.75
2023-01-01,FLAVORED RUM,17415.62
2023-01-01,GOLD RUM,3245.6999999999994
2023-01-01,IMPORTED BRANDIES,6447.690000000001
2023-01-01,IMPORTED CORDIALS & LIQUEURS,13021.94
2023-01-01,IMPORTED DISTILLED SPIRITS SPECIALTY,6079.74
2023-01-01,IMPORTED DRY GINS,5469.929999999999
2023-01-01,IMPORTED FLAVORED VODKA,7410.580000000001
2023-01-01,IMPORTED SCHNAPPS,10666.070000000002
2023-01-01,IMPORTED VODKAS,21339.139999999992
2023-01-01,IRISH WHISKIES,9620.54
2023-01-01,MEZCAL,331.2
2023-01-01,MIXTO TEQUILA,17919.390000000003
2023-01-01,NEUTRAL GRAIN SPIRITS,1009.75
2023-01-01,NEUTRAL GRAIN SPIRITS FLAVORED,3482.649999999999
2023-01-01,SCOTCH WHISKIES,7133.2
2023-01-01,SINGLE BARREL BOURBON WHISKIES,1560.0
2023-01-01,SINGLE MALT SCOTCH,2122.95
2023-01-01,SPECIAL ORDER ITEMS,12923.75
2023-01-01,SPICED RUM,51122.650000000016
2023-01-01,STRAIGHT BOURBON WHISKIES,48886.20999999999
2023-01-01,STRAIGHT RYE WHISKIES,3697.4799999999996
2023-01-01,TEMPORARY & SPECIALTY PACKAGES,6262.55
2023-01-01,TENNESSEE WHISKIES,16680.35
2023-01-01,TRIPLE SEC,6414.0
2023-01-01,WHISKEY LIQUEUR,42393.82
2023-01-01,WHITE RUM,15718.070000000005
2023-02-01,100% AGAVE TEQUILA,53083.39
2023-02-01,AGED DARK RUM,2796.4
2023-02-01,AMERICAN BRANDIES,28566.560000000005
2023-02-01,AMERICAN CORDIALS & LIQUEURS,13566.250000000002
2023-02-01,AMERICAN DISTILLED SPIRITS SPECIALTY,5508.650000000002
2023-02-01,AMERICAN DRY GINS,24607.489999999994
2023-02-01,AMERICAN FLAVORED VODKA,54669.66000000003
2023-02-01,AMERICAN SCHNAPPS,34510.61000000001
2023-02-01,AMERICAN SLOE GINS,269.0
2023-02-01,AMERICAN VODKAS,419923.23999999993
2023-02-01,BLENDED WHISKIES,50495.090000000004
2023-02-01,BOTTLED IN BOND BOURBON,2560.75
2023-02-01,CANADIAN WHISKIES,292384.20000000007
2023-02-01,COCKTAILS/RTD,55480.11999999999
2023-02-01,COFFEE LIQUEURS,5691.05
2023-02-01,CORN WHISKIES,467.59000000000003
2023-02-01,CREAM LIQUEURS,21590.100000000002
2023-02-01,FLAVORED GIN,1558.35
2023-02-01,FLAVORED RUM,33048.969999999994
2023-02-01,GOLD RUM,6675.709999999998
2023-02-01,IMPORTED BRANDIES,18477.41
2023-02-01,IMPORTED CORDIALS & LIQUEURS,25832.57000000001
2023-02-01,IMPORTED DISTILLED SPIRITS SPECIALTY,23420.940000000002
2023-02-01,IMPORTED DRY GINS,11572.840000000002
2023-02-01,IMPORTED FLAVORED VODKA,14278.28
2023-02-01,IMPORTED SCHNAPPS,23603.830000000005
2023-02-01,IMPORTED VODKAS,56374.95999999999
2023-02-01,IRISH WHISKIES,30336.760000000006
2023-02-01,MEZCAL,790.95
2023-02-01,MIXTO TEQUILA,44652.590000000004
2023-02-01,NEUTRAL GRAIN SPIRITS,1771.0500000000002
2023-02-01,NEUTRAL GRAIN SPIRITS FLAVORED,7274.2999999999965
2023-02-01,SCOTCH WHISKIES,14661.06
2023-02-01,SINGLE BARREL BOURBON WHISKIES,1794.0
2023-02-01,SINGLE MALT SCOTCH,4554.0
2023-02-01,SPECIAL ORDER ITEMS,12512.399999999998
2023-02-01,SPICED RUM,84430.86000000002
2023-02-01,STRAIGHT BOURBON WHISKIES,100771.82
2023-02-01,STRAIGHT RYE WHISKIES,7953.069999999999
2023-02-01,TEMPORARY & SPECIALTY PACKAGES,9342.740000000003
2023-02-01,TENNESSEE WHISKIES,39481.13999999999
2023-02-01,TRIPLE SEC,14423.75
2023-02-01,WHISKEY LIQUEUR,75072.06999999999
2023-02-01,WHITE RUM,39238.31
2023-03-01,100% AGAVE TEQUILA,50371.39
2023-03-01,AGED DARK RUM,3027.25
2023-03-01,AMERICAN BRANDIES,32628.480000000003
2023-03-01,AMERICAN CORDIALS & LIQUEURS,16258.549999999996
2023-03-01,AMERICAN DISTILLED SPIRITS SPECIALTY,5191.299999999998
2023-03-01,AMERICAN DRY GINS,22447.759999999995
2023-03-01,AMERICAN FLAVORED VODKA,64459.61000000001
2023-03-01,AMERICAN SCHNAPPS,41869.429999999986
2023-03-01,AMERICAN SLOE GINS,228.0
2023-03-01,AMERICAN VODKAS,486758.07000000007
2023-03-01,BLENDED WHISKIES,62095.62999999997
2023-03-01,BOTTLED IN BOND BOURBON,3145.25
2023-03-01,CANADIAN WHISKIES,209398.16999999993
2023-03-01,COCKTAILS/RTD,73303.28000000003
2023-03-01,COFFEE LIQUEURS,6234.72
2023-03-01,CORN WHISKIES,578.58
2023-03-01,CREAM LIQUEURS,26259.599999999995
2023-03-01,FLAVORED GIN,1958.55
2023-03-01,FLAVORED RUM,41979.59
2023-03-01,GOLD RUM,6956.660000000002
2023-03-01,IMPORTED BRANDIES,20756.49
2023-03-01,IMPORTED CORDIALS & LIQUEURS,33710.57000000001
2023-03-01,IMPORTED DISTILLED SPIRITS SPECIALTY,34693.66
2023-03-01,IMPORTED DRY GINS,15276.5

2025-01-18 09:50:13 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:13 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:13 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:14 - snowflake.connector.cursor - INFO - Number of results in first chunk: 21
2025-01-18 09:50:14 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:14 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:14 - root - INFO - SQL:
-- 5. Get total sales volume per month over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month
ORDER BY sales_month
Results:
SALES_MONTH,TOTAL_MONTHLY_VOLUME_LITERS
2023-01-01,785160.3699999998
2023-02-01,1770074.8800000004
2023-03-01,2014654.9399999997
2023-04-01,1791898.3700000006
2023-05-01,2185563.0700000003
2023-06-01,2218165.1200000006
2023-07-01,1867670.4299999995
2023-08-01,2128266.5500000007
2023-09-01,1880754.6500000008
2023-10-01,2036159.2400000002
2023-11-01,2060220.9799999997
2023-12-01,2029585.8800000004
2024-01-01,1757426.22
2024-02-01,1833717.6700000002
2024-03-01,1806155.8899999994
2024-04-01,1945657.3199999996
2024-05-01,2082952.6400000004
2024-06-01,1924118.6600000004
2024-07-01,1969592.4099999995
2024-08-01,1951273.95
2024-09-01,1790693.4100000001

2025-01-18 09:50:14 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:14 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:14 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:15 - snowflake.connector.cursor - INFO - Number of results in first chunk: 44
2025-01-18 09:50:15 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:16 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:16 - root - INFO - SQL:
-- 6. Get average monthly sales volume per category over the last 24 months
SELECT "category_name", AVG(monthly_volume) AS average_monthly_volume_liters
FROM (
  SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS monthly_volume
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY "category_name", sales_month
) sub
GROUP BY "category_name"
Results:
category_name,AVERAGE_MONTHLY_VOLUME_LITERS
COFFEE LIQUEURS,6428.946190476192
COCKTAILS/RTD,76212.14904761904
CREAM LIQUEURS,24992.730952380956
SPECIAL ORDER ITEMS,12438.324761904758
IMPORTED FLAVORED VODKA,16139.621904761907
NEUTRAL GRAIN SPIRITS FLAVORED,8537.92380952381
TENNESSEE WHISKIES,41665.037142857145
IRISH WHISKIES,23213.154761904763
100% AGAVE TEQUILA,63713.14952380953
SINGLE BARREL BOURBON WHISKIES,3166.75
SCOTCH WHISKIES,16147.459523809524
IMPORTED VODKAS,58858.52952380952
IMPORTED DRY GINS,16022.276666666668
AMERICAN FLAVORED VODKA,59730.33761904761
AGED DARK RUM,3040.5119047619046
IMPORTED CORDIALS & LIQUEURS,30793.46952380953
FLAVORED RUM,38731.78047619048
IMPORTED SCHNAPPS,24483.80666666667
WHISKEY LIQUEUR,86684.33714285714
BOTTLED IN BOND BOURBON,3000.2285714285717
SINGLE MALT SCOTCH,4455.157142857142
FLAVORED GIN,2596.802380952381
MIXTO TEQUILA,49246.8761904762
MEZCAL,925.202380952381
AMERICAN DISTILLED SPIRITS SPECIALTY,5117.410952380953
CORN WHISKIES,447.6895238095237
SPICED RUM,112173.20857142856
AMERICAN BRANDIES,29059.17095238095
CANADIAN WHISKIES,234333.27095238096
BLENDED WHISKIES,54867.25761904762
AMERICAN SCHNAPPS,36555.73095238096
AMERICAN SLOE GINS,244.25
AMERICAN CORDIALS & LIQUEURS,14585.632857142857
AMERICAN DRY GINS,23383.57
AMERICAN VODKAS,467933.86238095234
TRIPLE SEC,16767.619047619046
IMPORTED DISTILLED SPIRITS SPECIALTY,25044.122857142855
GOLD RUM,6493.231904761906
WHITE RUM,40128.4338095238
IMPORTED BRANDIES,17106.928571428572
STRAIGHT RYE WHISKIES,7984.011904761905
STRAIGHT BOURBON WHISKIES,109329.85523809523
TEMPORARY & SPECIALTY PACKAGES,21499.275714285715
NEUTRAL GRAIN SPIRITS,2376.266666666667

2025-01-18 09:50:16 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:16 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:16 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:17 - snowflake.connector.cursor - INFO - Number of results in first chunk: 23
2025-01-18 09:50:17 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:18 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:18 - root - INFO - SQL:
-- 7. Get categories that contribute at least 1% to the total sales volume over the last 24 months
SELECT "category_name", (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 AS percentage_contribution
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES, (
  SELECT SUM("volume_sold_liters") AS total_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
) total_volume
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", total_volume.total_volume_liters
HAVING (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 >= 1
Results:
category_name,PERCENTAGE_CONTRIBUTION
100% AGAVE TEQUILA,3.3592370402940395
MIXTO TEQUILA,2.5965115812709962
WHISKEY LIQUEUR,4.5703789299382125
IRISH WHISKIES,1.2238994600184987
IMPORTED DISTILLED SPIRITS SPECIALTY,1.32043613872753
IMPORTED CORDIALS & LIQUEURS,1.6235669433495854
IMPORTED SCHNAPPS,1.2908938085273771
AMERICAN SCHNAPPS,1.9273786709346614
TEMPORARY & SPECIALTY PACKAGES,1.133536230098524
BLENDED WHISKIES,2.892842772187596
STRAIGHT BOURBON WHISKIES,5.764350092103799
WHITE RUM,2.1157472551496608
IMPORTED VODKAS,3.10328015474629
AMERICAN VODKAS,24.671528164378856
TENNESSEE WHISKIES,2.1967637309031263
CREAM LIQUEURS,1.3177265318200433
COCKTAILS/RTD,4.0182391847620025
AMERICAN FLAVORED VODKA,3.149245706087579
CANADIAN WHISKIES,12.355079123224447
SPICED RUM,5.914264166472506
FLAVORED RUM,2.042109557989043
AMERICAN BRANDIES,1.5321271064616804
AMERICAN DRY GINS,1.2328844997523476

2025-01-18 09:50:18 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:18 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:18 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:19 - snowflake.connector.cursor - INFO - Number of results in first chunk: 924
2025-01-18 09:50:19 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:20 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:20 - root - INFO - SQL:
-- 8. Get monthly sales percentages per category over the last 24 months
SELECT t.sales_month, t."category_name", (t.monthly_volume_liters / m.total_monthly_volume_liters) * 100 AS sales_percentage
FROM (
  SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month, "category_name"
) t
JOIN (
  SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month
) m
ON t.sales_month = m.sales_month
ORDER BY t.sales_month, t."category_name"
Results:
Too long, hard cut:
SALES_MONTH,category_name,SALES_PERCENTAGE
2023-01-01,100% AGAVE TEQUILA,3.0211063760133476
2023-01-01,AGED DARK RUM,0.22632319050947514
2023-01-01,AMERICAN BRANDIES,1.800893236626296
2023-01-01,AMERICAN CORDIALS & LIQUEURS,0.8668929635355893
2023-01-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.4047198663376248
2023-01-01,AMERICAN DRY GINS,1.269441298979468
2023-01-01,AMERICAN FLAVORED VODKA,3.267636903273657
2023-01-01,AMERICAN SCHNAPPS,2.1652531953440293
2023-01-01,AMERICAN SLOE GINS,0.023179977868725086
2023-01-01,AMERICAN VODKAS,23.559656990838697
2023-01-01,BLENDED WHISKIES,3.293111953676419
2023-01-01,BOTTLED IN BOND BOURBON,0.18387963213171343
2023-01-01,CANADIAN WHISKIES,11.341266498205963
2023-01-01,COCKTAILS/RTD,3.303221990177624
2023-01-01,COFFEE LIQUEURS,0.4974385041873675
2023-01-01,CORN WHISKIES,0.034482127517464996
2023-01-01,CREAM LIQUEURS,1.539274072123636
2023-01-01,FLAVORED GIN,0.10593377248523128
2023-01-01,FLAVORED RUM,2.218097176758934
2023-01-01,GOLD RUM,0.4133805174094561
2023-01-01,IMPORTED BRANDIES,0.8211940192549455
2023-01-01,IMPORTED CORDIALS & LIQUEURS,1.6585070385047584
2023-01-01,IMPORTED DISTILLED SPIRITS SPECIALTY,0.7743309815802344
2023-01-01,IMPORTED DRY GINS,0.6966640458432715
2023-01-01,IMPORTED FLAVORED VODKA,0.943830112057235
2023-01-01,IMPORTED SCHNAPPS,1.358457508496003
2023-01-01,IMPORTED VODKAS,2.717806554602341
2023-01-01,IRISH WHISKIES,1.2252961773911233
2023-01-01,MEZCAL,0.04218246522044916
2023-01-01,MIXTO TEQUILA,2.2822585913244713
2023-01-01,NEUTRAL GRAIN SPIRITS,0.12860430029090744
2023-01-01,NEUTRAL GRAIN SPIRITS FLAVORED,0.44355906551931545
2023-01-01,SCOTCH WHISKIES,0.9085022974351088
2023-01-01,SINGLE BARREL BOURBON WHISKIES,0.19868552458907215
2023-01-01,SINGLE MALT SCOTCH,0.2703842528374171
2023-01-01,SPECIAL ORDER ITEMS,1.6460013130820648
2023-01-01,SPICED RUM,6.511109316431753
2023-01-01,STRAIGHT BOURBON WHISKIES,6.226270691680477
2023-01-01,STRAIGHT RYE WHISKIES,0.47092035478051447
2023-01-01,TEMPORARY & SPECIALTY PACKAGES,0.7976141230867271
2023-01-01,TENNESSEE WHISKIES,2.124451339794443
2023-01-01,TRIPLE SEC,0.8169031760989159
2023-01-01,WHISKEY LIQUEUR,5.399383567970962
2023-01-01,WHITE RUM,2.001892938126769
2023-02-01,100% AGAVE TEQUILA,2.998934711733778
2023-02-01,AGED DARK RUM,0.15798201712234908
2023-02-01,AMERICAN BRANDIES,1.6138616689481522
2023-02-01,AMERICAN CORDIALS & LIQUEURS,0.7664223786962054
2023-02-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.3112099980764656
2023-02-01,AMERICAN DRY GINS,1.3901948600050187
2023-02-01,AMERICAN FLAVORED VODKA,3.0885506945333288
2023-02-01,AMERICAN SCHNAPPS,1.9496694964678554
2023-02-01,AMERICAN SLOE GINS,0.015197097198509476
2023-02-01,AMERICAN VODKAS,23.72347321261346
2023-02-01,BLENDED WHISKIES,2.852709259395851
2023-02-01,BOTTLED IN BOND BOURBON,0.14466902100774404
2023-02-01,CANADIAN WHISKIES,16.51818255281946
2023-02-01,COCKTAILS/RTD,3.1343374580853887
2023-02-01,COFFEE LIQUEURS,0.32151464688318726
2023-02-01,CORN WHISKIES,0.02641639657639794
2023-02-01,CREAM LIQUEURS,1.2197280603179905
2023-02-01,FLAVORED GIN,0.0880386483988745
2023-02-01,FLAVORED RUM,1.8670944587383782
2023-02-01,GOLD RUM,0.3771428020039468
2023-02-01,IMPORTED BRANDIES,1.0438773076085908
2023-02-01,IMPORTED CORDIALS & LIQUEURS,1.4594054913654273
2023-02-01,IMPORTED DISTILLED SPIRITS SPECIALTY,1.3231609727154594
2023-02-01,IMPORTED DRY GINS,0.6538051090810351
2023-02-01,IMPORTED FLAVORED VODKA,0.8066483605484531
2023-02-01,IMPORTED SCHNAPPS,1.333493303966892
2023-02-01,IMPORTED VODKAS,3.1848912516062597
2023-02-01,IRISH WHISKIES,1.7138687375756672
2023-02-01,MEZCAL,0.04468455029427908
2023-02-01,MIXTO TEQUILA,2.5226384773055472
2023-02-01,NEUTRAL GRAIN SPIRITS,0.10005508919487065
2023-02-01,NEUTRAL GRAIN SPIRITS FLAVORED,0.4109600154316635
2023-02-01,SCOTCH WHISKIES,0.8282734343984364
2023-02-01,SINGLE BARREL BOURBON WHISKIES,0.10135164451347957
2023-02-01,SINGLE MALT SCOTCH,0.2572772514572942
2023-02-01,SPECIAL ORDER ITEMS,0.7068853493926764
2023-02-01,SPICED RUM,4.769903293582698
2023-02-01,STRAIGHT BOURBON WHISKIES,5.6930823175119
2023-02-01,STRAIGHT RYE WHISKIES,0.4493069807306682
2023-02-01,TEMPORARY & SPECIALTY PACKAGES,0.5278160887747302
2023-02-01,TENNESSEE WHISKIES,2.2304785207730875
2023-02-01,TRIPLE SEC,0.8148666569405244
2023-02-01,WHISKEY LIQUEUR,4.24118046350672
2023-02-01,WHITE RUM,2.216759892101287
2023-03-01,100% AGAVE TEQUILA,2.5002490004566242
2023-03-01,AGED DARK RUM,0.15026146363307255
2023-03-01,AMERICAN BRANDIES,1.6195567465265286
2023-03-01,AMERICAN CORDIALS & LIQUEURS,0.8070141281861395
2023-03-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.2576768803892541
2023-03-01,AMERICAN DRY GINS,1.1142235602886912
2023-03-01,AMERICAN FLAVORED VODKA,3.199535995975569
2023-03-01,AMERICAN SCHNAPPS,2.078243235042522
2023-03-01,AMERICAN SLOE GINS,0.011317074476287239
2023-03-01,AMERICAN VODKAS,24.160865482999284
2023-03-01,BLENDED WHISKIES,3.0821967954472633
2023-03-01,BOTTLED IN BOND BOURBON,0.15611854603746683
2023-03-01,CANAD

2025-01-18 09:50:20 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:20 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:20 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:21 - snowflake.connector.cursor - INFO - Number of results in first chunk: 44
2025-01-18 09:50:21 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:21 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:22 - root - INFO - SQL:
-- 9. Get the number of records per category over the last 24 months
SELECT "category_name", COUNT(*) AS record_count
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Results:
category_name,RECORD_COUNT
COFFEE LIQUEURS,18731
COCKTAILS/RTD,140930
CREAM LIQUEURS,81495
SPECIAL ORDER ITEMS,4144
NEUTRAL GRAIN SPIRITS FLAVORED,69838
IMPORTED FLAVORED VODKA,52584
IRISH WHISKIES,55570
TENNESSEE WHISKIES,129975
100% AGAVE TEQUILA,228002
SINGLE BARREL BOURBON WHISKIES,12116
SCOTCH WHISKIES,51806
IMPORTED VODKAS,98635
IMPORTED DRY GINS,41782
AMERICAN FLAVORED VODKA,213517
AGED DARK RUM,12932
IMPORTED CORDIALS & LIQUEURS,99024
FLAVORED RUM,88027
IMPORTED SCHNAPPS,57541
WHISKEY LIQUEUR,282450
SINGLE MALT SCOTCH,28110
BOTTLED IN BOND BOURBON,15222
FLAVORED GIN,8450
MIXTO TEQUILA,97130
MEZCAL,5037
AMERICAN DISTILLED SPIRITS SPECIALTY,16667
SPICED RUM,167582
CORN WHISKIES,2156
CANADIAN WHISKIES,428682
AMERICAN BRANDIES,96123
BLENDED WHISKIES,152590
AMERICAN SCHNAPPS,145302
AMERICAN CORDIALS & LIQUEURS,105533
AMERICAN SLOE GINS,973
AMERICAN DRY GINS,56339
AMERICAN VODKAS,694524
TRIPLE SEC,14436
IMPORTED DISTILLED SPIRITS SPECIALTY,13533
GOLD RUM,18437
WHITE RUM,74454
IMPORTED BRANDIES,68510
STRAIGHT BOURBON WHISKIES,343826
STRAIGHT RYE WHISKIES,35322
TEMPORARY & SPECIALTY PACKAGES,93405
NEUTRAL GRAIN SPIRITS,8137

2025-01-18 09:50:22 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:22 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:22 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:23 - snowflake.connector.cursor - INFO - Number of results in first chunk: 44
2025-01-18 09:50:23 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:23 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:23 - root - INFO - SQL:
-- 10. Get total sales in dollars per category over the last 24 months
SELECT "category_name", SUM("sale_dollars") AS total_sales_dollars
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Results:
category_name,TOTAL_SALES_DOLLARS
COFFEE LIQUEURS,3428062.8100000005
COCKTAILS/RTD,14257094.760000002
CREAM LIQUEURS,12665351.35
SPECIAL ORDER ITEMS,2250048.730000001
NEUTRAL GRAIN SPIRITS FLAVORED,5904044.789999999
IMPORTED FLAVORED VODKA,7467776.369999999
IRISH WHISKIES,16384050.310000002
TENNESSEE WHISKIES,28363478.37
100% AGAVE TEQUILA,56781176.47
SINGLE BARREL BOURBON WHISKIES,3663003.83
SCOTCH WHISKIES,9272660.36
IMPORTED VODKAS,20143481.090000004
IMPORTED DRY GINS,9111249.249999998
AMERICAN FLAVORED VODKA,20105492.139999997
AGED DARK RUM,1698202.87
FLAVORED RUM,13554614.770000003
IMPORTED CORDIALS & LIQUEURS,20829965.02
IMPORTED SCHNAPPS,10195782.090000002
WHISKEY LIQUEUR,44936647.390000015
BOTTLED IN BOND BOURBON,2225459.6599999997
SINGLE MALT SCOTCH,6706807.279999998
FLAVORED GIN,1855294.0800000003
MIXTO TEQUILA,19363919.47
MEZCAL,864461.3700000001
AMERICAN DISTILLED SPIRITS SPECIALTY,3191339.7600000002
SPICED RUM,37732727.449999996
CORN WHISKIES,348747.41000000003
CANADIAN WHISKIES,84879706.84999996
AMERICAN BRANDIES,7799939.15
BLENDED WHISKIES,18533851.619999997
AMERICAN SCHNAPPS,12620932.629999999
AMERICAN CORDIALS & LIQUEURS,7422863.199999998
AMERICAN SLOE GINS,43891.770000000004
AMERICAN DRY GINS,5628449.000000003
AMERICAN VODKAS,114640002.38999999
IMPORTED DISTILLED SPIRITS SPECIALTY,4568133.669999999
TRIPLE SEC,1472906.4099999997
GOLD RUM,1718273.23
WHITE RUM,9837199.780000001
IMPORTED BRANDIES,17900014.80000001
STRAIGHT BOURBON WHISKIES,65615085.90999999
STRAIGHT RYE WHISKIES,7021560.750000002
TEMPORARY & SPECIALTY PACKAGES,17573616.599999998
NEUTRAL GRAIN SPIRITS,940443.3299999995

2025-01-18 09:50:23 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:23 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:23 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:25 - snowflake.connector.cursor - INFO - Number of results in first chunk: 21
2025-01-18 09:50:25 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:25 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:25 - root - INFO - SQL:
-- 11. Get the list of months in the dataset over the last 24 months
SELECT DISTINCT DATE_TRUNC('month', "date") AS sales_month
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
ORDER BY sales_month
Results:
SALES_MONTH
2023-01-01
2023-02-01
2023-03-01
2023-04-01
2023-05-01
2023-06-01
2023-07-01
2023-08-01
2023-09-01
2023-10-01
2023-11-01
2023-12-01
2024-01-01
2024-02-01
2024-03-01
2024-04-01
2024-05-01
2024-06-01
2024-07-01
2024-08-01
2024-09-01

2025-01-18 09:50:25 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:50:25 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:50:25 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:50:27 - snowflake.connector.cursor - INFO - Number of results in first chunk: 924
2025-01-18 09:50:27 - snowflake.connector.connection - INFO - closed
2025-01-18 09:50:27 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:50:27 - root - INFO - SQL:
-- 12. Get average sales volume per category per month over the last 24 months
SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, AVG("volume_sold_liters") AS average_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", sales_month
ORDER BY "category_name", sales_month
Results:
Too long, hard cut:
category_name,SALES_MONTH,AVERAGE_VOLUME_LITERS
100% AGAVE TEQUILA,2023-01-01,5.7883186920449
100% AGAVE TEQUILA,2023-02-01,6.411037439613528
100% AGAVE TEQUILA,2023-03-01,5.13260546158549
100% AGAVE TEQUILA,2023-04-01,6.343638177236455
100% AGAVE TEQUILA,2023-05-01,6.298545647558387
100% AGAVE TEQUILA,2023-06-01,6.200162544169614
100% AGAVE TEQUILA,2023-07-01,5.586109862447181
100% AGAVE TEQUILA,2023-08-01,6.138334044915037
100% AGAVE TEQUILA,2023-09-01,6.202953486159993
100% AGAVE TEQUILA,2023-10-01,5.71651574074074
100% AGAVE TEQUILA,2023-11-01,5.3669946684126835
100% AGAVE TEQUILA,2023-12-01,5.919297116590055
100% AGAVE TEQUILA,2024-01-01,5.0661943002644225
100% AGAVE TEQUILA,2024-02-01,5.897208261945554
100% AGAVE TEQUILA,2024-03-01,5.313464388027264
100% AGAVE TEQUILA,2024-04-01,6.461096505823626
100% AGAVE TEQUILA,2024-05-01,5.7435201010626455
100% AGAVE TEQUILA,2024-06-01,6.259495194249254
100% AGAVE TEQUILA,2024-07-01,5.775129661644851
100% AGAVE TEQUILA,2024-08-01,5.569443155452436
100% AGAVE TEQUILA,2024-09-01,5.863935293063274
AGED DARK RUM,2023-01-01,5.048295454545454
AGED DARK RUM,2023-02-01,5.316349809885931
AGED DARK RUM,2023-03-01,4.722698907956318
AGED DARK RUM,2023-04-01,5.095656192236599
AGED DARK RUM,2023-05-01,5.108372456964006
AGED DARK RUM,2023-06-01,5.1888386123680235
AGED DARK RUM,2023-07-01,5.1618819776714515
AGED DARK RUM,2023-08-01,4.94620253164557
AGED DARK RUM,2023-09-01,4.832230623818526
AGED DARK RUM,2023-10-01,5.538142620232173
AGED DARK RUM,2023-11-01,4.8261024182076815
AGED DARK RUM,2023-12-01,4.873705408515535
AGED DARK RUM,2024-01-01,3.99185667752443
AGED DARK RUM,2024-02-01,4.822042139384116
AGED DARK RUM,2024-03-01,5.815630397236615
AGED DARK RUM,2024-04-01,4.552479338842975
AGED DARK RUM,2024-05-01,4.947869101978691
AGED DARK RUM,2024-06-01,4.777917981072555
AGED DARK RUM,2024-07-01,5.021198830409356
AGED DARK RUM,2024-08-01,4.368055555555555
AGED DARK RUM,2024-09-01,4.904545454545454
AMERICAN BRANDIES,2023-01-01,5.874491067719153
AMERICAN BRANDIES,2023-02-01,5.936525353283458
AMERICAN BRANDIES,2023-03-01,6.140097854723371
AMERICAN BRANDIES,2023-04-01,6.467758231844834
AMERICAN BRANDIES,2023-05-01,6.304408408408409
AMERICAN BRANDIES,2023-06-01,6.224836131095124
AMERICAN BRANDIES,2023-07-01,6.161615551799084
AMERICAN BRANDIES,2023-08-01,6.286965738758031
AMERICAN BRANDIES,2023-09-01,6.462167848699765
AMERICAN BRANDIES,2023-10-01,6.444595833333337
AMERICAN BRANDIES,2023-11-01,6.455529169783096
AMERICAN BRANDIES,2023-12-01,6.322208904109587
AMERICAN BRANDIES,2024-01-01,6.546884469696969
AMERICAN BRANDIES,2024-02-01,6.232660022148394
AMERICAN BRANDIES,2024-03-01,6.627505854800939
AMERICAN BRANDIES,2024-04-01,6.4079341383095505
AMERICAN BRANDIES,2024-05-01,6.487855263157897
AMERICAN BRANDIES,2024-06-01,6.441729341317364
AMERICAN BRANDIES,2024-07-01,6.423715984450036
AMERICAN BRANDIES,2024-08-01,6.377374100719426
AMERICAN BRANDIES,2024-09-01,6.534451536643025
AMERICAN CORDIALS & LIQUEURS,2023-01-01,2.9050362782757144
AMERICAN CORDIALS & LIQUEURS,2023-02-01,2.925021561017679
AMERICAN CORDIALS & LIQUEURS,2023-03-01,2.872535335689046
AMERICAN CORDIALS & LIQUEURS,2023-04-01,2.874632443531828
AMERICAN CORDIALS & LIQUEURS,2023-05-01,2.7952870537917427
AMERICAN CORDIALS & LIQUEURS,2023-06-01,2.8557753647777413
AMERICAN CORDIALS & LIQUEURS,2023-07-01,2.6348387694588586
AMERICAN CORDIALS & LIQUEURS,2023-08-01,2.7331157817109144
AMERICAN CORDIALS & LIQUEURS,2023-09-01,2.991840806693842
AMERICAN CORDIALS & LIQUEURS,2023-10-01,2.8438706525986714
AMERICAN CORDIALS & LIQUEURS,2023-11-01,3.1749458417477503
AMERICAN CORDIALS & LIQUEURS,2023-12-01,3.505404937883315
AMERICAN CORDIALS & LIQUEURS,2024-01-01,2.952664595067003
AMERICAN CORDIALS & LIQUEURS,2024-02-01,2.9883203661327236
AMERICAN CORDIALS & LIQUEURS,2024-03-01,3.171422523285352
AMERICAN CORDIALS & LIQUEURS,2024-04-01,2.852561023622047
AMERICAN CORDIALS & LIQUEURS,2024-05-01,2.720218949044586
AMERICAN CORDIALS & LIQUEURS,2024-06-01,2.986811872731155
AMERICAN CORDIALS & LIQUEURS,2024-07-01,2.647127155580823
AMERICAN CORDIALS & LIQUEURS,2024-08-01,2.7290811258278147
AMERICAN CORDIALS & LIQUEURS,2024-09-01,2.7018557158712544
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-01-01,6.746709129511678
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-02-01,6.999555273189327
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-03-01,5.806823266219239
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-04-01,7.475464190981432
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-05-01,5.233262486716261
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-06-01,5.903291384317521
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-07-01,6.024385964912282
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-08-01,5.107396449704143
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-09-01,8.182189973614776
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-10-01,8.599617346938777
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-11-01,6.1125000000000025
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-12-01,6.3128773584905655
AMERICAN DISTILLED SPIRITS SPEC

2025-01-18 09:50:27 - root - INFO - itercount: 0
2025-01-18 09:50:27 - root - INFO - Database Name: IOWA_LIQUOR_SALES
Schema Name: IOWA_LIQUOR_SALES
DDL describes table information.
,0
table_name,SALES
description,
DDL,"create or replace TABLE SALES (
	""invoice_and_item_number"" VARCHAR(16777216),
	""date"" DATE,
	""store_number"" VARCHAR(16777216),
	""store_name"" VARCHAR(16777216),
	""address"" VARCHAR(16777216),
	""city"" VARCHAR(16777216),
	""zip_code"" VARCHAR(16777216),
	""store_location"" BINARY(8388608),
	""county_number"" VARCHAR(16777216),
	""county"" VARCHAR(16777216),
	""category"" VARCHAR(16777216),
	""category_name"" VARCHAR(16777216),
	""vendor_number"" VARCHAR(16777216),
	""vendor_name"" VARCHAR(16777216),
	""item_number"" VARCHAR(16777216),
	""item_description"" VARCHAR(16777216),
	""pack"" NUMBER(38,0),
	""bottle_volume_ml"" NUMBER(38,0),
	""state_bottle_cost"" FLOAT,
	""state_bottle_retail"" FLOAT,
	""bottles_sold"" NUMBER(38,0),
	""sale_dollars"" FLOAT,
	""volume_sold_liters"" FLOAT,
	""volume_sold_gallons"" FLOAT
);"

External knowledge that might be helpful: 
None
The table structure information is ({database name: {schema name: {table name}}}): 
{'IOWA_LIQUOR_SALES': {'IOWA_LIQUOR_SALES': ['SALES']}}
Begin Exploring Related Columns
**Relevant Tables and Columns:**

*Table:* `SALES`  
*Database:* `IOWA_LIQUOR_SALES`  
*Schema:* `IOWA_LIQUOR_SALES`  

**Columns and Potential Usage:**

1. **"date"**: Used to filter sales data within the last 24 months and to group sales data by month.
2. **"category"**: Category code for liquor; could be used to identify different liquor categories.
3. **"category_name"**: Name of the liquor category; essential for labeling and analyzing categories.
4. **"volume_sold_liters"**: Volume of liquor sold in liters; used to calculate sales volumes and percentages.
5. **"sale_dollars"**: Total sales amount in dollars; may be used to analyze sales revenue.
6. **"bottles_sold"**: Number of bottles sold; could provide additional insight into sales volume.
7. **"store_number"**, **"store_name"**, **"city"**, **"county"**: Could be used if regional analysis is needed.

**Conditions That May Be Used:**

- Filter data to the last 24 months: `"date" >= DATEADD(month, -24, CURRENT_DATE)`
- Exclude categories contributing less than an average of 1% to monthly sales volume.
- Group data by `"category_name"` and by month to calculate volumes and percentages.
- Calculate Pearson correlation coefficients between sales percentages of categories.

---

**SQL Queries to Understand the Data:**

*Note: All queries are limited to the `SALES` table within the `IOWA_LIQUOR_SALES` database and schema.*

```sql
-- 1. Get a list of all distinct liquor categories
SELECT DISTINCT "category_name"
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES;

-- 2. Get the total sales volume in liters over the last 24 months
SELECT SUM("volume_sold_liters") AS total_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE);

-- 3. Get total sales volume per category over the last 24 months
SELECT "category_name", SUM("volume_sold_liters") AS category_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name";

-- 4. Get monthly sales volume per category over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month, "category_name"
ORDER BY sales_month, "category_name";

-- 5. Get total sales volume per month over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month
ORDER BY sales_month;

-- 6. Get average monthly sales volume per category over the last 24 months
SELECT "category_name", AVG(monthly_volume) AS average_monthly_volume_liters
FROM (
  SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS monthly_volume
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY "category_name", sales_month
) sub
GROUP BY "category_name";

-- 7. Get categories that contribute at least 1% to the total sales volume over the last 24 months
SELECT "category_name", (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 AS percentage_contribution
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES, (
  SELECT SUM("volume_sold_liters") AS total_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
) total_volume
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", total_volume.total_volume_liters
HAVING (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 >= 1;

-- 8. Get monthly sales percentages per category over the last 24 months
SELECT t.sales_month, t."category_name", (t.monthly_volume_liters / m.total_monthly_volume_liters) * 100 AS sales_percentage
FROM (
  SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month, "category_name"
) t
JOIN (
  SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month
) m
ON t.sales_month = m.sales_month
ORDER BY t.sales_month, t."category_name";

-- 9. Get the number of records per category over the last 24 months
SELECT "category_name", COUNT(*) AS record_count
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name";

-- 10. Get total sales in dollars per category over the last 24 months
SELECT "category_name", SUM("sale_dollars") AS total_sales_dollars
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name";

-- 11. Get the list of months in the dataset over the last 24 months
SELECT DISTINCT DATE_TRUNC('month', "date") AS sales_month
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
ORDER BY sales_month;

-- 12. Get average sales volume per category per month over the last 24 months
SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, AVG("volume_sold_liters") AS average_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", sales_month
ORDER BY "category_name", sales_month;
```

*Explanation:*

- Queries 1 and 2 help identify the different liquor categories and the total sales volume to understand the scale.
- Queries 3 to 6 aggregate sales volume data per category and per month to analyze trends and compute averages.
- Query 7 identifies categories contributing an average of at least 1% to monthly sales volume.
- Query 8 calculates monthly sales percentages per category, which are necessary to compute the Pearson correlation coefficients.
- Queries 9 and 10 provide additional context on the number of transactions and total sales dollars per category.
- Query 11 lists all months involved, ensuring no months are missing in the 24-month range.
- Query 12 computes average sales volume per category per month, useful for further analysis.

---

By executing these queries, we can gather the necessary data to identify the two liquor categories that meet the specified criteria and calculate the Pearson correlation coefficients of their sales percentages to determine which pair has the lowest correlation.Query:
-- 1. Get a list of all distinct liquor categories
SELECT DISTINCT "category_name"
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
Answer:
category_name
IMPORTED WHISKIES
100 PROOF VODKA
WHITE CREME DE CACAO
COFFEE LIQUEURS
CREME DE ALMOND
HIGH PROOF BEER - AMERICAN
COCKTAILS/RTD
LOW PROOF VODKA
VODKA FLAVORED
DARK CREME DE CACAO
WATERMELON SCHNAPPS
CREAM LIQUEURS
BUTTERSCOTCH SCHNAPPS
SPECIAL ORDER ITEMS
APPLE SCHNAPPS
IMPORTED FLAVORED VODKA
NEUTRAL GRAIN SPIRITS FLAVORED
DELISTED ITEMS
TENNESSEE WHISKIES
IRISH WHISKIES
VODKA 80 PROOF
100% AGAVE TEQUILA
SCOTCH WHISKIES
SINGLE BARREL BOURBON WHISKIES
ROOT BEER SCHNAPPS
SPEARMINT SCHNAPPS
""
IMPORTED GRAPE BRANDIES
TEQUILA
BARBADOS RUM
CINNAMON SCHNAPPS
IMPORTED GINS
IMPORTED VODKAS
IMPORTED DRY GINS
AMERICAN COCKTAILS
BLACKBERRY BRANDIES
OTHER PROOF VODKA
GREEN CREME DE MENTHE
ANISETTE
IMPORTED VODKA - CHERRY
MISC. AMERICAN CORDIALS & LIQUEURS
DECANTERS & SPECIALTY PACKAGES
AMERICAN FLAVORED VODKA
AGED DARK RUM
FLAVORED RUM
IMPORTED CORDIALS & LIQUEURS
GRAPE SCHNAPPS
SCHNAPPS - IMPORTED
IMPORTED SCHNAPPS
SINGLE MALT SCOTCH
WHISKEY LIQUEUR
BOTTLED IN BOND BOURBON
PEACH BRANDIES
JAPANESE WHISKY
FLAVORED GIN
MIXTO TEQUILA
AMERICAN WHISKIES
IOWA DISTILLERY WHISKIES
AMERICAN ALCOHOL
PEACH SCHNAPPS
AMERICAN GRAPE BRANDIES
MEZCAL
TROPICAL FRUIT SCHNAPPS
SPICED RUM
PEPPERMINT SCHNAPPS
CORN WHISKIES
AMERICAN DISTILLED SPIRITS SPECIALTY
AMERICAN BRANDIES
CANADIAN WHISKIES
MISCELLANEOUS  BRANDIES
IMPORTED VODKA - MISC
BLENDED WHISKIES
APRICOT BRANDIES
FLAVORED GINS
AMERICAN SCHNAPPS
ROCK & RYE
AMERICAN CORDIALS & LIQUEURS
AMERICAN SLOE GINS
JAMAICA RUM
WHITE CREME DE MENTHE
AMERICAN DRY GINS
STRAWBERRY SCHNAPPS
AMERICAN VODKAS
IMPORTED AMARETTO
AMERICAN AMARETTO
AMARETTO - IMPORTED
IMPORTED DISTILLED SPIRITS SPECIALTY
TRIPLE SEC
MISC. IMPORTED CORDIALS & LIQUEURS
MISCELLANEOUS SCHNAPPS
GOLD RUM
IOWA DISTILLERIES
WHITE RUM
CHERRY BRANDIES
RASPBERRY SCHNAPPS
PUERTO RICO & VIRGIN ISLANDS RUM
IMPORTED BRANDIES
STRAIGHT BOURBON WHISKIES
STRAIGHT RYE WHISKIES
DELISTED / SPECIAL ORDER ITEMS
TEMPORARY & SPECIALTY PACKAGES
NEUTRAL GRAIN SPIRITS
DISTILLED SPIRITS SPECIALTY
HOLIDAY VAP
Query:
-- 2. Get the total sales volume in liters over the last 24 months
SELECT SUM("volume_sold_liters") AS total_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
Answer:
TOTAL_VOLUME_LITERS
39829762.65
Query:
-- 3. Get total sales volume per category over the last 24 months
SELECT "category_name", SUM("volume_sold_liters") AS category_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Answer:
category_name,CATEGORY_VOLUME_LITERS
COFFEE LIQUEURS,135007.87
COCKTAILS/RTD,1600455.1300000001
CREAM LIQUEURS,524847.35
SPECIAL ORDER ITEMS,261204.81999999998
IMPORTED FLAVORED VODKA,338932.06
NEUTRAL GRAIN SPIRITS FLAVORED,179296.40000000008
IRISH WHISKIES,487476.2499999999
TENNESSEE WHISKIES,874965.7800000001
SCOTCH WHISKIES,339096.6500000001
100% AGAVE TEQUILA,1337976.1400000008
SINGLE BARREL BOURBON WHISKIES,66501.75
IMPORTED VODKAS,1236029.1200000003
IMPORTED DRY GINS,336467.80999999994
AMERICAN FLAVORED VODKA,1254337.0899999999
AGED DARK RUM,63850.75
IMPORTED CORDIALS & LIQUEURS,646662.8599999999
FLAVORED RUM,813367.3900000001
IMPORTED SCHNAPPS,514159.9400000001
SINGLE MALT SCOTCH,93558.3
WHISKEY LIQUEUR,1820371.08
BOTTLED IN BOND BOURBON,63004.8
FLAVORED GIN,54532.85000000001
MIXTO TEQUILA,1034184.4
MEZCAL,19429.250000000004
SPICED RUM,2355637.380000001
AMERICAN DISTILLED SPIRITS SPECIALTY,107465.63
CORN WHISKIES,9401.479999999998
CANADIAN WHISKIES,4920998.6899999995
AMERICAN BRANDIES,610242.59
BLENDED WHISKIES,1152212.41
AMERICAN SCHNAPPS,767670.3500000001
AMERICAN CORDIALS & LIQUEURS,306298.28999999986
AMERICAN SLOE GINS,5129.25
AMERICAN DRY GINS,491054.9700000001
AMERICAN VODKAS,9826611.110000001
IMPORTED DISTILLED SPIRITS SPECIALTY,525926.58
TRIPLE SEC,352120.0
GOLD RUM,136357.87
WHITE RUM,842697.1100000001
IMPORTED BRANDIES,359245.4999999999
STRAIGHT BOURBON WHISKIES,2295926.96
STRAIGHT RYE WHISKIES,167664.25000000003
TEMPORARY & SPECIALTY PACKAGES,451484.7899999999
NEUTRAL GRAIN SPIRITS,49901.599999999984
Query:
-- 4. Get monthly sales volume per category over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month, "category_name"
ORDER BY sales_month, "category_name"
Answer:
Too long, hard cut:
SALES_MONTH,category_name,MONTHLY_VOLUME_LITERS
2023-01-01,100% AGAVE TEQUILA,23720.529999999995
2023-01-01,AGED DARK RUM,1777.0
2023-01-01,AMERICAN BRANDIES,14139.900000000001
2023-01-01,AMERICAN CORDIALS & LIQUEURS,6806.499999999999
2023-01-01,AMERICAN DISTILLED SPIRITS SPECIALTY,3177.700000000001
2023-01-01,AMERICAN DRY GINS,9967.150000000001
2023-01-01,AMERICAN FLAVORED VODKA,25656.18999999998
2023-01-01,AMERICAN SCHNAPPS,17000.71
2023-01-01,AMERICAN SLOE GINS,182.0
2023-01-01,AMERICAN VODKAS,184981.08999999994
2023-01-01,BLENDED WHISKIES,25856.21
2023-01-01,BOTTLED IN BOND BOURBON,1443.75
2023-01-01,CANADIAN WHISKIES,89047.12999999998
2023-01-01,COCKTAILS/RTD,25935.59
2023-01-01,COFFEE LIQUEURS,3905.69
2023-01-01,CORN WHISKIES,270.74
2023-01-01,CREAM LIQUEURS,12085.770000000002
2023-01-01,FLAVORED GIN,831.75
2023-01-01,FLAVORED RUM,17415.62
2023-01-01,GOLD RUM,3245.6999999999994
2023-01-01,IMPORTED BRANDIES,6447.690000000001
2023-01-01,IMPORTED CORDIALS & LIQUEURS,13021.94
2023-01-01,IMPORTED DISTILLED SPIRITS SPECIALTY,6079.74
2023-01-01,IMPORTED DRY GINS,5469.929999999999
2023-01-01,IMPORTED FLAVORED VODKA,7410.580000000001
2023-01-01,IMPORTED SCHNAPPS,10666.070000000002
2023-01-01,IMPORTED VODKAS,21339.139999999992
2023-01-01,IRISH WHISKIES,9620.54
2023-01-01,MEZCAL,331.2
2023-01-01,MIXTO TEQUILA,17919.390000000003
2023-01-01,NEUTRAL GRAIN SPIRITS,1009.75
2023-01-01,NEUTRAL GRAIN SPIRITS FLAVORED,3482.649999999999
2023-01-01,SCOTCH WHISKIES,7133.2
2023-01-01,SINGLE BARREL BOURBON WHISKIES,1560.0
2023-01-01,SINGLE MALT SCOTCH,2122.95
2023-01-01,SPECIAL ORDER ITEMS,12923.75
2023-01-01,SPICED RUM,51122.650000000016
2023-01-01,STRAIGHT BOURBON WHISKIES,48886.20999999999
2023-01-01,STRAIGHT RYE WHISKIES,3697.4799999999996
2023-01-01,TEMPORARY & SPECIALTY PACKAGES,6262.55
2023-01-01,TENNESSEE WHISKIES,16680.35
2023-01-01,TRIPLE SEC,6414.0
2023-01-01,WHISKEY LIQUEUR,42393.82
2023-01-01,WHITE RUM,15718.070000000005
2023-02-01,100% AGAVE TEQUILA,53083.39
2023-02-01,AGED DARK RUM,2796.4
2023-02-01,AMERICAN BRANDIES,28566.560000000005
2023-02-01,AMERICAN CORDIALS & LIQUEURS,13566.250000000002
2023-02-01,AMERICAN DISTILLED SPIRITS SPECIALTY,5508.650000000002
2023-02-01,AMERICAN DRY GINS,24607.489999999994
2023-02-01,AMERICAN FLAVORED VODKA,54669.66000000003
2023-02-01,AMERICAN SCHNAPPS,34510.61000000001
2023-02-01,AMERICAN SLOE GINS,269.0
2023-02-01,AMERICAN VODKAS,419923.23999999993
2023-02-01,BLENDED WHISKIES,50495.090000000004
2023-02-01,BOTTLED IN BOND BOURBON,2560.75
2023-02-01,CANADIAN WHISKIES,292384.20000000007
2023-02-01,COCKTAILS/RTD,55480.11999999999
2023-02-01,COFFEE LIQUEURS,5691.05
2023-02-01,CORN WHISKIES,467.59000000000003
2023-02-01,CREAM LIQUEURS,21590.100000000002
2023-02-01,FLAVORED GIN,1558.35
2023-02-01,FLAVORED RUM,33048.969999999994
2023-02-01,GOLD RUM,6675.709999999998
2023-02-01,IMPORTED BRANDIES,18477.41
2023-02-01,IMPORTED CORDIALS & LIQUEURS,25832.57000000001
2023-02-01,IMPORTED DISTILLED SPIRITS SPECIALTY,23420.940000000002
2023-02-01,IMPORTED DRY GINS,11572.840000000002
2023-02-01,IMPORTED FLAVORED VODKA,14278.28
2023-02-01,IMPORTED SCHNAPPS,23603.830000000005
2023-02-01,IMPORTED VODKAS,56374.95999999999
2023-02-01,IRISH WHISKIES,30336.760000000006
2023-02-01,MEZCAL,790.95
2023-02-01,MIXTO TEQUILA,44652.590000000004
2023-02-01,NEUTRAL GRAIN SPIRITS,1771.0500000000002
2023-02-01,NEUTRAL GRAIN SPIRITS FLAVORED,7274.2999999999965
2023-02-01,SCOTCH WHISKIES,14661.06
2023-02-01,SINGLE BARREL BOURBON WHISKIES,1794.0
2023-02-01,SINGLE MALT SCOTCH,4554.0
2023-02-01,SPECIAL ORDER ITEMS,12512.399999999998
2023-02-01,SPICED RUM,84430.86000000002
2023-02-01,STRAIGHT BOURBON WHISKIES,100771.82
2023-02-01,STRAIGHT RYE WHISKIES,7953.069999999999
2023-02-01,TEMPORARY & SPECIALTY PACKAGES,9342.740000000003
2023-02-01,TENNESSEE WHISKIES,39481.13999999999
2023-02-01,TRIPLE SEC,14423.75
2023-02-01,WHISKEY LIQUEUR,75072.06999999999
2023-02-01,WHITE RUM,39238.31
2023-03-01,100% AGAVE TEQUILA,50371.39
2023-03-01,AGED DARK RUM,3027.25
2023-03-01,AMERICAN BRANDIES,32628.480000000003
2023-03-01,AMERICAN CORDIALS & LIQUEURS,16258.549999999996
2023-03-01,AMERICAN DISTILLED SPIRITS SPECIALTY,5191.299999999998
2023-03-01,AMERICAN DRY GINS,22447.759999999995
2023-03-01,AMERICAN FLAVORED VODKA,64459.61000000001
2023-03-01,AMERICAN SCHNAPPS,41869.429999999986
2023-03-01,AMERICAN SLOE GINS,228.0
2023-03-01,AMERICAN VODKAS,486758.07000000007
2023-03-01,BLENDED WHISKIES,62095.62999999997
2023-03-01,BOTTLED IN BOND BOURBON,3145.25
2023-03-01,CANADIAN WHISKIES,209398.16999999993
2023-03-01,COCKTAILS/RTD,73303.28000000003
2023-03-01,COFFEE LIQUEURS,6234.72
2023-03-01,CORN WHISKIES,578.58
2023-03-01,CREAM LIQUEURS,26259.599999999995
2023-03-01,FLAVORED GIN,1958.55
2023-03-01,FLAVORED RUM,41979.59
2023-03-01,GOLD RUM,6956.660000000002
2023-03-01,IMPORTED BRANDIES,20756.49
2023-03-01,IMPORTED CORDIALS & LIQUEURS,33710.57000000001
2023-03-01,IMPORTED DISTILLED SPIRITS SPECIALTY,34693.66
2023-03-01,IMPORTED DRY GINS,15276.5
Query:
-- 5. Get total sales volume per month over the last 24 months
SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY sales_month
ORDER BY sales_month
Answer:
SALES_MONTH,TOTAL_MONTHLY_VOLUME_LITERS
2023-01-01,785160.3699999998
2023-02-01,1770074.8800000004
2023-03-01,2014654.9399999997
2023-04-01,1791898.3700000006
2023-05-01,2185563.0700000003
2023-06-01,2218165.1200000006
2023-07-01,1867670.4299999995
2023-08-01,2128266.5500000007
2023-09-01,1880754.6500000008
2023-10-01,2036159.2400000002
2023-11-01,2060220.9799999997
2023-12-01,2029585.8800000004
2024-01-01,1757426.22
2024-02-01,1833717.6700000002
2024-03-01,1806155.8899999994
2024-04-01,1945657.3199999996
2024-05-01,2082952.6400000004
2024-06-01,1924118.6600000004
2024-07-01,1969592.4099999995
2024-08-01,1951273.95
2024-09-01,1790693.4100000001
Query:
-- 6. Get average monthly sales volume per category over the last 24 months
SELECT "category_name", AVG(monthly_volume) AS average_monthly_volume_liters
FROM (
  SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS monthly_volume
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY "category_name", sales_month
) sub
GROUP BY "category_name"
Answer:
category_name,AVERAGE_MONTHLY_VOLUME_LITERS
COFFEE LIQUEURS,6428.946190476192
COCKTAILS/RTD,76212.14904761904
CREAM LIQUEURS,24992.730952380956
SPECIAL ORDER ITEMS,12438.324761904758
IMPORTED FLAVORED VODKA,16139.621904761907
NEUTRAL GRAIN SPIRITS FLAVORED,8537.92380952381
TENNESSEE WHISKIES,41665.037142857145
IRISH WHISKIES,23213.154761904763
100% AGAVE TEQUILA,63713.14952380953
SINGLE BARREL BOURBON WHISKIES,3166.75
SCOTCH WHISKIES,16147.459523809524
IMPORTED VODKAS,58858.52952380952
IMPORTED DRY GINS,16022.276666666668
AMERICAN FLAVORED VODKA,59730.33761904761
AGED DARK RUM,3040.5119047619046
IMPORTED CORDIALS & LIQUEURS,30793.46952380953
FLAVORED RUM,38731.78047619048
IMPORTED SCHNAPPS,24483.80666666667
WHISKEY LIQUEUR,86684.33714285714
BOTTLED IN BOND BOURBON,3000.2285714285717
SINGLE MALT SCOTCH,4455.157142857142
FLAVORED GIN,2596.802380952381
MIXTO TEQUILA,49246.8761904762
MEZCAL,925.202380952381
AMERICAN DISTILLED SPIRITS SPECIALTY,5117.410952380953
CORN WHISKIES,447.6895238095237
SPICED RUM,112173.20857142856
AMERICAN BRANDIES,29059.17095238095
CANADIAN WHISKIES,234333.27095238096
BLENDED WHISKIES,54867.25761904762
AMERICAN SCHNAPPS,36555.73095238096
AMERICAN SLOE GINS,244.25
AMERICAN CORDIALS & LIQUEURS,14585.632857142857
AMERICAN DRY GINS,23383.57
AMERICAN VODKAS,467933.86238095234
TRIPLE SEC,16767.619047619046
IMPORTED DISTILLED SPIRITS SPECIALTY,25044.122857142855
GOLD RUM,6493.231904761906
WHITE RUM,40128.4338095238
IMPORTED BRANDIES,17106.928571428572
STRAIGHT RYE WHISKIES,7984.011904761905
STRAIGHT BOURBON WHISKIES,109329.85523809523
TEMPORARY & SPECIALTY PACKAGES,21499.275714285715
NEUTRAL GRAIN SPIRITS,2376.266666666667
Query:
-- 7. Get categories that contribute at least 1% to the total sales volume over the last 24 months
SELECT "category_name", (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 AS percentage_contribution
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES, (
  SELECT SUM("volume_sold_liters") AS total_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
) total_volume
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", total_volume.total_volume_liters
HAVING (SUM("volume_sold_liters") / total_volume.total_volume_liters) * 100 >= 1
Answer:
category_name,PERCENTAGE_CONTRIBUTION
100% AGAVE TEQUILA,3.3592370402940395
MIXTO TEQUILA,2.5965115812709962
WHISKEY LIQUEUR,4.5703789299382125
IRISH WHISKIES,1.2238994600184987
IMPORTED DISTILLED SPIRITS SPECIALTY,1.32043613872753
IMPORTED CORDIALS & LIQUEURS,1.6235669433495854
IMPORTED SCHNAPPS,1.2908938085273771
AMERICAN SCHNAPPS,1.9273786709346614
TEMPORARY & SPECIALTY PACKAGES,1.133536230098524
BLENDED WHISKIES,2.892842772187596
STRAIGHT BOURBON WHISKIES,5.764350092103799
WHITE RUM,2.1157472551496608
IMPORTED VODKAS,3.10328015474629
AMERICAN VODKAS,24.671528164378856
TENNESSEE WHISKIES,2.1967637309031263
CREAM LIQUEURS,1.3177265318200433
COCKTAILS/RTD,4.0182391847620025
AMERICAN FLAVORED VODKA,3.149245706087579
CANADIAN WHISKIES,12.355079123224447
SPICED RUM,5.914264166472506
FLAVORED RUM,2.042109557989043
AMERICAN BRANDIES,1.5321271064616804
AMERICAN DRY GINS,1.2328844997523476
Query:
-- 8. Get monthly sales percentages per category over the last 24 months
SELECT t.sales_month, t."category_name", (t.monthly_volume_liters / m.total_monthly_volume_liters) * 100 AS sales_percentage
FROM (
  SELECT DATE_TRUNC('month', "date") AS sales_month, "category_name", SUM("volume_sold_liters") AS monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month, "category_name"
) t
JOIN (
  SELECT DATE_TRUNC('month', "date") AS sales_month, SUM("volume_sold_liters") AS total_monthly_volume_liters
  FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
  WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
  GROUP BY sales_month
) m
ON t.sales_month = m.sales_month
ORDER BY t.sales_month, t."category_name"
Answer:
Too long, hard cut:
SALES_MONTH,category_name,SALES_PERCENTAGE
2023-01-01,100% AGAVE TEQUILA,3.0211063760133476
2023-01-01,AGED DARK RUM,0.22632319050947514
2023-01-01,AMERICAN BRANDIES,1.800893236626296
2023-01-01,AMERICAN CORDIALS & LIQUEURS,0.8668929635355893
2023-01-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.4047198663376248
2023-01-01,AMERICAN DRY GINS,1.269441298979468
2023-01-01,AMERICAN FLAVORED VODKA,3.267636903273657
2023-01-01,AMERICAN SCHNAPPS,2.1652531953440293
2023-01-01,AMERICAN SLOE GINS,0.023179977868725086
2023-01-01,AMERICAN VODKAS,23.559656990838697
2023-01-01,BLENDED WHISKIES,3.293111953676419
2023-01-01,BOTTLED IN BOND BOURBON,0.18387963213171343
2023-01-01,CANADIAN WHISKIES,11.341266498205963
2023-01-01,COCKTAILS/RTD,3.303221990177624
2023-01-01,COFFEE LIQUEURS,0.4974385041873675
2023-01-01,CORN WHISKIES,0.034482127517464996
2023-01-01,CREAM LIQUEURS,1.539274072123636
2023-01-01,FLAVORED GIN,0.10593377248523128
2023-01-01,FLAVORED RUM,2.218097176758934
2023-01-01,GOLD RUM,0.4133805174094561
2023-01-01,IMPORTED BRANDIES,0.8211940192549455
2023-01-01,IMPORTED CORDIALS & LIQUEURS,1.6585070385047584
2023-01-01,IMPORTED DISTILLED SPIRITS SPECIALTY,0.7743309815802344
2023-01-01,IMPORTED DRY GINS,0.6966640458432715
2023-01-01,IMPORTED FLAVORED VODKA,0.943830112057235
2023-01-01,IMPORTED SCHNAPPS,1.358457508496003
2023-01-01,IMPORTED VODKAS,2.717806554602341
2023-01-01,IRISH WHISKIES,1.2252961773911233
2023-01-01,MEZCAL,0.04218246522044916
2023-01-01,MIXTO TEQUILA,2.2822585913244713
2023-01-01,NEUTRAL GRAIN SPIRITS,0.12860430029090744
2023-01-01,NEUTRAL GRAIN SPIRITS FLAVORED,0.44355906551931545
2023-01-01,SCOTCH WHISKIES,0.9085022974351088
2023-01-01,SINGLE BARREL BOURBON WHISKIES,0.19868552458907215
2023-01-01,SINGLE MALT SCOTCH,0.2703842528374171
2023-01-01,SPECIAL ORDER ITEMS,1.6460013130820648
2023-01-01,SPICED RUM,6.511109316431753
2023-01-01,STRAIGHT BOURBON WHISKIES,6.226270691680477
2023-01-01,STRAIGHT RYE WHISKIES,0.47092035478051447
2023-01-01,TEMPORARY & SPECIALTY PACKAGES,0.7976141230867271
2023-01-01,TENNESSEE WHISKIES,2.124451339794443
2023-01-01,TRIPLE SEC,0.8169031760989159
2023-01-01,WHISKEY LIQUEUR,5.399383567970962
2023-01-01,WHITE RUM,2.001892938126769
2023-02-01,100% AGAVE TEQUILA,2.998934711733778
2023-02-01,AGED DARK RUM,0.15798201712234908
2023-02-01,AMERICAN BRANDIES,1.6138616689481522
2023-02-01,AMERICAN CORDIALS & LIQUEURS,0.7664223786962054
2023-02-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.3112099980764656
2023-02-01,AMERICAN DRY GINS,1.3901948600050187
2023-02-01,AMERICAN FLAVORED VODKA,3.0885506945333288
2023-02-01,AMERICAN SCHNAPPS,1.9496694964678554
2023-02-01,AMERICAN SLOE GINS,0.015197097198509476
2023-02-01,AMERICAN VODKAS,23.72347321261346
2023-02-01,BLENDED WHISKIES,2.852709259395851
2023-02-01,BOTTLED IN BOND BOURBON,0.14466902100774404
2023-02-01,CANADIAN WHISKIES,16.51818255281946
2023-02-01,COCKTAILS/RTD,3.1343374580853887
2023-02-01,COFFEE LIQUEURS,0.32151464688318726
2023-02-01,CORN WHISKIES,0.02641639657639794
2023-02-01,CREAM LIQUEURS,1.2197280603179905
2023-02-01,FLAVORED GIN,0.0880386483988745
2023-02-01,FLAVORED RUM,1.8670944587383782
2023-02-01,GOLD RUM,0.3771428020039468
2023-02-01,IMPORTED BRANDIES,1.0438773076085908
2023-02-01,IMPORTED CORDIALS & LIQUEURS,1.4594054913654273
2023-02-01,IMPORTED DISTILLED SPIRITS SPECIALTY,1.3231609727154594
2023-02-01,IMPORTED DRY GINS,0.6538051090810351
2023-02-01,IMPORTED FLAVORED VODKA,0.8066483605484531
2023-02-01,IMPORTED SCHNAPPS,1.333493303966892
2023-02-01,IMPORTED VODKAS,3.1848912516062597
2023-02-01,IRISH WHISKIES,1.7138687375756672
2023-02-01,MEZCAL,0.04468455029427908
2023-02-01,MIXTO TEQUILA,2.5226384773055472
2023-02-01,NEUTRAL GRAIN SPIRITS,0.10005508919487065
2023-02-01,NEUTRAL GRAIN SPIRITS FLAVORED,0.4109600154316635
2023-02-01,SCOTCH WHISKIES,0.8282734343984364
2023-02-01,SINGLE BARREL BOURBON WHISKIES,0.10135164451347957
2023-02-01,SINGLE MALT SCOTCH,0.2572772514572942
2023-02-01,SPECIAL ORDER ITEMS,0.7068853493926764
2023-02-01,SPICED RUM,4.769903293582698
2023-02-01,STRAIGHT BOURBON WHISKIES,5.6930823175119
2023-02-01,STRAIGHT RYE WHISKIES,0.4493069807306682
2023-02-01,TEMPORARY & SPECIALTY PACKAGES,0.5278160887747302
2023-02-01,TENNESSEE WHISKIES,2.2304785207730875
2023-02-01,TRIPLE SEC,0.8148666569405244
2023-02-01,WHISKEY LIQUEUR,4.24118046350672
2023-02-01,WHITE RUM,2.216759892101287
2023-03-01,100% AGAVE TEQUILA,2.5002490004566242
2023-03-01,AGED DARK RUM,0.15026146363307255
2023-03-01,AMERICAN BRANDIES,1.6195567465265286
2023-03-01,AMERICAN CORDIALS & LIQUEURS,0.8070141281861395
2023-03-01,AMERICAN DISTILLED SPIRITS SPECIALTY,0.2576768803892541
2023-03-01,AMERICAN DRY GINS,1.1142235602886912
2023-03-01,AMERICAN FLAVORED VODKA,3.199535995975569
2023-03-01,AMERICAN SCHNAPPS,2.078243235042522
2023-03-01,AMERICAN SLOE GINS,0.011317074476287239
2023-03-01,AMERICAN VODKAS,24.160865482999284
2023-03-01,BLENDED WHISKIES,3.0821967954472633
2023-03-01,BOTTLED IN BOND BOURBON,0.15611854603746683
2023-03-01,CANAD
Query:
-- 9. Get the number of records per category over the last 24 months
SELECT "category_name", COUNT(*) AS record_count
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Answer:
category_name,RECORD_COUNT
COFFEE LIQUEURS,18731
COCKTAILS/RTD,140930
CREAM LIQUEURS,81495
SPECIAL ORDER ITEMS,4144
NEUTRAL GRAIN SPIRITS FLAVORED,69838
IMPORTED FLAVORED VODKA,52584
IRISH WHISKIES,55570
TENNESSEE WHISKIES,129975
100% AGAVE TEQUILA,228002
SINGLE BARREL BOURBON WHISKIES,12116
SCOTCH WHISKIES,51806
IMPORTED VODKAS,98635
IMPORTED DRY GINS,41782
AMERICAN FLAVORED VODKA,213517
AGED DARK RUM,12932
IMPORTED CORDIALS & LIQUEURS,99024
FLAVORED RUM,88027
IMPORTED SCHNAPPS,57541
WHISKEY LIQUEUR,282450
SINGLE MALT SCOTCH,28110
BOTTLED IN BOND BOURBON,15222
FLAVORED GIN,8450
MIXTO TEQUILA,97130
MEZCAL,5037
AMERICAN DISTILLED SPIRITS SPECIALTY,16667
SPICED RUM,167582
CORN WHISKIES,2156
CANADIAN WHISKIES,428682
AMERICAN BRANDIES,96123
BLENDED WHISKIES,152590
AMERICAN SCHNAPPS,145302
AMERICAN CORDIALS & LIQUEURS,105533
AMERICAN SLOE GINS,973
AMERICAN DRY GINS,56339
AMERICAN VODKAS,694524
TRIPLE SEC,14436
IMPORTED DISTILLED SPIRITS SPECIALTY,13533
GOLD RUM,18437
WHITE RUM,74454
IMPORTED BRANDIES,68510
STRAIGHT BOURBON WHISKIES,343826
STRAIGHT RYE WHISKIES,35322
TEMPORARY & SPECIALTY PACKAGES,93405
NEUTRAL GRAIN SPIRITS,8137
Query:
-- 10. Get total sales in dollars per category over the last 24 months
SELECT "category_name", SUM("sale_dollars") AS total_sales_dollars
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name"
Answer:
category_name,TOTAL_SALES_DOLLARS
COFFEE LIQUEURS,3428062.8100000005
COCKTAILS/RTD,14257094.760000002
CREAM LIQUEURS,12665351.35
SPECIAL ORDER ITEMS,2250048.730000001
NEUTRAL GRAIN SPIRITS FLAVORED,5904044.789999999
IMPORTED FLAVORED VODKA,7467776.369999999
IRISH WHISKIES,16384050.310000002
TENNESSEE WHISKIES,28363478.37
100% AGAVE TEQUILA,56781176.47
SINGLE BARREL BOURBON WHISKIES,3663003.83
SCOTCH WHISKIES,9272660.36
IMPORTED VODKAS,20143481.090000004
IMPORTED DRY GINS,9111249.249999998
AMERICAN FLAVORED VODKA,20105492.139999997
AGED DARK RUM,1698202.87
FLAVORED RUM,13554614.770000003
IMPORTED CORDIALS & LIQUEURS,20829965.02
IMPORTED SCHNAPPS,10195782.090000002
WHISKEY LIQUEUR,44936647.390000015
BOTTLED IN BOND BOURBON,2225459.6599999997
SINGLE MALT SCOTCH,6706807.279999998
FLAVORED GIN,1855294.0800000003
MIXTO TEQUILA,19363919.47
MEZCAL,864461.3700000001
AMERICAN DISTILLED SPIRITS SPECIALTY,3191339.7600000002
SPICED RUM,37732727.449999996
CORN WHISKIES,348747.41000000003
CANADIAN WHISKIES,84879706.84999996
AMERICAN BRANDIES,7799939.15
BLENDED WHISKIES,18533851.619999997
AMERICAN SCHNAPPS,12620932.629999999
AMERICAN CORDIALS & LIQUEURS,7422863.199999998
AMERICAN SLOE GINS,43891.770000000004
AMERICAN DRY GINS,5628449.000000003
AMERICAN VODKAS,114640002.38999999
IMPORTED DISTILLED SPIRITS SPECIALTY,4568133.669999999
TRIPLE SEC,1472906.4099999997
GOLD RUM,1718273.23
WHITE RUM,9837199.780000001
IMPORTED BRANDIES,17900014.80000001
STRAIGHT BOURBON WHISKIES,65615085.90999999
STRAIGHT RYE WHISKIES,7021560.750000002
TEMPORARY & SPECIALTY PACKAGES,17573616.599999998
NEUTRAL GRAIN SPIRITS,940443.3299999995
Query:
-- 11. Get the list of months in the dataset over the last 24 months
SELECT DISTINCT DATE_TRUNC('month', "date") AS sales_month
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
ORDER BY sales_month
Answer:
SALES_MONTH
2023-01-01
2023-02-01
2023-03-01
2023-04-01
2023-05-01
2023-06-01
2023-07-01
2023-08-01
2023-09-01
2023-10-01
2023-11-01
2023-12-01
2024-01-01
2024-02-01
2024-03-01
2024-04-01
2024-05-01
2024-06-01
2024-07-01
2024-08-01
2024-09-01
Query:
-- 12. Get average sales volume per category per month over the last 24 months
SELECT "category_name", DATE_TRUNC('month', "date") AS sales_month, AVG("volume_sold_liters") AS average_volume_liters
FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
GROUP BY "category_name", sales_month
ORDER BY "category_name", sales_month
Answer:
Too long, hard cut:
category_name,SALES_MONTH,AVERAGE_VOLUME_LITERS
100% AGAVE TEQUILA,2023-01-01,5.7883186920449
100% AGAVE TEQUILA,2023-02-01,6.411037439613528
100% AGAVE TEQUILA,2023-03-01,5.13260546158549
100% AGAVE TEQUILA,2023-04-01,6.343638177236455
100% AGAVE TEQUILA,2023-05-01,6.298545647558387
100% AGAVE TEQUILA,2023-06-01,6.200162544169614
100% AGAVE TEQUILA,2023-07-01,5.586109862447181
100% AGAVE TEQUILA,2023-08-01,6.138334044915037
100% AGAVE TEQUILA,2023-09-01,6.202953486159993
100% AGAVE TEQUILA,2023-10-01,5.71651574074074
100% AGAVE TEQUILA,2023-11-01,5.3669946684126835
100% AGAVE TEQUILA,2023-12-01,5.919297116590055
100% AGAVE TEQUILA,2024-01-01,5.0661943002644225
100% AGAVE TEQUILA,2024-02-01,5.897208261945554
100% AGAVE TEQUILA,2024-03-01,5.313464388027264
100% AGAVE TEQUILA,2024-04-01,6.461096505823626
100% AGAVE TEQUILA,2024-05-01,5.7435201010626455
100% AGAVE TEQUILA,2024-06-01,6.259495194249254
100% AGAVE TEQUILA,2024-07-01,5.775129661644851
100% AGAVE TEQUILA,2024-08-01,5.569443155452436
100% AGAVE TEQUILA,2024-09-01,5.863935293063274
AGED DARK RUM,2023-01-01,5.048295454545454
AGED DARK RUM,2023-02-01,5.316349809885931
AGED DARK RUM,2023-03-01,4.722698907956318
AGED DARK RUM,2023-04-01,5.095656192236599
AGED DARK RUM,2023-05-01,5.108372456964006
AGED DARK RUM,2023-06-01,5.1888386123680235
AGED DARK RUM,2023-07-01,5.1618819776714515
AGED DARK RUM,2023-08-01,4.94620253164557
AGED DARK RUM,2023-09-01,4.832230623818526
AGED DARK RUM,2023-10-01,5.538142620232173
AGED DARK RUM,2023-11-01,4.8261024182076815
AGED DARK RUM,2023-12-01,4.873705408515535
AGED DARK RUM,2024-01-01,3.99185667752443
AGED DARK RUM,2024-02-01,4.822042139384116
AGED DARK RUM,2024-03-01,5.815630397236615
AGED DARK RUM,2024-04-01,4.552479338842975
AGED DARK RUM,2024-05-01,4.947869101978691
AGED DARK RUM,2024-06-01,4.777917981072555
AGED DARK RUM,2024-07-01,5.021198830409356
AGED DARK RUM,2024-08-01,4.368055555555555
AGED DARK RUM,2024-09-01,4.904545454545454
AMERICAN BRANDIES,2023-01-01,5.874491067719153
AMERICAN BRANDIES,2023-02-01,5.936525353283458
AMERICAN BRANDIES,2023-03-01,6.140097854723371
AMERICAN BRANDIES,2023-04-01,6.467758231844834
AMERICAN BRANDIES,2023-05-01,6.304408408408409
AMERICAN BRANDIES,2023-06-01,6.224836131095124
AMERICAN BRANDIES,2023-07-01,6.161615551799084
AMERICAN BRANDIES,2023-08-01,6.286965738758031
AMERICAN BRANDIES,2023-09-01,6.462167848699765
AMERICAN BRANDIES,2023-10-01,6.444595833333337
AMERICAN BRANDIES,2023-11-01,6.455529169783096
AMERICAN BRANDIES,2023-12-01,6.322208904109587
AMERICAN BRANDIES,2024-01-01,6.546884469696969
AMERICAN BRANDIES,2024-02-01,6.232660022148394
AMERICAN BRANDIES,2024-03-01,6.627505854800939
AMERICAN BRANDIES,2024-04-01,6.4079341383095505
AMERICAN BRANDIES,2024-05-01,6.487855263157897
AMERICAN BRANDIES,2024-06-01,6.441729341317364
AMERICAN BRANDIES,2024-07-01,6.423715984450036
AMERICAN BRANDIES,2024-08-01,6.377374100719426
AMERICAN BRANDIES,2024-09-01,6.534451536643025
AMERICAN CORDIALS & LIQUEURS,2023-01-01,2.9050362782757144
AMERICAN CORDIALS & LIQUEURS,2023-02-01,2.925021561017679
AMERICAN CORDIALS & LIQUEURS,2023-03-01,2.872535335689046
AMERICAN CORDIALS & LIQUEURS,2023-04-01,2.874632443531828
AMERICAN CORDIALS & LIQUEURS,2023-05-01,2.7952870537917427
AMERICAN CORDIALS & LIQUEURS,2023-06-01,2.8557753647777413
AMERICAN CORDIALS & LIQUEURS,2023-07-01,2.6348387694588586
AMERICAN CORDIALS & LIQUEURS,2023-08-01,2.7331157817109144
AMERICAN CORDIALS & LIQUEURS,2023-09-01,2.991840806693842
AMERICAN CORDIALS & LIQUEURS,2023-10-01,2.8438706525986714
AMERICAN CORDIALS & LIQUEURS,2023-11-01,3.1749458417477503
AMERICAN CORDIALS & LIQUEURS,2023-12-01,3.505404937883315
AMERICAN CORDIALS & LIQUEURS,2024-01-01,2.952664595067003
AMERICAN CORDIALS & LIQUEURS,2024-02-01,2.9883203661327236
AMERICAN CORDIALS & LIQUEURS,2024-03-01,3.171422523285352
AMERICAN CORDIALS & LIQUEURS,2024-04-01,2.852561023622047
AMERICAN CORDIALS & LIQUEURS,2024-05-01,2.720218949044586
AMERICAN CORDIALS & LIQUEURS,2024-06-01,2.986811872731155
AMERICAN CORDIALS & LIQUEURS,2024-07-01,2.647127155580823
AMERICAN CORDIALS & LIQUEURS,2024-08-01,2.7290811258278147
AMERICAN CORDIALS & LIQUEURS,2024-09-01,2.7018557158712544
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-01-01,6.746709129511678
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-02-01,6.999555273189327
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-03-01,5.806823266219239
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-04-01,7.475464190981432
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-05-01,5.233262486716261
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-06-01,5.903291384317521
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-07-01,6.024385964912282
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-08-01,5.107396449704143
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-09-01,8.182189973614776
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-10-01,8.599617346938777
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-11-01,6.1125000000000025
AMERICAN DISTILLED SPIRITS SPECIALTY,2023-12-01,6.3128773584905655
AMERICAN DISTILLED SPIRITS SPEC
End Exploring Related Columns
Task: Which two liquor categories, each contributing an average of at least 1% to monthly sales volume over 24 months, have the lowest Pearson correlation coefficient in their sales percentages?

Please answer only one complete SQL in snowflake dialect in ```sql``` format.
Usage example: SELECT S."Column_Name" FROM {Database Name}.{Schema Name}.{Table_name} (ensure all column names are enclosed in double quotations)
Follow the answer format like: ```csv
Category_1,Category_2
Vodka,Brandy
```

**Explanation:** Vodka and Brandy are two liquor categories that each contributed an average of at least 1% to the monthly sales volume over the past 24 months. Their sales percentages have the lowest Pearson correlation coefficient among such categories, indicating that their sales trends are not closely related. This low correlation suggests that when Vodka sales percentages increase, Brandy sales percentages do not necessarily follow the same trend, and vice versa..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'IOWA_LIQUOR_SALES': {'IOWA_LIQUOR_SALES': ['SALES']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book" SQL: WHERE "title" LIKE '%book%'
However, if the string is not decided, you may use ILIKE and %. e.g. Get articles that mention "education": SQL: "body" ILIKE '%education%' OR "title" ILIKE '%education%'
When using ORDER BY xxx DESC, add NULLS LAST to exclude null records: ORDER BY xxx DESC NULLS LAST.
Keep all decimals to four decimal places.

2025-01-18 09:51:06 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-18 09:51:06 - root - INFO - ```sql
WITH monthly_total AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           SUM("volume_sold_liters") AS total_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month
),
category_monthly_volume AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           "category_name",
           SUM("volume_sold_liters") AS category_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month, "category_name"
),
category_monthly_percentage AS (
    SELECT cm.sales_month,
           cm."category_name",
           (cm.category_volume_liters / mt.total_volume_liters) * 100 AS sales_percentage
    FROM category_monthly_volume cm
    JOIN monthly_total mt ON cm.sales_month = mt.sales_month
),
category_average_percentage AS (
    SELECT "category_name",
           AVG(sales_percentage) AS avg_sales_percentage
    FROM category_monthly_percentage
    GROUP BY "category_name"
),
selected_categories AS (
    SELECT "category_name"
    FROM category_average_percentage
    WHERE avg_sales_percentage >= 1
),
selected_category_data AS (
    SELECT cmp.sales_month,
           cmp."category_name",
           cmp.sales_percentage
    FROM category_monthly_percentage cmp
    JOIN selected_categories sc ON cmp."category_name" = sc."category_name"
),
category_pairs AS (
    SELECT c1."category_name" AS category1,
           c2."category_name" AS category2
    FROM selected_categories c1
    JOIN selected_categories c2
        ON c1."category_name" < c2."category_name"
),
correlations AS (
    SELECT cp.category1,
           cp.category2,
           CORR(sc1.sales_percentage, sc2.sales_percentage) AS correlation_coefficient
    FROM category_pairs cp
    JOIN selected_category_data sc1 ON sc1."category_name" = cp.category1
    JOIN selected_category_data sc2 ON sc2."category_name" = cp.category2 AND sc1.sales_month = sc2.sales_month
    GROUP BY cp.category1, cp.category2
)
SELECT category1 AS Category_1,
       category2 AS Category_2
FROM correlations
ORDER BY correlation_coefficient ASC NULLS LAST
LIMIT 1;
```
2025-01-18 09:51:06 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:51:06 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:51:06 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:51:08 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-18 09:51:08 - snowflake.connector.connection - INFO - closed
2025-01-18 09:51:08 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:51:08 - root - INFO - itercount: 1
2025-01-18 09:51:08 - root - INFO - 0
2025-01-18 09:51:08 - root - INFO - results: 
CATEGORY_1,CATEGORY_2
CREAM LIQUEURS,WHITE RUM


2025-01-18 09:51:08 - root - INFO - Please check the answer again by reviewing Which two liquor categories, each contributing an average of at least 1% to monthly sales volume over 24 months, have the lowest Pearson correlation coefficient in their sales percentages?, reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: ```csv
Category_1,Category_2
Vodka,Brandy
```

**Explanation:** Vodka and Brandy are two liquor categories that each contributed an average of at least 1% to the monthly sales volume over the past 24 months. Their sales percentages have the lowest Pearson correlation coefficient among such categories, indicating that their sales trends are not closely related. This low correlation suggests that when Vodka sales percentages increase, Brandy sales percentages do not necessarily follow the same trend, and vice versa. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
CATEGORY_1,CATEGORY_2
CREAM LIQUEURS,WHITE RUM
Current sql:
WITH monthly_total AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           SUM("volume_sold_liters") AS total_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month
),
category_monthly_volume AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           "category_name",
           SUM("volume_sold_liters") AS category_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month, "category_name"
),
category_monthly_percentage AS (
    SELECT cm.sales_month,
           cm."category_name",
           (cm.category_volume_liters / mt.total_volume_liters) * 100 AS sales_percentage
    FROM category_monthly_volume cm
    JOIN monthly_total mt ON cm.sales_month = mt.sales_month
),
category_average_percentage AS (
    SELECT "category_name",
           AVG(sales_percentage) AS avg_sales_percentage
    FROM category_monthly_percentage
    GROUP BY "category_name"
),
selected_categories AS (
    SELECT "category_name"
    FROM category_average_percentage
    WHERE avg_sales_percentage >= 1
),
selected_category_data AS (
    SELECT cmp.sales_month,
           cmp."category_name",
           cmp.sales_percentage
    FROM category_monthly_percentage cmp
    JOIN selected_categories sc ON cmp."category_name" = sc."category_name"
),
category_pairs AS (
    SELECT c1."category_name" AS category1,
           c2."category_name" AS category2
    FROM selected_categories c1
    JOIN selected_categories c2
        ON c1."category_name" < c2."category_name"
),
correlations AS (
    SELECT cp.category1,
           cp.category2,
           CORR(sc1.sales_percentage, sc2.sales_percentage) AS correlation_coefficient
    FROM category_pairs cp
    JOIN selected_category_data sc1 ON sc1."category_name" = cp.category1
    JOIN selected_category_data sc2 ON sc2."category_name" = cp.category2 AND sc1.sales_month = sc2.sales_month
    GROUP BY cp.category1, cp.category2
)
SELECT category1 AS Category_1,
       category2 AS Category_2
FROM correlations
ORDER BY correlation_coefficient ASC NULLS LAST
LIMIT 1;
2025-01-18 09:51:35 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-18 09:51:35 - root - INFO - ```sql
WITH monthly_total AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           SUM("volume_sold_liters") AS total_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month
),
category_monthly_volume AS (
    SELECT DATE_TRUNC('month', "date") AS sales_month,
           "category_name",
           SUM("volume_sold_liters") AS category_volume_liters
    FROM IOWA_LIQUOR_SALES.IOWA_LIQUOR_SALES.SALES
    WHERE "date" >= DATEADD(month, -24, CURRENT_DATE)
    GROUP BY sales_month, "category_name"
),
category_monthly_percentage AS (
    SELECT cm.sales_month,
           cm."category_name",
           (cm.category_volume_liters / mt.total_volume_liters) * 100 AS sales_percentage
    FROM category_monthly_volume cm
    JOIN monthly_total mt ON cm.sales_month = mt.sales_month
),
category_average_percentage AS (
    SELECT "category_name",
           AVG(sales_percentage) AS avg_sales_percentage
    FROM category_monthly_percentage
    GROUP BY "category_name"
),
selected_categories AS (
    SELECT "category_name"
    FROM category_average_percentage
    WHERE avg_sales_percentage >= 1
),
selected_category_data AS (
    SELECT cmp.sales_month,
           cmp."category_name",
           cmp.sales_percentage
    FROM category_monthly_percentage cmp
    JOIN selected_categories sc ON cmp."category_name" = sc."category_name"
),
category_pairs AS (
    SELECT c1."category_name" AS category1,
           c2."category_name" AS category2
    FROM selected_categories c1
    JOIN selected_categories c2
        ON c1."category_name" < c2."category_name"
),
correlations AS (
    SELECT cp.category1,
           cp.category2,
           CORR(sc1.sales_percentage, sc2.sales_percentage) AS correlation_coefficient
    FROM category_pairs cp
    JOIN selected_category_data sc1 ON sc1."category_name" = cp.category1
    JOIN selected_category_data sc2 ON sc2."category_name" = cp.category2 AND sc1.sales_month = sc2.sales_month
    GROUP BY cp.category1, cp.category2
)
SELECT category1 AS Category_1,
       category2 AS Category_2
FROM correlations
ORDER BY correlation_coefficient ASC NULLS LAST
LIMIT 1;
```
2025-01-18 09:51:35 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-18 09:51:35 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-18 09:51:35 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-18 09:51:36 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-18 09:51:36 - snowflake.connector.connection - INFO - closed
2025-01-18 09:51:36 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-18 09:51:37 - root - INFO - itercount: 2
2025-01-18 09:51:37 - root - INFO - 0
2025-01-18 09:51:37 - root - INFO - Total iteration counts: 2
