SELECT
    STUDENTS."StudLastName" AS "LastName",
    NTILE(5) OVER (ORDER BY STUDENT_SCHEDULES."Grade" DESC NULLS LAST) AS "GradeQuintileRank"
FROM
    SCHOOL_SCHEDULING.SCHOOL_SCHEDULING.STUDENT_SCHEDULES
JOIN
    SCHOOL_SCHEDULING.SCHOOL_SCHEDULING.CLASSES ON STUDENT_SCHEDULES."ClassID" = CLASSES."ClassID"
JOIN
    SCHOOL_SCHEDULING.SCHOOL_SCHEDULING.SUBJECTS ON CLASSES."SubjectID" = SUBJECTS."SubjectID"
JOIN
    SCHOOL_SCHEDULING.SCHOOL_SCHEDULING.STUDENTS ON STUDENT_SCHEDULES."StudentID" = STUDENTS."StudentID"
WHERE
    SUBJECTS."SubjectName" ILIKE '%English%'
    AND STUDENT_SCHEDULES."Grade" IS NOT NULL
ORDER BY
    "GradeQuintileRank" DESC,
    STUDENT_SCHEDULES."Grade" DESC NULLS LAST;