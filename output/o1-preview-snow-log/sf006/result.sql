WITH
  mar2020_counts AS (
    SELECT "STATE_ABBREVIATION",
           COUNT(*) AS "ActiveBranches_Mar2020"
    FROM "FINANCE__ECONOMICS"."CYBERSYN"."FINANCIAL_BRANCH_ENTITIES"
    WHERE "START_DATE" <= '2020-03-01'
      AND ("END_DATE" > '2020-03-01' OR "END_DATE" IS NULL)
      AND "STATE_ABBREVIATION" IS NOT NULL AND "STATE_ABBREVIATION" <> ''
    GROUP BY "STATE_ABBREVIATION"
  ),
  dec2021_counts AS (
    SELECT "STATE_ABBREVIATION",
           COUNT(*) AS "ActiveBranches_Dec2021"
    FROM "FINANCE__ECONOMICS"."CYBERSYN"."FINANCIAL_BRANCH_ENTITIES"
    WHERE "START_DATE" <= '2021-12-31'
      AND ("END_DATE" > '2021-12-31' OR "END_DATE" IS NULL)
      AND "STATE_ABBREVIATION" IS NOT NULL AND "STATE_ABBREVIATION" <> ''
    GROUP BY "STATE_ABBREVIATION"
  )
SELECT
  mar2020_counts."STATE_ABBREVIATION" AS "State",
  ROUND(
    (dec2021_counts."ActiveBranches_Dec2021" - mar2020_counts."ActiveBranches_Mar2020") * 100.0 /
    mar2020_counts."ActiveBranches_Mar2020", 4
  ) AS "PercentageChange"
FROM mar2020_counts
JOIN dec2021_counts
  ON mar2020_counts."STATE_ABBREVIATION" = dec2021_counts."STATE_ABBREVIATION"
ORDER BY "State";