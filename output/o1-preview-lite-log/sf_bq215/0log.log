2025-01-24 01:49:25 - openai._base_client - INFO - Retrying request to /chat/completions in 0.481920 seconds
2025-01-24 01:51:03 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:51:03 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:03 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:03 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:04 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:04 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:04 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:04 - root - INFO - SQL:
SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
Results:
publication_number
US-2006143594-A1
US-2006143284-A1
US-2006148139-A1
US-2006152123-A1
US-2006150698-A1
US-2005254871-A1
US-2005168584-A1
US-2005161997-A1
US-2005175186-A1
US-2006175765-A1
US-2005150005-A1
US-2006118954-A1
US-2005148066-A1
US-2006010011-A1
US-2006183586-A1
US-2005189252-A1
US-2005184759-A1
US-2005144256-A1
US-2006195821-A1
US-2005143653-A1
US-2006198380-A1
US-2006118870-A1
US-2005253263-A1
US-2006197375-A1
US-2005222693-A1
US-2005180450-A1
US-2006212456-A1
US-2005218642-A1
US-2005176269-A1
US-2006228959-A1
US-2006252404-A1
US-2006224211-A1
US-2006241817-A1
US-2005237771-A1
US-2005243216-A1
US-2005249541-A1
US-2006089219-A1
US-2005271201-A1
US-2005216965-A1
US-2005267909-A1
US-2006266770-A1
US-2005270599-A1
US-2006079895-A1
US-2005273202-A1
US-2006001866-A1
US-2006006761-A1
US-2006287882-A1
US-2005216567-A1
US-2006209512-A1
US-2006000939-A1
US-2006091163-A1
US-2007009364-A1
US-2006023254-A1
US-2005257319-A1
US-2007004239-A1
US-2006040365-A1
US-2005276065-A1
US-2007039052-A1
US-2006045302-A1
US-2006204424-A1
US-2007011371-A1
US-2007061140-A1
US-2006180497-A1
US-2007069906-A1
US-2006028190-A1
US-2006036325-A1
US-2006034112-A1
US-2007114474-A1
US-2006047060-A1
US-2006039234-A1
US-2006113251-A1
US-2006122815-A1
US-2007106350-A1
US-2006218841-A1
US-2006131931-A1
US-2007107149-A1
US-2006234529-A1
US-2006136397-A1
US-2006079849-A1
US-2006186294-A1
US-2006261821-A1
US-2006145963-A1
US-2006128522-A1
US-2006090877-A1
US-2007071085-A1
US-2007053149-A1
US-2007159350-A1
US-2006206019-A1
US-2006147574-A1
US-2006144602-A1
US-2006112201-A1
US-2006112495-A1
US-2006182055-A1
US-2007163684-A1
US-2007112592-A1
US-2006172276-A1
US-2006129939-A1
US-2006172084-A1
US-2006185810-A1
US-2007085071-A1

2025-01-24 01:51:04 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:04 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:04 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:06 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:06 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:06 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:06 - root - INFO - SQL:
SELECT "publication_number", "kind_code"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
Results:
publication_number,kind_code
US-2006143594-A1,A1
US-2006143284-A1,A1
US-2006148139-A1,A1
US-2006152123-A1,A1
US-2006150698-A1,A1
US-2005254871-A1,A1
US-2005168584-A1,A1
US-2005161997-A1,A1
US-2005175186-A1,A1
US-2006175765-A1,A1
US-2005150005-A1,A1
US-2006118954-A1,A1
US-2005148066-A1,A1
US-2006010011-A1,A1
US-2006183586-A1,A1
US-2005189252-A1,A1
US-2005184759-A1,A1
US-2005144256-A1,A1
US-2006195821-A1,A1
US-2005143653-A1,A1
US-2006198380-A1,A1
US-2006118870-A1,A1
US-2005253263-A1,A1
US-2006197375-A1,A1
US-2005222693-A1,A1
US-2005180450-A1,A1
US-2006212456-A1,A1
US-2005218642-A1,A1
US-2005176269-A1,A1
US-2006228959-A1,A1
US-2006252404-A1,A1
US-2006224211-A1,A1
US-2006241817-A1,A1
US-2005237771-A1,A1
US-2005243216-A1,A1
US-2005249541-A1,A1
US-2006089219-A1,A1
US-2005271201-A1,A1
US-2005216965-A1,A1
US-2005267909-A1,A1
US-2006266770-A1,A1
US-2005270599-A1,A1
US-2006079895-A1,A1
US-2005273202-A1,A1
US-2006001866-A1,A1
US-2006006761-A1,A1
US-2006287882-A1,A1
US-2005216567-A1,A1
US-2006209512-A1,A1
US-2006000939-A1,A1
US-2006091163-A1,A1
US-2007009364-A1,A1
US-2006023254-A1,A1
US-2005257319-A1,A1
US-2007004239-A1,A1
US-2006040365-A1,A1
US-2005276065-A1,A1
US-2007039052-A1,A1
US-2006045302-A1,A1
US-2006204424-A1,A1
US-2007011371-A1,A1
US-2007061140-A1,A1
US-2006180497-A1,A1
US-2007069906-A1,A1
US-2006028190-A1,A1
US-2006036325-A1,A1
US-2006034112-A1,A1
US-2007114474-A1,A1
US-2006047060-A1,A1
US-2006039234-A1,A1
US-2006113251-A1,A1
US-2006122815-A1,A1
US-2007106350-A1,A1
US-2006218841-A1,A1
US-2006131931-A1,A1
US-2007107149-A1,A1
US-2006234529-A1,A1
US-2006136397-A1,A1
US-2006079849-A1,A1
US-2006186294-A1,A1
US-2006261821-A1,A1
US-2006145963-A1,A1
US-2006128522-A1,A1
US-2006090877-A1,A1
US-2007071085-A1,A1
US-2007053149-A1,A1
US-2007159350-A1,A1
US-2006206019-A1,A1
US-2006147574-A1,A1
US-2006144602-A1,A1
US-2006112201-A1,A1
US-2006112495-A1,A1
US-2006182055-A1,A1
US-2007163684-A1,A1
US-2007112592-A1,A1
US-2006172276-A1,A1
US-2006129939-A1,A1
US-2006172084-A1,A1
US-2006185810-A1,A1
US-2007085071-A1,A1

2025-01-24 01:51:06 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:06 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:06 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:07 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:07 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:07 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:08 - root - INFO - SQL:
SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2'
    LIMIT 100;
Results:
publication_number
US-8857551-B2
US-9370027-B2
US-9042351-B2
US-10561638-B2
US-8962445-B2
US-9270639-B2
US-8938152-B2
US-9389656-B2
US-9482287-B2
US-9386020-B2
US-10142276-B2
US-9216545-B2
US-9548844-B2
US-9111730-B2
US-9340798-B2
US-10324723-B2
US-9190745-B2
US-9380603-B2
US-9650743-B2
US-10140934-B2
US-9556907-B2
US-9567200-B2
US-10722723-B2
US-9188941-B2
US-9048861-B2
US-9460689-B2
US-9318050-B2
US-10533556-B2
US-9520094-B2
US-9412846-B2
US-10070142-B2
US-9585927-B2
US-9415120-B2
US-10533291-B2
US-9329543-B2
US-10487804-B2
US-9502685-B2
US-9434993-B2
US-10120886-B2
US-9343259-B2
US-10025922-B2
US-10093135-B2
US-11058417-B2
US-10791626-B2
US-10040253-B2
US-10268050-B2
US-9595167-B2
US-9425382-B2
US-10292858-B2
US-10439992-B2
US-10463632-B2
US-10040372-B2
US-11043142-B2
US-10096317-B2
US-10620487-B2
US-9616746-B2
US-10132013-B2
US-10075410-B2
US-11055623-B2
US-10501667-B2
US-10614930-B2
US-11100138-B2
US-10294485-B2
US-10420148-B2
US-10192648-B2
US-10799929-B2
US-10132055-B2
US-10306558-B2
US-10266255-B2
US-11229607-B2
US-11099445-B2
US-10918669-B2
US-10104056-B2
US-10170592-B2
US-10949373-B2
US-10637868-B2
US-10828230-B2
US-10612778-B2
US-10891534-B2
US-10827186-B2
US-10798073-B2
US-10574908-B2
US-10199059-B2
US-10178137-B2
US-10377792-B2
US-10141686-B2
US-11154290-B2
US-10891268-B2
US-10141468-B2
US-10941196-B2
US-10543714-B2
US-10513055-B2
US-10968393-B2
US-10630153-B2
US-10418599-B2
US-10128451-B2
US-10150865-B2
US-10483008-B2
US-10619236-B2
US-10634183-B2

2025-01-24 01:51:08 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:08 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:08 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:09 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:09 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:09 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:09 - root - INFO - SQL:
SELECT "publication_number", "grant_date"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2' AND "grant_date" BETWEEN 20150101 AND 20181231
    LIMIT 100;
Results:
publication_number,grant_date
US-9370027-B2,20160614
US-9042351-B2,20150526
US-8962445-B2,20150224
US-9270639-B2,20160223
US-8938152-B2,20150120
US-9389656-B2,20160712
US-9482287-B2,20161101
US-9386020-B2,20160705
US-10142276-B2,20181127
US-9216545-B2,20151222
US-9548844-B2,20170117
US-9111730-B2,20150818
US-9340798-B2,20160517
US-9190745-B2,20151117
US-9380603-B2,20160628
US-9650743-B2,20170516
US-10140934-B2,20181127
US-9556907-B2,20170131
US-9567200-B2,20170214
US-9188941-B2,20151117
US-9048861-B2,20150602
US-9460689-B2,20161004
US-9318050-B2,20160419
US-9520094-B2,20161213
US-9412846-B2,20160809
US-10070142-B2,20180904
US-9585927-B2,20170307
US-9415120-B2,20160816
US-9329543-B2,20160503
US-9502685-B2,20161122
US-9434993-B2,20160906
US-10120886-B2,20181106
US-9343259-B2,20160517
US-10025922-B2,20180717
US-10093135-B2,20181009
US-10040253-B2,20180807
US-9595167-B2,20170314
US-9425382-B2,20160823
US-10040372-B2,20180807
US-10096317-B2,20181009
US-9616746-B2,20170411
US-10132013-B2,20181120
US-10075410-B2,20180911
US-10132055-B2,20181120
US-10104056-B2,20181016
US-10141686-B2,20181127
US-10141468-B2,20181127
US-10128451-B2,20181113
US-10150865-B2,20181211
US-10136240-B2,20181120
US-10021398-B2,20180710
US-10154644-B2,20181218
US-9028758-B2,20150512
US-9143515-B2,20150922
US-8967144-B2,20150303
US-9038000-B2,20150519
US-9144476-B2,20150929
US-8950264-B2,20150210
US-9169572-B2,20151027
US-9089610-B2,20150728
US-9106878-B2,20150811
US-9028530-B2,20150512
US-9329365-B2,20160503
US-9040017-B2,20150526
US-9505537-B2,20161129
US-8967952-B2,20150303
US-8966958-B2,20150303
US-9047835-B2,20150602
US-9009284-B2,20150414
US-9181436-B2,20151110
US-9152566-B2,20151006
US-9276150-B2,20160301
US-9002672-B2,20150407
US-9053245-B2,20150609
US-9309435-B2,20160412
US-8981843-B2,20150317
US-9004917-B2,20150414
US-9317982-B2,20160419
US-9150444-B2,20151006
US-9103795-B2,20150811
US-9083005-B2,20150714
US-9265617-B2,20160223
US-9157667-B2,20151013
US-9288612-B2,20160315
US-8957450-B2,20150217
US-8967362-B2,20150303
US-9438017-B2,20160906
US-9169941-B2,20151027
US-9466599-B2,20161011
US-9091060-B2,20150728
US-9087841-B2,20150721
US-9156164-B2,20151013
US-9256652-B2,20160209
US-9244073-B2,20160126
US-9316812-B2,20160419
US-9514786-B2,20161206
US-9449376-B2,20160920
US-8933415-B2,20150113
US-9469007-B2,20161018
US-9459437-B2,20161004

2025-01-24 01:51:09 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:09 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:09 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:11 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:11 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:11 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:11 - root - INFO - SQL:
SELECT "publication_number", "ipc"
    FROM PATENTS.PATENTS.PUBLICATIONS
    LIMIT 100;
Results:
Too long, hard cut:
publication_number,ipc
CR-5634-A,"[
  {
    ""code"": ""G01N21/01"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CR-5990-A,[]
FI-429-A,"[
  {
    ""code"": ""C10C1/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
HK-6083-A,"[
  {
    ""code"": ""H02M5/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
HU-T52763-A,"[
  {
    ""code"": ""A01N43/54"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""A01N47/36"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D239/47"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D521/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
JP-H03206829-A,"[
  {
    ""code"": ""A01K61/00"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""A01K63/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
JP-S62159089-A,"[
  {
    ""code"": ""G21C5/10"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""G21C1/02"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  }
]"
US-416-A,[]
US-2528225-A,"[
  {
    ""code"": ""E21B27/02"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A41580-A,"[
  {
    ""code"": ""B22D11/08"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A47682-A,"[
  {
    ""code"": ""C07D471/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D471/16"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A63682-A,"[
  {
    ""code"": ""G01N27/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-920790-A,"[
  {
    ""code"": ""C03C4/12"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-950907-A,"[
  {
    ""code"": ""C08K5/47"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M133/44"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D263/56"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D277/64"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/46"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M133/48"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/35"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C11B5/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10L1/14"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M135/36"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C09K15/30"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D235/12"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/3447"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-920830-A,"[
  {
    ""code"": ""E02D5/38"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D5/80"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D7/28"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D5/54"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D7/26"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-9086-A,[]
CH-3256-A,[]
CH-540255-A,"[
  {
    ""code"": ""C07D213/56"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/38"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/51"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/32"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/30"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CH-433637-A,[]
CH-8494-A,[]
CH-9587-A,[]
CH-9968-A,[]
DD-8297-A,[]
FR-1334211-A,"[
  {
    ""code"": ""C12H1/14"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
FR-1444995-A,"[
  {
    ""code"": ""C07F7/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
FR-1474468-A,"[
  {
    ""code"": ""G11B15/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""G11B15/62"",
    ""first"": false,
    ""inventive"": true,
    

2025-01-24 01:51:11 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:11 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:11 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:12 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:12 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:12 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:13 - root - INFO - SQL:
SELECT t."publication_number", ipc_u.value:"code"::STRING AS "ipc_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
Results:
publication_number,ipc_code
US-11883790-B2,B01J13/18
US-11883790-B2,C08F220/32
US-11883790-B2,C09D5/00
US-11883790-B2,C09D7/40
US-11883790-B2,C09D133/14
US-11883790-B2,F16L59/02
US-11883790-B2,G02B1/18
US-11530904-B2,F41H13/00
US-11492186-B2,B65D75/58
US-11492186-B2,B65D75/26
US-11492186-B2,B65D75/00
US-11492186-B2,B65D81/38
US-11459996-B2,F02P17/00
US-11459996-B2,G01R31/00
US-11459996-B2,H01H47/00
US-11459996-B2,H01F7/06
US-12058446-B2,H04N21/81
US-12058446-B2,H04N21/4402
US-12058446-B2,H04N21/2343
US-12058446-B2,G06T7/11
US-12058446-B2,H04N23/698
US-12032333-B2,G04B15/14
US-12032333-B2,G04B13/02
US-12032333-B2,G04B15/04
US-11203375-B2,B62D7/22
US-11203375-B2,B62D1/19
US-11203375-B2,F16F15/08
US-11142880-B2,E04B1/66
US-11142880-B2,E02D31/06
US-11142880-B2,B01D71/06
US-11142880-B2,E02D31/02
US-11530450-B2,C07H21/04
US-11530450-B2,C12Q1/6886
US-11530450-B2,C12Q1/6858
US-10899387-B2,B62D21/02
US-10899387-B2,B60R16/04
US-10912049-B2,H04W4/70
US-10912049-B2,H04W56/00
US-11702538-B2,C08L63/00
US-11702538-B2,C08G59/24
US-11702538-B2,C08L77/06
US-11702538-B2,C08L79/02
US-11702538-B2,C09J163/00
US-11702538-B2,C09J177/06
US-10782773-B2,G06F1/20
US-10782773-B2,G06F1/329
US-10782773-B2,H04W52/02
US-10782773-B2,H02J7/00
US-10782773-B2,G06F1/3212
US-10782773-B2,G06F1/324
US-11099035-B2,G01D5/20
US-11176945-B2,G10L15/07
US-11176945-B2,G16H40/63
US-11176945-B2,G16H10/60
US-11176945-B2,G16H40/20
US-11176945-B2,G10L15/26
US-11176945-B2,G06F3/16
US-11176945-B2,G06N20/00
US-11176945-B2,G10L17/22
US-11069158-B2,G07C5/08
US-11069158-B2,G07C5/00
US-11069158-B2,G05D1/00
US-11069158-B2,H04W4/80
US-11069158-B2,H04W4/02
US-11069158-B2,H04W4/029
US-11069158-B2,G06F1/20
US-11069158-B2,H04W4/40
US-10874919-B2,A63B1/00
US-10874919-B2,A63B60/00
US-10874919-B2,A63B60/54
US-10874919-B2,A63B53/04
US-10874919-B2,A63B60/02
US-11679559-B2,B29C64/135
US-11679559-B2,B33Y30/00
US-11679559-B2,B29C64/364
US-11679559-B2,B29C64/264
US-11191932-B2,A61M25/10
US-11191932-B2,B29C53/40
US-11191932-B2,B29K105/00
US-11191932-B2,B29C49/00
US-11191932-B2,B29L22/02
US-11191932-B2,B29C70/30
US-11191932-B2,B29C63/08
US-11062275-B2,G06Q30/06
US-11062275-B2,G06Q10/10
US-11062275-B2,G06Q10/00
US-11062275-B2,G06Q30/02
US-10938981-B2,G06N20/00
US-10938981-B2,H04M3/22
US-10938981-B2,H04M3/26
US-10938981-B2,G06N3/08
US-10955870-B2,E02F9/24
US-10955870-B2,G05G1/32
US-10955870-B2,F16P1/02
US-10955870-B2,F16P1/00
US-10955870-B2,G05G1/60
US-10955870-B2,G05G5/00
US-11184318-B2,H04L29/06
US-11184318-B2,G06F15/16
US-11184318-B2,H04L29/12

2025-01-24 01:51:13 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:13 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:13 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:14 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:14 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:14 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:15 - root - INFO - SQL:
SELECT t."publication_number", SUBSTR(ipc_u.value:"code"::STRING, 0, 4) AS "ipc4_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
Results:
publication_number,ipc4_code
DE-69427315-T2,C08J
DE-69427315-T2,C08L
DE-69611147-T2,E05B
DE-69611147-T2,E05B
DE-69614271-T2,A61K
DE-69614271-T2,C12N
DE-69614271-T2,C12Q
DE-69614271-T2,C07K
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,C07K
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,C12N
DE-69614271-T2,A61K
DE-69614271-T2,C12P
DE-69630331-T2,H04L
DE-69630331-T2,G06F
DE-69636755-T2,C12N
DE-69636755-T2,G01N
DE-69636755-T2,C12R
DE-69636755-T2,C12N
DE-69636755-T2,C12N
DE-69636755-T2,A61K
DE-69636755-T2,G01N
DE-69636755-T2,C12Q
DE-69636755-T2,C12N
DE-69728658-T2,B32B
DE-69728658-T2,B41C
DE-69728658-T2,B41N
DE-69728658-T2,B41N
DE-69728658-T2,B32B
DE-69728658-T2,B32B
DE-69807539-T2,G01N
DE-69807539-T2,G01N
DE-69807539-T2,G01N
DE-69832203-T2,A61B
DE-69832203-T2,A61B
HU-E042779-T2,F28B
HU-E042779-T2,F28C
HU-E039475-T2,E02D
HU-E039475-T2,F28F
HU-E045258-T2,H04L
HU-E032026-T2,B41J
HU-E032026-T2,B41J
HU-E059707-T2,B01D
HU-E059707-T2,B01D
HU-E062821-T2,G01N
HU-E062821-T2,A61B
HU-E062821-T2,A61F
TR-200000810-T2,C08L
TR-200000810-T2,C08L
TR-200000810-T2,C08L
TR-200000810-T2,C08J
TR-200000810-T2,C08J
TR-200000810-T2,C08K
TR-200000810-T2,C08F
TR-200000810-T2,C08K
TR-200000810-T2,C08J
DE-602004001511-T2,E05D
DK-1861705-T3,C12Q
DK-1861705-T3,G01N
DK-2101612-T3,A47C
DK-2101612-T3,A47C
DK-2579875-T3,A61P
DK-2579875-T3,A61P
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2692719-T3,C07H
DK-2692719-T3,C07C
DK-2692719-T3,C07C
DK-2692719-T3,C07C
DK-2692719-T3,A61Q
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61K
DK-2692719-T3,A61K
DK-2692719-T3,A23L
DK-2817131-T3,C08J
DK-2817131-T3,B29B
DK-3592973-T3,F03D
DK-3592973-T3,B66C
DK-3592973-T3,B66C
DK-3617419-T3,E04F
DK-3566308-T3,H03K
DK-3566308-T3,B06B
DK-0474188-T3,C07C
DK-0474188-T3,C07B
DK-0474188-T3,C07C
DK-0474188-T3,B01J
DK-0474188-T3,C07C

2025-01-24 01:51:15 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:15 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:15 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:16 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:51:16 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:16 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:51:16 - root - INFO - SQL:
SELECT t."publication_number", cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."citation") cit_u
    LIMIT 100;
Results:
publication_number,cited_publication_number
US-11883790-B2,US-4626471-A
US-11883790-B2,WO-0109259-A1
US-11883790-B2,CN-1333802-A
US-11883790-B2,CN-1376187-A
US-11883790-B2,US-6593408-B1
US-11883790-B2,US-6593417-B1
US-11883790-B2,US-2003212199-A1
US-11883790-B2,US-6759478-B2
US-11883790-B2,US-2004225057-A1
US-11883790-B2,WO-2005097870-A1
US-11883790-B2,US-7005472-B2
US-11883790-B2,JP-2006063297-A
US-11883790-B2,JP-2006346553-A
US-11883790-B2,JP-2007070484-A
US-11883790-B2,US-2007251422-A1
US-11883790-B2,CN-101245120-A
US-11883790-B2,JP-2010032719-A
US-11883790-B2,JP-2010084018-A
US-11883790-B2,JP-2010084017-A
US-11883790-B2,JP-2010285624-A
US-11883790-B2,US-7981511-B2
US-11883790-B2,CN-103304775-A
US-11883790-B2,US-2015037535-A1
US-11883790-B2,CN-104540499-A
US-11883790-B2,US-2015247033-A1
US-11883790-B2,CN-104903332-A
US-11883790-B2,US-2015297520-A1
US-11883790-B2,WO-2016014807-A1
US-11883790-B2,CN-105348457-A
US-11883790-B2,WO-2016111314-A1
US-11883790-B2,CN-106573851-A
US-11883790-B2,US-2017114243-A1
US-11883790-B2,JP-2017109898-A
US-11883790-B2,US-2017196815-A1
US-11883790-B2,US-9725590-B2
US-11883790-B2,WO-2017163439-A1
US-11883790-B2,JP-2018035031-A
US-11883790-B2,WO-2018051794-A1
US-11883790-B2,US-2018228733-A9
US-11883790-B2,US-2019100637-A1
US-11883790-B2,US-2019209994-A1
US-11883790-B2,US-2019254976-A1
US-11883790-B2,US-10774192-B2
US-11883790-B2,
US-11883790-B2,
US-11883790-B2,
US-11883790-B2,
US-11530904-B2,US-2006207466-A1
US-11530904-B2,US-8356438-B2
US-11530904-B2,US-2015153144-A1
US-11530904-B2,US-2016040965-A1
US-11530904-B2,US-9354026-B2
US-11530904-B2,CN-107883811-A
US-11530904-B2,KR-101872709-B1
US-11530904-B2,US-10168127-B1
US-11530904-B2,US-10598467-B1
US-11530904-B2,
US-11492186-B2,US-5351828-A
US-11492186-B2,US-5753895-A
US-11492186-B2,US-2003108699-A1
US-11492186-B2,CN-1478043-A
US-11492186-B2,US-2004035865-A1
US-11492186-B2,CN-1481326-A
US-11492186-B2,US-2004234174-A1
US-11492186-B2,WO-2007008021-A1
US-11492186-B2,US-2007068118-A1
US-11492186-B2,US-2009169134-A1
US-11492186-B2,US-2010061664-A1
US-11492186-B2,US-7858909-B2
US-11492186-B2,CN-102099185-A
US-11492186-B2,US-2013292287-A1
US-11492186-B2,US-2014033654-A1
US-11492186-B2,CN-204056710-U
US-11492186-B2,US-2015122846-A1
US-11492186-B2,US-2015126349-A1
US-11492186-B2,US-2015122840-A1
US-11492186-B2,US-2015122841-A1
US-11492186-B2,US-2015121810-A1
US-11492186-B2,US-2015122373-A1
US-11492186-B2,US-9327867-B2
US-11492186-B2,JP-2016108034-A
US-11492186-B2,US-2016176578-A1
US-11492186-B2,US-2016176582-A1
US-11492186-B2,US-2016176583-A1
US-11492186-B2,US-2016176584-A1
US-11492186-B2,US-2016176597-A1
US-11492186-B2,US-2016221727-A1
US-11492186-B2,US-2016297589-A1
US-11492186-B2,US-2016297569-A1
US-11492186-B2,US-2016297591-A1
US-11492186-B2,US-2016297590-A1
US-11492186-B2,US-2016325518-A1
US-11492186-B2,US-2016362228-A1
US-11492186-B2,US-2017001782-A1
US-11492186-B2,CN-107107477-A
US-11492186-B2,JP-2018095267-A
US-11492186-B2,EP-3348488-A1
US-11492186-B2,US-10457457-B2
US-11492186-B2,
US-11459996-B2,JP-2001253307-A

2025-01-24 01:51:16 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:51:16 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:51:16 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:51:17 - snowflake.connector.connection - INFO - closed
2025-01-24 01:51:18 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:52:21 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:52:21 - root - INFO - The error you're encountering:

```
SQL compilation error:
Lateral View cannot be on the left side of join
```

occurs because in Snowflake SQL, you cannot use `LATERAL FLATTEN` directly on the left side of a `JOIN`. To fix this issue, you need to restructure your query so that the flattening of arrays (using `LATERAL FLATTEN`) happens in subqueries or Common Table Expressions (CTEs) before the `JOIN` operations.

Here’s the corrected query:

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        ipc.value:"code"::STRING AS "cited_ipc_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100;
```

**Explanation:**

1. **Flatten Citations:**

   - The first CTE `citing_citations` extracts the citing and cited publication numbers by flattening the `"citation"` field from the `PUBLICATIONS` table.
   - This gives a table with columns `"citing_publication_number"` and `"cited_publication_number"`.

    ```sql
    WITH citing_citations AS (
        SELECT
            t."publication_number" AS "citing_publication_number",
            cit.value:"publication_number"::STRING AS "cited_publication_number"
        FROM
            PATENTS.PATENTS.PUBLICATIONS t,
            LATERAL FLATTEN(input => t."citation") cit
    )
    ```

2. **Flatten IPC Codes of Cited Publications:**

   - The second CTE `cited_ipc_codes` extracts the IPC codes from the cited publications by flattening the `"ipc"` field.
   - This results in a table with columns `"cited_publication_number"` and `"cited_ipc_code"`.

    ```sql
    cited_ipc_codes AS (
        SELECT
            cp."publication_number" AS "cited_publication_number",
            ipc.value:"code"::STRING AS "cited_ipc_code"
        FROM
            PATENTS.PATENTS.PUBLICATIONS cp,
            LATERAL FLATTEN(input => cp."ipc") ipc
    )
    ```

3. **Join the Results:**

   - The main query joins the two CTEs on `"cited_publication_number"` to associate each backward citation with its IPC codes.
   - The `LEFT JOIN` ensures that all citations are included, even if some cited publications don't have IPC codes.

    ```sql
    SELECT
        cc."citing_publication_number",
        cc."cited_publication_number",
        cic."cited_ipc_code"
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic
            ON cc."cited_publication_number" = cic."cited_publication_number"
    LIMIT 100;
    ```

**Note:**

- By using CTEs, we perform the `LATERAL FLATTEN` operations before the `JOIN`, which complies with Snowflake's SQL rules.
- The `LIMIT 100` clause limits the result to 100 rows for testing purposes.

**Resulting Output Format:**

```csv
citing_publication_number,cited_publication_number,cited_ipc_code
publication_number1,publication_number2,ipc_code1
publication_number1,publication_number3,ipc_code2
publication_number4,publication_number5,ipc_code3
...
```

**Next Steps:**

- You can run this query to retrieve the backward citations and their IPC codes.
- With this data, you can calculate the originality score for each patent based on the diversity of 4-digit IPC codes from its backward citations.
- Remember to extract the first four characters of each IPC code to get the 4-digit codes, using `SUBSTR(cic."cited_ipc_code", 1, 4)` if needed.

**Example Adjusted for 4-Digit IPC Codes:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc4_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100;
```

Now, the `"cited_ipc4_code"` column contains the 4-digit IPC codes needed for your originality score calculation.
2025-01-24 01:52:21 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:52:21 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:52:21 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:52:23 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:52:23 - snowflake.connector.connection - INFO - closed
2025-01-24 01:52:23 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:54:03 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:54:03 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        ipc.value:"code"::STRING AS "cited_ipc_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100;
Results:
citing_publication_number,cited_publication_number,cited_ipc_code
US-8548719-B2,US-2007276594-A1,G01C21/32
US-11346835-B2,US-2007235250-A1,G01V1/04
US-11661936-B2,US-2008304236-A1,F25B29/00
US-11661936-B2,US-2008304236-A1,H05K7/20
US-10844739-B2,US-2008145216-A1,F04D29/08
US-10844739-B2,US-2008145216-A1,F01D9/02
CN-102048535-A,US-2007253526-A1,H05G1/60
CN-102048535-A,US-2007253526-A1,G21K1/12
CN-102048535-A,US-2007253526-A1,A61B6/00
CN-102048535-A,US-2007253526-A1,G01N23/00
US-11805327-B2,US-2007284440-A1,G06K15/00
US-11507933-B2,US-2007284440-A1,G06K15/00
US-2019242790-A1,US-2009091566-A1,G06K9/00
US-2019242790-A1,US-2009091566-A1,G06T15/00
US-2010248057-A1,US-2007099049-A1,H01M8/02
US-2010248057-A1,US-2007099049-A1,H01M8/04
US-11160360-B2,US-2005218033-A1,A45D27/22
US-11160360-B2,US-2005218033-A1,B65D69/00
US-2007281355-A1,US-2007122905-A1,C12N5/071
US-2007281355-A1,US-2007122905-A1,C12N5/073
US-9597149-B2,US-2009173943-A1,H01L33/00
US-8500451-B2,US-2007049817-A1,A61B5/296
US-8500451-B2,US-2007049817-A1,A61B5/00
US-8500451-B2,US-2007049817-A1,A61B8/12
US-8500451-B2,US-2007049817-A1,A61B5/01
US-8500451-B2,US-2007049817-A1,A61B8/08
US-8500451-B2,US-2007049817-A1,A61B6/03
US-8500451-B2,US-2007049817-A1,A61B8/06
US-9575648-B2,US-2006028455-A1,G06F3/033
US-9575648-B2,US-2006028455-A1,G06F3/048
US-9575648-B2,US-2006028455-A1,G06F3/02
US-9575648-B2,US-2006028455-A1,G06F3/023
US-9575648-B2,US-2006028455-A1,G09G5/00
US-2006102001-A1,US-2006102001-A1,B01D47/00
US-8381997-B2,US-2006244676-A1,H01Q5/10
US-8528829-B2,US-2006244676-A1,H01Q5/10
US-8381997-B2,US-2006244676-A1,H01Q1/36
US-8528829-B2,US-2006244676-A1,H01Q1/36
US-10200885-B2,US-2007216575-A1,G01S19/25
US-10200885-B2,US-2007216575-A1,G01S5/14
US-8335977-B2,US-2007180346-A1,H03M13/00
US-2015067446-A1,US-2007180346-A1,H03M13/00
US-10933691-B2,US-2010170762-A1,F16D41/24
US-11431960-B2,US-2016216540-A1,G02B30/25
US-11431960-B2,US-2016216540-A1,G02F1/137
US-11431960-B2,US-2016216540-A1,G02F1/13363
US-11431960-B2,US-2016216540-A1,G02F1/1335
US-11431960-B2,US-2016216540-A1,G02B30/28
US-2021210094-A1,US-2023267935-A1,G10L17/04
US-2021210094-A1,US-2023267935-A1,G10L15/08
US-2021210094-A1,US-2023267935-A1,G10L15/22
US-2021210094-A1,US-2023267935-A1,G10L17/14
US-2021210094-A1,US-2023267935-A1,G10L17/18
US-2021210094-A1,US-2023267935-A1,G10L17/22
US-11320713-B2,US-2017063429-A1,G01B7/02
US-11320713-B2,US-2017063429-A1,H04Q5/00
US-11320713-B2,US-2017063429-A1,H04B3/46
US-2023033400-A1,US-2022321389-A1,H04L5/00
US-2023033400-A1,US-2022321389-A1,H04L27/26
US-2023033400-A1,US-2022321389-A1,H04L25/02
US-2023172274-A1,US-2023127975-A1,A24F40/465
US-2023172274-A1,US-2023127975-A1,A24F40/50
US-2010058330-A1,US-6594664-B1,G06F17/30
US-2021272046-A1,US-2015161969-A1,G06T11/60
US-2021272046-A1,US-2015161969-A1,G09G5/30
US-2021272046-A1,US-2015161969-A1,G09G5/377
US-11680437-B2,DE-102015106680-A1,B60R25/00
US-11680437-B2,DE-102015106680-A1,B60R16/037
US-11680437-B2,DE-102015106680-A1,A61B5/117
US-2004118448-A1,US-2004095658-A1,F24S23/00
US-2004118448-A1,US-2004095658-A1,H10K99/00
US-2004118448-A1,US-2004095658-A1,G02B5/10
US-2004118448-A1,US-2004095658-A1,G02B6/122
US-2004118448-A1,US-2004095658-A1,H01S3/063
US-2004118448-A1,US-2004095658-A1,H01S5/10
US-2004118448-A1,US-2004095658-A1,G02B1/04
US-2008171970-A1,US-2005154348-A1,A61M1/06
US-2008171970-A1,US-2005154348-A1,A61M1/00
US-10722723-B2,US-2005080430-A1,A61F2/06
US-10722723-B2,US-2005080430-A1,A61B19/00
US-10722723-B2,US-2005080430-A1,A61B17/12
US-10722723-B2,US-2005080430-A1,A61F2/01
US-10722723-B2,US-2005080430-A1,A61B17/22
US-10722723-B2,US-2005080430-A1,A61M29/00
US-10722723-B2,US-2005080430-A1,A61B17/34
US-10722723-B2,US-2005080430-A1,A61M25/00
US-10722723-B2,US-2005080430-A1,A61F2/84
US-2016183808-A1,US-2007083126-A1,A61F2/958
US-2016183808-A1,US-2007083126-A1,A61B5/02
US-2016183808-A1,US-2007083126-A1,A61M31/00
US-8072754-B2,US-2008043436-A1,H05K7/20
US-10963524-B2,US-2008037721-A1,H04M1/64
US-2018260785-A1,US-2008037721-A1,H04M1/64
WO-2021112688-A1,EP-0800988-A1,B60K1/04
WO-2021112688-A1,EP-0800988-A1,B62M6/40
WO-2021243127-A1,WO-2020258237-A1,A47J19/02
DE-102016203967-B4,DE-102008000145-A1,B62D5/04
DE-102016203967-B4,DE-102008000145-A1,H02H7/08
WO-2024100023-A1,WO-2018151123-A1,A47B49/00
WO-2024100023-A1,WO-2018151123-A1,A47B61/04

2025-01-24 01:54:03 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:54:03 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:54:03 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:54:05 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:54:05 - snowflake.connector.connection - INFO - closed
2025-01-24 01:54:05 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:54:06 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc4_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100
Results:
citing_publication_number,cited_publication_number,cited_ipc4_code
US-9355294-B2,US-2009014531-A1,G09G
US-9355294-B2,US-2009014531-A1,G06F
US-9355294-B2,US-2009014531-A1,G06F
US-9355294-B2,US-2009014531-A1,G06K
US-9355294-B2,US-2009014531-A1,G01S
US-10589120-B1,US-2007260229-A1,A61B
US-11629886-B2,US-2009252619-A1,F16L
US-11629886-B2,US-2009252619-A1,F04B
US-9622691-B2,US-2006272652-A1,A61B
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-2019119050-A1,US-2003155452-A1,B65G
US-2019119050-A1,US-2003155452-A1,B65B
US-2019119050-A1,US-2003155452-A1,B65D
US-2019119050-A1,US-2003155452-A1,B65G
US-2019119050-A1,US-2003155452-A1,B65G
US-2005223909-A1,US-2005223909-A1,C11B
US-2005223909-A1,US-2005223909-A1,A47J
US-2005223909-A1,US-2005223909-A1,B01D
US-2005223909-A1,US-2005223909-A1,A23D
US-2008143161-A1,US-2006226685-A1,A47C
US-2010256194-A1,US-2006160812-A1,A61B
US-2010256194-A1,US-2006160812-A1,C07D
US-2010256194-A1,US-2006160812-A1,A61K
US-2010256194-A1,US-2006160812-A1,C07D
US-11902122-B2,US-2007044147-A1,G06F
US-2009119572-A1,US-2007271228-A1,G06F
US-9131283-B2,US-2007244760-A1,G06Q
US-11436630-B2,US-2007244760-A1,G06Q
US-9371099-B2,US-2006092043-A1,G08G
US-11570601-B2,US-2006092043-A1,G08G
US-10229589-B1,US-2006092043-A1,G08G
EP-3846008-A1,US-2008215994-A1,G06F
US-8732593-B2,US-2008215994-A1,G06F
US-10554596-B1,US-2008215994-A1,G06F
US-11062336-B2,US-2007043615-A1,G06Q
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2005255501-A1,US-2003008290-A1,C12Q
US-2005255501-A1,US-2003008290-A1,C12P
US-2008259670-A1,US-2006117152-A1,G06F
JP-2008046989-A,US-2006117152-A1,G06F
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,B32B
WO-2022140455-A1,US-2009056865-A1,B29C
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
US-10625938-B2,US-2009016864-A1,A47F
US-10625938-B2,US-2009016864-A1,B65G
US-10429872-B2,US-2008238710-A1,G08C
US-2020203060-A1,US-9478344-B2,H03B
US-2020203060-A1,US-9478344-B2,H03L
US-2020203060-A1,US-9478344-B2,H01F
US-2020203060-A1,US-9478344-B2,H01F
US-2020203060-A1,US-9478344-B2,H01F
US-10239398-B2,DE-102015014819-A1,B60J
US-10239398-B2,DE-102015014819-A1,B60J
WO-2020219915-A1,WO-2018106805-A1,G06N
WO-2020219915-A1,WO-2018106805-A1,G06N
WO-2020219915-A1,WO-2018106805-A1,H03M
WO-2020219915-A1,WO-2018106805-A1,G06V
US-11395931-B2,US-2006213672-A1,A62C
US-11395931-B2,US-2006213672-A1,A62C
US-10596675-B2,US-2006025778-A1,A61B
US-2006036325-A1,US-2005045936-A1,H10B
US-2006036325-A1,US-2005045936-A1,H01L
US-11452433-B2,US-2006224053-A1,A61B
US-9284409-B2,US-2008071350-A1,A61F
TW-I480672-B,US-2005254624-A1,H04N
TW-I480672-B,US-2005254624-A1,H01L
TW-I480672-B,US-2005254624-A1,A61B
TW-I480672-B,US-2005254624-A1,G06T
TW-I480672-B,US-2005254624-A1,H04N
TW-I480672-B,US-2005254624-A1,H01L
TW-I480672-B,US-2005254624-A1,G01T
TW-I480672-B,US-2005254624-A1,H05G
TW-I480672-B,US-2005254624-A1,G01T
TW-I480672-B,US-2005254624-A1,A61B
WO-2021112688-A1,EP-0800988-A1,B60K
WO-2021112688-A1,EP-0800988-A1,B62M
WO-2021243127-A1,WO-2020258237-A1,A47J
DE-102016203967-B4,DE-102008000145-A1,B62D
DE-102016203967-B4,DE-102008000145-A1,H02H
WO-2024100023-A1,WO-2018151123-A1,A47B
WO-2024100023-A1,WO-2018151123-A1,A47B
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06Q
US-11416109-B2,US-9619652-B2,G06Q
US-11222142-B2,US-9619652-B2,G06F

2025-01-24 01:54:06 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:54:06 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:54:06 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:54:07 - snowflake.connector.connection - INFO - closed
2025-01-24 01:54:07 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:54:53 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:54:53 - root - INFO - The error you're encountering:

```
Unsupported feature 'lateral table function called with OUTER JOIN syntax or a join predicate (ON clause)'.
```

occurs because Snowflake does not support joining `LATERAL FLATTEN` using `LEFT JOIN` with an `ON` condition in the way you've written it. Specifically, Snowflake does not allow `LEFT JOIN LATERAL FLATTEN(...) ON TRUE`.

**Explanation of the Error:**

- **Unsupported Feature:** In Snowflake, you cannot use `OUTER JOIN` syntax or a join predicate (`ON` clause) with lateral table functions like `LATERAL FLATTEN`.

- **Implication:** This means you cannot write `LEFT JOIN LATERAL FLATTEN(...) ON TRUE`.

**Solution:**

To include all rows from `t`, even when there are no citations (i.e., `t."citation"` is `NULL`), you can use the `OUTER => TRUE` parameter in the `FLATTEN` function. This parameter ensures that the `FLATTEN` function returns a row even when the input is `NULL` or empty.

Here's the corrected query:

```sql
SELECT
    t."publication_number",
    COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "num_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
GROUP BY t."publication_number"
LIMIT 100;
```

**Explanation:**

- **`LATERAL FLATTEN` with `OUTER => TRUE`:** By setting `OUTER => TRUE`, the `FLATTEN` function includes a row for each `publication_number` even if the `citation` field is `NULL` or empty for that publication. When there are no citations, `cit_u.value` will be `NULL`.

- **Counting Citations:**
  - The `COUNT(DISTINCT cit_u.value:"publication_number"::STRING)` function counts the number of unique cited publication numbers.
  - Since `COUNT` ignores `NULL` values, publications with no citations will have a count of `0`.

**Additional Correction for Other Queries:**

Similarly, for the other queries you listed, you need to avoid using `LEFT JOIN` with `LATERAL FLATTEN`. Instead, you can use `LATERAL FLATTEN` with `OUTER => TRUE` directly in the `FROM` clause or restructure the queries using Common Table Expressions (CTEs). Here's how you can correct them:

---

**1. Corrected Query:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc4_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100;
```

---

**2. Corrected Query:**

(Already corrected above.)

---

**3. Corrected Query:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cic."cited_ipc4_code",
    COUNT(*) AS "num_citations_to_ipc4"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."citing_publication_number", cic."cited_ipc4_code"
LIMIT 100;
```

**Note:** In the `COUNT(*)`, ensure that you're counting the number of citations to each IPC code per citing publication.

---

**4. Corrected Query:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "num_backward_citations",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."publication_number"
LIMIT 100;
```

---

**5. Corrected Query:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    cic."cited_ipc4_code",
    COUNT(*) AS "n_i_k"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."publication_number", cic."cited_ipc4_code"
LIMIT 100;
```

---

**6. Corrected Query:**

(This query does not use `LATERAL FLATTEN` and therefore doesn't need correction.)

```sql
SELECT "publication_number", "grant_date", "kind_code"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "country_code" = 'US' AND "kind_code" = 'B2' AND "grant_date" BETWEEN 20150101 AND 20181231
LIMIT 100;
```

---

**7. Corrected Query:**

```sql
SELECT DISTINCT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code"
FROM PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
LIMIT 100;
```

---

**8. Corrected Query:**

```sql
SELECT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code", COUNT(DISTINCT t."publication_number") AS "num_patents"
FROM PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
GROUP BY "ipc4_code"
LIMIT 100;
```

---

**9. Corrected Query:**

```sql
SELECT
    t."publication_number" AS "citing_publication_number",
    cic."cited_ipc4_code",
    COUNT(*) AS "num_citations_to_ipc4"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
    LEFT JOIN (
        SELECT
            cp."publication_number" AS "cited_publication_number",
            SUBSTR(cip.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
        FROM
            PATENTS.PATENTS.PUBLICATIONS cp,
            LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cip
    ) cic
    ON cit_u.value:"publication_number"::STRING = cic."cited_publication_number"
WHERE t."publication_number" = 'some_publication_number'
GROUP BY t."publication_number", cic."cited_ipc4_code"
LIMIT 100;
```

---

**10. Corrected Query:**

```sql
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_sections AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 1) AS "ipc_section"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."publication_number",
    cic."ipc_section",
    COUNT(*) AS "num_citations_to_section"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_sections cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."publication_number", cic."ipc_section"
LIMIT 100;
```

---

**11. Corrected Query:**

```sql
SELECT
    t."publication_number" AS "citing_publication_number",
    cit_u.value:"publication_number"::STRING AS "cited_publication_number",
    COUNT(cit_u.value:"publication_number"::STRING) OVER (PARTITION BY t."publication_number") AS "total_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
LIMIT 100;
```

**Note:** In each corrected query, we:

- **Removed `LEFT JOIN LATERAL FLATTEN`:** This syntax is not supported in Snowflake.

- **Used `LATERAL FLATTEN` with `OUTER => TRUE` in the `FROM` clause:** This ensures that even when the input array is `NULL` or empty, we still get a row for each publication.

- **Adjusted JOINs and Logic Appropriately:** Ensured that the logic remains intact and that we retrieve the intended results.

**General Recommendations:**

- **Avoid `LEFT JOIN` with `LATERAL FLATTEN`:** Instead, use `LATERAL FLATTEN` directly in the `FROM` clause with `OUTER => TRUE` if needed.

- **Use `OUTER => TRUE` to Include All Rows:** This is especially useful when you want to include publications that may not have any citations or IPC codes.

**Testing the Corrected Queries:**

- **Run the Queries:** Execute the corrected queries in your Snowflake environment to ensure they work as intended.

- **Verify Results:** Check the results to make sure they align with your expectations.

By making these adjustments, you should be able to execute the queries without encountering the `Unsupported feature` error.
2025-01-24 01:54:53 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:54:53 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:54:53 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:54:54 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:54:54 - snowflake.connector.connection - INFO - closed
2025-01-24 01:54:55 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:56:39 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:56:39 - root - INFO - SQL:
SELECT
    t."publication_number",
    COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "num_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
GROUP BY t."publication_number"
LIMIT 100;
Results:
publication_number,num_backward_citations
US-552281-A,0
US-4349255-A,8
US-8560474-B2,41
US-9499521-B2,184
US-2008237040-A1,32
US-2015244938-A1,25
WO-2014122093-A1,11
US-9143515-B2,15
US-10730205-B2,26
US-10988035-B2,22
US-2008195166-A1,19
AT-521300-A1,3
WO-2023233794-A1,5
US-2007141853-A1,12
US-2007284440-A1,23
US-2009307115-A1,19
KR-20160084604-A,4
CN-101844231-A,3
WO-2021087540-A1,7
DE-2460286-A1,0
US-8900118-B2,778
US-10647799-B2,14
US-2007074329-A1,73
US-2007115483-A1,99
US-9483346-B2,121
US-8500209-B2,156
US-11590628-B2,20
RU-2337651-C1,1
US-2008251677-A1,27
CN-107530754-A,5
CN-107116688-A,5
CN-110845293-A,4
JP-S61113746-A,12
JP-S5241258-B1,0
CN-107174299-A,8
US-10036488-B2,29
JP-2005165649-A,0
JP-2011030203-A,0
KR-20210144025-A,1
US-8354789-B2,11
US-11157999-B2,114
US-2005076622-A1,3
US-2010294614-A1,13
JP-H0827723-A,5
KR-100687878-B1,3
CN-113936573-A,9
DE-102015009796-A1,41
US-11905336-B2,119
US-2010002609-A1,2
AT-163249-B,0
JP-2015018552-A,4
CN-105718880-A,6
DE-102007026947-A1,4
JP-2011200474-A,6
US-2005010697-A1,7
CN-114291853-B,15
US-2004154269-A1,12
US-6256469-B1,11
WO-2019154221-A1,6
US-2008089664-A1,42
US-2472439-A,17
JP-S6040613-A,0
CN-103080988-A,6
CN-211543083-U,0
AU-6365100-A,0
US-2017169190-A1,9
DE-1263920-B,1
US-2022260821-A1,3
US-2002021202-A1,0
WO-2017160556-A1,3
US-2008246626-A1,37
US-11912602-B2,17
CN-108033132-A,15
CN-113685509-A,41
CN-113467661-A,9
US-11070533-B2,13
CN-108423991-A,3
AT-E26039-T1,0
US-2016318034-A1,6
US-3397863-A,9
DE-102019109413-A1,4
US-10429872-B2,400
US-2006279577-A1,66
TR-201805389-A2,0
EP-1316770-A3,8
JP-2015129856-A,4
CN-109367668-A,9
FR-975615-A,0
US-2267301-A,0
US-4702921-A,5
JP-2007090745-A,4
KR-20110069484-A,0
CN-107329702-A,8
US-2011098755-A1,102
US-2006211052-A1,27
KR-200309397-Y1,0
US-2007010883-A1,24
US-2017196661-A1,19
CN-117602747-A,10
CN-210670675-U,0

2025-01-24 01:56:39 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:56:39 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:56:39 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:56:41 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:56:41 - snowflake.connector.connection - INFO - closed
2025-01-24 01:56:41 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:56:42 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cic."cited_ipc4_code",
    COUNT(*) AS "num_citations_to_ipc4"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."citing_publication_number", cic."cited_ipc4_code"
LIMIT 100
Results:
citing_publication_number,cited_ipc4_code,num_citations_to_ipc4
US-11320713-B2,G01B,1
JP-6085719-B2,,1
CA-1044986-A,,1
YU-87669-A,,1
JP-4791083-B2,,1
CN-208620513-U,,1
CN-103820282-A,,1
CA-1108887-A,,1
CL-2017000769-S1,,1
JP-H06312824-A,,1
JP-6402733-B2,,1
JP-2006300573-A,,1
JP-2011238568-A,,1
JP-2007191450-A,,1
US-1081614-A,,1
JP-S6227741-Y2,,1
JP-S5114121-U,,1
KR-20170057119-A,,1
CN-101541970-A,,1
CN-216251206-U,,1
GB-190106301-A,,1
CN-209563421-U,,1
CA-530546-A,,1
JP-S59132838-U,,1
CN-207251193-U,,1
CN-210618726-U,,1
GB-958924-A,,1
JP-H0754183-B2,,1
CN-100494909-C,,1
CN-205693866-U,,1
CN-212643184-U,,1
CN-212367207-U,,1
FR-2160117-A5,,1
CN-211989059-U,,1
CN-220262749-U,,1
CN-2059280-U,,1
CN-204526409-U,,1
CN-212833475-U,,1
CN-221091613-U,,1
CN-113622854-B,,1
JP-2021088866-A,,7
PT-4093901-T,,1
CN-113696839-A,,32
CN-212887809-U,,1
CN-210669616-U,,1
CN-207889708-U,,1
US-2463209-A,,5
CN-204326838-U,,1
CN-203643479-U,,1
CN-206408836-U,,1
US-11221682-B2,,1324
US-10154644-B2,,94
RU-2508167-C2,,10
JP-S5925118-B2,,1
US-1567024-A,,1
IT-237462-Y1,,1
CN-214495683-U,,1
US-8336272-B2,,81
CN-102205651-A,,4
US-4854089-A,,23
CN-106144430-A,,7
US-2009027661-A1,,99
JP-2008009087-A,,7
DE-102010015571-A1,,5
JP-2005200174-A,,1
JP-1735513-S,,1
CA-3000454-A1,,1
SK-7542001-A3,,1
CA-2084155-C,,1
JP-4830144-B2,,1
JP-S5981868-A,,1
CN-117447976-A,,1
CN-101050802-A,,1
JP-H07301432-A,,1
CN-215011179-U,,1
KR-20170021046-A,,1
JP-3145672-B2,,1
CN-211154194-U,,1
CN-219815852-U,,1
JP-S5756285-A,,1
SE-7010582-L,,1
CN-205456186-U,,1
CN-2847466-Y,,1
CN-109013684-A,,4
CN-209583587-U,,1
CN-215541567-U,,1
CN-215295467-U,,1
US-2024189135-A1,,107
CN-212842289-U,,1
CN-214760130-U,,1
CN-215087362-U,,1
US-2006025756-A1,,99
US-8170543-B1,,17
US-11064741-B2,,43
US-2018364895-A1,,84
US-9262515-B2,,53
JP-S531011-A,,1
US-2004178584-A1,,24
US-3994620-A,,11
CN-108218726-A,,8

2025-01-24 01:56:42 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:56:42 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:56:42 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:56:44 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:56:44 - snowflake.connector.connection - INFO - closed
2025-01-24 01:56:44 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:56:44 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "num_backward_citations",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."publication_number"
LIMIT 100
Results:
publication_number,num_backward_citations,num_distinct_cited_ipc4_codes
WO-2017021623-A1,6,0
US-3047771-A,12,0
EP-2663972-A1,0,0
CN-117463239-A,0,0
US-5728994-A,39,0
JP-2001263749-A,0,0
FR-2521157-A1,0,0
JP-H0638193-B2,0,0
CN-109686400-B,4,0
US-2010156039-A1,6,0
BR-7603887-A,0,0
EP-2359614-A1,1,0
US-2504103-A,5,0
AU-2020283323-A1,0,0
CN-114777232-A,4,0
JP-2007046609-A,0,0
CN-206498994-U,0,0
US-5247987-A,6,0
CN-113686248-A,16,0
DE-102013021892-A1,7,0
US-11245716-B2,28,0
CN-103345780-B,7,0
CN-107239222-A,6,3
JP-2004149901-A,0,0
CN-105685473-A,5,0
CN-106192829-B,7,0
RU-2016136606-A,0,0
BR-112018073292-B1,0,0
AU-2547895-A,0,0
KR-102572052-B1,6,0
NO-20171426-A1,4,0
US-7606931-B2,11,0
WO-2023011002-A1,5,0
JP-2010192584-A,0,0
CN-103062749-A,6,0
DE-69721689-T2,0,0
TW-D173844-S,0,0
CN-103920104-A,1,0
CN-114551138-A,3,0
CN-208397283-U,0,0
CN-104177077-A,3,0
CN-107859486-A,0,0
CN-107006103-A,5,0
WO-2013091522-A1,2,0
CN-210480343-U,0,0
CN-118531528-A,0,0
CN-210458133-U,0,0
JP-S5485986-U,0,0
GB-0412652-D0,0,0
JP-3787240-B2,0,0
CN-107907771-A,1,0
CN-103826639-A,1,0
KR-20120139449-A,0,0
CN-103050103-A,6,0
CN-203945894-U,0,0
US-2022266341-A1,0,0
JP-5717980-B2,0,0
AU-2002333260-B2,3,0
CN-103075454-A,9,0
US-3073853-A,4,0
KR-20140136100-A,0,0
CN-209834948-U,0,0
CN-210864206-U,0,0
CN-101941580-A,3,0
US-2587069-A,5,0
CN-111478811-B,0,0
CN-106448080-B,3,0
KR-20030093918-A,0,0
TW-M497602-U,0,0
CN-102309021-A,2,0
CN-211408666-U,0,0
CN-208865457-U,0,0
CN-106406447-B,5,0
WO-2022032289-A1,6,0
CN-209163451-U,0,0
CN-217153790-U,0,0
KR-20170074852-A,2,0
JP-H01207141-A,1,0
AT-79076-B,0,0
KR-101515573-B1,3,0
JP-S5176234-A,0,0
CA-55044-A,0,0
JP-S5517644-A,0,0
CN-213939974-U,0,0
JP-S62110796-A,0,0
CN-106743425-B,0,0
CA-2900827-A1,0,0
US-2019107495-A1,0,0
CN-208205611-U,0,0
IL-231109-B,0,0
TW-I480672-B,7,6
HR-P20030810-A2,0,0
CN-209887200-U,0,0
JP-2003231832-A,0,0
CN-204323774-U,0,0
CN-219809492-U,0,0
JP-2007101778-A,0,0
CN-211841483-U,0,0
AU-474868-B2,0,0
CN-207883963-U,0,0

2025-01-24 01:56:44 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:56:44 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:56:44 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:56:46 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:56:46 - snowflake.connector.connection - INFO - closed
2025-01-24 01:56:46 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:57:18 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:57:18 - root - INFO - ```sql
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    cic."cited_ipc4_code",
    COUNT(DISTINCT cic."cited_publication_number") AS "n_i_k"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."cited_ipc4_code"
LIMIT 100;
```

This SQL query eliminates empty values in the `cited_ipc4_code` column by:

- Filtering out `NULL` values in the `cited_publication_number` field of the `citing_citations` CTE.
- Filtering out `NULL` values in the `cited_ipc4_code` field of the `cited_ipc_codes` CTE.
- Using an `INNER JOIN` between `citing_citations` and `cited_ipc_codes` to include only records where the cited publication has a valid IPC code.

This ensures that all columns have valid data and there are no empty values in the result.
2025-01-24 01:57:18 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:57:18 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:57:18 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:57:20 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:57:20 - snowflake.connector.connection - INFO - closed
2025-01-24 01:57:20 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:58:26 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:58:26 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    cic."cited_ipc4_code",
    COUNT(DISTINCT cic."cited_publication_number") AS "n_i_k"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."cited_ipc4_code"
LIMIT 100;
Results:
publication_number,n_i,cited_ipc4_code,n_i_k
JP-7360647-B2,1,H10N,1
CN-109545116-A,1,G09G,1
US-8072754-B2,1,H05K,1
US-2005070847-A1,1,A61M,1
CN-1089211-C,1,A01H,1
US-2007095661-A1,1,H01L,1
CN-113375002-A,1,B23Q,1
JP-S62168346-U,1,B62M,1
US-2021133906-A1,2,G06Q,2
CN-102909728-A,1,B25J,1
JP-H054811-U,1,A01B,1
JP-2007261428-A,1,E04B,1
US-11473504-B2,1,F02C,1
US-9622691-B2,1,G06F,1
US-10283172-B2,1,H01L,1
US-2009202193-A1,1,G01N,1
US-10840771-B2,1,H02K,1
US-3819863-A,1,H01H,1
JP-4585597-B1,1,G06T,1
US-2010250927-A1,1,G09C,1
DE-102016002636-A1,1,G09F,1
CN-103236097-A,1,G06Q,1
IT-MI20121007-A1,1,B29D,1
CN-104006579-A,1,F28F,1
CN-111984853-A,1,G06K,1
JP-2005004407-A,1,G01C,1
CN-105021200-A,1,H04B,1
US-8105361-B2,1,A61M,1
KR-102104937-B1,1,H03M,1
US-8246777-B2,1,B32B,1
US-7427002-B2,1,A61B,1
US-8432798-B2,1,H04L,1
US-2022281264-A1,1,C14B,1
US-2011137007-A1,1,C12P,1
CN-104558752-A,1,C08L,1
DE-102020116746-A1,1,B23Q,1
US-9436499-B2,1,G06F,1
JP-7491100-B2,2,G06F,2
KR-102120403-B1,1,B65H,1
US-8412927-B2,2,H04L,2
CN-107478063-A,1,F27D,1
US-2018209348-A1,1,F01D,1
KR-20240013058-A,1,A61C,1
US-11911287-B2,1,B22F,1
US-2009028345-A1,1,H03D,1
JP-2009237637-A,1,G06F,1
US-2006220881-A1,1,A61B,1
US-11432771-B2,1,G16H,1
US-9001770-B2,1,H04B,1
US-3085045-A,1,A01N,1
US-2006016752-A1,1,A61K,1
JP-2024087319-A,1,B32B,1
US-5343935-A,1,F24F,1
US-9185094-B2,1,G06F,1
JP-2016164482-A,1,F25B,1
US-11284898-B2,1,A61F,1
US-2023046314-A1,1,H01J,1
US-4847105-A,1,A23D,1
CN-113828098-A,1,B01D,1
CN-114260559-A,1,B23K,1
US-2004105980-A1,1,C08J,1
CN-103249220-A,1,H05B,1
US-11224684-B2,1,A61M,1
RU-2652946-C1,1,G06Q,1
CN-100388758-C,1,G06T,1
CN-112359845-B,1,H02G,1
US-8329176-B2,2,C07K,2
US-8920346-B2,1,A61F,1
US-11526949-B1,1,G06Q,1
US-8240235-B2,1,C10M,1
US-11925536-B2,1,A61F,1
CN-102825319-A,1,B23C,1
US-7143574-B2,1,F01N,1
CN-112781617-B,1,G01C,1
CN-102621119-A,1,G02B,1
US-11320713-B2,1,G01B,1
EP-1076214-A1,1,H01J,1
CN-109814691-A,1,H05K,1
US-6350588-B1,1,C07C,1
JP-2006125909-A,1,G01N,1
CN-109760158-B,1,E04F,1
CN-113302042-B,1,A61C,1
JP-4711714-B2,1,B23B,1
CN-114393584-B,1,G03B,1
US-9526699-B2,1,C07C,1
CN-108278777-A,1,F02G,1
US-5933205-A,1,G02F,1
JP-2013506370-A,1,H04W,1
JP-2008506596-A,1,B42F,1
US-10709830-B2,1,G21G,1
US-2008259670-A1,1,G06F,1
CN-106818432-A,1,A01C,1
JP-2016203395-A,1,C08J,1
CN-106383277-A,1,G01K,1
CN-114658331-A,1,F04F,1
US-10076611-B2,1,A61M,1
JP-2016016174-A,1,A61B,1
US-11172929-B2,1,D04H,1
CN-106814744-A,1,G08C,1
US-10731810-B2,1,F21V,1

2025-01-24 01:58:26 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:58:26 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:58:26 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:58:27 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:58:27 - snowflake.connector.connection - INFO - closed
2025-01-24 01:58:28 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:58:28 - root - INFO - SQL:
SELECT "publication_number", "grant_date", "kind_code"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "country_code" = 'US'
  AND "kind_code" = 'B2'
  AND "grant_date" BETWEEN 20150101 AND 20181231
  AND "publication_number" IS NOT NULL
  AND "grant_date" IS NOT NULL
  AND "kind_code" IS NOT NULL
LIMIT 100
Results:
publication_number,grant_date,kind_code
US-9247876-B2,20160202,B2
US-9278232-B2,20160308,B2
US-9042220-B2,20150526,B2
US-9224188-B2,20151229,B2
US-8928865-B2,20150106,B2
US-9652521-B2,20170516,B2
US-9376833-B2,20160628,B2
US-9052538-B2,20150609,B2
US-9211492-B2,20151215,B2
US-9593581-B2,20170314,B2
US-9292737-B2,20160322,B2
US-9342526-B2,20160517,B2
US-8939137-B2,20150127,B2
US-9047554-B2,20150602,B2
US-9088106-B2,20150721,B2
US-9323683-B2,20160426,B2
US-8995452-B2,20150331,B2
US-9218976-B2,20151222,B2
US-9437584-B2,20160906,B2
US-9482626-B2,20161101,B2
US-9649467-B2,20170516,B2
US-9522418-B2,20161220,B2
US-10109894-B2,20181023,B2
US-9374093-B2,20160621,B2
US-9200455-B2,20151201,B2
US-9344086-B2,20160517,B2
US-9151039-B2,20151006,B2
US-9408896-B2,20160809,B2
US-9084802-B2,20150721,B2
US-10030011-B2,20180724,B2
US-9124016-B2,20150901,B2
US-9082138-B2,20150714,B2
US-9264218-B2,20160216,B2
US-9264318-B2,20160216,B2
US-9447659-B2,20160920,B2
US-9181374-B2,20151110,B2
US-10121971-B2,20181106,B2
US-9401795-B2,20160726,B2
US-9529473-B2,20161227,B2
US-9083090-B2,20150714,B2
US-9258578-B2,20160209,B2
US-9268979-B2,20160223,B2
US-9559610-B2,20170131,B2
US-9319849-B2,20160419,B2
US-9122593-B2,20150901,B2
US-10102455-B2,20181016,B2
US-9161055-B2,20151013,B2
US-9546744-B2,20170117,B2
US-9355294-B2,20160531,B2
US-9554160-B2,20170124,B2
US-9591529-B2,20170307,B2
US-10011949-B2,20180703,B2
US-9573763-B2,20170221,B2
US-10137283-B2,20181127,B2
US-10076323-B2,20180918,B2
US-9348862-B2,20160524,B2
US-9616068-B2,20170411,B2
US-9639475-B2,20170502,B2
US-9596378-B2,20170314,B2
US-10070538-B2,20180904,B2
US-10005712-B2,20180626,B2
US-10050540-B2,20180814,B2
US-10127843-B2,20181113,B2
US-10056669-B2,20180821,B2
US-10144284-B2,20181204,B2
US-10154644-B2,20181218,B2
US-9362717-B2,20160607,B2
US-9275036-B2,20160301,B2
US-8974982-B2,20150310,B2
US-8992882-B2,20150331,B2
US-9034622-B2,20150519,B2
US-8930147-B2,20150106,B2
US-9029140-B2,20150512,B2
US-9371099-B2,20160621,B2
US-9429369-B2,20160830,B2
US-8952769-B2,20150210,B2
US-9095517-B2,20150804,B2
US-8971612-B2,20150303,B2
US-9266071-B2,20160223,B2
US-9295586-B2,20160329,B2
US-9018534-B2,20150428,B2
US-9415834-B2,20160816,B2
US-9116906-B2,20150825,B2
US-8958899-B2,20150217,B2
US-9193657-B2,20151124,B2
US-9279473-B2,20160308,B2
US-9155586-B2,20151013,B2
US-8942526-B2,20150127,B2
US-8994624-B2,20150331,B2
US-9004129-B2,20150414,B2
US-9187733-B2,20151117,B2
US-8945898-B2,20150203,B2
US-9101361-B2,20150811,B2
US-8964683-B2,20150224,B2
US-9160895-B2,20151013,B2
US-9579464-B2,20170228,B2
US-9172497-B2,20151027,B2
US-8983152-B2,20150317,B2
US-9466138-B2,20161011,B2
US-9166674-B2,20151020,B2

2025-01-24 01:58:28 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:58:28 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:58:28 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:58:29 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:58:29 - snowflake.connector.connection - INFO - closed
2025-01-24 01:58:30 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:58:30 - root - INFO - SQL:
SELECT DISTINCT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
WHERE ipc_u.value:"code" IS NOT NULL
LIMIT 100
Results:
ipc4_code
G02F
H04M
A61F
F16S
B23D
C10N
B03D
F23K
H04Q
G02C
F16M
C09J
E06B
C03C
F25J
G21K
B61L
F28G
F16F
B29L
D21H
C12J
B44D
D21D
H01B
C01F
G01Q
D06B
H04K
F25C
G04B
G06M
C10J
H05C
G02B
B66F
B63B
C09D
F02M
H03J
B62L
B21H
G06Q
C05G
H01Q
E02F
B25H
F01B
C12H
B62C
D04D
A41H
G06N
C12M
H04J
D07B
E04D
A43C
C06D
H04W
F28B
C08F
B21D
A47L
B26D
B02C
B61G
B21F
G04C
D06G
A61D
F16P
B61C
A61G
A46D
B64U
F21V
F42B
B41L
A21D
B03C
A47J
A47D
C05D
B09C
B01D
E05F
G07C
H03K
B29B
F02P
B31B
D05C
F04F
B05B
B30B
H04B
B41M
G08G
C08L

2025-01-24 01:58:30 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:58:30 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:58:30 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:58:35 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 01:58:35 - snowflake.connector.connection - INFO - closed
2025-01-24 01:58:35 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:58:36 - root - INFO - SQL:
SELECT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code",
       COUNT(DISTINCT t."publication_number") AS "num_patents"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
WHERE ipc_u.value:"code" IS NOT NULL
GROUP BY "ipc4_code"
LIMIT 100
Results:
ipc4_code,num_patents
B23P,1751
F24S,529
D06M,988
C23F,509
G03F,2029
B66D,402
B60H,942
B64F,288
D21J,60
H01F,2836
A44B,503
B41C,132
H04Q,1514
G21K,230
G02C,633
C03C,1251
B61L,388
E06B,2590
F16M,1933
C09J,1802
F25J,201
B60L,1748
H01P,718
E04C,1375
G05G,343
C12R,1321
F26B,2195
B06B,237
C06C,30
B67B,283
D01D,538
C13K,52
B68C,7
C01F,409
H04K,131
F25C,227
G04B,503
C10J,271
G06M,186
H01B,2722
D06B,581
G01Q,98
H05C,11
H04M,3785
B23D,1208
A61F,4363
G02F,3969
C10N,375
F23K,232
F16S,98
B03D,127
G06Q,6681
H01Q,1762
B25H,714
E02F,1094
C05G,513
A41H,189
F01B,133
C12H,112
D04D,30
B62C,3
A23C,453
G01B,3552
B27B,275
F21L,194
B28D,506
B66B,1310
A22C,388
A01M,1137
B29L,1366
D21H,814
B44D,174
F16F,2484
F28G,139
C12J,47
D21D,89
G21F,339
G08B,2376
H02K,4007
A42B,343
C23C,3294
F16G,340
B23C,448
A01J,133
G01J,1065
A63D,73
Y02E,1
C01B,2737
C09C,366
D01H,483
E05D,718
C10M,693
G06G,179
G16C,62
E02C,17
B24B,2837
C04B,3224
F16D,2211
B05C,1394
B60Q,966

2025-01-24 01:58:36 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:58:36 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:58:36 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:58:37 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-24 01:58:37 - snowflake.connector.connection - INFO - closed
2025-01-24 01:58:37 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 01:59:46 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 01:59:46 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit_u
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc_u
)

SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number"
ORDER BY
    "num_distinct_cited_ipc4_codes" DESC,
    "n_i" DESC
LIMIT 1;
```

**Explanation:**

- **Purpose:** This query identifies the U.S. patents under the B2 classification granted between 2015 and 2018, calculates the number of backward citations (`n_i`), and counts the number of distinct 4-digit IPC codes in those backward citations (`num_distinct_cited_ipc4_codes`).

- **Simplifications Made:**
  - Removed restrictive `WHERE` clauses that filtered out null values, which might have led to no data being returned.
  - Used `LEFT JOIN` instead of `INNER JOIN` to ensure that all citations are considered, even if some cited publications do not have IPC codes.
  - Removed `IS NOT NULL` conditions to include all possible data.

- **Query Breakdown:**
  - **`us_patents` CTE:**
    - Selects all U.S. patents with kind code 'B2' granted between 2015 and 2018.
  - **`citing_citations` CTE:**
    - Retrieves all backward citations (`cited_publication_number`) for each patent in `us_patents`.
  - **`cited_ipc_codes` CTE:**
    - Extracts the 4-digit IPC codes (`cited_ipc4_code`) from the cited publications.
  - **Main Query:**
    - Joins `citing_citations` with `cited_ipc_codes` on `cited_publication_number`.
    - Calculates:
      - `n_i`: Total number of backward citations per patent.
      - `num_distinct_cited_ipc4_codes`: Number of distinct 4-digit IPC codes cited.
    - Orders the results to find the patent with the highest `num_distinct_cited_ipc4_codes`.
    - Limits the output to one patent (the one with the highest originality score).

By simplifying the conditions and removing restrictive filters, this query should return data that allows you to identify the publication number of the U.S. patent with the highest originality score based on the diversity of 4-digit IPC codes from its backward citations.
2025-01-24 01:59:46 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 01:59:46 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 01:59:46 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 01:59:48 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-24 01:59:48 - snowflake.connector.connection - INFO - closed
2025-01-24 01:59:48 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:00:52 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:00:52 - root - INFO - SQL:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit_u
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc_u
)

SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number"
ORDER BY
    "num_distinct_cited_ipc4_codes" DESC,
    "n_i" DESC
LIMIT 1;
Results:
publication_number,n_i,num_distinct_cited_ipc4_codes
US-9121016-B2,79,9

2025-01-24 02:00:52 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:00:52 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:00:52 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:00:54 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 02:00:54 - snowflake.connector.connection - INFO - closed
2025-01-24 02:00:55 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:01:22 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:01:22 - root - INFO - ```sql
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_sections AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 1) AS "ipc_section"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    cic."ipc_section",
    COUNT(*) AS "num_citations_to_section"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_sections cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."ipc_section"
LIMIT 100;
```
2025-01-24 02:01:22 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:01:22 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:01:22 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:01:24 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 02:01:24 - snowflake.connector.connection - INFO - closed
2025-01-24 02:01:24 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:01:48 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:01:48 - root - INFO - SQL:
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_sections AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 1) AS "ipc_section"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    cic."ipc_section",
    COUNT(*) AS "num_citations_to_section"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_sections cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."ipc_section"
LIMIT 100;
Results:
publication_number,ipc_section,num_citations_to_section
US-2016363905-A1,G,1
US-8440053-B2,C,1
CN-113524200-A,G,2
CN-116046825-A,G,2
US-2005265933-A1,A,5
US-2006229833-A1,G,4
US-2006058878-A1,A,7
US-6847194-B2,F,1
KR-20240013058-A,A,4
KR-20160000642-A,B,1
US-2021124116-A1,G,2
US-4349216-A,B,1
US-11529926-B2,B,3
US-3256058-A,C,1
WO-2020115607-A3,F,1
US-2581165-A,F,1
US-2841043-A,G,2
US-2004123746-A1,A,3
CN-102916505-A,H,2
CN-109402482-A,C,1
US-11532457-B2,H,13
CN-102275861-A,H,10
KR-20170133463-A,H,2
CN-103096255-A,H,1
CN-109595630-A,F,1
CN-104518014-A,H,3
KR-102607197-B1,B,1
US-11092593-B2,B,2
US-10576130-B2,G,1
CN-104571337-A,G,1
WO-2024108987-A1,H,7
US-9158133-B1,C,2
JP-2014102607-A,H,2
JP-2016099816-A,G,2
CN-106687325-A,F,2
CN-108770666-A,A,1
US-11829958-B2,G,5
US-10985142-B2,H,3
US-11642422-B2,A,5
US-10625938-B2,A,1
US-8532586-B2,H,1
US-10600860-B2,H,3
US-11172929-B2,D,5
US-2008271384-A1,B,2
US-2626395-A,A,1
US-2022280127-A1,H,1
US-6806242-B2,A,1
US-2007129352-A1,A,1
US-7977993-B2,H,2
US-2005038588-A1,B,4
US-9211498-B2,A,1
CN-107786878-A,H,4
CN-113721260-B,G,1
CN-109735315-B,E,2
CN-109577202-A,E,1
JP-S6416634-U,H,1
US-7631501-B2,F,4
US-8920346-B2,A,5
US-6358233-B1,A,3
US-8797684-B1,G,3
US-2007122905-A1,C,1
CN-104291800-A,E,1
CN-109120127-A,H,1
CN-107393312-A,G,2
US-10606257-B2,H,1
US-2022182297-A1,G,2
CN-104029081-A,B,2
CN-114147143-A,B,1
CN-106899198-B,H,3
CN-103320995-A,D,2
CN-114200338-B,G,1
JP-2012018889-A,H,2
CN-108735419-A,F,1
US-9173003-B2,H,6
DE-10057101-C1,E,2
DE-102017107615-B3,G,2
CN-101372863-A,E,1
CN-106470614-A,A,3
CN-101906236-B,C,5
CN-113668132-A,D,1
CN-109624572-B,B,2
US-2019278199-A1,G,2
US-4349028-A,A,2
JP-2016164482-A,F,1
US-2010037524-A1,E,6
US-10670435-B2,G,1
WO-2015161825-A1,D,1
US-2019119050-A1,B,5
US-2650292-A,G,4
JP-2013098141-A,B,2
CN-106369052-A,F,2
GB-2315354-A,G,2
US-2009039418-A1,H,4
US-2010256194-A1,C,2
JP-S61166186-A,H,2
US-5251239-A,H,3
US-2010132221-A1,C,1
US-11058417-B2,A,4
US-2010208258-A1,G,4
JP-2007122992-A,H,14

2025-01-24 02:01:48 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:01:48 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:01:48 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:01:50 - snowflake.connector.cursor - INFO - Number of results in first chunk: 100
2025-01-24 02:01:50 - snowflake.connector.connection - INFO - closed
2025-01-24 02:01:50 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:01:50 - root - INFO - SQL:
SELECT
    t."publication_number" AS "citing_publication_number",
    cit_u.value:"publication_number"::STRING AS "cited_publication_number",
    COUNT(cit_u.value:"publication_number"::STRING) OVER (PARTITION BY t."publication_number") AS "total_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation") cit_u
WHERE
    cit_u.value:"publication_number" IS NOT NULL
LIMIT 100
Results:
citing_publication_number,cited_publication_number,total_backward_citations
US-5271502-A,US-329676-A,11
US-5271502-A,US-821019-A,11
US-5271502-A,US-856881-A,11
US-5271502-A,US-909734-A,11
US-5271502-A,US-2756515-A,11
US-5271502-A,US-4262838-A,11
US-5271502-A,US-4415081-A,11
US-5271502-A,US-4730727-A,11
US-5271502-A,US-5064069-A,11
US-5271502-A,US-5088602-A,11
US-5271502-A,US-5193681-A,11
JP-S63170789-A,JP-S61223991-A,3
JP-S63170789-A,JP-S61239384-A,3
JP-S63170789-A,JP-S61253411-A,3
JP-S60150936-A,JP-S58143934-A,1
JP-S5289187-A,JP-S4926393-A,2
JP-S5289187-A,JP-S5096679-A,2
JP-H02185342-A,JP-S6084232-U,2
JP-H02185342-A,JP-S617110-A,2
JP-S60151563-A,JP-S5370474-A,3
JP-S60151563-A,JP-S5630614-A,3
JP-S60151563-A,JP-S5672349-A,3
JP-S59135502-A,JP-S4932093-A,6
JP-S59135502-A,JP-S5042284-A,6
JP-S59135502-A,JP-S5490467-A,6
JP-S59135502-A,JP-S5528838-A,6
JP-S59135502-A,JP-S5598083-A,6
JP-S59135502-A,JP-S56123017-A,6
JP-H03213929-A,JP-S6419260-A,1
TR-25908-A,DE-1286866-B,5
TR-25908-A,,5
TR-25908-A,,5
TR-25908-A,,5
TR-25908-A,,5
US-5249405-A,US-1212843-A,17
US-5249405-A,US-1533411-A,17
US-5249405-A,US-1783391-A,17
US-5249405-A,US-2180651-A,17
US-5249405-A,US-2236082-A,17
US-5249405-A,US-2429113-A,17
US-5249405-A,US-2612813-A,17
US-5249405-A,US-2816436-A,17
US-5249405-A,US-3343329-A,17
US-5249405-A,US-3436883-A,17
US-5249405-A,US-3901471-A,17
US-5249405-A,US-4448007-A,17
US-5249405-A,US-4481749-A,17
US-5249405-A,US-4498272-A,17
US-5249405-A,US-4782642-A,17
US-5249405-A,US-4844651-A,17
US-5249405-A,US-4995605-A,17
US-2595898-A,DE-657012-C,4
US-2595898-A,US-2112606-A,4
US-2595898-A,DE-680782-C,4
US-2595898-A,US-2484341-A,4
US-6113523-A,US-4185816-A,4
US-6113523-A,US-4378939-A,4
US-6113523-A,US-4787626-A,4
US-6113523-A,US-5186702-A,4
US-5387642-A,GB-1601033-A,4
US-5387642-A,US-4608413-A,4
US-5387642-A,US-4945128-A,4
US-5387642-A,US-5004779-A,4
US-2529330-A,US-1224109-A,6
US-2529330-A,US-1320530-A,6
US-2529330-A,US-1442795-A,6
US-2529330-A,FR-621941-A,6
US-2529330-A,US-1678798-A,6
US-2529330-A,US-2424578-A,6
GB-2362054-A,US-2491561-A,7
GB-2362054-A,US-5014134-A,7
GB-2362054-A,US-5321776-A,7
GB-2362054-A,US-5392255-A,7
GB-2362054-A,US-5602589-A,7
GB-2362054-A,US-5706220-A,7
GB-2362054-A,US-5737448-A,7
GB-2371668-A,US-3742448-A,6
GB-2371668-A,DE-2613558-A1,6
GB-2371668-A,GB-1547559-A,6
GB-2371668-A,US-4651127-A,6
GB-2371668-A,US-5483221-A,6
GB-2371668-A,US-5714930-A,6
GB-2371503-A,GB-2039306-A,4
GB-2371503-A,JP-S6385189-A,4
GB-2371503-A,FR-2681288-A1,4
GB-2371503-A,DE-4317556-A1,4
GB-2398268-A,US-5236421-A,2
GB-2398268-A,US-5397639-A,2
GB-2383711-A,JP-H0193895-U,7
GB-2383711-A,US-5133428-A,7
GB-2383711-A,JP-H05553-U,7
GB-2383711-A,JP-H05116570-A,7
GB-2383711-A,JP-H07274286-A,7
GB-2383711-A,JP-H11151989-A,7
GB-2383711-A,US-2001002632-A1,7
GB-2410868-A,GB-2242335-A,7
GB-2410868-A,EP-1026895-A1,7
GB-2410868-A,WO-0141408-A1,7
GB-2410868-A,US-2002066115-A1,7
GB-2410868-A,WO-0243389-A1,7

2025-01-24 02:01:50 - root - INFO - itercount: 0
2025-01-24 02:01:50 - root - INFO - Database Name: PATENTS
Schema Name: PATENTS
DDL describes table information.
,0
table_name,DISCLOSURES_13
description,
DDL,"create or replace TABLE DISCLOSURES_13 (
	""family_id"" VARCHAR(16777216),
	""record_id"" VARCHAR(16777216),
	""disclosure_event"" VARCHAR(16777216),
	""sso"" VARCHAR(16777216),
	""patent_owner_harmonized"" VARCHAR(16777216),
	""patent_owner_unharmonized"" VARCHAR(16777216),
	""date"" NUMBER(38,0),
	""standard"" VARCHAR(16777216),
	""committee_project"" VARCHAR(16777216),
	""tc_name"" VARCHAR(16777216),
	""sc_name"" VARCHAR(16777216),
	""wg_name"" VARCHAR(16777216),
	""licensing_commitment"" VARCHAR(16777216),
	""copyright"" VARCHAR(16777216),
	""blanket_type"" VARCHAR(16777216),
	""blanket_scope"" VARCHAR(16777216),
	""third_party"" VARCHAR(16777216),
	""reciprocity"" VARCHAR(16777216),
	""serial_cleaned"" VARCHAR(16777216),
	""pub_cleaned"" VARCHAR(16777216)
);"

,1
table_name,PUBLICATIONS
description,
DDL,"create or replace TABLE PUBLICATIONS (
	""publication_number"" VARCHAR(16777216),
	""application_number"" VARCHAR(16777216),
	""country_code"" VARCHAR(16777216),
	""kind_code"" VARCHAR(16777216),
	""application_kind"" VARCHAR(16777216),
	""application_number_formatted"" VARCHAR(16777216),
	""pct_number"" VARCHAR(16777216),
	""family_id"" VARCHAR(16777216),
	""spif_publication_number"" VARCHAR(16777216),
	""spif_application_number"" VARCHAR(16777216),
	""title_localized"" VARIANT,
	""abstract_localized"" VARIANT,
	""claims_localized"" VARIANT,
	""claims_localized_html"" VARIANT,
	""description_localized"" VARIANT,
	""description_localized_html"" VARIANT,
	""publication_date"" NUMBER(38,0),
	""filing_date"" NUMBER(38,0),
	""grant_date"" NUMBER(38,0),
	""priority_date"" NUMBER(38,0),
	""priority_claim"" VARIANT,
	""inventor"" VARIANT,
	""inventor_harmonized"" VARIANT,
	""assignee"" VARIANT,
	""assignee_harmonized"" VARIANT,
	""examiner"" VARIANT,
	""uspc"" VARIANT,
	""ipc"" VARIANT,
	""cpc"" VARIANT,
	""fi"" VARIANT,
	""fterm"" VARIANT,
	""locarno"" VARIANT,
	""citation"" VARIANT,
	""parent"" VARIANT,
	""child"" VARIANT,
	""entity_status"" VARCHAR(16777216),
	""art_unit"" VARCHAR(16777216)
);"

,2
table_name,CPC_DEFINITION
description,
DDL,"create or replace TABLE CPC_DEFINITION (
	""applicationReferences"" VARIANT,
	""breakdownCode"" BOOLEAN,
	""childGroups"" VARIANT,
	""children"" VARIANT,
	""dateRevised"" FLOAT,
	""definition"" VARIANT,
	""glossary"" VARIANT,
	""informativeReferences"" VARIANT,
	""ipcConcordant"" VARCHAR(16777216),
	""level"" FLOAT,
	""limitingReferences"" VARIANT,
	""notAllocatable"" BOOLEAN,
	""parents"" VARIANT,
	""precedenceLimitingReferences"" VARIANT,
	""residualReferences"" VARIANT,
	""rules"" VARIANT,
	""scopeLimitingReferences"" VARIANT,
	""status"" VARCHAR(16777216),
	""symbol"" VARCHAR(16777216),
	""synonyms"" VARIANT,
	""titleFull"" VARCHAR(16777216),
	""titlePart"" VARIANT
);"

External knowledge that might be helpful: 
### IPC Codes: Handling Main IPC Code Selection

When dealing with the `ipc` field in the `patents-public-data.patents.publications` dataset, it is important to understand the structure of this field, especially the subfield `first`. This subfield is a boolean that indicates whether a given IPC code is the main code for the publication number in question. This is crucial because each patent publication can be associated with multiple IPC codes, signifying the various aspects of the technology covered by the patent.

However, not every publication in the dataset has a designated main IPC code. This lack of a clearly identified main IPC code complicates the process of determining the most relevant IPC code for each publication, as selecting a single IPC code from multiple possibilities without clear prioritization can lead to inconsistent or skewed analyses.

This approach ensures a more consistent and representative selection of IPC codes across the dataset, facilitating more accurate and meaningful analysis of patent trends and classifications. By focusing on the most frequently occurring 4-digit IPC code, the view helps overcome the limitations posed by the absence of a designated main IPC code, thereby enhancing the reliability of patent-related studies and insights derived from this data.

Here is an example

```
SELECT 
    t1.publication_number, 
    SUBSTR(ipc_u.code, 0, 4) as ipc4, 
    COUNT(
    SUBSTR(ipc_u.code, 0, 4)
    ) as ipc4_count 
FROM 
    `patents-public-data.patents.publications` t1, 
    UNNEST(ipc) AS ipc_u 
GROUP BY 
    t1.publication_number, 
    ipc4

```



# Text Embeddings (Similarity)

Patent documents are rich with textual data. In fact, most of the information contained in a patent document is text. This includes the `abstract_localized`, `description_localized`, and `claims_localized`. Textual data can be a powerful tool to analyze and compare patent scope and content across patents. However, before being able to use textual data, it needs to be vectorized or transformed into text embeddings that can be used by machine learning models. Therefore, creating text embeddings from the textual data of patents is necessary to compare patent contents. Technically speaking, running an NLP algorithm that creates embeddings for all U.S. patents is computationally difficult.

Nevertheless, Google runs their own machine learning algorithm which transforms patent text metadata into text embeddings which they report in `patents-public-data.google_patents_research.publications` table. The textual embeddings of one patent, without any knowledge on the algorithm being used to create them, are meaningless on their own. However, the embeddings are powerful when it comes to comparing textual content of two or more patents. Embeddings can be used to calculate a similarity score between any two patents. This similarity score is calculated by applying the dot product of the embeddings vector of the patents, as shown below:

The similarity \( \text{Similarty}_{i,k} \) between two patents \( i \) and \( k \) is calculated as the dot product of their embedding vectors:

\[
\text{Similarty}_{i,k} = \mathbf{v}_i \cdot \mathbf{v}_k
\]

where

\[
\mathbf{v}_i = [v_{i1}, v_{i2}, v_{i3}, \ldots, v_{iN}]
\]
and
\[
\mathbf{v}_k = [v_{k1}, v_{k2}, v_{k3}, \ldots, v_{kN}]
\]

are the embedding vectors for patents \( i \) and \( k \) respectively. The higher the dot product, the more similar the patents.





# Originality (Trajtenberg)

One of the most important measures of a patent is "basicness". The aspects of basicness are tough to measure. Nevertheless, some literature finds that important aspects of these measures are embodied in the relationship between the invention and the technological predcessors and successors it is connected to through, for example, patent citations. We can thus use patent citations to construct measures that identify basicness and appropriability. Trajtenberg et al. 1997 provide a number of these measures. They distinguish between:

1. Forward-looking measures: measures that are derived from the relationship between an invention and subsequent technologies that build upon it. These measures are thus constructed from the forward citations. One example of a forward-looking basicness measure they provide is Generality, which is calculated as:

\[
\text{GENERALITY}_i = 1 - \sum_{k=1}^{N_i} \left( \frac{\text{NCITING}_{G_k}}{\text{NCITING}_i} \right)
\]


2. Backward-looking measures: measures that are derived from the relationship between a given patent and the body of knowledge that preceded it. These measure are thus constructed from the backward citations. One example of a backward-looking basicness measure they provide is Orginality, which is calculated as:

\[
\text{ORIGINALITY}_i = 1 - \sum_{k=1}^{N_i} \left( \frac{\text{NCITED}_{i,k}}{\text{NCITED}_i} \right)
\]

With **NCITING** and **NCITED** defined as the number of patents citing the focal patent and the number of patents cited by the focal patent, respectively. Index `i` corresponds to the focal patent considered, and `k` is the index of patent classes. For example, **NCITED_2,3** refers to the number of patents in patent class 3 and cited by our focal patent 2.


The table structure information is ({database name: {schema name: {table name}}}): 
{'PATENTS': {'PATENTS': ['CPC_DEFINITION', 'DISCLOSURES_13', 'PUBLICATIONS']}}
Begin Exploring Related Columns
**Relevant Tables and Columns:**

**Table:** `PATENTS.PATENTS.PUBLICATIONS`

- `"publication_number"`: Identifies each patent.
  
- `"country_code"`: To filter US patents. **Condition:** `"country_code" = 'US'`.

- `"kind_code"`: To filter patents with 'B2' classification. **Condition:** `"kind_code" = 'B2'`.

- `"grant_date"`: To filter patents granted between 2015 and 2018. **Condition:** `"grant_date" BETWEEN 20150101 AND 20181231`.

- `"ipc"`: Contains IPC codes of the patent.

- `"citation"`: Contains backward citations; need to extract cited publication numbers.

- `"ipc".code`: The IPC code for each entry in the `"ipc"` VARIANT array.

- Backward citations' IPC codes: Need to obtain IPC codes for cited patents.

**Possible Conditions:**

- Filter to US patents with kind code 'B2' and grant dates between 2015 and 2018.

- Extract 4-digit IPC codes from IPC codes.

- Extract backward citations from `"citation"` field.

- Join backward citations with cited patents to get their IPC codes.

- Calculate counts for originality score.

---

**SQL Queries:**

1. **Select publication numbers of US patents:**

    ```sql
    SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
    ```

2. **Select publication numbers and kind codes of US patents:**

    ```sql
    SELECT "publication_number", "kind_code"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
    ```

3. **Select publication numbers of US patents with kind code 'B2':**

    ```sql
    SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2'
    LIMIT 100;
    ```

4. **Select publication numbers and grant dates of US patents with kind code 'B2' granted between 2015 and 2018:**

    ```sql
    SELECT "publication_number", "grant_date"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2' AND "grant_date" BETWEEN 20150101 AND 20181231
    LIMIT 100;
    ```

5. **Select publication numbers and IPC codes:**

    ```sql
    SELECT "publication_number", "ipc"
    FROM PATENTS.PATENTS.PUBLICATIONS
    LIMIT 100;
    ```

6. **Flatten the "ipc" field to get individual IPC codes for patents:**

    ```sql
    SELECT t."publication_number", ipc_u.value:"code"::STRING AS "ipc_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
    ```

7. **Get 4-digit IPC codes for each patent:**

    ```sql
    SELECT t."publication_number", SUBSTR(ipc_u.value:"code"::STRING, 0, 4) AS "ipc4_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
    ```

8. **Get backward citations for patents:**

    ```sql
    SELECT t."publication_number", cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."citation") cit_u
    LIMIT 100;
    ```

9. **Get backward citations and their IPC codes:**

    ```sql
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number",
        cited_ipc_u.value:"code"::STRING AS "cited_ipc_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    LIMIT 100;
    ```

10. **Get the 4-digit IPC codes of the backward citations:**

    ```sql
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    LIMIT 100;
    ```

11. **Count the number of backward citations per citing patent:**

    ```sql
    SELECT
        t."publication_number",
        COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "num_backward_citations"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
    GROUP BY t."publication_number"
    LIMIT 100;
    ```

12. **Count the number of backward citations per 4-digit IPC code per patent:**

    ```sql
    SELECT
        t."publication_number" AS "citing_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 4) AS "cited_ipc4_code",
        COUNT(*) AS "num_citations_to_ipc4"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    GROUP BY t."publication_number", "cited_ipc4_code"
    LIMIT 100;
    ```

13. **Select patents with their total number of backward citations and distinct 4-digit IPC codes in their backward citations:**

    ```sql
    SELECT
        t."publication_number",
        COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "num_backward_citations",
        COUNT(DISTINCT SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 4)) AS "num_distinct_cited_ipc4_codes"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    GROUP BY t."publication_number"
    LIMIT 100;
    ```

14. **Get the counts needed to compute the originality score for each patent:**

    ```sql
    SELECT
        t."publication_number",
        COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "n_i",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 4) AS "cited_ipc4_code",
        COUNT(*) AS "n_i_k"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    GROUP BY t."publication_number", "cited_ipc4_code"
    LIMIT 100;
    ```

15. **Select patents with their grant dates and kind codes for specific filtering:**

    ```sql
    SELECT "publication_number", "grant_date", "kind_code"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2' AND "grant_date" BETWEEN 20150101 AND 20181231
    LIMIT 100;
    ```

16. **List distinct 4-digit IPC codes from IPC codes:**

    ```sql
    SELECT DISTINCT SUBSTR(ipc_u.value:"code"::STRING, 0, 4) AS "ipc4_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
    ```

17. **Count number of patents per 4-digit IPC code:**

    ```sql
    SELECT SUBSTR(ipc_u.value:"code"::STRING, 0, 4) AS "ipc4_code", COUNT(DISTINCT t."publication_number") AS "num_patents"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    GROUP BY "ipc4_code"
    LIMIT 100;
    ```

18. **Get the backward citations and their counts per cited IPC code for a specific patent:**

    ```sql
    SELECT
        t."publication_number" AS "citing_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 4) AS "cited_ipc4_code",
        COUNT(*) AS "num_citations_to_ipc4"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t
        LEFT JOIN LATERAL FLATTEN(input => t."citation") cit_u ON TRUE
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number"
        LEFT JOIN LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u ON TRUE
    WHERE t."publication_number" = 'some_publication_number'
    GROUP BY t."publication_number", "cited_ipc4_code"
    LIMIT 100;
    ```

19. **Select patents and their backward citations counts to IPC sections (first letter of IPC code):**

    ```sql
    SELECT
        t."publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 0, 1) AS "ipc_section",
        COUNT(*) AS "num_citations_to_section"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
        LEFT JOIN PATENTS.PATENTS.PUBLICATIONS cited_pubs
            ON cit_u.value:"publication_number"::STRING = cited_pubs."publication_number",
        LATERAL FLATTEN(input => cited_pubs."ipc") cited_ipc_u
    GROUP BY t."publication_number", "ipc_section"
    LIMIT 100;
    ```

20. **List the patents along with their backward citations and associated counts for understanding distribution:**

    ```sql
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number",
        COUNT(*) OVER (PARTITION BY t."publication_number") AS "total_backward_citations"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
    LIMIT 100;
    ```

These queries help explore the relevant data and understand how to process the necessary fields to compute the originality score based on the diversity of 4-digit IPC codes from backward citations.Query:
SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
Answer:
publication_number
US-2006143594-A1
US-2006143284-A1
US-2006148139-A1
US-2006152123-A1
US-2006150698-A1
US-2005254871-A1
US-2005168584-A1
US-2005161997-A1
US-2005175186-A1
US-2006175765-A1
US-2005150005-A1
US-2006118954-A1
US-2005148066-A1
US-2006010011-A1
US-2006183586-A1
US-2005189252-A1
US-2005184759-A1
US-2005144256-A1
US-2006195821-A1
US-2005143653-A1
US-2006198380-A1
US-2006118870-A1
US-2005253263-A1
US-2006197375-A1
US-2005222693-A1
US-2005180450-A1
US-2006212456-A1
US-2005218642-A1
US-2005176269-A1
US-2006228959-A1
US-2006252404-A1
US-2006224211-A1
US-2006241817-A1
US-2005237771-A1
US-2005243216-A1
US-2005249541-A1
US-2006089219-A1
US-2005271201-A1
US-2005216965-A1
US-2005267909-A1
US-2006266770-A1
US-2005270599-A1
US-2006079895-A1
US-2005273202-A1
US-2006001866-A1
US-2006006761-A1
US-2006287882-A1
US-2005216567-A1
US-2006209512-A1
US-2006000939-A1
US-2006091163-A1
US-2007009364-A1
US-2006023254-A1
US-2005257319-A1
US-2007004239-A1
US-2006040365-A1
US-2005276065-A1
US-2007039052-A1
US-2006045302-A1
US-2006204424-A1
US-2007011371-A1
US-2007061140-A1
US-2006180497-A1
US-2007069906-A1
US-2006028190-A1
US-2006036325-A1
US-2006034112-A1
US-2007114474-A1
US-2006047060-A1
US-2006039234-A1
US-2006113251-A1
US-2006122815-A1
US-2007106350-A1
US-2006218841-A1
US-2006131931-A1
US-2007107149-A1
US-2006234529-A1
US-2006136397-A1
US-2006079849-A1
US-2006186294-A1
US-2006261821-A1
US-2006145963-A1
US-2006128522-A1
US-2006090877-A1
US-2007071085-A1
US-2007053149-A1
US-2007159350-A1
US-2006206019-A1
US-2006147574-A1
US-2006144602-A1
US-2006112201-A1
US-2006112495-A1
US-2006182055-A1
US-2007163684-A1
US-2007112592-A1
US-2006172276-A1
US-2006129939-A1
US-2006172084-A1
US-2006185810-A1
US-2007085071-A1
Query:
SELECT "publication_number", "kind_code"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US'
    LIMIT 100;
Answer:
publication_number,kind_code
US-2006143594-A1,A1
US-2006143284-A1,A1
US-2006148139-A1,A1
US-2006152123-A1,A1
US-2006150698-A1,A1
US-2005254871-A1,A1
US-2005168584-A1,A1
US-2005161997-A1,A1
US-2005175186-A1,A1
US-2006175765-A1,A1
US-2005150005-A1,A1
US-2006118954-A1,A1
US-2005148066-A1,A1
US-2006010011-A1,A1
US-2006183586-A1,A1
US-2005189252-A1,A1
US-2005184759-A1,A1
US-2005144256-A1,A1
US-2006195821-A1,A1
US-2005143653-A1,A1
US-2006198380-A1,A1
US-2006118870-A1,A1
US-2005253263-A1,A1
US-2006197375-A1,A1
US-2005222693-A1,A1
US-2005180450-A1,A1
US-2006212456-A1,A1
US-2005218642-A1,A1
US-2005176269-A1,A1
US-2006228959-A1,A1
US-2006252404-A1,A1
US-2006224211-A1,A1
US-2006241817-A1,A1
US-2005237771-A1,A1
US-2005243216-A1,A1
US-2005249541-A1,A1
US-2006089219-A1,A1
US-2005271201-A1,A1
US-2005216965-A1,A1
US-2005267909-A1,A1
US-2006266770-A1,A1
US-2005270599-A1,A1
US-2006079895-A1,A1
US-2005273202-A1,A1
US-2006001866-A1,A1
US-2006006761-A1,A1
US-2006287882-A1,A1
US-2005216567-A1,A1
US-2006209512-A1,A1
US-2006000939-A1,A1
US-2006091163-A1,A1
US-2007009364-A1,A1
US-2006023254-A1,A1
US-2005257319-A1,A1
US-2007004239-A1,A1
US-2006040365-A1,A1
US-2005276065-A1,A1
US-2007039052-A1,A1
US-2006045302-A1,A1
US-2006204424-A1,A1
US-2007011371-A1,A1
US-2007061140-A1,A1
US-2006180497-A1,A1
US-2007069906-A1,A1
US-2006028190-A1,A1
US-2006036325-A1,A1
US-2006034112-A1,A1
US-2007114474-A1,A1
US-2006047060-A1,A1
US-2006039234-A1,A1
US-2006113251-A1,A1
US-2006122815-A1,A1
US-2007106350-A1,A1
US-2006218841-A1,A1
US-2006131931-A1,A1
US-2007107149-A1,A1
US-2006234529-A1,A1
US-2006136397-A1,A1
US-2006079849-A1,A1
US-2006186294-A1,A1
US-2006261821-A1,A1
US-2006145963-A1,A1
US-2006128522-A1,A1
US-2006090877-A1,A1
US-2007071085-A1,A1
US-2007053149-A1,A1
US-2007159350-A1,A1
US-2006206019-A1,A1
US-2006147574-A1,A1
US-2006144602-A1,A1
US-2006112201-A1,A1
US-2006112495-A1,A1
US-2006182055-A1,A1
US-2007163684-A1,A1
US-2007112592-A1,A1
US-2006172276-A1,A1
US-2006129939-A1,A1
US-2006172084-A1,A1
US-2006185810-A1,A1
US-2007085071-A1,A1
Query:
SELECT "publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2'
    LIMIT 100;
Answer:
publication_number
US-8857551-B2
US-9370027-B2
US-9042351-B2
US-10561638-B2
US-8962445-B2
US-9270639-B2
US-8938152-B2
US-9389656-B2
US-9482287-B2
US-9386020-B2
US-10142276-B2
US-9216545-B2
US-9548844-B2
US-9111730-B2
US-9340798-B2
US-10324723-B2
US-9190745-B2
US-9380603-B2
US-9650743-B2
US-10140934-B2
US-9556907-B2
US-9567200-B2
US-10722723-B2
US-9188941-B2
US-9048861-B2
US-9460689-B2
US-9318050-B2
US-10533556-B2
US-9520094-B2
US-9412846-B2
US-10070142-B2
US-9585927-B2
US-9415120-B2
US-10533291-B2
US-9329543-B2
US-10487804-B2
US-9502685-B2
US-9434993-B2
US-10120886-B2
US-9343259-B2
US-10025922-B2
US-10093135-B2
US-11058417-B2
US-10791626-B2
US-10040253-B2
US-10268050-B2
US-9595167-B2
US-9425382-B2
US-10292858-B2
US-10439992-B2
US-10463632-B2
US-10040372-B2
US-11043142-B2
US-10096317-B2
US-10620487-B2
US-9616746-B2
US-10132013-B2
US-10075410-B2
US-11055623-B2
US-10501667-B2
US-10614930-B2
US-11100138-B2
US-10294485-B2
US-10420148-B2
US-10192648-B2
US-10799929-B2
US-10132055-B2
US-10306558-B2
US-10266255-B2
US-11229607-B2
US-11099445-B2
US-10918669-B2
US-10104056-B2
US-10170592-B2
US-10949373-B2
US-10637868-B2
US-10828230-B2
US-10612778-B2
US-10891534-B2
US-10827186-B2
US-10798073-B2
US-10574908-B2
US-10199059-B2
US-10178137-B2
US-10377792-B2
US-10141686-B2
US-11154290-B2
US-10891268-B2
US-10141468-B2
US-10941196-B2
US-10543714-B2
US-10513055-B2
US-10968393-B2
US-10630153-B2
US-10418599-B2
US-10128451-B2
US-10150865-B2
US-10483008-B2
US-10619236-B2
US-10634183-B2
Query:
SELECT "publication_number", "grant_date"
    FROM PATENTS.PATENTS.PUBLICATIONS
    WHERE "country_code" = 'US' AND "kind_code" = 'B2' AND "grant_date" BETWEEN 20150101 AND 20181231
    LIMIT 100;
Answer:
publication_number,grant_date
US-9370027-B2,20160614
US-9042351-B2,20150526
US-8962445-B2,20150224
US-9270639-B2,20160223
US-8938152-B2,20150120
US-9389656-B2,20160712
US-9482287-B2,20161101
US-9386020-B2,20160705
US-10142276-B2,20181127
US-9216545-B2,20151222
US-9548844-B2,20170117
US-9111730-B2,20150818
US-9340798-B2,20160517
US-9190745-B2,20151117
US-9380603-B2,20160628
US-9650743-B2,20170516
US-10140934-B2,20181127
US-9556907-B2,20170131
US-9567200-B2,20170214
US-9188941-B2,20151117
US-9048861-B2,20150602
US-9460689-B2,20161004
US-9318050-B2,20160419
US-9520094-B2,20161213
US-9412846-B2,20160809
US-10070142-B2,20180904
US-9585927-B2,20170307
US-9415120-B2,20160816
US-9329543-B2,20160503
US-9502685-B2,20161122
US-9434993-B2,20160906
US-10120886-B2,20181106
US-9343259-B2,20160517
US-10025922-B2,20180717
US-10093135-B2,20181009
US-10040253-B2,20180807
US-9595167-B2,20170314
US-9425382-B2,20160823
US-10040372-B2,20180807
US-10096317-B2,20181009
US-9616746-B2,20170411
US-10132013-B2,20181120
US-10075410-B2,20180911
US-10132055-B2,20181120
US-10104056-B2,20181016
US-10141686-B2,20181127
US-10141468-B2,20181127
US-10128451-B2,20181113
US-10150865-B2,20181211
US-10136240-B2,20181120
US-10021398-B2,20180710
US-10154644-B2,20181218
US-9028758-B2,20150512
US-9143515-B2,20150922
US-8967144-B2,20150303
US-9038000-B2,20150519
US-9144476-B2,20150929
US-8950264-B2,20150210
US-9169572-B2,20151027
US-9089610-B2,20150728
US-9106878-B2,20150811
US-9028530-B2,20150512
US-9329365-B2,20160503
US-9040017-B2,20150526
US-9505537-B2,20161129
US-8967952-B2,20150303
US-8966958-B2,20150303
US-9047835-B2,20150602
US-9009284-B2,20150414
US-9181436-B2,20151110
US-9152566-B2,20151006
US-9276150-B2,20160301
US-9002672-B2,20150407
US-9053245-B2,20150609
US-9309435-B2,20160412
US-8981843-B2,20150317
US-9004917-B2,20150414
US-9317982-B2,20160419
US-9150444-B2,20151006
US-9103795-B2,20150811
US-9083005-B2,20150714
US-9265617-B2,20160223
US-9157667-B2,20151013
US-9288612-B2,20160315
US-8957450-B2,20150217
US-8967362-B2,20150303
US-9438017-B2,20160906
US-9169941-B2,20151027
US-9466599-B2,20161011
US-9091060-B2,20150728
US-9087841-B2,20150721
US-9156164-B2,20151013
US-9256652-B2,20160209
US-9244073-B2,20160126
US-9316812-B2,20160419
US-9514786-B2,20161206
US-9449376-B2,20160920
US-8933415-B2,20150113
US-9469007-B2,20161018
US-9459437-B2,20161004
Query:
SELECT "publication_number", "ipc"
    FROM PATENTS.PATENTS.PUBLICATIONS
    LIMIT 100;
Answer:
Too long, hard cut:
publication_number,ipc
CR-5634-A,"[
  {
    ""code"": ""G01N21/01"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CR-5990-A,[]
FI-429-A,"[
  {
    ""code"": ""C10C1/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
HK-6083-A,"[
  {
    ""code"": ""H02M5/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
HU-T52763-A,"[
  {
    ""code"": ""A01N43/54"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""A01N47/36"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D239/47"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D521/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
JP-H03206829-A,"[
  {
    ""code"": ""A01K61/00"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""A01K63/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
JP-S62159089-A,"[
  {
    ""code"": ""G21C5/10"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""G21C1/02"",
    ""first"": true,
    ""inventive"": true,
    ""tree"": []
  }
]"
US-416-A,[]
US-2528225-A,"[
  {
    ""code"": ""E21B27/02"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A41580-A,"[
  {
    ""code"": ""B22D11/08"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A47682-A,"[
  {
    ""code"": ""C07D471/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D471/16"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
AT-A63682-A,"[
  {
    ""code"": ""G01N27/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-920790-A,"[
  {
    ""code"": ""C03C4/12"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-950907-A,"[
  {
    ""code"": ""C08K5/47"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M133/44"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D263/56"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D277/64"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/46"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M133/48"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/35"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C11B5/00"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10L1/14"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C10M135/36"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C09K15/30"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D235/12"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C08K5/3447"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-920830-A,"[
  {
    ""code"": ""E02D5/38"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D5/80"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D7/28"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D5/54"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""E02D7/26"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CA-9086-A,[]
CH-3256-A,[]
CH-540255-A,"[
  {
    ""code"": ""C07D213/56"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/38"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/51"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/32"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""C07D213/30"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
CH-433637-A,[]
CH-8494-A,[]
CH-9587-A,[]
CH-9968-A,[]
DD-8297-A,[]
FR-1334211-A,"[
  {
    ""code"": ""C12H1/14"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
FR-1444995-A,"[
  {
    ""code"": ""C07F7/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  }
]"
FR-1474468-A,"[
  {
    ""code"": ""G11B15/22"",
    ""first"": false,
    ""inventive"": true,
    ""tree"": []
  },
  {
    ""code"": ""G11B15/62"",
    ""first"": false,
    ""inventive"": true,
    
Query:
SELECT t."publication_number", ipc_u.value:"code"::STRING AS "ipc_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
Answer:
publication_number,ipc_code
US-11883790-B2,B01J13/18
US-11883790-B2,C08F220/32
US-11883790-B2,C09D5/00
US-11883790-B2,C09D7/40
US-11883790-B2,C09D133/14
US-11883790-B2,F16L59/02
US-11883790-B2,G02B1/18
US-11530904-B2,F41H13/00
US-11492186-B2,B65D75/58
US-11492186-B2,B65D75/26
US-11492186-B2,B65D75/00
US-11492186-B2,B65D81/38
US-11459996-B2,F02P17/00
US-11459996-B2,G01R31/00
US-11459996-B2,H01H47/00
US-11459996-B2,H01F7/06
US-12058446-B2,H04N21/81
US-12058446-B2,H04N21/4402
US-12058446-B2,H04N21/2343
US-12058446-B2,G06T7/11
US-12058446-B2,H04N23/698
US-12032333-B2,G04B15/14
US-12032333-B2,G04B13/02
US-12032333-B2,G04B15/04
US-11203375-B2,B62D7/22
US-11203375-B2,B62D1/19
US-11203375-B2,F16F15/08
US-11142880-B2,E04B1/66
US-11142880-B2,E02D31/06
US-11142880-B2,B01D71/06
US-11142880-B2,E02D31/02
US-11530450-B2,C07H21/04
US-11530450-B2,C12Q1/6886
US-11530450-B2,C12Q1/6858
US-10899387-B2,B62D21/02
US-10899387-B2,B60R16/04
US-10912049-B2,H04W4/70
US-10912049-B2,H04W56/00
US-11702538-B2,C08L63/00
US-11702538-B2,C08G59/24
US-11702538-B2,C08L77/06
US-11702538-B2,C08L79/02
US-11702538-B2,C09J163/00
US-11702538-B2,C09J177/06
US-10782773-B2,G06F1/20
US-10782773-B2,G06F1/329
US-10782773-B2,H04W52/02
US-10782773-B2,H02J7/00
US-10782773-B2,G06F1/3212
US-10782773-B2,G06F1/324
US-11099035-B2,G01D5/20
US-11176945-B2,G10L15/07
US-11176945-B2,G16H40/63
US-11176945-B2,G16H10/60
US-11176945-B2,G16H40/20
US-11176945-B2,G10L15/26
US-11176945-B2,G06F3/16
US-11176945-B2,G06N20/00
US-11176945-B2,G10L17/22
US-11069158-B2,G07C5/08
US-11069158-B2,G07C5/00
US-11069158-B2,G05D1/00
US-11069158-B2,H04W4/80
US-11069158-B2,H04W4/02
US-11069158-B2,H04W4/029
US-11069158-B2,G06F1/20
US-11069158-B2,H04W4/40
US-10874919-B2,A63B1/00
US-10874919-B2,A63B60/00
US-10874919-B2,A63B60/54
US-10874919-B2,A63B53/04
US-10874919-B2,A63B60/02
US-11679559-B2,B29C64/135
US-11679559-B2,B33Y30/00
US-11679559-B2,B29C64/364
US-11679559-B2,B29C64/264
US-11191932-B2,A61M25/10
US-11191932-B2,B29C53/40
US-11191932-B2,B29K105/00
US-11191932-B2,B29C49/00
US-11191932-B2,B29L22/02
US-11191932-B2,B29C70/30
US-11191932-B2,B29C63/08
US-11062275-B2,G06Q30/06
US-11062275-B2,G06Q10/10
US-11062275-B2,G06Q10/00
US-11062275-B2,G06Q30/02
US-10938981-B2,G06N20/00
US-10938981-B2,H04M3/22
US-10938981-B2,H04M3/26
US-10938981-B2,G06N3/08
US-10955870-B2,E02F9/24
US-10955870-B2,G05G1/32
US-10955870-B2,F16P1/02
US-10955870-B2,F16P1/00
US-10955870-B2,G05G1/60
US-10955870-B2,G05G5/00
US-11184318-B2,H04L29/06
US-11184318-B2,G06F15/16
US-11184318-B2,H04L29/12
Query:
SELECT t."publication_number", SUBSTR(ipc_u.value:"code"::STRING, 0, 4) AS "ipc4_code"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."ipc") ipc_u
    LIMIT 100;
Answer:
publication_number,ipc4_code
DE-69427315-T2,C08J
DE-69427315-T2,C08L
DE-69611147-T2,E05B
DE-69611147-T2,E05B
DE-69614271-T2,A61K
DE-69614271-T2,C12N
DE-69614271-T2,C12Q
DE-69614271-T2,C07K
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,C07K
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,G01N
DE-69614271-T2,C12N
DE-69614271-T2,C12N
DE-69614271-T2,A61K
DE-69614271-T2,C12P
DE-69630331-T2,H04L
DE-69630331-T2,G06F
DE-69636755-T2,C12N
DE-69636755-T2,G01N
DE-69636755-T2,C12R
DE-69636755-T2,C12N
DE-69636755-T2,C12N
DE-69636755-T2,A61K
DE-69636755-T2,G01N
DE-69636755-T2,C12Q
DE-69636755-T2,C12N
DE-69728658-T2,B32B
DE-69728658-T2,B41C
DE-69728658-T2,B41N
DE-69728658-T2,B41N
DE-69728658-T2,B32B
DE-69728658-T2,B32B
DE-69807539-T2,G01N
DE-69807539-T2,G01N
DE-69807539-T2,G01N
DE-69832203-T2,A61B
DE-69832203-T2,A61B
HU-E042779-T2,F28B
HU-E042779-T2,F28C
HU-E039475-T2,E02D
HU-E039475-T2,F28F
HU-E045258-T2,H04L
HU-E032026-T2,B41J
HU-E032026-T2,B41J
HU-E059707-T2,B01D
HU-E059707-T2,B01D
HU-E062821-T2,G01N
HU-E062821-T2,A61B
HU-E062821-T2,A61F
TR-200000810-T2,C08L
TR-200000810-T2,C08L
TR-200000810-T2,C08L
TR-200000810-T2,C08J
TR-200000810-T2,C08J
TR-200000810-T2,C08K
TR-200000810-T2,C08F
TR-200000810-T2,C08K
TR-200000810-T2,C08J
DE-602004001511-T2,E05D
DK-1861705-T3,C12Q
DK-1861705-T3,G01N
DK-2101612-T3,A47C
DK-2101612-T3,A47C
DK-2579875-T3,A61P
DK-2579875-T3,A61P
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2579875-T3,A61K
DK-2692719-T3,C07H
DK-2692719-T3,C07C
DK-2692719-T3,C07C
DK-2692719-T3,C07C
DK-2692719-T3,A61Q
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61P
DK-2692719-T3,A61K
DK-2692719-T3,A61K
DK-2692719-T3,A23L
DK-2817131-T3,C08J
DK-2817131-T3,B29B
DK-3592973-T3,F03D
DK-3592973-T3,B66C
DK-3592973-T3,B66C
DK-3617419-T3,E04F
DK-3566308-T3,H03K
DK-3566308-T3,B06B
DK-0474188-T3,C07C
DK-0474188-T3,C07B
DK-0474188-T3,C07C
DK-0474188-T3,B01J
DK-0474188-T3,C07C
Query:
SELECT t."publication_number", cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM PATENTS.PATENTS.PUBLICATIONS t, LATERAL FLATTEN(input => t."citation") cit_u
    LIMIT 100;
Answer:
publication_number,cited_publication_number
US-11883790-B2,US-4626471-A
US-11883790-B2,WO-0109259-A1
US-11883790-B2,CN-1333802-A
US-11883790-B2,CN-1376187-A
US-11883790-B2,US-6593408-B1
US-11883790-B2,US-6593417-B1
US-11883790-B2,US-2003212199-A1
US-11883790-B2,US-6759478-B2
US-11883790-B2,US-2004225057-A1
US-11883790-B2,WO-2005097870-A1
US-11883790-B2,US-7005472-B2
US-11883790-B2,JP-2006063297-A
US-11883790-B2,JP-2006346553-A
US-11883790-B2,JP-2007070484-A
US-11883790-B2,US-2007251422-A1
US-11883790-B2,CN-101245120-A
US-11883790-B2,JP-2010032719-A
US-11883790-B2,JP-2010084018-A
US-11883790-B2,JP-2010084017-A
US-11883790-B2,JP-2010285624-A
US-11883790-B2,US-7981511-B2
US-11883790-B2,CN-103304775-A
US-11883790-B2,US-2015037535-A1
US-11883790-B2,CN-104540499-A
US-11883790-B2,US-2015247033-A1
US-11883790-B2,CN-104903332-A
US-11883790-B2,US-2015297520-A1
US-11883790-B2,WO-2016014807-A1
US-11883790-B2,CN-105348457-A
US-11883790-B2,WO-2016111314-A1
US-11883790-B2,CN-106573851-A
US-11883790-B2,US-2017114243-A1
US-11883790-B2,JP-2017109898-A
US-11883790-B2,US-2017196815-A1
US-11883790-B2,US-9725590-B2
US-11883790-B2,WO-2017163439-A1
US-11883790-B2,JP-2018035031-A
US-11883790-B2,WO-2018051794-A1
US-11883790-B2,US-2018228733-A9
US-11883790-B2,US-2019100637-A1
US-11883790-B2,US-2019209994-A1
US-11883790-B2,US-2019254976-A1
US-11883790-B2,US-10774192-B2
US-11883790-B2,
US-11883790-B2,
US-11883790-B2,
US-11883790-B2,
US-11530904-B2,US-2006207466-A1
US-11530904-B2,US-8356438-B2
US-11530904-B2,US-2015153144-A1
US-11530904-B2,US-2016040965-A1
US-11530904-B2,US-9354026-B2
US-11530904-B2,CN-107883811-A
US-11530904-B2,KR-101872709-B1
US-11530904-B2,US-10168127-B1
US-11530904-B2,US-10598467-B1
US-11530904-B2,
US-11492186-B2,US-5351828-A
US-11492186-B2,US-5753895-A
US-11492186-B2,US-2003108699-A1
US-11492186-B2,CN-1478043-A
US-11492186-B2,US-2004035865-A1
US-11492186-B2,CN-1481326-A
US-11492186-B2,US-2004234174-A1
US-11492186-B2,WO-2007008021-A1
US-11492186-B2,US-2007068118-A1
US-11492186-B2,US-2009169134-A1
US-11492186-B2,US-2010061664-A1
US-11492186-B2,US-7858909-B2
US-11492186-B2,CN-102099185-A
US-11492186-B2,US-2013292287-A1
US-11492186-B2,US-2014033654-A1
US-11492186-B2,CN-204056710-U
US-11492186-B2,US-2015122846-A1
US-11492186-B2,US-2015126349-A1
US-11492186-B2,US-2015122840-A1
US-11492186-B2,US-2015122841-A1
US-11492186-B2,US-2015121810-A1
US-11492186-B2,US-2015122373-A1
US-11492186-B2,US-9327867-B2
US-11492186-B2,JP-2016108034-A
US-11492186-B2,US-2016176578-A1
US-11492186-B2,US-2016176582-A1
US-11492186-B2,US-2016176583-A1
US-11492186-B2,US-2016176584-A1
US-11492186-B2,US-2016176597-A1
US-11492186-B2,US-2016221727-A1
US-11492186-B2,US-2016297589-A1
US-11492186-B2,US-2016297569-A1
US-11492186-B2,US-2016297591-A1
US-11492186-B2,US-2016297590-A1
US-11492186-B2,US-2016325518-A1
US-11492186-B2,US-2016362228-A1
US-11492186-B2,US-2017001782-A1
US-11492186-B2,CN-107107477-A
US-11492186-B2,JP-2018095267-A
US-11492186-B2,EP-3348488-A1
US-11492186-B2,US-10457457-B2
US-11492186-B2,
US-11459996-B2,JP-2001253307-A
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        ipc.value:"code"::STRING AS "cited_ipc_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100;
Answer:
citing_publication_number,cited_publication_number,cited_ipc_code
US-8548719-B2,US-2007276594-A1,G01C21/32
US-11346835-B2,US-2007235250-A1,G01V1/04
US-11661936-B2,US-2008304236-A1,F25B29/00
US-11661936-B2,US-2008304236-A1,H05K7/20
US-10844739-B2,US-2008145216-A1,F04D29/08
US-10844739-B2,US-2008145216-A1,F01D9/02
CN-102048535-A,US-2007253526-A1,H05G1/60
CN-102048535-A,US-2007253526-A1,G21K1/12
CN-102048535-A,US-2007253526-A1,A61B6/00
CN-102048535-A,US-2007253526-A1,G01N23/00
US-11805327-B2,US-2007284440-A1,G06K15/00
US-11507933-B2,US-2007284440-A1,G06K15/00
US-2019242790-A1,US-2009091566-A1,G06K9/00
US-2019242790-A1,US-2009091566-A1,G06T15/00
US-2010248057-A1,US-2007099049-A1,H01M8/02
US-2010248057-A1,US-2007099049-A1,H01M8/04
US-11160360-B2,US-2005218033-A1,A45D27/22
US-11160360-B2,US-2005218033-A1,B65D69/00
US-2007281355-A1,US-2007122905-A1,C12N5/071
US-2007281355-A1,US-2007122905-A1,C12N5/073
US-9597149-B2,US-2009173943-A1,H01L33/00
US-8500451-B2,US-2007049817-A1,A61B5/296
US-8500451-B2,US-2007049817-A1,A61B5/00
US-8500451-B2,US-2007049817-A1,A61B8/12
US-8500451-B2,US-2007049817-A1,A61B5/01
US-8500451-B2,US-2007049817-A1,A61B8/08
US-8500451-B2,US-2007049817-A1,A61B6/03
US-8500451-B2,US-2007049817-A1,A61B8/06
US-9575648-B2,US-2006028455-A1,G06F3/033
US-9575648-B2,US-2006028455-A1,G06F3/048
US-9575648-B2,US-2006028455-A1,G06F3/02
US-9575648-B2,US-2006028455-A1,G06F3/023
US-9575648-B2,US-2006028455-A1,G09G5/00
US-2006102001-A1,US-2006102001-A1,B01D47/00
US-8381997-B2,US-2006244676-A1,H01Q5/10
US-8528829-B2,US-2006244676-A1,H01Q5/10
US-8381997-B2,US-2006244676-A1,H01Q1/36
US-8528829-B2,US-2006244676-A1,H01Q1/36
US-10200885-B2,US-2007216575-A1,G01S19/25
US-10200885-B2,US-2007216575-A1,G01S5/14
US-8335977-B2,US-2007180346-A1,H03M13/00
US-2015067446-A1,US-2007180346-A1,H03M13/00
US-10933691-B2,US-2010170762-A1,F16D41/24
US-11431960-B2,US-2016216540-A1,G02B30/25
US-11431960-B2,US-2016216540-A1,G02F1/137
US-11431960-B2,US-2016216540-A1,G02F1/13363
US-11431960-B2,US-2016216540-A1,G02F1/1335
US-11431960-B2,US-2016216540-A1,G02B30/28
US-2021210094-A1,US-2023267935-A1,G10L17/04
US-2021210094-A1,US-2023267935-A1,G10L15/08
US-2021210094-A1,US-2023267935-A1,G10L15/22
US-2021210094-A1,US-2023267935-A1,G10L17/14
US-2021210094-A1,US-2023267935-A1,G10L17/18
US-2021210094-A1,US-2023267935-A1,G10L17/22
US-11320713-B2,US-2017063429-A1,G01B7/02
US-11320713-B2,US-2017063429-A1,H04Q5/00
US-11320713-B2,US-2017063429-A1,H04B3/46
US-2023033400-A1,US-2022321389-A1,H04L5/00
US-2023033400-A1,US-2022321389-A1,H04L27/26
US-2023033400-A1,US-2022321389-A1,H04L25/02
US-2023172274-A1,US-2023127975-A1,A24F40/465
US-2023172274-A1,US-2023127975-A1,A24F40/50
US-2010058330-A1,US-6594664-B1,G06F17/30
US-2021272046-A1,US-2015161969-A1,G06T11/60
US-2021272046-A1,US-2015161969-A1,G09G5/30
US-2021272046-A1,US-2015161969-A1,G09G5/377
US-11680437-B2,DE-102015106680-A1,B60R25/00
US-11680437-B2,DE-102015106680-A1,B60R16/037
US-11680437-B2,DE-102015106680-A1,A61B5/117
US-2004118448-A1,US-2004095658-A1,F24S23/00
US-2004118448-A1,US-2004095658-A1,H10K99/00
US-2004118448-A1,US-2004095658-A1,G02B5/10
US-2004118448-A1,US-2004095658-A1,G02B6/122
US-2004118448-A1,US-2004095658-A1,H01S3/063
US-2004118448-A1,US-2004095658-A1,H01S5/10
US-2004118448-A1,US-2004095658-A1,G02B1/04
US-2008171970-A1,US-2005154348-A1,A61M1/06
US-2008171970-A1,US-2005154348-A1,A61M1/00
US-10722723-B2,US-2005080430-A1,A61F2/06
US-10722723-B2,US-2005080430-A1,A61B19/00
US-10722723-B2,US-2005080430-A1,A61B17/12
US-10722723-B2,US-2005080430-A1,A61F2/01
US-10722723-B2,US-2005080430-A1,A61B17/22
US-10722723-B2,US-2005080430-A1,A61M29/00
US-10722723-B2,US-2005080430-A1,A61B17/34
US-10722723-B2,US-2005080430-A1,A61M25/00
US-10722723-B2,US-2005080430-A1,A61F2/84
US-2016183808-A1,US-2007083126-A1,A61F2/958
US-2016183808-A1,US-2007083126-A1,A61B5/02
US-2016183808-A1,US-2007083126-A1,A61M31/00
US-8072754-B2,US-2008043436-A1,H05K7/20
US-10963524-B2,US-2008037721-A1,H04M1/64
US-2018260785-A1,US-2008037721-A1,H04M1/64
WO-2021112688-A1,EP-0800988-A1,B60K1/04
WO-2021112688-A1,EP-0800988-A1,B62M6/40
WO-2021243127-A1,WO-2020258237-A1,A47J19/02
DE-102016203967-B4,DE-102008000145-A1,B62D5/04
DE-102016203967-B4,DE-102008000145-A1,H02H7/08
WO-2024100023-A1,WO-2018151123-A1,A47B49/00
WO-2024100023-A1,WO-2018151123-A1,A47B61/04
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cc."cited_publication_number",
    cic."cited_ipc4_code"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
LIMIT 100
Answer:
citing_publication_number,cited_publication_number,cited_ipc4_code
US-9355294-B2,US-2009014531-A1,G09G
US-9355294-B2,US-2009014531-A1,G06F
US-9355294-B2,US-2009014531-A1,G06F
US-9355294-B2,US-2009014531-A1,G06K
US-9355294-B2,US-2009014531-A1,G01S
US-10589120-B1,US-2007260229-A1,A61B
US-11629886-B2,US-2009252619-A1,F16L
US-11629886-B2,US-2009252619-A1,F04B
US-9622691-B2,US-2006272652-A1,A61B
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-8759129-B2,US-2002177251-A1,H01L
US-2019119050-A1,US-2003155452-A1,B65G
US-2019119050-A1,US-2003155452-A1,B65B
US-2019119050-A1,US-2003155452-A1,B65D
US-2019119050-A1,US-2003155452-A1,B65G
US-2019119050-A1,US-2003155452-A1,B65G
US-2005223909-A1,US-2005223909-A1,C11B
US-2005223909-A1,US-2005223909-A1,A47J
US-2005223909-A1,US-2005223909-A1,B01D
US-2005223909-A1,US-2005223909-A1,A23D
US-2008143161-A1,US-2006226685-A1,A47C
US-2010256194-A1,US-2006160812-A1,A61B
US-2010256194-A1,US-2006160812-A1,C07D
US-2010256194-A1,US-2006160812-A1,A61K
US-2010256194-A1,US-2006160812-A1,C07D
US-11902122-B2,US-2007044147-A1,G06F
US-2009119572-A1,US-2007271228-A1,G06F
US-9131283-B2,US-2007244760-A1,G06Q
US-11436630-B2,US-2007244760-A1,G06Q
US-9371099-B2,US-2006092043-A1,G08G
US-11570601-B2,US-2006092043-A1,G08G
US-10229589-B1,US-2006092043-A1,G08G
EP-3846008-A1,US-2008215994-A1,G06F
US-8732593-B2,US-2008215994-A1,G06F
US-10554596-B1,US-2008215994-A1,G06F
US-11062336-B2,US-2007043615-A1,G06Q
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2011000660-A1,US-2009120647-A1,E21B
US-2005255501-A1,US-2003008290-A1,C12Q
US-2005255501-A1,US-2003008290-A1,C12P
US-2008259670-A1,US-2006117152-A1,G06F
JP-2008046989-A,US-2006117152-A1,G06F
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,B32B
WO-2022140455-A1,US-2009056865-A1,B29C
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
WO-2022140455-A1,US-2009056865-A1,C09J
US-10625938-B2,US-2009016864-A1,A47F
US-10625938-B2,US-2009016864-A1,B65G
US-10429872-B2,US-2008238710-A1,G08C
US-2020203060-A1,US-9478344-B2,H03B
US-2020203060-A1,US-9478344-B2,H03L
US-2020203060-A1,US-9478344-B2,H01F
US-2020203060-A1,US-9478344-B2,H01F
US-2020203060-A1,US-9478344-B2,H01F
US-10239398-B2,DE-102015014819-A1,B60J
US-10239398-B2,DE-102015014819-A1,B60J
WO-2020219915-A1,WO-2018106805-A1,G06N
WO-2020219915-A1,WO-2018106805-A1,G06N
WO-2020219915-A1,WO-2018106805-A1,H03M
WO-2020219915-A1,WO-2018106805-A1,G06V
US-11395931-B2,US-2006213672-A1,A62C
US-11395931-B2,US-2006213672-A1,A62C
US-10596675-B2,US-2006025778-A1,A61B
US-2006036325-A1,US-2005045936-A1,H10B
US-2006036325-A1,US-2005045936-A1,H01L
US-11452433-B2,US-2006224053-A1,A61B
US-9284409-B2,US-2008071350-A1,A61F
TW-I480672-B,US-2005254624-A1,H04N
TW-I480672-B,US-2005254624-A1,H01L
TW-I480672-B,US-2005254624-A1,A61B
TW-I480672-B,US-2005254624-A1,G06T
TW-I480672-B,US-2005254624-A1,H04N
TW-I480672-B,US-2005254624-A1,H01L
TW-I480672-B,US-2005254624-A1,G01T
TW-I480672-B,US-2005254624-A1,H05G
TW-I480672-B,US-2005254624-A1,G01T
TW-I480672-B,US-2005254624-A1,A61B
WO-2021112688-A1,EP-0800988-A1,B60K
WO-2021112688-A1,EP-0800988-A1,B62M
WO-2021243127-A1,WO-2020258237-A1,A47J
DE-102016203967-B4,DE-102008000145-A1,B62D
DE-102016203967-B4,DE-102008000145-A1,H02H
WO-2024100023-A1,WO-2018151123-A1,A47B
WO-2024100023-A1,WO-2018151123-A1,A47B
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06F
US-11416109-B2,US-9619652-B2,G06F
US-11222142-B2,US-9619652-B2,G06Q
US-11416109-B2,US-9619652-B2,G06Q
US-11222142-B2,US-9619652-B2,G06F
Query:
SELECT
    t."publication_number",
    COUNT(DISTINCT cit_u.value:"publication_number"::STRING) AS "num_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
GROUP BY t."publication_number"
LIMIT 100;
Answer:
publication_number,num_backward_citations
US-552281-A,0
US-4349255-A,8
US-8560474-B2,41
US-9499521-B2,184
US-2008237040-A1,32
US-2015244938-A1,25
WO-2014122093-A1,11
US-9143515-B2,15
US-10730205-B2,26
US-10988035-B2,22
US-2008195166-A1,19
AT-521300-A1,3
WO-2023233794-A1,5
US-2007141853-A1,12
US-2007284440-A1,23
US-2009307115-A1,19
KR-20160084604-A,4
CN-101844231-A,3
WO-2021087540-A1,7
DE-2460286-A1,0
US-8900118-B2,778
US-10647799-B2,14
US-2007074329-A1,73
US-2007115483-A1,99
US-9483346-B2,121
US-8500209-B2,156
US-11590628-B2,20
RU-2337651-C1,1
US-2008251677-A1,27
CN-107530754-A,5
CN-107116688-A,5
CN-110845293-A,4
JP-S61113746-A,12
JP-S5241258-B1,0
CN-107174299-A,8
US-10036488-B2,29
JP-2005165649-A,0
JP-2011030203-A,0
KR-20210144025-A,1
US-8354789-B2,11
US-11157999-B2,114
US-2005076622-A1,3
US-2010294614-A1,13
JP-H0827723-A,5
KR-100687878-B1,3
CN-113936573-A,9
DE-102015009796-A1,41
US-11905336-B2,119
US-2010002609-A1,2
AT-163249-B,0
JP-2015018552-A,4
CN-105718880-A,6
DE-102007026947-A1,4
JP-2011200474-A,6
US-2005010697-A1,7
CN-114291853-B,15
US-2004154269-A1,12
US-6256469-B1,11
WO-2019154221-A1,6
US-2008089664-A1,42
US-2472439-A,17
JP-S6040613-A,0
CN-103080988-A,6
CN-211543083-U,0
AU-6365100-A,0
US-2017169190-A1,9
DE-1263920-B,1
US-2022260821-A1,3
US-2002021202-A1,0
WO-2017160556-A1,3
US-2008246626-A1,37
US-11912602-B2,17
CN-108033132-A,15
CN-113685509-A,41
CN-113467661-A,9
US-11070533-B2,13
CN-108423991-A,3
AT-E26039-T1,0
US-2016318034-A1,6
US-3397863-A,9
DE-102019109413-A1,4
US-10429872-B2,400
US-2006279577-A1,66
TR-201805389-A2,0
EP-1316770-A3,8
JP-2015129856-A,4
CN-109367668-A,9
FR-975615-A,0
US-2267301-A,0
US-4702921-A,5
JP-2007090745-A,4
KR-20110069484-A,0
CN-107329702-A,8
US-2011098755-A1,102
US-2006211052-A1,27
KR-200309397-Y1,0
US-2007010883-A1,24
US-2017196661-A1,19
CN-117602747-A,10
CN-210670675-U,0
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "citing_publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."citing_publication_number",
    cic."cited_ipc4_code",
    COUNT(*) AS "num_citations_to_ipc4"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."citing_publication_number", cic."cited_ipc4_code"
LIMIT 100
Answer:
citing_publication_number,cited_ipc4_code,num_citations_to_ipc4
US-11320713-B2,G01B,1
JP-6085719-B2,,1
CA-1044986-A,,1
YU-87669-A,,1
JP-4791083-B2,,1
CN-208620513-U,,1
CN-103820282-A,,1
CA-1108887-A,,1
CL-2017000769-S1,,1
JP-H06312824-A,,1
JP-6402733-B2,,1
JP-2006300573-A,,1
JP-2011238568-A,,1
JP-2007191450-A,,1
US-1081614-A,,1
JP-S6227741-Y2,,1
JP-S5114121-U,,1
KR-20170057119-A,,1
CN-101541970-A,,1
CN-216251206-U,,1
GB-190106301-A,,1
CN-209563421-U,,1
CA-530546-A,,1
JP-S59132838-U,,1
CN-207251193-U,,1
CN-210618726-U,,1
GB-958924-A,,1
JP-H0754183-B2,,1
CN-100494909-C,,1
CN-205693866-U,,1
CN-212643184-U,,1
CN-212367207-U,,1
FR-2160117-A5,,1
CN-211989059-U,,1
CN-220262749-U,,1
CN-2059280-U,,1
CN-204526409-U,,1
CN-212833475-U,,1
CN-221091613-U,,1
CN-113622854-B,,1
JP-2021088866-A,,7
PT-4093901-T,,1
CN-113696839-A,,32
CN-212887809-U,,1
CN-210669616-U,,1
CN-207889708-U,,1
US-2463209-A,,5
CN-204326838-U,,1
CN-203643479-U,,1
CN-206408836-U,,1
US-11221682-B2,,1324
US-10154644-B2,,94
RU-2508167-C2,,10
JP-S5925118-B2,,1
US-1567024-A,,1
IT-237462-Y1,,1
CN-214495683-U,,1
US-8336272-B2,,81
CN-102205651-A,,4
US-4854089-A,,23
CN-106144430-A,,7
US-2009027661-A1,,99
JP-2008009087-A,,7
DE-102010015571-A1,,5
JP-2005200174-A,,1
JP-1735513-S,,1
CA-3000454-A1,,1
SK-7542001-A3,,1
CA-2084155-C,,1
JP-4830144-B2,,1
JP-S5981868-A,,1
CN-117447976-A,,1
CN-101050802-A,,1
JP-H07301432-A,,1
CN-215011179-U,,1
KR-20170021046-A,,1
JP-3145672-B2,,1
CN-211154194-U,,1
CN-219815852-U,,1
JP-S5756285-A,,1
SE-7010582-L,,1
CN-205456186-U,,1
CN-2847466-Y,,1
CN-109013684-A,,4
CN-209583587-U,,1
CN-215541567-U,,1
CN-215295467-U,,1
US-2024189135-A1,,107
CN-212842289-U,,1
CN-214760130-U,,1
CN-215087362-U,,1
US-2006025756-A1,,99
US-8170543-B1,,17
US-11064741-B2,,43
US-2018364895-A1,,84
US-9262515-B2,,53
JP-S531011-A,,1
US-2004178584-A1,,24
US-3994620-A,,11
CN-108218726-A,,8
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "num_backward_citations",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY cc."publication_number"
LIMIT 100
Answer:
publication_number,num_backward_citations,num_distinct_cited_ipc4_codes
WO-2017021623-A1,6,0
US-3047771-A,12,0
EP-2663972-A1,0,0
CN-117463239-A,0,0
US-5728994-A,39,0
JP-2001263749-A,0,0
FR-2521157-A1,0,0
JP-H0638193-B2,0,0
CN-109686400-B,4,0
US-2010156039-A1,6,0
BR-7603887-A,0,0
EP-2359614-A1,1,0
US-2504103-A,5,0
AU-2020283323-A1,0,0
CN-114777232-A,4,0
JP-2007046609-A,0,0
CN-206498994-U,0,0
US-5247987-A,6,0
CN-113686248-A,16,0
DE-102013021892-A1,7,0
US-11245716-B2,28,0
CN-103345780-B,7,0
CN-107239222-A,6,3
JP-2004149901-A,0,0
CN-105685473-A,5,0
CN-106192829-B,7,0
RU-2016136606-A,0,0
BR-112018073292-B1,0,0
AU-2547895-A,0,0
KR-102572052-B1,6,0
NO-20171426-A1,4,0
US-7606931-B2,11,0
WO-2023011002-A1,5,0
JP-2010192584-A,0,0
CN-103062749-A,6,0
DE-69721689-T2,0,0
TW-D173844-S,0,0
CN-103920104-A,1,0
CN-114551138-A,3,0
CN-208397283-U,0,0
CN-104177077-A,3,0
CN-107859486-A,0,0
CN-107006103-A,5,0
WO-2013091522-A1,2,0
CN-210480343-U,0,0
CN-118531528-A,0,0
CN-210458133-U,0,0
JP-S5485986-U,0,0
GB-0412652-D0,0,0
JP-3787240-B2,0,0
CN-107907771-A,1,0
CN-103826639-A,1,0
KR-20120139449-A,0,0
CN-103050103-A,6,0
CN-203945894-U,0,0
US-2022266341-A1,0,0
JP-5717980-B2,0,0
AU-2002333260-B2,3,0
CN-103075454-A,9,0
US-3073853-A,4,0
KR-20140136100-A,0,0
CN-209834948-U,0,0
CN-210864206-U,0,0
CN-101941580-A,3,0
US-2587069-A,5,0
CN-111478811-B,0,0
CN-106448080-B,3,0
KR-20030093918-A,0,0
TW-M497602-U,0,0
CN-102309021-A,2,0
CN-211408666-U,0,0
CN-208865457-U,0,0
CN-106406447-B,5,0
WO-2022032289-A1,6,0
CN-209163451-U,0,0
CN-217153790-U,0,0
KR-20170074852-A,2,0
JP-H01207141-A,1,0
AT-79076-B,0,0
KR-101515573-B1,3,0
JP-S5176234-A,0,0
CA-55044-A,0,0
JP-S5517644-A,0,0
CN-213939974-U,0,0
JP-S62110796-A,0,0
CN-106743425-B,0,0
CA-2900827-A1,0,0
US-2019107495-A1,0,0
CN-208205611-U,0,0
IL-231109-B,0,0
TW-I480672-B,7,6
HR-P20030810-A2,0,0
CN-209887200-U,0,0
JP-2003231832-A,0,0
CN-204323774-U,0,0
CN-219809492-U,0,0
JP-2007101778-A,0,0
CN-211841483-U,0,0
AU-474868-B2,0,0
CN-207883963-U,0,0
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number" AS "publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation", OUTER => TRUE) cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc", OUTER => TRUE) cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    cic."cited_ipc4_code",
    COUNT(DISTINCT cic."cited_publication_number") AS "n_i_k"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_codes cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."cited_ipc4_code"
LIMIT 100;
Answer:
publication_number,n_i,cited_ipc4_code,n_i_k
JP-7360647-B2,1,H10N,1
CN-109545116-A,1,G09G,1
US-8072754-B2,1,H05K,1
US-2005070847-A1,1,A61M,1
CN-1089211-C,1,A01H,1
US-2007095661-A1,1,H01L,1
CN-113375002-A,1,B23Q,1
JP-S62168346-U,1,B62M,1
US-2021133906-A1,2,G06Q,2
CN-102909728-A,1,B25J,1
JP-H054811-U,1,A01B,1
JP-2007261428-A,1,E04B,1
US-11473504-B2,1,F02C,1
US-9622691-B2,1,G06F,1
US-10283172-B2,1,H01L,1
US-2009202193-A1,1,G01N,1
US-10840771-B2,1,H02K,1
US-3819863-A,1,H01H,1
JP-4585597-B1,1,G06T,1
US-2010250927-A1,1,G09C,1
DE-102016002636-A1,1,G09F,1
CN-103236097-A,1,G06Q,1
IT-MI20121007-A1,1,B29D,1
CN-104006579-A,1,F28F,1
CN-111984853-A,1,G06K,1
JP-2005004407-A,1,G01C,1
CN-105021200-A,1,H04B,1
US-8105361-B2,1,A61M,1
KR-102104937-B1,1,H03M,1
US-8246777-B2,1,B32B,1
US-7427002-B2,1,A61B,1
US-8432798-B2,1,H04L,1
US-2022281264-A1,1,C14B,1
US-2011137007-A1,1,C12P,1
CN-104558752-A,1,C08L,1
DE-102020116746-A1,1,B23Q,1
US-9436499-B2,1,G06F,1
JP-7491100-B2,2,G06F,2
KR-102120403-B1,1,B65H,1
US-8412927-B2,2,H04L,2
CN-107478063-A,1,F27D,1
US-2018209348-A1,1,F01D,1
KR-20240013058-A,1,A61C,1
US-11911287-B2,1,B22F,1
US-2009028345-A1,1,H03D,1
JP-2009237637-A,1,G06F,1
US-2006220881-A1,1,A61B,1
US-11432771-B2,1,G16H,1
US-9001770-B2,1,H04B,1
US-3085045-A,1,A01N,1
US-2006016752-A1,1,A61K,1
JP-2024087319-A,1,B32B,1
US-5343935-A,1,F24F,1
US-9185094-B2,1,G06F,1
JP-2016164482-A,1,F25B,1
US-11284898-B2,1,A61F,1
US-2023046314-A1,1,H01J,1
US-4847105-A,1,A23D,1
CN-113828098-A,1,B01D,1
CN-114260559-A,1,B23K,1
US-2004105980-A1,1,C08J,1
CN-103249220-A,1,H05B,1
US-11224684-B2,1,A61M,1
RU-2652946-C1,1,G06Q,1
CN-100388758-C,1,G06T,1
CN-112359845-B,1,H02G,1
US-8329176-B2,2,C07K,2
US-8920346-B2,1,A61F,1
US-11526949-B1,1,G06Q,1
US-8240235-B2,1,C10M,1
US-11925536-B2,1,A61F,1
CN-102825319-A,1,B23C,1
US-7143574-B2,1,F01N,1
CN-112781617-B,1,G01C,1
CN-102621119-A,1,G02B,1
US-11320713-B2,1,G01B,1
EP-1076214-A1,1,H01J,1
CN-109814691-A,1,H05K,1
US-6350588-B1,1,C07C,1
JP-2006125909-A,1,G01N,1
CN-109760158-B,1,E04F,1
CN-113302042-B,1,A61C,1
JP-4711714-B2,1,B23B,1
CN-114393584-B,1,G03B,1
US-9526699-B2,1,C07C,1
CN-108278777-A,1,F02G,1
US-5933205-A,1,G02F,1
JP-2013506370-A,1,H04W,1
JP-2008506596-A,1,B42F,1
US-10709830-B2,1,G21G,1
US-2008259670-A1,1,G06F,1
CN-106818432-A,1,A01C,1
JP-2016203395-A,1,C08J,1
CN-106383277-A,1,G01K,1
CN-114658331-A,1,F04F,1
US-10076611-B2,1,A61M,1
JP-2016016174-A,1,A61B,1
US-11172929-B2,1,D04H,1
CN-106814744-A,1,G08C,1
US-10731810-B2,1,F21V,1
Query:
SELECT "publication_number", "grant_date", "kind_code"
FROM PATENTS.PATENTS.PUBLICATIONS
WHERE "country_code" = 'US'
  AND "kind_code" = 'B2'
  AND "grant_date" BETWEEN 20150101 AND 20181231
  AND "publication_number" IS NOT NULL
  AND "grant_date" IS NOT NULL
  AND "kind_code" IS NOT NULL
LIMIT 100
Answer:
publication_number,grant_date,kind_code
US-9247876-B2,20160202,B2
US-9278232-B2,20160308,B2
US-9042220-B2,20150526,B2
US-9224188-B2,20151229,B2
US-8928865-B2,20150106,B2
US-9652521-B2,20170516,B2
US-9376833-B2,20160628,B2
US-9052538-B2,20150609,B2
US-9211492-B2,20151215,B2
US-9593581-B2,20170314,B2
US-9292737-B2,20160322,B2
US-9342526-B2,20160517,B2
US-8939137-B2,20150127,B2
US-9047554-B2,20150602,B2
US-9088106-B2,20150721,B2
US-9323683-B2,20160426,B2
US-8995452-B2,20150331,B2
US-9218976-B2,20151222,B2
US-9437584-B2,20160906,B2
US-9482626-B2,20161101,B2
US-9649467-B2,20170516,B2
US-9522418-B2,20161220,B2
US-10109894-B2,20181023,B2
US-9374093-B2,20160621,B2
US-9200455-B2,20151201,B2
US-9344086-B2,20160517,B2
US-9151039-B2,20151006,B2
US-9408896-B2,20160809,B2
US-9084802-B2,20150721,B2
US-10030011-B2,20180724,B2
US-9124016-B2,20150901,B2
US-9082138-B2,20150714,B2
US-9264218-B2,20160216,B2
US-9264318-B2,20160216,B2
US-9447659-B2,20160920,B2
US-9181374-B2,20151110,B2
US-10121971-B2,20181106,B2
US-9401795-B2,20160726,B2
US-9529473-B2,20161227,B2
US-9083090-B2,20150714,B2
US-9258578-B2,20160209,B2
US-9268979-B2,20160223,B2
US-9559610-B2,20170131,B2
US-9319849-B2,20160419,B2
US-9122593-B2,20150901,B2
US-10102455-B2,20181016,B2
US-9161055-B2,20151013,B2
US-9546744-B2,20170117,B2
US-9355294-B2,20160531,B2
US-9554160-B2,20170124,B2
US-9591529-B2,20170307,B2
US-10011949-B2,20180703,B2
US-9573763-B2,20170221,B2
US-10137283-B2,20181127,B2
US-10076323-B2,20180918,B2
US-9348862-B2,20160524,B2
US-9616068-B2,20170411,B2
US-9639475-B2,20170502,B2
US-9596378-B2,20170314,B2
US-10070538-B2,20180904,B2
US-10005712-B2,20180626,B2
US-10050540-B2,20180814,B2
US-10127843-B2,20181113,B2
US-10056669-B2,20180821,B2
US-10144284-B2,20181204,B2
US-10154644-B2,20181218,B2
US-9362717-B2,20160607,B2
US-9275036-B2,20160301,B2
US-8974982-B2,20150310,B2
US-8992882-B2,20150331,B2
US-9034622-B2,20150519,B2
US-8930147-B2,20150106,B2
US-9029140-B2,20150512,B2
US-9371099-B2,20160621,B2
US-9429369-B2,20160830,B2
US-8952769-B2,20150210,B2
US-9095517-B2,20150804,B2
US-8971612-B2,20150303,B2
US-9266071-B2,20160223,B2
US-9295586-B2,20160329,B2
US-9018534-B2,20150428,B2
US-9415834-B2,20160816,B2
US-9116906-B2,20150825,B2
US-8958899-B2,20150217,B2
US-9193657-B2,20151124,B2
US-9279473-B2,20160308,B2
US-9155586-B2,20151013,B2
US-8942526-B2,20150127,B2
US-8994624-B2,20150331,B2
US-9004129-B2,20150414,B2
US-9187733-B2,20151117,B2
US-8945898-B2,20150203,B2
US-9101361-B2,20150811,B2
US-8964683-B2,20150224,B2
US-9160895-B2,20151013,B2
US-9579464-B2,20170228,B2
US-9172497-B2,20151027,B2
US-8983152-B2,20150317,B2
US-9466138-B2,20161011,B2
US-9166674-B2,20151020,B2
Query:
SELECT DISTINCT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
WHERE ipc_u.value:"code" IS NOT NULL
LIMIT 100
Answer:
ipc4_code
G02F
H04M
A61F
F16S
B23D
C10N
B03D
F23K
H04Q
G02C
F16M
C09J
E06B
C03C
F25J
G21K
B61L
F28G
F16F
B29L
D21H
C12J
B44D
D21D
H01B
C01F
G01Q
D06B
H04K
F25C
G04B
G06M
C10J
H05C
G02B
B66F
B63B
C09D
F02M
H03J
B62L
B21H
G06Q
C05G
H01Q
E02F
B25H
F01B
C12H
B62C
D04D
A41H
G06N
C12M
H04J
D07B
E04D
A43C
C06D
H04W
F28B
C08F
B21D
A47L
B26D
B02C
B61G
B21F
G04C
D06G
A61D
F16P
B61C
A61G
A46D
B64U
F21V
F42B
B41L
A21D
B03C
A47J
A47D
C05D
B09C
B01D
E05F
G07C
H03K
B29B
F02P
B31B
D05C
F04F
B05B
B30B
H04B
B41M
G08G
C08L
Query:
SELECT SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "ipc4_code",
       COUNT(DISTINCT t."publication_number") AS "num_patents"
FROM PATENTS.PATENTS.PUBLICATIONS t,
     LATERAL FLATTEN(input => t."ipc", OUTER => TRUE) ipc_u
WHERE ipc_u.value:"code" IS NOT NULL
GROUP BY "ipc4_code"
LIMIT 100
Answer:
ipc4_code,num_patents
B23P,1751
F24S,529
D06M,988
C23F,509
G03F,2029
B66D,402
B60H,942
B64F,288
D21J,60
H01F,2836
A44B,503
B41C,132
H04Q,1514
G21K,230
G02C,633
C03C,1251
B61L,388
E06B,2590
F16M,1933
C09J,1802
F25J,201
B60L,1748
H01P,718
E04C,1375
G05G,343
C12R,1321
F26B,2195
B06B,237
C06C,30
B67B,283
D01D,538
C13K,52
B68C,7
C01F,409
H04K,131
F25C,227
G04B,503
C10J,271
G06M,186
H01B,2722
D06B,581
G01Q,98
H05C,11
H04M,3785
B23D,1208
A61F,4363
G02F,3969
C10N,375
F23K,232
F16S,98
B03D,127
G06Q,6681
H01Q,1762
B25H,714
E02F,1094
C05G,513
A41H,189
F01B,133
C12H,112
D04D,30
B62C,3
A23C,453
G01B,3552
B27B,275
F21L,194
B28D,506
B66B,1310
A22C,388
A01M,1137
B29L,1366
D21H,814
B44D,174
F16F,2484
F28G,139
C12J,47
D21D,89
G21F,339
G08B,2376
H02K,4007
A42B,343
C23C,3294
F16G,340
B23C,448
A01J,133
G01J,1065
A63D,73
Y02E,1
C01B,2737
C09C,366
D01H,483
E05D,718
C10M,693
G06G,179
G16C,62
E02C,17
B24B,2837
C04B,3224
F16D,2211
B05C,1394
B60Q,966
Query:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit_u
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(ipc_u.value:"code"::STRING, 1, 4) AS "cited_ipc4_code"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc_u
)

SELECT
    cc."publication_number",
    COUNT(DISTINCT cc."cited_publication_number") AS "n_i",
    COUNT(DISTINCT cic."cited_ipc4_code") AS "num_distinct_cited_ipc4_codes"
FROM
    citing_citations cc
    LEFT JOIN cited_ipc_codes cic ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number"
ORDER BY
    "num_distinct_cited_ipc4_codes" DESC,
    "n_i" DESC
LIMIT 1;
Answer:
publication_number,n_i,num_distinct_cited_ipc4_codes
US-9121016-B2,79,9
Query:
WITH citing_citations AS (
    SELECT
        t."publication_number",
        cit_u.value:"publication_number"::STRING AS "cited_publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS t,
        LATERAL FLATTEN(input => t."citation") cit_u
    WHERE
        cit_u.value:"publication_number" IS NOT NULL
),
cited_ipc_sections AS (
    SELECT
        cp."publication_number" AS "cited_publication_number",
        SUBSTR(cited_ipc_u.value:"code"::STRING, 1, 1) AS "ipc_section"
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") cited_ipc_u
    WHERE
        cited_ipc_u.value:"code" IS NOT NULL
)
SELECT
    cc."publication_number",
    cic."ipc_section",
    COUNT(*) AS "num_citations_to_section"
FROM
    citing_citations cc
    INNER JOIN cited_ipc_sections cic
        ON cc."cited_publication_number" = cic."cited_publication_number"
GROUP BY
    cc."publication_number",
    cic."ipc_section"
LIMIT 100;
Answer:
publication_number,ipc_section,num_citations_to_section
US-2016363905-A1,G,1
US-8440053-B2,C,1
CN-113524200-A,G,2
CN-116046825-A,G,2
US-2005265933-A1,A,5
US-2006229833-A1,G,4
US-2006058878-A1,A,7
US-6847194-B2,F,1
KR-20240013058-A,A,4
KR-20160000642-A,B,1
US-2021124116-A1,G,2
US-4349216-A,B,1
US-11529926-B2,B,3
US-3256058-A,C,1
WO-2020115607-A3,F,1
US-2581165-A,F,1
US-2841043-A,G,2
US-2004123746-A1,A,3
CN-102916505-A,H,2
CN-109402482-A,C,1
US-11532457-B2,H,13
CN-102275861-A,H,10
KR-20170133463-A,H,2
CN-103096255-A,H,1
CN-109595630-A,F,1
CN-104518014-A,H,3
KR-102607197-B1,B,1
US-11092593-B2,B,2
US-10576130-B2,G,1
CN-104571337-A,G,1
WO-2024108987-A1,H,7
US-9158133-B1,C,2
JP-2014102607-A,H,2
JP-2016099816-A,G,2
CN-106687325-A,F,2
CN-108770666-A,A,1
US-11829958-B2,G,5
US-10985142-B2,H,3
US-11642422-B2,A,5
US-10625938-B2,A,1
US-8532586-B2,H,1
US-10600860-B2,H,3
US-11172929-B2,D,5
US-2008271384-A1,B,2
US-2626395-A,A,1
US-2022280127-A1,H,1
US-6806242-B2,A,1
US-2007129352-A1,A,1
US-7977993-B2,H,2
US-2005038588-A1,B,4
US-9211498-B2,A,1
CN-107786878-A,H,4
CN-113721260-B,G,1
CN-109735315-B,E,2
CN-109577202-A,E,1
JP-S6416634-U,H,1
US-7631501-B2,F,4
US-8920346-B2,A,5
US-6358233-B1,A,3
US-8797684-B1,G,3
US-2007122905-A1,C,1
CN-104291800-A,E,1
CN-109120127-A,H,1
CN-107393312-A,G,2
US-10606257-B2,H,1
US-2022182297-A1,G,2
CN-104029081-A,B,2
CN-114147143-A,B,1
CN-106899198-B,H,3
CN-103320995-A,D,2
CN-114200338-B,G,1
JP-2012018889-A,H,2
CN-108735419-A,F,1
US-9173003-B2,H,6
DE-10057101-C1,E,2
DE-102017107615-B3,G,2
CN-101372863-A,E,1
CN-106470614-A,A,3
CN-101906236-B,C,5
CN-113668132-A,D,1
CN-109624572-B,B,2
US-2019278199-A1,G,2
US-4349028-A,A,2
JP-2016164482-A,F,1
US-2010037524-A1,E,6
US-10670435-B2,G,1
WO-2015161825-A1,D,1
US-2019119050-A1,B,5
US-2650292-A,G,4
JP-2013098141-A,B,2
CN-106369052-A,F,2
GB-2315354-A,G,2
US-2009039418-A1,H,4
US-2010256194-A1,C,2
JP-S61166186-A,H,2
US-5251239-A,H,3
US-2010132221-A1,C,1
US-11058417-B2,A,4
US-2010208258-A1,G,4
JP-2007122992-A,H,14
Query:
SELECT
    t."publication_number" AS "citing_publication_number",
    cit_u.value:"publication_number"::STRING AS "cited_publication_number",
    COUNT(cit_u.value:"publication_number"::STRING) OVER (PARTITION BY t."publication_number") AS "total_backward_citations"
FROM
    PATENTS.PATENTS.PUBLICATIONS t,
    LATERAL FLATTEN(input => t."citation") cit_u
WHERE
    cit_u.value:"publication_number" IS NOT NULL
LIMIT 100
Answer:
citing_publication_number,cited_publication_number,total_backward_citations
US-5271502-A,US-329676-A,11
US-5271502-A,US-821019-A,11
US-5271502-A,US-856881-A,11
US-5271502-A,US-909734-A,11
US-5271502-A,US-2756515-A,11
US-5271502-A,US-4262838-A,11
US-5271502-A,US-4415081-A,11
US-5271502-A,US-4730727-A,11
US-5271502-A,US-5064069-A,11
US-5271502-A,US-5088602-A,11
US-5271502-A,US-5193681-A,11
JP-S63170789-A,JP-S61223991-A,3
JP-S63170789-A,JP-S61239384-A,3
JP-S63170789-A,JP-S61253411-A,3
JP-S60150936-A,JP-S58143934-A,1
JP-S5289187-A,JP-S4926393-A,2
JP-S5289187-A,JP-S5096679-A,2
JP-H02185342-A,JP-S6084232-U,2
JP-H02185342-A,JP-S617110-A,2
JP-S60151563-A,JP-S5370474-A,3
JP-S60151563-A,JP-S5630614-A,3
JP-S60151563-A,JP-S5672349-A,3
JP-S59135502-A,JP-S4932093-A,6
JP-S59135502-A,JP-S5042284-A,6
JP-S59135502-A,JP-S5490467-A,6
JP-S59135502-A,JP-S5528838-A,6
JP-S59135502-A,JP-S5598083-A,6
JP-S59135502-A,JP-S56123017-A,6
JP-H03213929-A,JP-S6419260-A,1
TR-25908-A,DE-1286866-B,5
TR-25908-A,,5
TR-25908-A,,5
TR-25908-A,,5
TR-25908-A,,5
US-5249405-A,US-1212843-A,17
US-5249405-A,US-1533411-A,17
US-5249405-A,US-1783391-A,17
US-5249405-A,US-2180651-A,17
US-5249405-A,US-2236082-A,17
US-5249405-A,US-2429113-A,17
US-5249405-A,US-2612813-A,17
US-5249405-A,US-2816436-A,17
US-5249405-A,US-3343329-A,17
US-5249405-A,US-3436883-A,17
US-5249405-A,US-3901471-A,17
US-5249405-A,US-4448007-A,17
US-5249405-A,US-4481749-A,17
US-5249405-A,US-4498272-A,17
US-5249405-A,US-4782642-A,17
US-5249405-A,US-4844651-A,17
US-5249405-A,US-4995605-A,17
US-2595898-A,DE-657012-C,4
US-2595898-A,US-2112606-A,4
US-2595898-A,DE-680782-C,4
US-2595898-A,US-2484341-A,4
US-6113523-A,US-4185816-A,4
US-6113523-A,US-4378939-A,4
US-6113523-A,US-4787626-A,4
US-6113523-A,US-5186702-A,4
US-5387642-A,GB-1601033-A,4
US-5387642-A,US-4608413-A,4
US-5387642-A,US-4945128-A,4
US-5387642-A,US-5004779-A,4
US-2529330-A,US-1224109-A,6
US-2529330-A,US-1320530-A,6
US-2529330-A,US-1442795-A,6
US-2529330-A,FR-621941-A,6
US-2529330-A,US-1678798-A,6
US-2529330-A,US-2424578-A,6
GB-2362054-A,US-2491561-A,7
GB-2362054-A,US-5014134-A,7
GB-2362054-A,US-5321776-A,7
GB-2362054-A,US-5392255-A,7
GB-2362054-A,US-5602589-A,7
GB-2362054-A,US-5706220-A,7
GB-2362054-A,US-5737448-A,7
GB-2371668-A,US-3742448-A,6
GB-2371668-A,DE-2613558-A1,6
GB-2371668-A,GB-1547559-A,6
GB-2371668-A,US-4651127-A,6
GB-2371668-A,US-5483221-A,6
GB-2371668-A,US-5714930-A,6
GB-2371503-A,GB-2039306-A,4
GB-2371503-A,JP-S6385189-A,4
GB-2371503-A,FR-2681288-A1,4
GB-2371503-A,DE-4317556-A1,4
GB-2398268-A,US-5236421-A,2
GB-2398268-A,US-5397639-A,2
GB-2383711-A,JP-H0193895-U,7
GB-2383711-A,US-5133428-A,7
GB-2383711-A,JP-H05553-U,7
GB-2383711-A,JP-H05116570-A,7
GB-2383711-A,JP-H07274286-A,7
GB-2383711-A,JP-H11151989-A,7
GB-2383711-A,US-2001002632-A1,7
GB-2410868-A,GB-2242335-A,7
GB-2410868-A,EP-1026895-A1,7
GB-2410868-A,WO-0141408-A1,7
GB-2410868-A,US-2002066115-A1,7
GB-2410868-A,WO-0243389-A1,7
End Exploring Related Columns
Task: What is the publication number of US patent under the B2 classification granted during 2015 to 2018, with the highest originality score based on the diversity of 4-digits IPC codes from its backward citations?

Please answer only one complete SQL in snowflake dialect in ```sql``` format.
Usage example: ```sql
SELECT "COLUMN_NAME" FROM DATABASE.SCHEMA.TABLE WHERE ... ``` (Adjust "DATABASE", "SCHEMA", and "TABLE" to match actual names, ensure all column names are enclosed in double quotations)
Follow the answer format like: The publication number of the U.S. patent under the B2 classification granted during 2015 to 2018 with the highest originality score based on the diversity of 4-digit IPC codes from its backward citations is:

```csv
Publication_Number
number:str
(Attention: answer in one row)
```.
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'PATENTS': {'PATENTS': ['CPC_DEFINITION', 'DISCLOSURES_13', 'PUBLICATIONS']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY xxx DESC, add NULLS LAST to exclude null records: ORDER BY xxx DESC NULLS LAST.
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.Keep all decimals to four decimal places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-24 02:02:30 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:02:30 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(*) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) * (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        (1 - sum_of_squares) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
```
2025-01-24 02:02:30 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:02:30 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:02:30 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:02:32 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-24 02:02:32 - snowflake.connector.connection - INFO - closed
2025-01-24 02:02:32 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:02:32 - root - INFO - itercount: 1
2025-01-24 02:02:32 - root - INFO - 0
2025-01-24 02:02:32 - root - INFO - results: 
Publication_Number
US-10042510-B2


2025-01-24 02:02:32 - root - INFO - Please check the answer again by reviewing What is the publication number of US patent under the B2 classification granted during 2015 to 2018, with the highest originality score based on the diversity of 4-digits IPC codes from its backward citations?, reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: The publication number of the U.S. patent under the B2 classification granted during 2015 to 2018 with the highest originality score based on the diversity of 4-digit IPC codes from its backward citations is:

```csv
Publication_Number
number:str
(Attention: answer in one row)
``` The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Publication_Number
US-10042510-B2
Current sql:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(*) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) * (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        (1 - sum_of_squares) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
2025-01-24 02:03:00 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:03:00 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(*) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) * (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
```
2025-01-24 02:03:00 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:03:00 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:03:00 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:03:02 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-24 02:03:02 - snowflake.connector.connection - INFO - closed
2025-01-24 02:03:02 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:03:02 - root - INFO - itercount: 2
2025-01-24 02:03:02 - root - INFO - 0
2025-01-24 02:03:02 - root - INFO - results: 
Publication_Number
US-10010405-B2


2025-01-24 02:03:02 - root - INFO - Please check the answer again by reviewing What is the publication number of US patent under the B2 classification granted during 2015 to 2018, with the highest originality score based on the diversity of 4-digits IPC codes from its backward citations?, reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: The publication number of the U.S. patent under the B2 classification granted during 2015 to 2018 with the highest originality score based on the diversity of 4-digit IPC codes from its backward citations is:

```csv
Publication_Number
number:str
(Attention: answer in one row)
``` The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Publication_Number
US-10010405-B2
Current sql:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(*) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) * (CAST(n_i_k.n_i_k AS FLOAT) / n_i.n_i) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
2025-01-24 02:03:42 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:03:42 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(DISTINCT cited_publication_number) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( POWER(n_i_k.n_i_k / n_i.n_i, 2) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
```
2025-01-24 02:03:42 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:03:42 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:03:42 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:03:44 - snowflake.connector.connection - INFO - closed
2025-01-24 02:03:44 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:03:44 - root - INFO - itercount: 3
2025-01-24 02:03:44 - root - INFO - 000904 (42000): 01b9ea7b-0004-8086-0001-11c300f9052a: SQL compilation error: error line 58 at position 23
invalid identifier 'CITED_PUBLICATION_NUMBER'
2025-01-24 02:03:44 - root - INFO - Input sql:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),

citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),

cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),

citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),

n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),

n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(DISTINCT cited_publication_number) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),

originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( POWER(n_i_k.n_i_k / n_i.n_i, 2) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),

originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)

SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
The error information is:
000904 (42000): 01b9ea7b-0004-8086-0001-11c300f9052a: SQL compilation error: error line 58 at position 23
invalid identifier 'CITED_PUBLICATION_NUMBER'
Please correct it and output only 1 complete SQL query.
2025-01-24 02:04:22 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:04:22 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),
citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),
citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cc.cited_publication_number,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),
n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),
n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(DISTINCT cited_publication_number) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),
originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( POWER(n_i_k.n_i_k / n_i.n_i, 2) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),
originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)
SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
```
2025-01-24 02:04:22 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:04:22 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:04:22 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:04:24 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-24 02:04:24 - snowflake.connector.connection - INFO - closed
2025-01-24 02:04:25 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:04:25 - root - INFO - itercount: 4
2025-01-24 02:04:25 - root - INFO - 0
2025-01-24 02:04:25 - root - INFO - results: 
Publication_Number
US-10007422-B2


2025-01-24 02:04:25 - root - INFO - Please check the answer again by reviewing What is the publication number of US patent under the B2 classification granted during 2015 to 2018, with the highest originality score based on the diversity of 4-digits IPC codes from its backward citations?, reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: The publication number of the U.S. patent under the B2 classification granted during 2015 to 2018 with the highest originality score based on the diversity of 4-digit IPC codes from its backward citations is:

```csv
Publication_Number
number:str
(Attention: answer in one row)
``` The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Publication_Number
US-10007422-B2
Current sql:
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),
citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),
citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cc.cited_publication_number,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),
n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),
n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(DISTINCT cited_publication_number) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),
originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( POWER(n_i_k.n_i_k / n_i.n_i, 2) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),
originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)
SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
2025-01-24 02:05:03 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-24 02:05:03 - root - INFO - ```sql
WITH us_patents AS (
    SELECT
        p."publication_number"
    FROM
        PATENTS.PATENTS.PUBLICATIONS p
    WHERE
        p."country_code" = 'US'
        AND p."kind_code" = 'B2'
        AND p."grant_date" BETWEEN 20150101 AND 20181231
),
citing_citations AS (
    SELECT
        t."publication_number" AS citing_pub_num,
        cit.value:"publication_number"::STRING AS cited_publication_number
    FROM
        us_patents t
        JOIN PATENTS.PATENTS.PUBLICATIONS p ON t."publication_number" = p."publication_number",
        LATERAL FLATTEN(input => p."citation") cit
    WHERE
        cit.value:"publication_number" IS NOT NULL
),
cited_ipc_codes AS (
    SELECT
        cp."publication_number" AS cited_publication_number,
        SUBSTR(ipc.value:"code"::STRING, 1, 4) AS cited_ipc4_code
    FROM
        PATENTS.PATENTS.PUBLICATIONS cp,
        LATERAL FLATTEN(input => cp."ipc") ipc
    WHERE
        ipc.value:"code" IS NOT NULL
),
citations_with_ipc AS (
    SELECT
        cc.citing_pub_num,
        cc.cited_publication_number,
        cic.cited_ipc4_code
    FROM
        citing_citations cc
        LEFT JOIN cited_ipc_codes cic ON cc.cited_publication_number = cic.cited_publication_number
),
n_i AS (
    SELECT
        citing_pub_num,
        COUNT(DISTINCT cited_publication_number) AS n_i
    FROM
        citing_citations
    GROUP BY
        citing_pub_num
),
n_i_k AS (
    SELECT
        citing_pub_num,
        cited_ipc4_code,
        COUNT(DISTINCT cited_publication_number) AS n_i_k
    FROM
        citations_with_ipc
    WHERE
        cited_ipc4_code IS NOT NULL
    GROUP BY
        citing_pub_num,
        cited_ipc4_code
),
originality_calc AS (
    SELECT
        n_i.citing_pub_num,
        n_i.n_i,
        SUM( POWER(n_i_k.n_i_k::FLOAT / n_i.n_i, 2) ) AS sum_of_squares
    FROM
        n_i
        JOIN n_i_k ON n_i.citing_pub_num = n_i_k.citing_pub_num
    GROUP BY
        n_i.citing_pub_num, n_i.n_i
),
originality_scores AS (
    SELECT
        citing_pub_num AS "Publication_Number",
        ROUND(1 - sum_of_squares, 4) AS originality
    FROM
        originality_calc
)
SELECT
    "Publication_Number"
FROM
    originality_scores
ORDER BY
    originality DESC NULLS LAST,
    "Publication_Number"
LIMIT 1;
```
2025-01-24 02:05:03 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.62-x86_64-with-glibc2.31
2025-01-24 02:05:03 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-24 02:05:03 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-24 02:05:05 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-24 02:05:05 - snowflake.connector.connection - INFO - closed
2025-01-24 02:05:05 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-24 02:05:05 - root - INFO - itercount: 5
2025-01-24 02:05:05 - root - INFO - 0
2025-01-24 02:05:05 - root - INFO - Total iteration counts: 5
