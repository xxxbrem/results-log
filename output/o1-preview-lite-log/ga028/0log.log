2025-01-30 01:08:26 - openai._base_client - INFO - Retrying request to /chat/completions in 0.494916 seconds
2025-01-30 01:09:01 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:09:02 - root - INFO - SQL:
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
Results:
event_name
level_complete_quickplay
session_start
screen_view
level_fail_quickplay
level_end_quickplay
post_score
level_start_quickplay
select_content
user_engagement
level_up
level_complete
level_fail
level_end
level_start
level_retry
completed_5_levels
ad_reward
no_more_extra_steps
use_extra_steps
spend_virtual_currency
level_retry_quickplay
level_reset
level_reset_quickplay
app_exception
os_update
app_remove
challenge_a_friend
app_clear_data
app_update
firebase_campaign
error
first_open

2025-01-30 01:09:04 - root - INFO - SQL:
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
Results:
user_pseudo_id,event_name,event_date
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,session_start,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702

2025-01-30 01:09:09 - root - INFO - SQL:
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
GROUP BY event_date
ORDER BY event_date
LIMIT 100;
Results:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500

2025-01-30 01:09:14 - root - INFO - SQL:
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
Results:
user_pseudo_id
85FD06F19EBB6097388EEE0B207598B7
5217AB1A454DAED6243E1C9818BE6A20
2F0F260BD7B876C346B41977D0D03D62
94099563C71C699CCCEDC3EC2178DAD0
A87A30159D909E2356F72AAC76F26707
0318C42AEF29C012B2BA556EEF7A7661
B79F414B574CB7F894FE7236A1465837
986BCC5319B29A4EA06FDEB7DAFB01D0
C3D7BA97E184ABF0A446F35DE12BACF9
9B18A1CBA96D52D05CFA7CB7C9011EDE
E512079B53179DF9A608CF4ADE47DE9D
98578513E0F25350F961CDCBA9D3656F
88E6D3D4433BA2B424A6D5D23A871B97
8BE7BF90C971453A34C1FF6FF2A0ACAE
F0FC99F563E1247AD70240E5AA132ABF
BEC04B2A3A5CC892BE0907C44F5F921F
1B3AD9683D475EFB398E131DFE65AE61
78161BB39BB13189ED9A6838A9AE45DE
AAADF44F1C6A57099FEF88D15C7CF64D
24D41A78A6BB1244608DB32351B0658B
2CCA3846093A5C9AA76489A76DAA7D3A
3B48621D018502D4808ED7C757DA8919
72E752D33E3C79FDBC5525C86DFD2A75
E9DCE2D958652BD58E846DCE86BDD90A
F92B2FB00F381010F8895FDFB47A8331
A8576CA2812F32F35A850A7C773DA391
EBB30E8C806A423B024E51AC32021A6A
FC7CFC0E2E8479602D5245286E9DE088
E0F91AA200D6F12DBE53B0D166AFD87B
D1621FABED8BEBB6913F7C7456ABBDAB
8E2CA56C1FD81A095DECAEDE6F2ED626
7566596A1D6ACA781692A7A0B89B06EF
920DB84FCC0F4421650B9E257E33180B
B1AF454DE996A302235A9C354B6E5985
5BDEA4C55EFDF16308475E1ACA152767
F1732713A47A1A140F8B2BB3F232B4E5
9A12E7E2B3CF644B8304DF8E1A9CE2D8
A666FD2C8F5F662111C5ECEAF9CA6562
BCEC642620FB741AA4EE43E0FC6C7A05
7548E849537562672CF9C567B9C0EC87
A934B78A4B0A0D85718D89303D195B2E
D99F522177A35745D80F596989D1111E
487DE902636DD8A9844A2D61FE7BD568
F5822275490E7BF0C269CAED489C8053
1C65943AF5217570A2E4D9B58B6E6FC4
E8AA0D95D5317A98F1592D34D75A8946
32B8D06C9F7E1EA3FEEAA158A6912216
37DEF17DD3761C66B7F56806F978E726
717914316B7E4BD629C168B3A05634DC
FB149ABD1F42826AA82A9D0D3FB03342
83FB7D43B1E7E7F56B667667163A746A
4C984F59962433E54226AF922DAA894A
6DDDAE324FDA2F60DEFC8F4424C9547D
01C784BDB7AF4DC8DAD6DCD21AF56E25
ABE28FFF3F8B3F0E1AFAAEEE2FD0105C
D14F72ECEF450A96C642F9C58DEDF723
EEBCB25D5F056CCF59DDE654388ACD2B
E53BC2A0AD86417B443AF14EE3082C0F
38383D77F69C1CAA39B0CAC891CB0E0B
2F6043B9170F1B2C4A16A13F3D6D00EB
4295F8BC46B98B453731B1F938B75CAD
47F7713B7F3C4F3149A9200360757C6B
0155220BAB309646CC7AC980AB75A212
41CA0FA528C7227EA1E592DCC4733C40
36CD9DA75188D11BA0065964FF116EC0
3F6BC08D796DEE0902E221D5ADC88FC5
8320FC247A1967E7C0CDFC1502241310
4789C778386485B99F4077B97DFE34E3
0FE7AA892150DE7C58D1B2988580346D
498863DFCF5947A4D6DD8E82CC1BB322
44DE25D7B9A474632A68C3533417A1CD
B5F3D00E28A57C9522F2DEE3CB903DD1
3A2180BCAA45AB7675057130B18F8522
B4723ACA1A6C65BE5D0970DF4166CCBE
488BE19C45D3D8B2DF02214BC19B44B4
3B89F2F5E5B7FDE2FA5C12EF74A747DD
F1B841B645E96249BDFD59DB76865211
B5D8ACA33A57FF52CFC01C59EBD0E9EC
30E7FC7394103E7EFA3F0AFC9F14342C
874599EBF4EF79D625A0C161F74C0C0E
9E63A50ABB7C292735533D3308161DBD
437E1E4F1A7DF0CC995FCE10EAC96350
025FF377B4148748AF5743A54761EA15
5C75C4C24A8F46B0E518376A0CB1E6A1
93699FB737D442ABBD95CE58A686442F
EBE661044C1949546986A852F35083A1
0F91E57ED2FE4B74582FF8D781548671
102CC7D8CD5D3E861EACE1BAB97E61EC
2AC0EF5047BC538BDA6388E644409B5D
467D5A2A62334E71BE1651A86C2A69CA
046CC8D512A010F60CB1EB26AAE41757
D1FDE2A7EAF350A6C080F1EF4D93AAED
97E7144B7FA861C3C8DB7424D7039832

2025-01-30 01:09:20 - root - INFO - SQL:
SELECT user_pseudo_id, MIN(event_date) AS first_session_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
GROUP BY user_pseudo_id
LIMIT 100;
Results:
user_pseudo_id,first_session_date
B71CB5D517BE99FEEED64A0F57842032,20180621
343B740C7B3BD9C2CFA46BF097A8856E,20180613
036860D2869208B2EF11A6A23BD8EC2F,20180907
33A1F72714BF8B0591A135AFC746C038,20180907
0D17D0247F158FA3E40D21EFF46D1651,20180627
5441E1E2D53935E31C632E3FBAAD166B,20180907
25DFBAA3823DDC3B5D4C6F7B59CBF8B4,20180709
8AF6C2B07CBA18947A6C608DC3805B09,20180907
FDDFE28C3B0A73F93F593514F578760A,20180906
031E8A6C7AA76CC5B954EE4229A5CF98,20180907
D78D36FBC1694FDE2718E8E9A7CC99A1,20180626
049A296C5B282AF7100E0BC093589617,20180612
751B06814F2E7EFE53CF17EA6A435B58,20180818
B8C8015FECAD94364B76E74CA9C1A946,20180907
2320A677307F45BB4941696EC7412120,20180907
66739352C8F94F55906F93AD35A7D894,20180904
B784F081E3033006930B7070CB1F7CC5,20180907
FDA4BBBCF1EA2D95CDD77BFC5F00A837,20180625
93C5C5EEACDB9F83DD795449363339E2,20180612
F0192BFEC0959BEE0FB12685539F4131,20180619
7C7DE40DCACC2367C56621C0835BF04E,20180906
84B38C413A7F3C683BCC6CBCCA246FBE,20180907
EEED36297DE224E3E34468ECB0BA7AF5,20180904
0B15684EDDCE9514EFC8DDE9F80C5E7E,20180613
4D3850D024352B02B9C8FC234C823669,20180628
0BF28246916A6D54E16290E925B16593,20180904
599A28B77C37024BD13085EF61A55BDC,20180907
D55D4E5B60368F4BE64F16EFD78B2BE7,20180622
2F74E23BEA1E45E3897274EE4903DCC5,20180613
EA08B4A086F6269ADF5BCB411515361D,20180907
C677D4AC75F093F984D7881B299C8C12,20180628
DB9D0368B6DC1CD2E03CDDBE7060DE31,20180620
C11C29B300E223B1A516BB555C6EA232,20180907
1DA7C7F8359123550CA334AB575E95DA,20180614
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180620
B525B8771E5D7F146BDEB716A99FFB1C,20180904
7DCD9440F2BF5EB73FFCC4F26E26F580,20180906
0609C988CD429DF8D706827547C9FC2D,20180612
B29E5875DEFE1E68C9F885A278235FE4,20180907
A94FF1DB15116F965C00A2566F604043,20180904
7D3C8EA868F4490FB264FBCD32442711,20180907
0C621E64FC5D74AC60AADCF0EA9D640A,20180612
43179F39C4923E08D3CD9F3CC7D702B2,20180906
21E94A46F6DF2AF6254F916EABA0084A,20180619
7386D239899D55E3D62DA619F359A7C0,20180620
967F40F4C525E024B52809F7115718C0,20180620
E184A4B4ED5FAFEDD19266FB429F3765,20180618
4A47422A455E62E3529DE4F9F3BFAF66,20180613
C88B1D3F6DEC26E03432899B55EE420B,20180618
2E98271C4DE172F7AA1BB10FDEEA3913,20180619
B75F91EB6C7FDA9A329567E763CF9E44,20180618
C64FDEA4F0B0743BCF6CEDB45FEE8AB7,20180620
E0562323C1BAADE462D8D1BD783C75EA,20180620
1739B4C38E25048BC220EB3AD19AA0FB,20180620
10B0D468B5E036E16D13DB53A65F2D49,20180618
7EE035CA8E6132A8877C39656896BA41,20180612
A6C87EE4B7B875BCAB0C650365236072,20180620

2025-01-30 01:09:25 - root - INFO - SQL:
SELECT user_pseudo_id
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
Results:
user_pseudo_id
2F0F260BD7B876C346B41977D0D03D62
83EB6E905B20079A153828894109C0FF
986BCC5319B29A4EA06FDEB7DAFB01D0
9B18A1CBA96D52D05CFA7CB7C9011EDE
0155220BAB309646CC7AC980AB75A212
D1CE26407DE7F231D92F0EFB6FB1B6C6
88E6D3D4433BA2B424A6D5D23A871B97
0D6A346C85BF606BE12F9A70FC20A7B7
046CC8D512A010F60CB1EB26AAE41757
94099563C71C699CCCEDC3EC2178DAD0
B79F414B574CB7F894FE7236A1465837
C3D7BA97E184ABF0A446F35DE12BACF9
8BE7BF90C971453A34C1FF6FF2A0ACAE
78161BB39BB13189ED9A6838A9AE45DE
72E752D33E3C79FDBC5525C86DFD2A75
F92B2FB00F381010F8895FDFB47A8331
A8576CA2812F32F35A850A7C773DA391
FC7CFC0E2E8479602D5245286E9DE088
E0F91AA200D6F12DBE53B0D166AFD87B
D1621FABED8BEBB6913F7C7456ABBDAB
5BDEA4C55EFDF16308475E1ACA152767
F1732713A47A1A140F8B2BB3F232B4E5
A666FD2C8F5F662111C5ECEAF9CA6562
BCEC642620FB741AA4EE43E0FC6C7A05
A934B78A4B0A0D85718D89303D195B2E
D99F522177A35745D80F596989D1111E
F5822275490E7BF0C269CAED489C8053
E8AA0D95D5317A98F1592D34D75A8946
83FB7D43B1E7E7F56B667667163A746A
4C984F59962433E54226AF922DAA894A
ABE28FFF3F8B3F0E1AFAAEEE2FD0105C
D14F72ECEF450A96C642F9C58DEDF723
4295F8BC46B98B453731B1F938B75CAD
BDEEAEF22E7549E96E4763DB95477113
44DE25D7B9A474632A68C3533417A1CD
8320FC247A1967E7C0CDFC1502241310
498863DFCF5947A4D6DD8E82CC1BB322
B4723ACA1A6C65BE5D0970DF4166CCBE
F1B841B645E96249BDFD59DB76865211
B5D8ACA33A57FF52CFC01C59EBD0E9EC
30E7FC7394103E7EFA3F0AFC9F14342C
9E63A50ABB7C292735533D3308161DBD
5C75C4C24A8F46B0E518376A0CB1E6A1
93699FB737D442ABBD95CE58A686442F
AAECE8DA46F021A9CFE489ADF95DA078
657E8EB68545E75A6EAD9B6A11C2E773
676D390F2BEE51F6EC40C81D19C6FBC3
4E2E603C5BFF961B68142AFFC2D5C3F2
74CE0B2D3F78299DAFFB56CA001B7BC5
6FC11768E2D8132D0EBD54B823E26DC4
981CA03B25810447E879E7E767499ABD
8AB276B80B01A635BA7EF9C2071C0231
760224DD438185D3F00938581C387090
D1FDE2A7EAF350A6C080F1EF4D93AAED
CDFD94DA480631BEB80E66BC36103CB7
DEFD9295690E6A9847A9C92A90AC78FB
0EFF72F3A7E2118F0B938C4595B4166D
6FB0DC4B3B77B4945CCC153EB01DE168
BF77633BE8375F4A32984B692B4D8942
B993935197C496DF102FE8D0FE8527E2
CF47EB1BF0FD3A0CF7AB508DBC4DC30F
93C2529FAD40263384413CE9630B308E
A321A68F8050F7262B29FDA89387AEC7
83BD247F986B80A1459E119D2891452E
4D1DFFA5A6570E90D83878ED0021478B
B29745B420435984A30B6601B74648E5
EECDCA8076D5842922767F5C08957B17
2B8C48BCEDF2703CC0AA7262FA09769E
6B19694F160900435F42DD59928CD8C5
3D01D6221D54D40DC42C3D6FBCCEC926
08F14F3BCA030F81B447161BA8653B44
A51128E8CFDD686155CB07E35B410A57
C27D61F5B4239A4FD5AB86D61342FBBF
5177C7AEDDB6CE289372DCFABEC636CE
E2CD12EE286D97AF7174B8AB91391200
33C04C115CDB49A0A23F4CCCA62BDA40
970461AAC9D16D75C936A421BF403515
17C62023A0329A033075B1E4C3372275
83C946045F057E90A71CACBE15BC6C00
00EBE1243410277D1073CC84434B9401
C08AAF1391E0219CA2743DE09E394995
84AFEFA3875BA1F17232CB41D06B6EF4
4109514A07FD2A10C61DA26ED8F826CA
6715B569543C76DB5342D8677A8A0963
C8B06F76EE9091107007C19B08C7834E
A83BC91437FF6DFD5F6958D05FCA0051
D8A3FB65349D7DC9D73D39B1E473782F
07BA1D5FAA047D05359113E20FC8BBB9
EA30BC2CFFCAEB738E1AAE3043849EA6
0E99540ADD6E138A904409597A72DA7E
31847AC271201DA719BCE60A3B0B3EB7
1BCBD81E38843F32FCEB2CB5C8824543
D4C1F412017F567367B7E189BBB46A80

2025-01-30 01:09:30 - root - INFO - SQL:
SELECT COUNT(*) AS total_new_users
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708';
Results:
total_new_users
622

2025-01-30 01:09:36 - root - INFO - SQL:
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date > '20180708'  -- Events after Week 0
ORDER BY user_pseudo_id, event_date
LIMIT 100;
Results:
user_pseudo_id,event_name,event_date
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,level_fail_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,post_score,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,select_content,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_end_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,level_end_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,session_start,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,select_content,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,screen_view,20180726
0155220BAB309646CC7AC980AB75A212,user_engagement,20180726
0155220BAB309646CC7AC980AB75A212,session_start,20180726
0155220BAB309646CC7AC980AB75A212,screen_view,20180726
0155220BAB309646CC7AC980AB75A212,select_content,20180726
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,user_engagement,20180726
0155220BAB309646CC7AC980AB75A212,post_score,20180726
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180726

2025-01-30 01:09:43 - root - INFO - SQL:
SELECT COUNT(DISTINCT user_pseudo_id) AS retained_users_week1
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date BETWEEN '20180709' AND '20180715';
Results:
retained_users_week1
147

2025-01-30 01:09:49 - root - INFO - SQL:
SELECT
  COUNT(DISTINCT IF(event_date BETWEEN '20180709' AND '20180715', user_pseudo_id, NULL)) AS retained_users_week1,
  COUNT(DISTINCT IF(event_date BETWEEN '20180716' AND '20180722', user_pseudo_id, NULL)) AS retained_users_week2,
  COUNT(DISTINCT IF(event_date BETWEEN '20180723' AND '20180729', user_pseudo_id, NULL)) AS retained_users_week3,
  COUNT(DISTINCT IF(event_date BETWEEN '20180730' AND '20180805', user_pseudo_id, NULL)) AS retained_users_week4
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
);
Results:
retained_users_week1,retained_users_week2,retained_users_week3,retained_users_week4
147,110,119,116

2025-01-30 01:09:49 - root - INFO - itercount: 0
2025-01-30 01:09:49 - root - INFO - Database Name: firebase-public-project
Schema Name: analytics_153293282
DDL describes table information.
,0
table_name,events_20180801
ddl,"CREATE TABLE `firebase-public-project.analytics_153293282.events_20180801`
(
  event_date STRING,
  event_timestamp INT64,
  event_name STRING,
  event_params ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64>>>,
  event_previous_timestamp INT64,
  event_value_in_usd FLOAT64,
  event_bundle_sequence_id INT64,
  event_server_timestamp_offset INT64,
  user_id STRING,
  user_pseudo_id STRING,
  user_properties ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64, set_timestamp_micros INT64>>>,
  user_first_touch_timestamp INT64,
  user_ltv STRUCT<revenue FLOAT64, currency STRING>,
  device STRUCT<category STRING, mobile_brand_name STRING, mobile_model_name STRING, mobile_marketing_name STRING, mobile_os_hardware_model STRING, operating_system STRING, operating_system_version STRING, vendor_id STRING, advertising_id STRING, language STRING, is_limited_ad_tracking STRING, time_zone_offset_seconds INT64>,
  geo STRUCT<continent STRING, country STRING, region STRING, city STRING>,
  app_info STRUCT<id STRING, version STRING, install_store STRING, firebase_app_id STRING, install_source STRING>,
  traffic_source STRUCT<name STRING, medium STRING, source STRING>,
  stream_id STRING,
  platform STRING
);"

Some other tables have the similar structure: ['events_20180801', 'events_20180621', 'events_20180616', 'events_20180912', 'events_20180814', 'events_20180716', 'events_20181003', 'events_20180620', 'events_20180624', 'events_20180918', 'events_20180612', 'events_20180911', 'events_20180724', 'events_20180807', 'events_20180710', 'events_20180808', 'events_20180702', 'events_20180719', 'events_20180914', 'events_20180913', 'events_20180915', 'events_20180728', 'events_20180817', 'events_20180628', 'events_20180906', 'events_20180704', 'events_20180711', 'events_20180720', 'events_20180706', 'events_20180926', 'events_20180924', 'events_20180731', 'events_20180804', 'events_20180920', 'events_20180715', 'events_20180709', 'events_20180928', 'events_20180904', 'events_20180903', 'events_20180818', 'events_20180820', 'events_20180707', 'events_20180930', 'events_20180821', 'events_20180812', 'events_20180830', 'events_20180908', 'events_20180708', 'events_20180910', 'events_20180922', 'events_20180713', 'events_20180618', 'events_20180811', 'events_20181001', 'events_20180626', 'events_20180828', 'events_20180717', 'events_20180806', 'events_20180721', 'events_20180725', 'events_20180824', 'events_20180923', 'events_20180627', 'events_20180726', 'events_20180729', 'events_20180929', 'events_20180925', 'events_20180722', 'events_20180630', 'events_20180730', 'events_20180831', 'events_20180701', 'events_20180619', 'events_20180810', 'events_20180822', 'events_20180921', 'events_20180819', 'events_20180927', 'events_20180905', 'events_20180816', 'events_20180622', 'events_20180802', 'events_20180826', 'events_20180714', 'events_20180901', 'events_20180916', 'events_20180809', 'events_20181002', 'events_20180703', 'events_20180617', 'events_20180902', 'events_20180625', 'events_20180827', 'events_20180805', 'events_20180825', 'events_20180919', 'events_20180917', 'events_20180705', 'events_20180613', 'events_20180907', 'events_20180909', 'events_20180727', 'events_20180813', 'events_20180614', 'events_20180623', 'events_20180829', 'events_20180615', 'events_20180712', 'events_20180718', 'events_20180815', 'events_20180629', 'events_20180803', 'events_20180823', 'events_20180723']
External knowledge that might be helpful: 
How to Calculate User Retention in Big Query from Google Demo Game Analytics Data

As a Product / Website Analyst, I was pretty psyched to discover Google’s public Google Analytics 4 (GA4) gaming event dataset called `firebase-public-project.analytics_153293282.events_*`. The table allows experienced developers and learners alike to experiment with raw GA4 data in Big Query for free. Event data is basically a log of user interactions with your product for analysis .For newbies interested in learning more about event data and GA4, visit my prior blog. This article provides SQL queries for a quick table overview and explains how to utilize Google Big Query to calculate user retention.


What is Retention?
User retention rates are key indicators for whether your product team meets user needs. Improving retention is often central to long term growth strategies.

**Retention measure’s how often and for how long users tend to return to your product.**

The metric can be a powerful proxy for product usefulness and user opinion. Its analysis can reveal critical information like how well your site converts new visitors to users and which items and features are associated with users coming back. If user data is available, retention can also help a business understand the profiles of its most active users (power users). Finally, retention is a great guardrail metric for A/B tests. Successful, product oriented companies prioritize a healthy user bases over short term profits.


**Common Retention Calculation Strategies**

Two common strategies to calculate retention are: 

a) N-Day retention

b) Unbounded Retention.


a) For N-Day retention, analysts calculate how many users with certain characteristics return over successive periods. It is called N days because we define the length of each period. For example, with N=7 day retention, if User A becomes part of our cohort of interest on day 0 and returns to the product day 5 and day 15, they are counted as retained for week 1 (1–7 days) and week 3 (15–21 days) but not week 2 (8–14 days).


b) For Unbounded Retention, a user is counted as retained each week so long as their most recent product contact was after the week. For example, if User A becomes part of the cohort on day 0 and last returned to the site on day 21, they will be counted as retained in week 1 (1–7 days), week 2 (8–14 days), and week 3 (15–21 days) but not week 4 (22–28 days).

By calculating these metrics, companies can evaluate how well their products hold users’ interests. It also them closer to identifying the patterns that generate return users.



The table structure information is ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}
Begin Exploring Related Columns
To perform the 7-day retention analysis, we need to identify the relevant tables and columns.

### **Relevant Tables:**

- **Week 0 (July 2, 2018 - July 8, 2018):**
  - `firebase-public-project.analytics_153293282.events_20180702`
  - `firebase-public-project.analytics_153293282.events_20180703`
  - `firebase-public-project.analytics_153293282.events_20180704`
  - `firebase-public-project.analytics_153293282.events_20180705`
  - `firebase-public-project.analytics_153293282.events_20180706`
  - `firebase-public-project.analytics_153293282.events_20180707`
  - `firebase-public-project.analytics_153293282.events_20180708`

- **Subsequent Weeks (for retention analysis up to Week 4):**
  - All `events_YYYYMMDD` tables from `20180702` to `20180805`

### **Relevant Columns and Their Potential Usage:**

- **`user_pseudo_id`**: Unique identifier for users. Used to track individual users across sessions and weeks.
- **`event_name`**: Name of the event. We'll use this to identify 'session_start' events.
- **`event_date`**: Date of the event in 'YYYYMMDD' format. Used to filter events by specific dates and weeks.
- **Conditions That May Be Used:**
  - Filter events where `event_name = 'session_start'` to identify session starts.
  - Identify users whose **first** `session_start` event occurred between `'20180702'` and `'20180708'` (Week 0).
  - Track these users in subsequent weeks to see if they had any events (retention).

---

Below are 10 BigQuery SQL queries ranging from simple to complex to help us understand the data and prepare for the retention analysis.

---

#### **1. List Distinct Event Names on July 2, 2018**

```sql
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
```

---

#### **2. Retrieve Sample of Events with User IDs on July 2, 2018**

```sql
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
```

---

#### **3. Count of 'session_start' Events Each Day During Week 0**

```sql
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
GROUP BY event_date
ORDER BY event_date
LIMIT 100;
```

---

#### **4. List Sample of Users Who Started a Session During Week 0**

```sql
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
```

---

#### **5. Identify Users' First Session Dates**

```sql
SELECT user_pseudo_id, MIN(event_date) AS first_session_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
GROUP BY user_pseudo_id
LIMIT 100;
```

---

#### **6. List Users Who Had Their First Session During Week 0**

```sql
SELECT user_pseudo_id
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
```

---

#### **7. Count Total Number of New Users in Week 0**

```sql
SELECT COUNT(*) AS total_new_users
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708';
```

---

#### **8. Retrieve Events of New Users in Subsequent Weeks**

```sql
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date > '20180708'  -- Events after Week 0
ORDER BY user_pseudo_id, event_date
LIMIT 100;
```

---

#### **9. Count Retained Users in Week 1 (July 9 - July 15, 2018)**

```sql
SELECT COUNT(DISTINCT user_pseudo_id) AS retained_users_week1
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date BETWEEN '20180709' AND '20180715';
```

---

#### **10. Calculate Retained Users for Weeks 1 to 4**

```sql
SELECT
  COUNT(DISTINCT IF(event_date BETWEEN '20180709' AND '20180715', user_pseudo_id, NULL)) AS retained_users_week1,
  COUNT(DISTINCT IF(event_date BETWEEN '20180716' AND '20180722', user_pseudo_id, NULL)) AS retained_users_week2,
  COUNT(DISTINCT IF(event_date BETWEEN '20180723' AND '20180729', user_pseudo_id, NULL)) AS retained_users_week3,
  COUNT(DISTINCT IF(event_date BETWEEN '20180730' AND '20180805', user_pseudo_id, NULL)) AS retained_users_week4
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
);
```

---

These queries progressively help us understand the data:

- Queries 1-2: Explore the event names and sample user events.
- Queries 3-4: Analyze session_start events during Week 0.
- Queries 5-7: Identify new users who had their first session in Week 0 and count them.
- Queries 8-10: Track these new users in subsequent weeks to calculate retention numbers.

By analyzing the results of these queries, we can extract the total number of new users in Week 0 and the number of retained users for Weeks 1 to 4, which are needed for the 7-day retention analysis.Query:
SELECT DISTINCT event_name
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
Answer:
event_name
level_complete_quickplay
session_start
screen_view
level_fail_quickplay
level_end_quickplay
post_score
level_start_quickplay
select_content
user_engagement
level_up
level_complete
level_fail
level_end
level_start
level_retry
completed_5_levels
ad_reward
no_more_extra_steps
use_extra_steps
spend_virtual_currency
level_retry_quickplay
level_reset
level_reset_quickplay
app_exception
os_update
app_remove
challenge_a_friend
app_clear_data
app_update
firebase_campaign
error
first_open
Query:
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_20180702`
LIMIT 100;
Answer:
user_pseudo_id,event_name,event_date
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,level_complete_quickplay,20180702
654F30C1312F6C1A26DFDA9F076A62D8,session_start,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
654F30C1312F6C1A26DFDA9F076A62D8,screen_view,20180702
Query:
SELECT event_date, COUNT(*) AS session_start_count
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
GROUP BY event_date
ORDER BY event_date
LIMIT 100;
Answer:
event_date,session_start_count
20180702,621
20180703,596
20180704,556
20180705,548
20180706,574
20180707,615
20180708,500
Query:
SELECT DISTINCT user_pseudo_id
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
  AND event_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
Answer:
user_pseudo_id
85FD06F19EBB6097388EEE0B207598B7
5217AB1A454DAED6243E1C9818BE6A20
2F0F260BD7B876C346B41977D0D03D62
94099563C71C699CCCEDC3EC2178DAD0
A87A30159D909E2356F72AAC76F26707
0318C42AEF29C012B2BA556EEF7A7661
B79F414B574CB7F894FE7236A1465837
986BCC5319B29A4EA06FDEB7DAFB01D0
C3D7BA97E184ABF0A446F35DE12BACF9
9B18A1CBA96D52D05CFA7CB7C9011EDE
E512079B53179DF9A608CF4ADE47DE9D
98578513E0F25350F961CDCBA9D3656F
88E6D3D4433BA2B424A6D5D23A871B97
8BE7BF90C971453A34C1FF6FF2A0ACAE
F0FC99F563E1247AD70240E5AA132ABF
BEC04B2A3A5CC892BE0907C44F5F921F
1B3AD9683D475EFB398E131DFE65AE61
78161BB39BB13189ED9A6838A9AE45DE
AAADF44F1C6A57099FEF88D15C7CF64D
24D41A78A6BB1244608DB32351B0658B
2CCA3846093A5C9AA76489A76DAA7D3A
3B48621D018502D4808ED7C757DA8919
72E752D33E3C79FDBC5525C86DFD2A75
E9DCE2D958652BD58E846DCE86BDD90A
F92B2FB00F381010F8895FDFB47A8331
A8576CA2812F32F35A850A7C773DA391
EBB30E8C806A423B024E51AC32021A6A
FC7CFC0E2E8479602D5245286E9DE088
E0F91AA200D6F12DBE53B0D166AFD87B
D1621FABED8BEBB6913F7C7456ABBDAB
8E2CA56C1FD81A095DECAEDE6F2ED626
7566596A1D6ACA781692A7A0B89B06EF
920DB84FCC0F4421650B9E257E33180B
B1AF454DE996A302235A9C354B6E5985
5BDEA4C55EFDF16308475E1ACA152767
F1732713A47A1A140F8B2BB3F232B4E5
9A12E7E2B3CF644B8304DF8E1A9CE2D8
A666FD2C8F5F662111C5ECEAF9CA6562
BCEC642620FB741AA4EE43E0FC6C7A05
7548E849537562672CF9C567B9C0EC87
A934B78A4B0A0D85718D89303D195B2E
D99F522177A35745D80F596989D1111E
487DE902636DD8A9844A2D61FE7BD568
F5822275490E7BF0C269CAED489C8053
1C65943AF5217570A2E4D9B58B6E6FC4
E8AA0D95D5317A98F1592D34D75A8946
32B8D06C9F7E1EA3FEEAA158A6912216
37DEF17DD3761C66B7F56806F978E726
717914316B7E4BD629C168B3A05634DC
FB149ABD1F42826AA82A9D0D3FB03342
83FB7D43B1E7E7F56B667667163A746A
4C984F59962433E54226AF922DAA894A
6DDDAE324FDA2F60DEFC8F4424C9547D
01C784BDB7AF4DC8DAD6DCD21AF56E25
ABE28FFF3F8B3F0E1AFAAEEE2FD0105C
D14F72ECEF450A96C642F9C58DEDF723
EEBCB25D5F056CCF59DDE654388ACD2B
E53BC2A0AD86417B443AF14EE3082C0F
38383D77F69C1CAA39B0CAC891CB0E0B
2F6043B9170F1B2C4A16A13F3D6D00EB
4295F8BC46B98B453731B1F938B75CAD
47F7713B7F3C4F3149A9200360757C6B
0155220BAB309646CC7AC980AB75A212
41CA0FA528C7227EA1E592DCC4733C40
36CD9DA75188D11BA0065964FF116EC0
3F6BC08D796DEE0902E221D5ADC88FC5
8320FC247A1967E7C0CDFC1502241310
4789C778386485B99F4077B97DFE34E3
0FE7AA892150DE7C58D1B2988580346D
498863DFCF5947A4D6DD8E82CC1BB322
44DE25D7B9A474632A68C3533417A1CD
B5F3D00E28A57C9522F2DEE3CB903DD1
3A2180BCAA45AB7675057130B18F8522
B4723ACA1A6C65BE5D0970DF4166CCBE
488BE19C45D3D8B2DF02214BC19B44B4
3B89F2F5E5B7FDE2FA5C12EF74A747DD
F1B841B645E96249BDFD59DB76865211
B5D8ACA33A57FF52CFC01C59EBD0E9EC
30E7FC7394103E7EFA3F0AFC9F14342C
874599EBF4EF79D625A0C161F74C0C0E
9E63A50ABB7C292735533D3308161DBD
437E1E4F1A7DF0CC995FCE10EAC96350
025FF377B4148748AF5743A54761EA15
5C75C4C24A8F46B0E518376A0CB1E6A1
93699FB737D442ABBD95CE58A686442F
EBE661044C1949546986A852F35083A1
0F91E57ED2FE4B74582FF8D781548671
102CC7D8CD5D3E861EACE1BAB97E61EC
2AC0EF5047BC538BDA6388E644409B5D
467D5A2A62334E71BE1651A86C2A69CA
046CC8D512A010F60CB1EB26AAE41757
D1FDE2A7EAF350A6C080F1EF4D93AAED
97E7144B7FA861C3C8DB7424D7039832
Query:
SELECT user_pseudo_id, MIN(event_date) AS first_session_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE event_name = 'session_start'
GROUP BY user_pseudo_id
LIMIT 100;
Answer:
user_pseudo_id,first_session_date
B71CB5D517BE99FEEED64A0F57842032,20180621
343B740C7B3BD9C2CFA46BF097A8856E,20180613
036860D2869208B2EF11A6A23BD8EC2F,20180907
33A1F72714BF8B0591A135AFC746C038,20180907
0D17D0247F158FA3E40D21EFF46D1651,20180627
5441E1E2D53935E31C632E3FBAAD166B,20180907
25DFBAA3823DDC3B5D4C6F7B59CBF8B4,20180709
8AF6C2B07CBA18947A6C608DC3805B09,20180907
FDDFE28C3B0A73F93F593514F578760A,20180906
031E8A6C7AA76CC5B954EE4229A5CF98,20180907
D78D36FBC1694FDE2718E8E9A7CC99A1,20180626
049A296C5B282AF7100E0BC093589617,20180612
751B06814F2E7EFE53CF17EA6A435B58,20180818
B8C8015FECAD94364B76E74CA9C1A946,20180907
2320A677307F45BB4941696EC7412120,20180907
66739352C8F94F55906F93AD35A7D894,20180904
B784F081E3033006930B7070CB1F7CC5,20180907
FDA4BBBCF1EA2D95CDD77BFC5F00A837,20180625
93C5C5EEACDB9F83DD795449363339E2,20180612
F0192BFEC0959BEE0FB12685539F4131,20180619
7C7DE40DCACC2367C56621C0835BF04E,20180906
84B38C413A7F3C683BCC6CBCCA246FBE,20180907
EEED36297DE224E3E34468ECB0BA7AF5,20180904
0B15684EDDCE9514EFC8DDE9F80C5E7E,20180613
4D3850D024352B02B9C8FC234C823669,20180628
0BF28246916A6D54E16290E925B16593,20180904
599A28B77C37024BD13085EF61A55BDC,20180907
D55D4E5B60368F4BE64F16EFD78B2BE7,20180622
2F74E23BEA1E45E3897274EE4903DCC5,20180613
EA08B4A086F6269ADF5BCB411515361D,20180907
C677D4AC75F093F984D7881B299C8C12,20180628
DB9D0368B6DC1CD2E03CDDBE7060DE31,20180620
C11C29B300E223B1A516BB555C6EA232,20180907
1DA7C7F8359123550CA334AB575E95DA,20180614
B8ABD1FA94CF24CDEF5E10768CD6EF5C,20180620
B525B8771E5D7F146BDEB716A99FFB1C,20180904
7DCD9440F2BF5EB73FFCC4F26E26F580,20180906
0609C988CD429DF8D706827547C9FC2D,20180612
B29E5875DEFE1E68C9F885A278235FE4,20180907
A94FF1DB15116F965C00A2566F604043,20180904
7D3C8EA868F4490FB264FBCD32442711,20180907
0C621E64FC5D74AC60AADCF0EA9D640A,20180612
43179F39C4923E08D3CD9F3CC7D702B2,20180906
21E94A46F6DF2AF6254F916EABA0084A,20180619
7386D239899D55E3D62DA619F359A7C0,20180620
967F40F4C525E024B52809F7115718C0,20180620
E184A4B4ED5FAFEDD19266FB429F3765,20180618
4A47422A455E62E3529DE4F9F3BFAF66,20180613
C88B1D3F6DEC26E03432899B55EE420B,20180618
2E98271C4DE172F7AA1BB10FDEEA3913,20180619
B75F91EB6C7FDA9A329567E763CF9E44,20180618
C64FDEA4F0B0743BCF6CEDB45FEE8AB7,20180620
E0562323C1BAADE462D8D1BD783C75EA,20180620
1739B4C38E25048BC220EB3AD19AA0FB,20180620
10B0D468B5E036E16D13DB53A65F2D49,20180618
7EE035CA8E6132A8877C39656896BA41,20180612
A6C87EE4B7B875BCAB0C650365236072,20180620
Query:
SELECT user_pseudo_id
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708'
LIMIT 100;
Answer:
user_pseudo_id
2F0F260BD7B876C346B41977D0D03D62
83EB6E905B20079A153828894109C0FF
986BCC5319B29A4EA06FDEB7DAFB01D0
9B18A1CBA96D52D05CFA7CB7C9011EDE
0155220BAB309646CC7AC980AB75A212
D1CE26407DE7F231D92F0EFB6FB1B6C6
88E6D3D4433BA2B424A6D5D23A871B97
0D6A346C85BF606BE12F9A70FC20A7B7
046CC8D512A010F60CB1EB26AAE41757
94099563C71C699CCCEDC3EC2178DAD0
B79F414B574CB7F894FE7236A1465837
C3D7BA97E184ABF0A446F35DE12BACF9
8BE7BF90C971453A34C1FF6FF2A0ACAE
78161BB39BB13189ED9A6838A9AE45DE
72E752D33E3C79FDBC5525C86DFD2A75
F92B2FB00F381010F8895FDFB47A8331
A8576CA2812F32F35A850A7C773DA391
FC7CFC0E2E8479602D5245286E9DE088
E0F91AA200D6F12DBE53B0D166AFD87B
D1621FABED8BEBB6913F7C7456ABBDAB
5BDEA4C55EFDF16308475E1ACA152767
F1732713A47A1A140F8B2BB3F232B4E5
A666FD2C8F5F662111C5ECEAF9CA6562
BCEC642620FB741AA4EE43E0FC6C7A05
A934B78A4B0A0D85718D89303D195B2E
D99F522177A35745D80F596989D1111E
F5822275490E7BF0C269CAED489C8053
E8AA0D95D5317A98F1592D34D75A8946
83FB7D43B1E7E7F56B667667163A746A
4C984F59962433E54226AF922DAA894A
ABE28FFF3F8B3F0E1AFAAEEE2FD0105C
D14F72ECEF450A96C642F9C58DEDF723
4295F8BC46B98B453731B1F938B75CAD
BDEEAEF22E7549E96E4763DB95477113
44DE25D7B9A474632A68C3533417A1CD
8320FC247A1967E7C0CDFC1502241310
498863DFCF5947A4D6DD8E82CC1BB322
B4723ACA1A6C65BE5D0970DF4166CCBE
F1B841B645E96249BDFD59DB76865211
B5D8ACA33A57FF52CFC01C59EBD0E9EC
30E7FC7394103E7EFA3F0AFC9F14342C
9E63A50ABB7C292735533D3308161DBD
5C75C4C24A8F46B0E518376A0CB1E6A1
93699FB737D442ABBD95CE58A686442F
AAECE8DA46F021A9CFE489ADF95DA078
657E8EB68545E75A6EAD9B6A11C2E773
676D390F2BEE51F6EC40C81D19C6FBC3
4E2E603C5BFF961B68142AFFC2D5C3F2
74CE0B2D3F78299DAFFB56CA001B7BC5
6FC11768E2D8132D0EBD54B823E26DC4
981CA03B25810447E879E7E767499ABD
8AB276B80B01A635BA7EF9C2071C0231
760224DD438185D3F00938581C387090
D1FDE2A7EAF350A6C080F1EF4D93AAED
CDFD94DA480631BEB80E66BC36103CB7
DEFD9295690E6A9847A9C92A90AC78FB
0EFF72F3A7E2118F0B938C4595B4166D
6FB0DC4B3B77B4945CCC153EB01DE168
BF77633BE8375F4A32984B692B4D8942
B993935197C496DF102FE8D0FE8527E2
CF47EB1BF0FD3A0CF7AB508DBC4DC30F
93C2529FAD40263384413CE9630B308E
A321A68F8050F7262B29FDA89387AEC7
83BD247F986B80A1459E119D2891452E
4D1DFFA5A6570E90D83878ED0021478B
B29745B420435984A30B6601B74648E5
EECDCA8076D5842922767F5C08957B17
2B8C48BCEDF2703CC0AA7262FA09769E
6B19694F160900435F42DD59928CD8C5
3D01D6221D54D40DC42C3D6FBCCEC926
08F14F3BCA030F81B447161BA8653B44
A51128E8CFDD686155CB07E35B410A57
C27D61F5B4239A4FD5AB86D61342FBBF
5177C7AEDDB6CE289372DCFABEC636CE
E2CD12EE286D97AF7174B8AB91391200
33C04C115CDB49A0A23F4CCCA62BDA40
970461AAC9D16D75C936A421BF403515
17C62023A0329A033075B1E4C3372275
83C946045F057E90A71CACBE15BC6C00
00EBE1243410277D1073CC84434B9401
C08AAF1391E0219CA2743DE09E394995
84AFEFA3875BA1F17232CB41D06B6EF4
4109514A07FD2A10C61DA26ED8F826CA
6715B569543C76DB5342D8677A8A0963
C8B06F76EE9091107007C19B08C7834E
A83BC91437FF6DFD5F6958D05FCA0051
D8A3FB65349D7DC9D73D39B1E473782F
07BA1D5FAA047D05359113E20FC8BBB9
EA30BC2CFFCAEB738E1AAE3043849EA6
0E99540ADD6E138A904409597A72DA7E
31847AC271201DA719BCE60A3B0B3EB7
1BCBD81E38843F32FCEB2CB5C8824543
D4C1F412017F567367B7E189BBB46A80
Query:
SELECT COUNT(*) AS total_new_users
FROM (
  SELECT user_pseudo_id, MIN(event_date) AS first_session_date
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_name = 'session_start'
  GROUP BY user_pseudo_id
)
WHERE first_session_date BETWEEN '20180702' AND '20180708';
Answer:
total_new_users
622
Query:
SELECT user_pseudo_id, event_name, event_date
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date > '20180708'  -- Events after Week 0
ORDER BY user_pseudo_id, event_date
LIMIT 100;
Answer:
user_pseudo_id,event_name,event_date
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,level_fail_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,post_score,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,select_content,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_end_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,level_end_quickplay,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,session_start,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,screen_view,20180716
0155220BAB309646CC7AC980AB75A212,select_content,20180716
0155220BAB309646CC7AC980AB75A212,user_engagement,20180716
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,screen_view,20180726
0155220BAB309646CC7AC980AB75A212,user_engagement,20180726
0155220BAB309646CC7AC980AB75A212,session_start,20180726
0155220BAB309646CC7AC980AB75A212,screen_view,20180726
0155220BAB309646CC7AC980AB75A212,select_content,20180726
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,level_start_quickplay,20180726
0155220BAB309646CC7AC980AB75A212,user_engagement,20180726
0155220BAB309646CC7AC980AB75A212,post_score,20180726
0155220BAB309646CC7AC980AB75A212,level_complete_quickplay,20180726
Query:
SELECT COUNT(DISTINCT user_pseudo_id) AS retained_users_week1
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
)
AND event_date BETWEEN '20180709' AND '20180715';
Answer:
retained_users_week1
147
Query:
SELECT
  COUNT(DISTINCT IF(event_date BETWEEN '20180709' AND '20180715', user_pseudo_id, NULL)) AS retained_users_week1,
  COUNT(DISTINCT IF(event_date BETWEEN '20180716' AND '20180722', user_pseudo_id, NULL)) AS retained_users_week2,
  COUNT(DISTINCT IF(event_date BETWEEN '20180723' AND '20180729', user_pseudo_id, NULL)) AS retained_users_week3,
  COUNT(DISTINCT IF(event_date BETWEEN '20180730' AND '20180805', user_pseudo_id, NULL)) AS retained_users_week4
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE user_pseudo_id IN (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
);
Answer:
retained_users_week1,retained_users_week2,retained_users_week3,retained_users_week4
147,110,119,116
End Exploring Related Columns
Task: Please perform a 7-day retention analysis for users who first session start the app during the week starting on July 2, 2018. For each week from Week 0 (the week of their first session) to Week 4, provide the total number of new users in Week 0 and the number of retained users for each subsequent week.

Please answer only one complete SQL in bigquery dialect in ```sql``` format.
Usage example: ```sql
SELECT `column_name` FROM `database.schema.table` WHERE ... ``` (Replace `database`, `schema`, and `table` with actual names. Enclose column names and table identifiers with backticks.)
Follow the answer format like: To perform a 7-day retention analysis for users who first started a session during the week starting on July 2, 2018 (Week 0), we track these new users over the subsequent weeks to see how many return each week. Retention is calculated based on whether these users engage with the app in the following weeks.

Here is the requested data in CSV format:

```csv
Week,Number_of_Users
Week0,Total_New_Users:int
Week1,Retained_Users_Week1:int
Week2,Retained_Users_Week2:int
Week3,Retained_Users_Week3:int
Week4,Retained_Users_Week4:int
```

- **Week0**: Total number of new users who started their first session during the week of July 2, 2018.
- **Week1 to Week4**: Number of these users who returned in each subsequent week.

Please replace the placeholder `int` values with the actual numbers obtained from your analysis..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.If the task description does not specify the number of decimal places, retain all decimals to four places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-30 01:10:25 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:10:25 - root - INFO - ```sql
WITH new_users AS (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
),
retention AS (
  SELECT 'Week0' AS Week, COUNT(*) AS Number_of_Users FROM new_users
  UNION ALL
  SELECT 'Week1' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180709' AND '20180715'
  UNION ALL
  SELECT 'Week2' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180716' AND '20180722'
  UNION ALL
  SELECT 'Week3' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180723' AND '20180729'
  UNION ALL
  SELECT 'Week4' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180730' AND '20180805'
)
SELECT Week, Number_of_Users
FROM retention
ORDER BY Week;
```
2025-01-30 01:10:32 - root - INFO - itercount: 1
2025-01-30 01:10:32 - root - INFO - 0
2025-01-30 01:10:32 - root - INFO - results: 
Week,Number_of_Users
Week0,622
Week1,147
Week2,110
Week3,119
Week4,116


2025-01-30 01:10:32 - root - INFO - Please check the answer again by reviewing Please perform a 7-day retention analysis for users who first session start the app during the week starting on July 2, 2018. For each week from Week 0 (the week of their first session) to Week 4, provide the total number of new users in Week 0 and the number of retained users for each subsequent week., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: To perform a 7-day retention analysis for users who first started a session during the week starting on July 2, 2018 (Week 0), we track these new users over the subsequent weeks to see how many return each week. Retention is calculated based on whether these users engage with the app in the following weeks.

Here is the requested data in CSV format:

```csv
Week,Number_of_Users
Week0,Total_New_Users:int
Week1,Retained_Users_Week1:int
Week2,Retained_Users_Week2:int
Week3,Retained_Users_Week3:int
Week4,Retained_Users_Week4:int
```

- **Week0**: Total number of new users who started their first session during the week of July 2, 2018.
- **Week1 to Week4**: Number of these users who returned in each subsequent week.

Please replace the placeholder `int` values with the actual numbers obtained from your analysis. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
Week,Number_of_Users
Week0,622
Week1,147
Week2,110
Week3,119
Week4,116
Current sql:
WITH new_users AS (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
),
retention AS (
  SELECT 'Week0' AS Week, COUNT(*) AS Number_of_Users FROM new_users
  UNION ALL
  SELECT 'Week1' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180709' AND '20180715'
  UNION ALL
  SELECT 'Week2' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180716' AND '20180722'
  UNION ALL
  SELECT 'Week3' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180723' AND '20180729'
  UNION ALL
  SELECT 'Week4' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180730' AND '20180805'
)
SELECT Week, Number_of_Users
FROM retention
ORDER BY Week;
2025-01-30 01:10:58 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:10:58 - root - INFO - ```sql
WITH new_users AS (
  SELECT user_pseudo_id
  FROM (
    SELECT user_pseudo_id, MIN(event_date) AS first_session_date
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE event_name = 'session_start'
    GROUP BY user_pseudo_id
  )
  WHERE first_session_date BETWEEN '20180702' AND '20180708'
),
retention AS (
  SELECT 'Week0' AS Week, COUNT(*) AS Number_of_Users FROM new_users
  UNION ALL
  SELECT 'Week1' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180709' AND '20180715'
  UNION ALL
  SELECT 'Week2' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180716' AND '20180722'
  UNION ALL
  SELECT 'Week3' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180723' AND '20180729'
  UNION ALL
  SELECT 'Week4' AS Week, COUNT(DISTINCT user_pseudo_id) AS Number_of_Users
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE user_pseudo_id IN (SELECT user_pseudo_id FROM new_users)
    AND event_date BETWEEN '20180730' AND '20180805'
)
SELECT Week, Number_of_Users
FROM retention
ORDER BY Week;
```
2025-01-30 01:11:06 - root - INFO - itercount: 2
2025-01-30 01:11:06 - root - INFO - 0
2025-01-30 01:11:06 - root - INFO - Total iteration counts: 2
