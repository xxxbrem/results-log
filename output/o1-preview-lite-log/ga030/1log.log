2025-01-30 01:15:20 - openai._base_client - INFO - Retrying request to /chat/completions in 0.401214 seconds
2025-01-30 01:15:43 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:15:50 - root - INFO - SQL:
SELECT DISTINCT `user_pseudo_id`
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   LIMIT 100;
Results:
user_pseudo_id
501EC0B173398B023AB5B9A315FFD673
12A0B6E613AC52FAAA4EA602FAB670FE
61814C6B80D24FFDE5FEB59D61FD5B1C
0A4ED932688DC47611C0C894C6E3F350
859BD5756C9635B9A657B90A7265679A
8EA1829661F769B268D3718F3725BCEA
DA48D36D07835B1918BDF831AF83B5EF
D5E3AB32825D0258F168C3AB8853F3B6
E61A380E8D23814F4247CF6D2E11F13A
8558D5249FC196564CFD6ACD4FFA7F0A
6ECC63B6A31C0B1C500C2290FFB4B690
B3C470B60D2527FE10825101C54FB1F7
0B5C241A54583DE93B3EB4B03FF0C5AD
0E10123B79C73F4F30CC49462652D604
3E66A5DD741173F507C7DF9093616FAA
4539608D4915777AC09CF7AD30D86D78
D13AD8E2C50768FF1CAE163EF068EA52
2CCC2C66F8409A59FC7B5E2EE0B07123
6A07718AC1B8C83F70B2105FCA2E01E5
BE89C8EA9D132E6BD866F4B3A8B1E384
62D571096D5393BFB10F2D55DA2FC28C
6DC8E9960F2EAE5C05215ADFC160359C
5C17C05950C71938CFA82EA7C517748B
58E204089E7397B4B3131D7232AA58C5
74EFA3B9E98982CB94246D7F95DF29D0
622D6D8512303C2637073ADD1386B055
486D0900B48B18D315367260129BFFB6
0DC15C12E4170A5B32F94015B74BB0DB
73038968A6AC33439F79449DD2DB1584
52CFA8EDD77C74FAE4D79AD25CF4717C
E75EF199A45513454ECC834C545EAC75
209F61E1408331118A1929019A12FF0D
7392FB7027578690D48268EE642A3895
6CC62DC4D07B240209DC6837340DDF9F
3C70D01246600BA32125AF44750B2014
9F14E63D77F047289C3DDE07EB45055C
622E890EE63F0B83C532CC052BEE8A50
BD74D8BB4FC98995F143107223CB6A67
7436514EF3E15C5DF15939B047CEF45D
A8D0B4A2D4DC51BABB0F38E6B356BC7C
018F03084C88E944163F76A0D0C2FBA1
54827B02505D08E40E29E608008431B4
2876F06859C078320051B7A886306865
14369FEA1EBDEF36045794D5B5E0CF12
9D85589429925C621CFC1E7E25B89C74
2B0B4F617DE87BDD32E2DA9D6364F9B7
EBC3581ADA874D494FBE2C7CCF53BF99
70646770530D6BDEB05AFC16DD2559C2
CA51DAF1373B5C2A16C174AFBD2132A4
28AA4A0542C8873691715C284D13C34B
FCA08F9B0DCB6E33A74F672CE7F73BE3
96D260425F451E90979EA7417C72A09B
DF7B1F6B6AEF483760B6439EF91BC26A
6A2F4E7AB1816D2F6EC741BC92141766
7BCFAF1D468E309D866E9FEA7795FF85
22DC6A6AE86C0AA33EBB8C3164A26925
171871CA6AF9A891FB7B3E19CD144B2E
D4B90F489AEED383CB46669EEEB12E92
43B8EEA09D7D62EC90F40D0E3716E960
3B168DA00A67E36400FE38D1CCB6D8CD
F99CC3598522ABE54B9DCAC2969179CC
F3CA6D208932C0BD365FE0D589038E1C
5B763E8410411FFFEC4ADC5EEE935A84
7C7C8524146AA5006BE260A041101DF3
7AD666ADF83A65F3F883839685FE6E31
C59286E780962666D2A9C13A478542C8
A8DC644112858EF6E52078F7405F88FD
734AC9568F0674F7BBE59D45B5B90EA7
5B888A06EFF60B86B10367EEC3B44E85
47216088A078D06F9220263FAF964F10
2E03DB1924573F3131EEC916E5444F56
7CB9FDA17938289CE3019602888EEC58
E48A64DA907583189751D6FF988D14F6
C0DCE1FC7C20D42EC7F7326A7CC66B39
F27F046DF960AB50CE65B9F4364C981E
D5F25FE843F01514F448B1AA94028D2D
EC895C732092BA9A3CE9F507ED888726
68EA8FDC3D7F8984530BB60FAE9A42FD
05F7B2C58D627CE948B06C10E39CDF91
CA374E053CF35114C98D40A23CAFA777
62440E2EC0A24E9FB2CF09E230FFDEC4
A9F5CC6811A363B671124943547E3631
7842C62D45ECE888132F21C9F4417B21
0597C8E39ECFBDFB2C6289471B52B974
310D44D95961BF9754C9948AF6F437EA
E020680BE3366217F20F02840856AB51
BE13C3B4A34804D4CF30E6D8C417E4B4
5249B4686BC5038FBFE36A3E6CCA5B72
8BC72D1925A8866050D5A6FB01148518
146B1C215275774027FAEF96E5AA3713
8762A39B61912B4FDF4165FD4F2A782A
5800569BC32997BCE5774BA3C675C4E4
5E09265F12D64B9FA85FF9427A0A7FB0

2025-01-30 01:15:55 - root - INFO - SQL:
SELECT DISTINCT `event_name`
   FROM `firebase-public-project.analytics_153293282.events_*`
   LIMIT 100;
Results:
event_name
level_complete_quickplay
session_start
select_content
ad_reward
screen_view
post_score
level_start_quickplay
level_fail
level_retry
app_exception
level_up
no_more_extra_steps
error
level_complete
firebase_campaign
level_reset
challenge_accepted
spend_virtual_currency
first_open
level_end_quickplay
level_reset_quickplay
dynamic_link_app_open
app_update
notification_foreground
level_retry_quickplay
use_extra_steps
app_remove
app_clear_data
dynamic_link_first_open
os_update
in_app_purchase
challenge_a_friend
level_start
level_end
user_engagement
level_fail_quickplay
completed_5_levels

2025-01-30 01:16:02 - root - INFO - SQL:
SELECT `user_pseudo_id`, MIN(`event_date`) AS first_event_date
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `user_pseudo_id`
   LIMIT 100;
Results:
user_pseudo_id,first_event_date
B4E80A7992C6F1E4EF163BAA3A54041A,20180704
0E05F56141200FF41FCC0C7FA297FF08,20180704
7ED4165854463C38F1D739A2014001D9,20180703
D45CF251C60626FDB4BB8D50ABB7BA46,20180704
EB77017C771046704B0582544C3F9328,20180704
757F371D73A59AA7B6FB5CF1E6483B33,20180704
A4FFA7244522F8258DEC9B6E607E222E,20180704
FEDC59699D8832A11B88BFCCCAD0951D,20180702
B42CD43328FFA37DA41BC64C3DC1BB38,20180704
8EDB9A9856CDB5AFC42546106EE46734,20180702
CA04708DA02378999ECB402481FF1AE4,20180702
BBDCBE2491658165B7F20540DE652E3A,20180704
EAFD9AC6BBC95C8755DA42E07A37A2B1,20180704
22FC699EA575027C5A7909E24A7F187D,20180702
4CE503AE5B4C4F67A00474CE380CCC39,20180702
4DA8863CD8D2C860F6BB73579BC6F5C9,20180702
E4D0CD43ECF1890C6D20D2EC09153E02,20180703
F81180A020502492D27DCF8E528DB0D7,20180703
EED353A934B17D0F7C038AF551C14D2C,20180704
9FC8C8D89843323CBE3DCE4961C4EC39,20180704
50E809F1EAA00356B4556CE0A20602E0,20180704
68B5D960072F6FE9F0A5E5E01695F332,20180704
27B1CD26769B068D16FAAF82D4F2C1A8,20180703
223BF1D360715CB9BA85B0DDDE39D589,20180702
301AFECE7DEEE17ACC059F6C18017D80,20180704
3E93326F1DF43AF5F27987897F2BB819,20180704
33E5EA9FE1E29AC3127D975A5494213D,20180702
777D1C5560908C966A6E77B4DD1818CA,20180704
53717D02C147929860D981CD68CE2D9A,20180704
563CCC0B24F6185BEFA72F637F1BB3A0,20180704
36A84ED829638DCEBC057899C0C1BFD4,20180704
518DABD4A0DF4C41A6D811D6D45EB2B6,20180704
756728B497AE5786A9285442E1332AE5,20180704
0668B0D5FABD52C372E70A784F74D0DA,20180704
C7E2273D8B11257FCCC915D27C1FCA24,20180702
E5D16173400729E05DFFB4883FA6EF1C,20180704
05AD5EED131D70296485EA5138F3D6DF,20180704
47A7118B1B7FA4CD0EB591857CB9619F,20180704
B78DB4E683651327A612372A48B5734C,20180702
93A7A5C31807490E878F4164A6418BFC,20180702
F85977DD6D4B89E2164CC02D1DAFDD69,20180704
724B99CB6F41846F3F6BB46C2F663F5E,20180704
B3A9A38A561B3648D280614B8E2D8E07,20180702
8BA7798B298079BD1D9CDA0242AF2B09,20180903
77CBBB121DEF45BCEF21C8EE622E256E,20180724
C795AFA7F574C2BB09D3647AD90A9719,20180702
FF20E4EE129C3700FC1C6CEF188E17BB,20180829
FEEC515D32002A998761352F0E3C1172,20180903
6A8D61827CD1A7E5300673C05DEEDBCC,20180714
C962AE7EF8A83B7013D2610349D7D36E,20180710
ED0AF1301B6404476B420A990B98ABD7,20180903
B7701369F8598A25DED0499DAD3BE85D,20180702
096C23E69254818F7EE03C1239005F2B,20180702
6A9AB23D029870940ACDD4B67A5453EE,20180903
7064BC64E47E869B36967E854748969E,20180903
75F979DE60C91A6631485A88457C108E,20180707
F63CDC909B08737719D6BED3DB344C43,20180903
1F54AC7A413B33C6023DA0AF8F489684,20180807
EF7772819E807EDBD8DB0F0B5210030E,20180801

2025-01-30 01:16:08 - root - INFO - SQL:
SELECT t.`event_name`, f.key, f.value.string_value
   FROM `firebase-public-project.analytics_153293282.events_*` AS t,
     UNNEST(t.event_params) AS f
   WHERE t.`event_name` = 'session_start'
   LIMIT 100;
Results:
event_name,key,string_value
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,main_menu
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board

2025-01-30 01:16:15 - root - INFO - SQL:
SELECT `event_date`, COUNT(*) AS event_count
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `event_date`
   ORDER BY `event_date`
   LIMIT 100;
Results:
event_date,event_count
20180702,50000
20180703,50000
20180704,50000
20180705,50000
20180706,50000
20180707,50000
20180708,50000
20180709,50000
20180710,50000
20180711,50000
20180712,50000
20180713,50000
20180714,50000
20180715,50000
20180716,50000
20180717,50000
20180718,50000
20180719,50000
20180720,50000
20180721,50000
20180722,50000
20180723,50000
20180724,50000
20180725,50000
20180726,50000
20180727,50000
20180728,50000
20180729,50000
20180730,50000
20180731,50000
20180801,50000
20180802,50000
20180803,50000
20180804,50000
20180805,50000
20180806,50000
20180807,50000
20180808,50000
20180809,50000
20180810,50000
20180811,50000
20180812,50000
20180813,50000
20180814,50000
20180815,50000
20180816,50000
20180817,50000
20180818,50000
20180819,50000
20180820,50000
20180821,50000
20180822,50000
20180823,50000
20180824,50000
20180825,50000
20180826,50000
20180827,50000
20180828,50000
20180829,50000
20180830,50000
20180831,50000
20180901,50000
20180902,50000
20180903,50000
20180904,50000
20180905,50000
20180906,50000
20180907,50000
20180908,50000
20180909,50000
20180910,50000
20180911,50000
20180912,50000
20180913,50000
20180914,50000
20180915,50000
20180916,50000
20180917,50000
20180918,50000
20180919,50000
20180920,50000
20180921,50000
20180922,50000
20180923,50000
20180924,50000
20180925,50000
20180926,50000
20180927,50000
20180928,50000
20180929,50000
20180930,50000
20181001,50000
20181002,50000
20181003,50000

2025-01-30 01:16:35 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:16:35 - root - INFO - **Explanation:**

The error occurs because when you divide `event_timestamp` (which is an `INT64` representing microseconds) by `1000000`, the result is a `FLOAT64`. BigQuery does not allow casting a `FLOAT64` directly to a `TIMESTAMP`. Instead, you should use the appropriate function to convert microseconds to a timestamp.

To fix the error, use the `TIMESTAMP_MICROS()` function, which converts microseconds since the Unix epoch to a `TIMESTAMP`.

Here's the corrected SQL query:

```sql
SELECT `user_pseudo_id`, MIN(TIMESTAMP_MICROS(`event_timestamp`)) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start'
GROUP BY `user_pseudo_id`
LIMIT 100;
```

This query will successfully compute the minimum (first) session timestamp for each user without casting errors.

---

**Additional Guidance:**

Since you're working towards grouping users by the week of their first session start, you might need to extract the week start date (Monday) for each user's first session. Here's how you can do that:

```sql
SELECT 
  `user_pseudo_id`, 
  DATE_TRUNC(DATE(TIMESTAMP_MICROS(MIN(`event_timestamp`))), WEEK(MONDAY)) AS first_session_week_start
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start' AND `event_date` >= '20180702'
GROUP BY `user_pseudo_id`
LIMIT 100;
```

This query calculates the first session week start date (Monday) for each user, which will be useful for grouping users into cohorts based on their first session week.

---

Let me know if you need further assistance in calculating the retention rates or writing queries to identify the cohort with the highest fourth-week retention rate.
2025-01-30 01:17:16 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:17:16 - root - INFO - SQL:
SELECT `user_pseudo_id`, MIN(TIMESTAMP_MICROS(`event_timestamp`)) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start'
GROUP BY `user_pseudo_id`
LIMIT 100;
Results:
user_pseudo_id,first_session_timestamp
23A7E8D987ADCC38EB026096DC513F85,2018-06-18 07:26:10.107000+00:00
11FC272840E1ED3923F92C521AC68F1E,2018-09-05 12:26:58.498000+00:00
0ED6BC1D319AB5BD1F245628EA47EDBB,2018-07-31 10:33:13.809000+00:00
7A8D1CAA45CDE7652260DA6E71068A13,2018-07-23 05:23:46.983000+00:00
F3A2F44C99758CC6006BFE28AC78EBFE,2018-08-09 02:06:38.579000+00:00
20D316579BC2D1122CABFC41F704DACA,2018-09-13 21:16:48.569000+00:00
A5A56F3717C923CECBB9247595F6CA5F,2018-06-25 13:10:33.402000+00:00
44962B1EB7295E6C001F7F75CFA52D3C,2018-06-14 20:19:28.864000+00:00
65F8E2B80A986C0FDF372EF08A031483,2018-09-14 03:00:55.603000+00:00
D9E0B99D114ACD55A2349149F3BC96F7,2018-09-09 06:35:54.508000+00:00
EB1A430BACB37E6EA72592BF838E64A6,2018-06-18 13:10:58.668000+00:00
2E7493AC5967A8B48B8DEF79EDDFC056,2018-09-14 06:11:09.270000+00:00
AC14AD9D158A2A5449E120A33D5B55BB,2018-09-13 19:33:14.554000+00:00
A135A27E4373605B2EB6E48DCA05720A,2018-09-04 09:09:14.853000+00:00
ADD82F1153554D07815E0ACFBD68A23F,2018-09-05 05:34:38.922000+00:00
5BF7AFF8FACA9401CB5E0D7354479441,2018-09-12 03:45:31.868000+00:00
B9D8806148044938C86FA637A13431AA,2018-06-26 12:39:21.868000+00:00
42FE551121362B71E141D291CC7AA4E9,2018-09-13 12:02:05.749000+00:00
27EBD3EEECD253B2A30B2255280DD32D,2018-06-27 06:00:26.991000+00:00
857415053FD447A7EDDACD7FB72A8E9E,2018-09-08 14:11:49.609000+00:00
289F2AE59FE48FFF6DD12D0AB553C14E,2018-06-21 23:01:20.163000+00:00
0D05EABFC1DA51098487F5C027AB9EAB,2018-06-26 08:43:41.735000+00:00
A645F59DABBD8ED670286DCF716EBF47,2018-09-10 13:05:15.333000+00:00
7EB85F9A592C4051DC747C34349FC14D,2018-09-13 11:01:05.028000+00:00
4CC7B06FC12175C31ECBE1987A48DEA3,2018-06-25 15:50:12.652000+00:00
749D1C8A698B9549D1E4CEAD631A4610,2018-09-02 11:51:03.170000+00:00
10092C958CD92FE2E65A2610D613CC27,2018-09-13 20:22:35.307000+00:00
18688C841952131D9A6A01B81C8F65F3,2018-08-28 16:32:55.656000+00:00
1CE03BB4BFFE9960A4E94D81D89355BC,2018-06-16 08:25:25.063000+00:00
FF5D70EFCA9F6F557CF9167A85E44297,2018-09-13 18:04:52.717000+00:00
A6CC977A53243EE9A419FB3CDA0561EF,2018-09-13 10:14:11.755000+00:00

2025-01-30 01:17:22 - root - INFO - SQL:
SELECT DISTINCT e.`user_pseudo_id`
FROM `firebase-public-project.analytics_153293282.events_*` AS e
JOIN (
  SELECT
    `user_pseudo_id`,
    TIMESTAMP_ADD(TIMESTAMP_MICROS(MIN(`event_timestamp`)), INTERVAL 21 DAY) AS start_fourth_week,
    TIMESTAMP_ADD(TIMESTAMP_MICROS(MIN(`event_timestamp`)), INTERVAL 28 DAY) AS end_fourth_week
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE `event_name` = 'session_start'
  GROUP BY `user_pseudo_id`
) AS first_sessions
ON e.`user_pseudo_id` = first_sessions.`user_pseudo_id`
WHERE TIMESTAMP_MICROS(e.`event_timestamp`) BETWEEN first_sessions.start_fourth_week AND first_sessions.end_fourth_week
LIMIT 100
Results:
user_pseudo_id
B99FD965B0874192EE94E8A8FE85EA9E
7439CA3E049F434742CB5C63A55FC24D
BAF65BC3AA02395D12D8A6ABF85B8007
38328F5729077611D47495753D2C04D1
51B130949FD7983F1CF48C592B84ED1F
1E6348F7A97962E7EAA87C7FF638569F
1F91CA88C5E106304CDBD9C769FEC3E4
C96C96A3BFA142C6B393183BDB2B9DDB
0ADCAB98C7686603278BCDD71FE16CC8
859BD5756C9635B9A657B90A7265679A
886E4151EA714AA75E544D2938C1073D
73038968A6AC33439F79449DD2DB1584
686E8E8F73A49595EDE40F1BBDFB8C99
5D7B75012F4A81127A627CF594A8ABF8
3828BE5E2F158C7E5831478F63DAE9E4
5539C6BBAD980C27D8B18AE27CDD8341
ED90CC7C8BC768DBF3B8B87A75422721
E98AFA6BD0908A7BDF0FE75396B204DD
518CDCF91C158C552E1F183710D02AE7
1A34269052225805BDB10AE343A6DD29
52CFA8EDD77C74FAE4D79AD25CF4717C
A51BF75239709A5494645BEAABC3453D
5ACF1A6BFE350F7BB661BF389AF7E2F0
E1A3C786B2E4D56629EE808A3A174995
E0664E9E7883956A6E3084FD68AA274B
7E40E634997585B0C69B6F67C01C191B
004D2DFEB866BFB00427DB2F530C1F3D
28C4A09298C441D5AFD39E749D9F3DA3
0046A2D1B1135C0AB4462B8FF036739E
AB714CB216CB456740B54DD82E11FDB9
579700B60FE8D8C382D5421FBBF7535D
19DEEA6B15B314DB0ED2A4936959D8F9
F3C51AAD312E2312B693648105EB76F5
098868D9626624131122714C36A5D069
DEBFB520A77B520CA36FD8C9C9A269AD
5E3CBF1204F069C8F4474D492A361CCD
0217CFB14E415205AE6B110F64C9B713
F79A71D6D132595932E445E1F42CE65D
7FD3ECDE609533E2BC60B7733DB6CFCB
080DB8B23066DE56D78C5F570FF5A019
0AF862AFEB5358EBFDA7AFE3AC908844
89BD2B0E233951461CF06C9B4FDA0D81
55F9FB7C14AA4BAB066EA326D4A2221B
39CA0ABD1D955D12B7441AE21F4877D8
7ED8C235689771F6B0F29BBF295A346F
66E8EE325A3E6369E607998DFE9E13F1
DCF02493CA8559E632F3E2FB070DBEF0
1406751556EEDB1D112BF86CACAE9C88
8ACCEA29DD561542D9AE209167BC9943
C1327B694B124442335CFFD6FD3B15EC
4F34EA13CE343BE6955B67914BD4DF9E
BE36C49B1AB3968D420923AEC4FDD7AE
E5AFF3DE508996512D61B49A63D1D063
D5F9D9AF22EF5073E10342973D48FB2C
42E6A7C3536775E3B8C3DB919AE9A452
3875A92B5F5C2BBA1355CED06A986079
0CAAA1B6F161BA4D363EB7A2DEF64A08
A19F659EA9BA36A3595F088F30A6B7E7
19EA272CEA5C14D4E55F2AF25CB30950
71CD1253D6BB1366E146BEC63E305CB3
FC55032FC8C06EB1A1220D1ABD1164C9
7F2B633C86B765201C93FDB6FF261143
05F0FB18A61CCB1E2540F4D26721CCEC
8F030F26EB2BE0DF3C21FB0F13E6076F
8F4B58FA6F11840EF836F91A73A6CFD0
D9AA0EC27AF47514DDB5C664A6EF758A
5269565AB96D3D27ADEA4D7EF4DC2A88
AD99B4950F9D70E0FD5E8563F2A664FB
E93192CD2EC3D159E9A5B105E479E78D
6CA06212A2113C29F5E1B3C01536E38E
885852C000C31A983D41BBFB86D71AED
EA00BFE6FBAF082D6EA23AA9606D96BC
CAE8683FCC2445DDABFB1FF2516E0B5D
B529E84EE03C578C7E92CE5836AB1C1D
E069FDF17198500FCB6DDDF406ABA122
E415D4A90F9A9D8B784B3BCE2F5678B5
3E93326F1DF43AF5F27987897F2BB819
5885B9A6C2FBB71AB1304B9EDB330B76
9BC94B3773C8304A9E101AEBCFEF4A5F
16AAF7C1D78ED1950DE82A6802318C9A
C679FF00E17790E7E16AB903212EE05C
D21451ACF492761DBC86B3549AEA194A
AD6D349E4DF47BB97D06CA8BB65EBB66
0A9D7004114F34B9CD49538E173E01A7
67ABE7FC39408AE456040BFA4EFC5EFA
0DF6A14F536F6514A6F18BC12A532A82
95BF77235739808B7BC07A7F0563CC9A
D8995B39CDB121EC37EC90025DB53B6D
8C7A0CAF2B29D568268B8D331E37ABF6
0B427C5E490A982FADF586F82E797ACB
C1A0D9FB3527654CA715A732B5FB5202
01749360DADD769CDFB6D1E5DCBB2BD9
19AB27B8A0F2C7C738683CA2F5FFEBE1

2025-01-30 01:17:27 - root - INFO - SQL:
SELECT t.`user_pseudo_id`, f.key, f.value.string_value
FROM `firebase-public-project.analytics_153293282.events_*` AS t,
  UNNEST(t.user_properties) AS f
LIMIT 100
Results:
user_pseudo_id,key,string_value
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3

2025-01-30 01:17:33 - root - INFO - SQL:
SELECT `user_pseudo_id`, COUNTIF(`event_name` = 'session_start') AS session_count
FROM `firebase-public-project.analytics_153293282.events_*`
GROUP BY `user_pseudo_id`
LIMIT 100
Results:
user_pseudo_id,session_count
FFD44153572065E379B7E96916F730B8,13
B19501509EADDDB42342340A93E2BAAB,5
570495249052C5E40EC34A2B054DA1A1,9
7842C62D45ECE888132F21C9F4417B21,42
B8B20A9B77B516AC51BD7C96E3F1866C,7
CCE4BDDE62CA393AC9563B8718F5CFB9,17
9271152D92DEE0D6C59BAA65F92CED5D,3
A6A77DA8F2C4102A83EED1D5216EB318,22
25008881407A8ADFDA4815AB5397810B,4
5CC5F51FFBA6289E36363D9C2F835B0C,8
8A1C79A7DD82197D40A2F4845010CF67,5
0EFA419FF8D1FB5BAA12E4794D511937,1
60399FD820E8529CA63D0C69C8B4AD45,1
8B7110AC0A6E048628AB4BCC751E0A09,1
03C8FFC95DEC2C1E87EB4646970FC12E,0
1EFB7DDCF75186BFDD85D88E84681B55,2
5B888A06EFF60B86B10367EEC3B44E85,63
018F03084C88E944163F76A0D0C2FBA1,114
6A71951BC1C5F03C22E9E892AEB90B19,6
8AFB3221668B5EF2E9A246387A266772,0
0A74C26349ABD323C5CE34AB8DD52164,3
2684EA4DDB1F988E3C979AB15CFF601F,19
7410C5CC4FA11D31DB5F9B1D8ECD6BD0,34
DA48D36D07835B1918BDF831AF83B5EF,283
4E0D2F7E40746B90029E4F4241F9ECA9,6
92C9E3FA3B35FC5A5ED1B36CF4D114B9,14
CA51DAF1373B5C2A16C174AFBD2132A4,89
382B7E4C3513E0B32AD100ABCC15B917,0
C52D9633B63526E066BFD3E9BCF762A3,0
5E09265F12D64B9FA85FF9427A0A7FB0,138
6EBDDD1BC5E5489D7FF0B41B8DAA9D86,11
751F1516AC974AC343F62070D3BA39F5,67
325CCD0662FC4EA9853B7D3E3B6693A5,7
CB2A03B9DC1894380C75344D15BC0BE6,15
5B763E8410411FFFEC4ADC5EEE935A84,35
D13AD8E2C50768FF1CAE163EF068EA52,9
97746CE0DF1E7BBB0EEB43509FEE15D3,8
4BF98D09CA8359FC59ADAF56D00338F8,59
3A6E4010B115AA8EB99461DA8E9A7275,6
5631892AB2E836FD3A72540D3C316C51,2
7841ADFC1D9068C1476F07B9CFA40F68,2
6DC8E9960F2EAE5C05215ADFC160359C,27
8BE102266AF2AEC727AE08D0A5241DE0,4
D5A6C5F4F8B3D73D0FADFCEE09B520DC,8
BBD99D8850F41DD900934E8A5859CEFA,2
B141B75E5E5D48DAD8298F91B94A2E07,33
7392FB7027578690D48268EE642A3895,30
1BDCB994173E8A509680B6351EE6A3AE,1
622E890EE63F0B83C532CC052BEE8A50,19
14EC3B93608EFEEC1FA22D31EB995403,6
3686DE7B4C85F5F0AF385348F03492C9,7
37DC3F34CD3CF0D57CD6A753364BEC30,0
ABAACFAF0D1D72E4EB8B4C2B4268AC83,1
CCE60CE7DBE296A7828A028094E21D51,7
5D8DA83FF9997DB4B4CE4518B0550DDD,0
062EFDCE1B385D06E7F44D063AF58A83,10
ADD0757874A418957AAA60903AA5F62D,3
ABF803076F199C505F76E3B1CD0FB4ED,9
0C873D77670D1231E2C1DB2F833679D0,7
386EE7D00E029293C53C2ED7319EF520,12
F506E5B5D610285BF94A2A917A1858D4,9
201E3B0D000A2177487384189D647E14,0
A62611DA6D4B45AC3DB2450BF3A24C23,9
44759496F6F519B1A4BEF55BE55C631C,54
97EFE88578CA49C1B43A95A781C7AD16,3
31F8F98A5B838C7375267F10DADBDA24,33
859BD5756C9635B9A657B90A7265679A,47
44386D9242DC9705DAFE219EC2C114F5,49

2025-01-30 01:17:55 - root - INFO - SQL:
SELECT `user_pseudo_id`, DATE_TRUNC(DATE(PARSE_DATE('%Y%m%d', `event_date`)), WEEK(MONDAY)) AS week_start
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start' AND `event_date` >= '20180702'
GROUP BY `user_pseudo_id`, week_start
LIMIT 100
Results:
user_pseudo_id,week_start
D0E006B5E441969283C94713E308A11D,2018-08-20
B2D359D114428D8DD085DFAFF11195CE,2018-08-20
2C6786FA363E378426FBEAE3D9AC1B2F,2018-08-20
F3917138A3D4B03ADA1C2E77E3B84649,2018-08-20
B3EFE616640788FE5B1D9776C9972238,2018-08-20
D5F9D9AF22EF5073E10342973D48FB2C,2018-08-20
31E8B3EB3D9167E813FDFB812898F2F6,2018-08-20
42E6A7C3536775E3B8C3DB919AE9A452,2018-08-20
CA04708DA02378999ECB402481FF1AE4,2018-08-20
E4196C5E0A92A22F69DE4E3AA288D6EE,2018-08-20
F34FF1C9F0C022B684BC885BA1DDC260,2018-08-20
533E79DF88C5D3B27AB10A32F8185503,2018-08-20
77619E28EEE4A7F622E5CAE5847B5B0E,2018-08-20
13C310CA6E62FD1EB15BB8610D0CAE89,2018-08-20
F183D1950EDA9E115C8C05A84E42EA62,2018-08-20
DB96F991CEBF843652230B0F802424FA,2018-08-20
7EE035CA8E6132A8877C39656896BA41,2018-08-20
5110D174E1BB8A7B1D364A9061FFA15B,2018-08-20
1181F8E1F7926B07A503427D76E34082,2018-08-20
A19F659EA9BA36A3595F088F30A6B7E7,2018-08-20
841A68D5D1F94857BEB64225193B2432,2018-08-20
DE3F49561A3E21ED2C9CC518F564961E,2018-08-20
373016F8F89C087DC8C89E06B362AD1A,2018-08-20
0B54075D3F149377C6D802237E9BC290,2018-08-20
D031112AF5E886F8CB7B5D88C2A6EB2A,2018-08-20
8572B4BE029A37D6D73C28E42805A49F,2018-08-20
091F09F594F7507A1D6D34D006A49CD9,2018-08-20
5E8B4AEF7E3373AA78408DB08E72E3B8,2018-08-20
82F141D1C5A86CB8F5F4DFC7E09E5513,2018-08-20
F5CA9C70FB5ACA0C36279A6FB407A7B7,2018-08-20
E0664E9E7883956A6E3084FD68AA274B,2018-08-20
12E5626928FE0885DEEF068683E8BD63,2018-08-20
56E8EC9522573BD1BAD8E18AD2E33C9A,2018-08-20
86C279CEE90D97565DD82D2A92A9F421,2018-08-20
EBE661044C1949546986A852F35083A1,2018-08-20
DDB627A00E4213B6A69F35DB89681AF8,2018-08-20
7A1371C7EAD50DB944A44ADC0351CB7B,2018-07-02
E9B5EC78F1F4D6F90B5AFB34D09697F2,2018-07-02
5256B2B115955E80DDB7449775D92325,2018-07-02
1CF315BC6864E7A71A81E47925E18A61,2018-07-02
A95BA9143018CA81430258E8A725C3E6,2018-07-02
89BD2B0E233951461CF06C9B4FDA0D81,2018-07-02
D9FEC4E4418413FCE771B203FD7D48D2,2018-07-02
3875A92B5F5C2BBA1355CED06A986079,2018-07-02
159002C6F393752AD79B3C2E8C7104C7,2018-07-02
F2ACDC8D64D4218BA63EB8732C110BA5,2018-07-02
E4C074EBC3729FB45CFA48D9F6EA4DFD,2018-07-02
DB3B6E984B29883EA02F1A504A33730F,2018-07-02
E4C6FF8288DD4BFCDE93E2218E20643B,2018-07-02
885852C000C31A983D41BBFB86D71AED,2018-07-02
84E491A60BE52A4C6A438A89FADE283C,2018-07-02
1DF3029854CC8787F3EC5A2A9B21334C,2018-07-02
FF955E4CA27C75CE0BEE9FC89AD275A3,2018-07-02

2025-01-30 01:17:55 - root - INFO - itercount: 0
2025-01-30 01:17:55 - root - INFO - Database Name: firebase-public-project
Schema Name: analytics_153293282
DDL describes table information.
,0
table_name,events_20180801
ddl,"CREATE TABLE `firebase-public-project.analytics_153293282.events_20180801`
(
  event_date STRING,
  event_timestamp INT64,
  event_name STRING,
  event_params ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64>>>,
  event_previous_timestamp INT64,
  event_value_in_usd FLOAT64,
  event_bundle_sequence_id INT64,
  event_server_timestamp_offset INT64,
  user_id STRING,
  user_pseudo_id STRING,
  user_properties ARRAY<STRUCT<key STRING, value STRUCT<string_value STRING, int_value INT64, float_value FLOAT64, double_value FLOAT64, set_timestamp_micros INT64>>>,
  user_first_touch_timestamp INT64,
  user_ltv STRUCT<revenue FLOAT64, currency STRING>,
  device STRUCT<category STRING, mobile_brand_name STRING, mobile_model_name STRING, mobile_marketing_name STRING, mobile_os_hardware_model STRING, operating_system STRING, operating_system_version STRING, vendor_id STRING, advertising_id STRING, language STRING, is_limited_ad_tracking STRING, time_zone_offset_seconds INT64>,
  geo STRUCT<continent STRING, country STRING, region STRING, city STRING>,
  app_info STRUCT<id STRING, version STRING, install_store STRING, firebase_app_id STRING, install_source STRING>,
  traffic_source STRUCT<name STRING, medium STRING, source STRING>,
  stream_id STRING,
  platform STRING
);"

Some other tables have the similar structure: ['events_20180801', 'events_20180621', 'events_20180616', 'events_20180912', 'events_20180814', 'events_20180716', 'events_20181003', 'events_20180620', 'events_20180624', 'events_20180918', 'events_20180612', 'events_20180911', 'events_20180724', 'events_20180807', 'events_20180710', 'events_20180808', 'events_20180702', 'events_20180719', 'events_20180914', 'events_20180913', 'events_20180915', 'events_20180728', 'events_20180817', 'events_20180628', 'events_20180906', 'events_20180704', 'events_20180711', 'events_20180720', 'events_20180706', 'events_20180926', 'events_20180924', 'events_20180731', 'events_20180804', 'events_20180920', 'events_20180715', 'events_20180709', 'events_20180928', 'events_20180904', 'events_20180903', 'events_20180818', 'events_20180820', 'events_20180707', 'events_20180930', 'events_20180821', 'events_20180812', 'events_20180830', 'events_20180908', 'events_20180708', 'events_20180910', 'events_20180922', 'events_20180713', 'events_20180618', 'events_20180811', 'events_20181001', 'events_20180626', 'events_20180828', 'events_20180717', 'events_20180806', 'events_20180721', 'events_20180725', 'events_20180824', 'events_20180923', 'events_20180627', 'events_20180726', 'events_20180729', 'events_20180929', 'events_20180925', 'events_20180722', 'events_20180630', 'events_20180730', 'events_20180831', 'events_20180701', 'events_20180619', 'events_20180810', 'events_20180822', 'events_20180921', 'events_20180819', 'events_20180927', 'events_20180905', 'events_20180816', 'events_20180622', 'events_20180802', 'events_20180826', 'events_20180714', 'events_20180901', 'events_20180916', 'events_20180809', 'events_20181002', 'events_20180703', 'events_20180617', 'events_20180902', 'events_20180625', 'events_20180827', 'events_20180805', 'events_20180825', 'events_20180919', 'events_20180917', 'events_20180705', 'events_20180613', 'events_20180907', 'events_20180909', 'events_20180727', 'events_20180813', 'events_20180614', 'events_20180623', 'events_20180829', 'events_20180615', 'events_20180712', 'events_20180718', 'events_20180815', 'events_20180629', 'events_20180803', 'events_20180823', 'events_20180723']
External knowledge that might be helpful: 
How to Calculate User Retention in Big Query from Google Demo Game Analytics Data

As a Product / Website Analyst, I was pretty psyched to discover Google’s public Google Analytics 4 (GA4) gaming event dataset called `firebase-public-project.analytics_153293282.events_*`. The table allows experienced developers and learners alike to experiment with raw GA4 data in Big Query for free. Event data is basically a log of user interactions with your product for analysis .For newbies interested in learning more about event data and GA4, visit my prior blog. This article provides SQL queries for a quick table overview and explains how to utilize Google Big Query to calculate user retention.


What is Retention?
User retention rates are key indicators for whether your product team meets user needs. Improving retention is often central to long term growth strategies.

**Retention measure’s how often and for how long users tend to return to your product.**

The metric can be a powerful proxy for product usefulness and user opinion. Its analysis can reveal critical information like how well your site converts new visitors to users and which items and features are associated with users coming back. If user data is available, retention can also help a business understand the profiles of its most active users (power users). Finally, retention is a great guardrail metric for A/B tests. Successful, product oriented companies prioritize a healthy user bases over short term profits.


**Common Retention Calculation Strategies**

Two common strategies to calculate retention are: 

a) N-Day retention

b) Unbounded Retention.


a) For N-Day retention, analysts calculate how many users with certain characteristics return over successive periods. It is called N days because we define the length of each period. For example, with N=7 day retention, if User A becomes part of our cohort of interest on day 0 and returns to the product day 5 and day 15, they are counted as retained for week 1 (1–7 days) and week 3 (15–21 days) but not week 2 (8–14 days).


b) For Unbounded Retention, a user is counted as retained each week so long as their most recent product contact was after the week. For example, if User A becomes part of the cohort on day 0 and last returned to the site on day 21, they will be counted as retained in week 1 (1–7 days), week 2 (8–14 days), and week 3 (15–21 days) but not week 4 (22–28 days).

By calculating these metrics, companies can evaluate how well their products hold users’ interests. It also them closer to identifying the patterns that generate return users.



The table structure information is ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}
Begin Exploring Related Columns
**Relevant Columns and Potential Usage:**

- `user_pseudo_id`: Unique identifier for users; used to group and track users across sessions.
- `event_name`: Name of the event; used to identify session start events.
- `event_timestamp`: Timestamp of the event (in microseconds); used to determine when events occurred.
- `event_date`: Date of the event (as STRING in 'YYYYMMDD' format); used for filtering and grouping by date.
- `event_params`: Array of key-value pairs; may contain additional details like session ID or other parameters.
- `user_properties`: Array of key-value pairs; may contain user attributes.

**Conditions that May Be Used:**

- Filter events starting from '2018-07-02'.
- Identify session start events (e.g., where `event_name` is 'session_start').
- Group users by the week (Monday to Sunday) of their first session.
- Calculate dates for the fourth week after the first session.
- Determine if users returned in the fourth week.

**Sample BigQuery SQL Queries:**

1. **Get Distinct Users Starting from July 2, 2018**

   ```sql
   SELECT DISTINCT `user_pseudo_id`
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   LIMIT 100;
   ```

2. **List Event Names to Identify Session Start Events**

   ```sql
   SELECT DISTINCT `event_name`
   FROM `firebase-public-project.analytics_153293282.events_*`
   LIMIT 100;
   ```

3. **Get First Event Date for Each User Starting from July 2, 2018**

   ```sql
   SELECT `user_pseudo_id`, MIN(`event_date`) AS first_event_date
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `user_pseudo_id`
   LIMIT 100;
   ```

4. **View Event Parameters for Session Start Events**

   ```sql
   SELECT t.`event_name`, f.key, f.value.string_value
   FROM `firebase-public-project.analytics_153293282.events_*` AS t,
     UNNEST(t.event_params) AS f
   WHERE t.`event_name` = 'session_start'
   LIMIT 100;
   ```

5. **Count Events per Day Starting from July 2, 2018**

   ```sql
   SELECT `event_date`, COUNT(*) AS event_count
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `event_date`
   ORDER BY `event_date`
   LIMIT 100;
   ```

6. **Get Users with Their First Session Date**

   ```sql
   SELECT `user_pseudo_id`, MIN(CAST(`event_timestamp`/1000000 AS TIMESTAMP)) AS first_session_timestamp
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_name` = 'session_start'
   GROUP BY `user_pseudo_id`
   LIMIT 100;
   ```

7. **Filter Users Who Had Events in the Fourth Week After First Session**

   ```sql
   SELECT DISTINCT e.`user_pseudo_id`
   FROM `firebase-public-project.analytics_153293282.events_*` AS e
   JOIN (
     SELECT `user_pseudo_id`, TIMESTAMP_ADD(MIN(CAST(`event_timestamp`/1000000 AS TIMESTAMP)), INTERVAL 21 DAY) AS start_fourth_week,
            TIMESTAMP_ADD(MIN(CAST(`event_timestamp`/1000000 AS TIMESTAMP)), INTERVAL 28 DAY) AS end_fourth_week
     FROM `firebase-public-project.analytics_153293282.events_*`
     WHERE `event_name` = 'session_start'
     GROUP BY `user_pseudo_id`
   ) AS first_sessions
   ON e.`user_pseudo_id` = first_sessions.`user_pseudo_id`
   WHERE TIMESTAMP_MICROS(e.`event_timestamp`) BETWEEN first_sessions.start_fourth_week AND first_sessions.end_fourth_week
   LIMIT 100;
   ```

8. **List User Properties for Analysis**

   ```sql
   SELECT t.`user_pseudo_id`, f.key, f.value.string_value
   FROM `firebase-public-project.analytics_153293282.events_*` AS t,
     UNNEST(t.user_properties) AS f
   LIMIT 100;
   ```

9. **Get Number of Sessions per User**

   ```sql
   SELECT `user_pseudo_id`, COUNTIF(`event_name` = 'session_start') AS session_count
   FROM `firebase-public-project.analytics_153293282.events_*`
   GROUP BY `user_pseudo_id`
   LIMIT 100;
   ```

10. **Find the Week Start Date of Users' First Session**

    ```sql
    SELECT `user_pseudo_id`, DATE_TRUNC(DATE(PARSE_DATE('%Y%m%d', `event_date`)), WEEK(MONDAY)) AS week_start
    FROM `firebase-public-project.analytics_153293282.events_*`
    WHERE `event_name` = 'session_start' AND `event_date` >= '20180702'
    GROUP BY `user_pseudo_id`, week_start
    LIMIT 100;
    ```

These queries help in understanding the data structure and retrieving essential information needed to compute the retention rates per cohort.Query:
SELECT DISTINCT `user_pseudo_id`
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   LIMIT 100;
Answer:
user_pseudo_id
501EC0B173398B023AB5B9A315FFD673
12A0B6E613AC52FAAA4EA602FAB670FE
61814C6B80D24FFDE5FEB59D61FD5B1C
0A4ED932688DC47611C0C894C6E3F350
859BD5756C9635B9A657B90A7265679A
8EA1829661F769B268D3718F3725BCEA
DA48D36D07835B1918BDF831AF83B5EF
D5E3AB32825D0258F168C3AB8853F3B6
E61A380E8D23814F4247CF6D2E11F13A
8558D5249FC196564CFD6ACD4FFA7F0A
6ECC63B6A31C0B1C500C2290FFB4B690
B3C470B60D2527FE10825101C54FB1F7
0B5C241A54583DE93B3EB4B03FF0C5AD
0E10123B79C73F4F30CC49462652D604
3E66A5DD741173F507C7DF9093616FAA
4539608D4915777AC09CF7AD30D86D78
D13AD8E2C50768FF1CAE163EF068EA52
2CCC2C66F8409A59FC7B5E2EE0B07123
6A07718AC1B8C83F70B2105FCA2E01E5
BE89C8EA9D132E6BD866F4B3A8B1E384
62D571096D5393BFB10F2D55DA2FC28C
6DC8E9960F2EAE5C05215ADFC160359C
5C17C05950C71938CFA82EA7C517748B
58E204089E7397B4B3131D7232AA58C5
74EFA3B9E98982CB94246D7F95DF29D0
622D6D8512303C2637073ADD1386B055
486D0900B48B18D315367260129BFFB6
0DC15C12E4170A5B32F94015B74BB0DB
73038968A6AC33439F79449DD2DB1584
52CFA8EDD77C74FAE4D79AD25CF4717C
E75EF199A45513454ECC834C545EAC75
209F61E1408331118A1929019A12FF0D
7392FB7027578690D48268EE642A3895
6CC62DC4D07B240209DC6837340DDF9F
3C70D01246600BA32125AF44750B2014
9F14E63D77F047289C3DDE07EB45055C
622E890EE63F0B83C532CC052BEE8A50
BD74D8BB4FC98995F143107223CB6A67
7436514EF3E15C5DF15939B047CEF45D
A8D0B4A2D4DC51BABB0F38E6B356BC7C
018F03084C88E944163F76A0D0C2FBA1
54827B02505D08E40E29E608008431B4
2876F06859C078320051B7A886306865
14369FEA1EBDEF36045794D5B5E0CF12
9D85589429925C621CFC1E7E25B89C74
2B0B4F617DE87BDD32E2DA9D6364F9B7
EBC3581ADA874D494FBE2C7CCF53BF99
70646770530D6BDEB05AFC16DD2559C2
CA51DAF1373B5C2A16C174AFBD2132A4
28AA4A0542C8873691715C284D13C34B
FCA08F9B0DCB6E33A74F672CE7F73BE3
96D260425F451E90979EA7417C72A09B
DF7B1F6B6AEF483760B6439EF91BC26A
6A2F4E7AB1816D2F6EC741BC92141766
7BCFAF1D468E309D866E9FEA7795FF85
22DC6A6AE86C0AA33EBB8C3164A26925
171871CA6AF9A891FB7B3E19CD144B2E
D4B90F489AEED383CB46669EEEB12E92
43B8EEA09D7D62EC90F40D0E3716E960
3B168DA00A67E36400FE38D1CCB6D8CD
F99CC3598522ABE54B9DCAC2969179CC
F3CA6D208932C0BD365FE0D589038E1C
5B763E8410411FFFEC4ADC5EEE935A84
7C7C8524146AA5006BE260A041101DF3
7AD666ADF83A65F3F883839685FE6E31
C59286E780962666D2A9C13A478542C8
A8DC644112858EF6E52078F7405F88FD
734AC9568F0674F7BBE59D45B5B90EA7
5B888A06EFF60B86B10367EEC3B44E85
47216088A078D06F9220263FAF964F10
2E03DB1924573F3131EEC916E5444F56
7CB9FDA17938289CE3019602888EEC58
E48A64DA907583189751D6FF988D14F6
C0DCE1FC7C20D42EC7F7326A7CC66B39
F27F046DF960AB50CE65B9F4364C981E
D5F25FE843F01514F448B1AA94028D2D
EC895C732092BA9A3CE9F507ED888726
68EA8FDC3D7F8984530BB60FAE9A42FD
05F7B2C58D627CE948B06C10E39CDF91
CA374E053CF35114C98D40A23CAFA777
62440E2EC0A24E9FB2CF09E230FFDEC4
A9F5CC6811A363B671124943547E3631
7842C62D45ECE888132F21C9F4417B21
0597C8E39ECFBDFB2C6289471B52B974
310D44D95961BF9754C9948AF6F437EA
E020680BE3366217F20F02840856AB51
BE13C3B4A34804D4CF30E6D8C417E4B4
5249B4686BC5038FBFE36A3E6CCA5B72
8BC72D1925A8866050D5A6FB01148518
146B1C215275774027FAEF96E5AA3713
8762A39B61912B4FDF4165FD4F2A782A
5800569BC32997BCE5774BA3C675C4E4
5E09265F12D64B9FA85FF9427A0A7FB0
Query:
SELECT DISTINCT `event_name`
   FROM `firebase-public-project.analytics_153293282.events_*`
   LIMIT 100;
Answer:
event_name
level_complete_quickplay
session_start
select_content
ad_reward
screen_view
post_score
level_start_quickplay
level_fail
level_retry
app_exception
level_up
no_more_extra_steps
error
level_complete
firebase_campaign
level_reset
challenge_accepted
spend_virtual_currency
first_open
level_end_quickplay
level_reset_quickplay
dynamic_link_app_open
app_update
notification_foreground
level_retry_quickplay
use_extra_steps
app_remove
app_clear_data
dynamic_link_first_open
os_update
in_app_purchase
challenge_a_friend
level_start
level_end
user_engagement
level_fail_quickplay
completed_5_levels
Query:
SELECT `user_pseudo_id`, MIN(`event_date`) AS first_event_date
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `user_pseudo_id`
   LIMIT 100;
Answer:
user_pseudo_id,first_event_date
B4E80A7992C6F1E4EF163BAA3A54041A,20180704
0E05F56141200FF41FCC0C7FA297FF08,20180704
7ED4165854463C38F1D739A2014001D9,20180703
D45CF251C60626FDB4BB8D50ABB7BA46,20180704
EB77017C771046704B0582544C3F9328,20180704
757F371D73A59AA7B6FB5CF1E6483B33,20180704
A4FFA7244522F8258DEC9B6E607E222E,20180704
FEDC59699D8832A11B88BFCCCAD0951D,20180702
B42CD43328FFA37DA41BC64C3DC1BB38,20180704
8EDB9A9856CDB5AFC42546106EE46734,20180702
CA04708DA02378999ECB402481FF1AE4,20180702
BBDCBE2491658165B7F20540DE652E3A,20180704
EAFD9AC6BBC95C8755DA42E07A37A2B1,20180704
22FC699EA575027C5A7909E24A7F187D,20180702
4CE503AE5B4C4F67A00474CE380CCC39,20180702
4DA8863CD8D2C860F6BB73579BC6F5C9,20180702
E4D0CD43ECF1890C6D20D2EC09153E02,20180703
F81180A020502492D27DCF8E528DB0D7,20180703
EED353A934B17D0F7C038AF551C14D2C,20180704
9FC8C8D89843323CBE3DCE4961C4EC39,20180704
50E809F1EAA00356B4556CE0A20602E0,20180704
68B5D960072F6FE9F0A5E5E01695F332,20180704
27B1CD26769B068D16FAAF82D4F2C1A8,20180703
223BF1D360715CB9BA85B0DDDE39D589,20180702
301AFECE7DEEE17ACC059F6C18017D80,20180704
3E93326F1DF43AF5F27987897F2BB819,20180704
33E5EA9FE1E29AC3127D975A5494213D,20180702
777D1C5560908C966A6E77B4DD1818CA,20180704
53717D02C147929860D981CD68CE2D9A,20180704
563CCC0B24F6185BEFA72F637F1BB3A0,20180704
36A84ED829638DCEBC057899C0C1BFD4,20180704
518DABD4A0DF4C41A6D811D6D45EB2B6,20180704
756728B497AE5786A9285442E1332AE5,20180704
0668B0D5FABD52C372E70A784F74D0DA,20180704
C7E2273D8B11257FCCC915D27C1FCA24,20180702
E5D16173400729E05DFFB4883FA6EF1C,20180704
05AD5EED131D70296485EA5138F3D6DF,20180704
47A7118B1B7FA4CD0EB591857CB9619F,20180704
B78DB4E683651327A612372A48B5734C,20180702
93A7A5C31807490E878F4164A6418BFC,20180702
F85977DD6D4B89E2164CC02D1DAFDD69,20180704
724B99CB6F41846F3F6BB46C2F663F5E,20180704
B3A9A38A561B3648D280614B8E2D8E07,20180702
8BA7798B298079BD1D9CDA0242AF2B09,20180903
77CBBB121DEF45BCEF21C8EE622E256E,20180724
C795AFA7F574C2BB09D3647AD90A9719,20180702
FF20E4EE129C3700FC1C6CEF188E17BB,20180829
FEEC515D32002A998761352F0E3C1172,20180903
6A8D61827CD1A7E5300673C05DEEDBCC,20180714
C962AE7EF8A83B7013D2610349D7D36E,20180710
ED0AF1301B6404476B420A990B98ABD7,20180903
B7701369F8598A25DED0499DAD3BE85D,20180702
096C23E69254818F7EE03C1239005F2B,20180702
6A9AB23D029870940ACDD4B67A5453EE,20180903
7064BC64E47E869B36967E854748969E,20180903
75F979DE60C91A6631485A88457C108E,20180707
F63CDC909B08737719D6BED3DB344C43,20180903
1F54AC7A413B33C6023DA0AF8F489684,20180807
EF7772819E807EDBD8DB0F0B5210030E,20180801
Query:
SELECT t.`event_name`, f.key, f.value.string_value
   FROM `firebase-public-project.analytics_153293282.events_*` AS t,
     UNNEST(t.event_params) AS f
   WHERE t.`event_name` = 'session_start'
   LIMIT 100;
Answer:
event_name,key,string_value
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,main_menu
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
session_start,firebase_event_origin,auto
session_start,firebase_screen_id,
session_start,firebase_conversion,
session_start,firebase_screen_class,game_board
Query:
SELECT `event_date`, COUNT(*) AS event_count
   FROM `firebase-public-project.analytics_153293282.events_*`
   WHERE `event_date` >= '20180702'
   GROUP BY `event_date`
   ORDER BY `event_date`
   LIMIT 100;
Answer:
event_date,event_count
20180702,50000
20180703,50000
20180704,50000
20180705,50000
20180706,50000
20180707,50000
20180708,50000
20180709,50000
20180710,50000
20180711,50000
20180712,50000
20180713,50000
20180714,50000
20180715,50000
20180716,50000
20180717,50000
20180718,50000
20180719,50000
20180720,50000
20180721,50000
20180722,50000
20180723,50000
20180724,50000
20180725,50000
20180726,50000
20180727,50000
20180728,50000
20180729,50000
20180730,50000
20180731,50000
20180801,50000
20180802,50000
20180803,50000
20180804,50000
20180805,50000
20180806,50000
20180807,50000
20180808,50000
20180809,50000
20180810,50000
20180811,50000
20180812,50000
20180813,50000
20180814,50000
20180815,50000
20180816,50000
20180817,50000
20180818,50000
20180819,50000
20180820,50000
20180821,50000
20180822,50000
20180823,50000
20180824,50000
20180825,50000
20180826,50000
20180827,50000
20180828,50000
20180829,50000
20180830,50000
20180831,50000
20180901,50000
20180902,50000
20180903,50000
20180904,50000
20180905,50000
20180906,50000
20180907,50000
20180908,50000
20180909,50000
20180910,50000
20180911,50000
20180912,50000
20180913,50000
20180914,50000
20180915,50000
20180916,50000
20180917,50000
20180918,50000
20180919,50000
20180920,50000
20180921,50000
20180922,50000
20180923,50000
20180924,50000
20180925,50000
20180926,50000
20180927,50000
20180928,50000
20180929,50000
20180930,50000
20181001,50000
20181002,50000
20181003,50000
Query:
SELECT `user_pseudo_id`, MIN(TIMESTAMP_MICROS(`event_timestamp`)) AS first_session_timestamp
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start'
GROUP BY `user_pseudo_id`
LIMIT 100;
Answer:
user_pseudo_id,first_session_timestamp
23A7E8D987ADCC38EB026096DC513F85,2018-06-18 07:26:10.107000+00:00
11FC272840E1ED3923F92C521AC68F1E,2018-09-05 12:26:58.498000+00:00
0ED6BC1D319AB5BD1F245628EA47EDBB,2018-07-31 10:33:13.809000+00:00
7A8D1CAA45CDE7652260DA6E71068A13,2018-07-23 05:23:46.983000+00:00
F3A2F44C99758CC6006BFE28AC78EBFE,2018-08-09 02:06:38.579000+00:00
20D316579BC2D1122CABFC41F704DACA,2018-09-13 21:16:48.569000+00:00
A5A56F3717C923CECBB9247595F6CA5F,2018-06-25 13:10:33.402000+00:00
44962B1EB7295E6C001F7F75CFA52D3C,2018-06-14 20:19:28.864000+00:00
65F8E2B80A986C0FDF372EF08A031483,2018-09-14 03:00:55.603000+00:00
D9E0B99D114ACD55A2349149F3BC96F7,2018-09-09 06:35:54.508000+00:00
EB1A430BACB37E6EA72592BF838E64A6,2018-06-18 13:10:58.668000+00:00
2E7493AC5967A8B48B8DEF79EDDFC056,2018-09-14 06:11:09.270000+00:00
AC14AD9D158A2A5449E120A33D5B55BB,2018-09-13 19:33:14.554000+00:00
A135A27E4373605B2EB6E48DCA05720A,2018-09-04 09:09:14.853000+00:00
ADD82F1153554D07815E0ACFBD68A23F,2018-09-05 05:34:38.922000+00:00
5BF7AFF8FACA9401CB5E0D7354479441,2018-09-12 03:45:31.868000+00:00
B9D8806148044938C86FA637A13431AA,2018-06-26 12:39:21.868000+00:00
42FE551121362B71E141D291CC7AA4E9,2018-09-13 12:02:05.749000+00:00
27EBD3EEECD253B2A30B2255280DD32D,2018-06-27 06:00:26.991000+00:00
857415053FD447A7EDDACD7FB72A8E9E,2018-09-08 14:11:49.609000+00:00
289F2AE59FE48FFF6DD12D0AB553C14E,2018-06-21 23:01:20.163000+00:00
0D05EABFC1DA51098487F5C027AB9EAB,2018-06-26 08:43:41.735000+00:00
A645F59DABBD8ED670286DCF716EBF47,2018-09-10 13:05:15.333000+00:00
7EB85F9A592C4051DC747C34349FC14D,2018-09-13 11:01:05.028000+00:00
4CC7B06FC12175C31ECBE1987A48DEA3,2018-06-25 15:50:12.652000+00:00
749D1C8A698B9549D1E4CEAD631A4610,2018-09-02 11:51:03.170000+00:00
10092C958CD92FE2E65A2610D613CC27,2018-09-13 20:22:35.307000+00:00
18688C841952131D9A6A01B81C8F65F3,2018-08-28 16:32:55.656000+00:00
1CE03BB4BFFE9960A4E94D81D89355BC,2018-06-16 08:25:25.063000+00:00
FF5D70EFCA9F6F557CF9167A85E44297,2018-09-13 18:04:52.717000+00:00
A6CC977A53243EE9A419FB3CDA0561EF,2018-09-13 10:14:11.755000+00:00
Query:
SELECT DISTINCT e.`user_pseudo_id`
FROM `firebase-public-project.analytics_153293282.events_*` AS e
JOIN (
  SELECT
    `user_pseudo_id`,
    TIMESTAMP_ADD(TIMESTAMP_MICROS(MIN(`event_timestamp`)), INTERVAL 21 DAY) AS start_fourth_week,
    TIMESTAMP_ADD(TIMESTAMP_MICROS(MIN(`event_timestamp`)), INTERVAL 28 DAY) AS end_fourth_week
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE `event_name` = 'session_start'
  GROUP BY `user_pseudo_id`
) AS first_sessions
ON e.`user_pseudo_id` = first_sessions.`user_pseudo_id`
WHERE TIMESTAMP_MICROS(e.`event_timestamp`) BETWEEN first_sessions.start_fourth_week AND first_sessions.end_fourth_week
LIMIT 100
Answer:
user_pseudo_id
B99FD965B0874192EE94E8A8FE85EA9E
7439CA3E049F434742CB5C63A55FC24D
BAF65BC3AA02395D12D8A6ABF85B8007
38328F5729077611D47495753D2C04D1
51B130949FD7983F1CF48C592B84ED1F
1E6348F7A97962E7EAA87C7FF638569F
1F91CA88C5E106304CDBD9C769FEC3E4
C96C96A3BFA142C6B393183BDB2B9DDB
0ADCAB98C7686603278BCDD71FE16CC8
859BD5756C9635B9A657B90A7265679A
886E4151EA714AA75E544D2938C1073D
73038968A6AC33439F79449DD2DB1584
686E8E8F73A49595EDE40F1BBDFB8C99
5D7B75012F4A81127A627CF594A8ABF8
3828BE5E2F158C7E5831478F63DAE9E4
5539C6BBAD980C27D8B18AE27CDD8341
ED90CC7C8BC768DBF3B8B87A75422721
E98AFA6BD0908A7BDF0FE75396B204DD
518CDCF91C158C552E1F183710D02AE7
1A34269052225805BDB10AE343A6DD29
52CFA8EDD77C74FAE4D79AD25CF4717C
A51BF75239709A5494645BEAABC3453D
5ACF1A6BFE350F7BB661BF389AF7E2F0
E1A3C786B2E4D56629EE808A3A174995
E0664E9E7883956A6E3084FD68AA274B
7E40E634997585B0C69B6F67C01C191B
004D2DFEB866BFB00427DB2F530C1F3D
28C4A09298C441D5AFD39E749D9F3DA3
0046A2D1B1135C0AB4462B8FF036739E
AB714CB216CB456740B54DD82E11FDB9
579700B60FE8D8C382D5421FBBF7535D
19DEEA6B15B314DB0ED2A4936959D8F9
F3C51AAD312E2312B693648105EB76F5
098868D9626624131122714C36A5D069
DEBFB520A77B520CA36FD8C9C9A269AD
5E3CBF1204F069C8F4474D492A361CCD
0217CFB14E415205AE6B110F64C9B713
F79A71D6D132595932E445E1F42CE65D
7FD3ECDE609533E2BC60B7733DB6CFCB
080DB8B23066DE56D78C5F570FF5A019
0AF862AFEB5358EBFDA7AFE3AC908844
89BD2B0E233951461CF06C9B4FDA0D81
55F9FB7C14AA4BAB066EA326D4A2221B
39CA0ABD1D955D12B7441AE21F4877D8
7ED8C235689771F6B0F29BBF295A346F
66E8EE325A3E6369E607998DFE9E13F1
DCF02493CA8559E632F3E2FB070DBEF0
1406751556EEDB1D112BF86CACAE9C88
8ACCEA29DD561542D9AE209167BC9943
C1327B694B124442335CFFD6FD3B15EC
4F34EA13CE343BE6955B67914BD4DF9E
BE36C49B1AB3968D420923AEC4FDD7AE
E5AFF3DE508996512D61B49A63D1D063
D5F9D9AF22EF5073E10342973D48FB2C
42E6A7C3536775E3B8C3DB919AE9A452
3875A92B5F5C2BBA1355CED06A986079
0CAAA1B6F161BA4D363EB7A2DEF64A08
A19F659EA9BA36A3595F088F30A6B7E7
19EA272CEA5C14D4E55F2AF25CB30950
71CD1253D6BB1366E146BEC63E305CB3
FC55032FC8C06EB1A1220D1ABD1164C9
7F2B633C86B765201C93FDB6FF261143
05F0FB18A61CCB1E2540F4D26721CCEC
8F030F26EB2BE0DF3C21FB0F13E6076F
8F4B58FA6F11840EF836F91A73A6CFD0
D9AA0EC27AF47514DDB5C664A6EF758A
5269565AB96D3D27ADEA4D7EF4DC2A88
AD99B4950F9D70E0FD5E8563F2A664FB
E93192CD2EC3D159E9A5B105E479E78D
6CA06212A2113C29F5E1B3C01536E38E
885852C000C31A983D41BBFB86D71AED
EA00BFE6FBAF082D6EA23AA9606D96BC
CAE8683FCC2445DDABFB1FF2516E0B5D
B529E84EE03C578C7E92CE5836AB1C1D
E069FDF17198500FCB6DDDF406ABA122
E415D4A90F9A9D8B784B3BCE2F5678B5
3E93326F1DF43AF5F27987897F2BB819
5885B9A6C2FBB71AB1304B9EDB330B76
9BC94B3773C8304A9E101AEBCFEF4A5F
16AAF7C1D78ED1950DE82A6802318C9A
C679FF00E17790E7E16AB903212EE05C
D21451ACF492761DBC86B3549AEA194A
AD6D349E4DF47BB97D06CA8BB65EBB66
0A9D7004114F34B9CD49538E173E01A7
67ABE7FC39408AE456040BFA4EFC5EFA
0DF6A14F536F6514A6F18BC12A532A82
95BF77235739808B7BC07A7F0563CC9A
D8995B39CDB121EC37EC90025DB53B6D
8C7A0CAF2B29D568268B8D331E37ABF6
0B427C5E490A982FADF586F82E797ACB
C1A0D9FB3527654CA715A732B5FB5202
01749360DADD769CDFB6D1E5DCBB2BD9
19AB27B8A0F2C7C738683CA2F5FFEBE1
Query:
SELECT t.`user_pseudo_id`, f.key, f.value.string_value
FROM `firebase-public-project.analytics_153293282.events_*` AS t,
  UNNEST(t.user_properties) AS f
LIMIT 100
Answer:
user_pseudo_id,key,string_value
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
8065F8E98407106A65D35195984B2258,ad_frequency,3
8065F8E98407106A65D35195984B2258,initial_extra_steps,20
8065F8E98407106A65D35195984B2258,plays_quickplay,true
8065F8E98407106A65D35195984B2258,num_levels_available,30
8065F8E98407106A65D35195984B2258,plays_progressive,true
8065F8E98407106A65D35195984B2258,first_open_time,
8065F8E98407106A65D35195984B2258,firebase_exp_3,3
Query:
SELECT `user_pseudo_id`, COUNTIF(`event_name` = 'session_start') AS session_count
FROM `firebase-public-project.analytics_153293282.events_*`
GROUP BY `user_pseudo_id`
LIMIT 100
Answer:
user_pseudo_id,session_count
FFD44153572065E379B7E96916F730B8,13
B19501509EADDDB42342340A93E2BAAB,5
570495249052C5E40EC34A2B054DA1A1,9
7842C62D45ECE888132F21C9F4417B21,42
B8B20A9B77B516AC51BD7C96E3F1866C,7
CCE4BDDE62CA393AC9563B8718F5CFB9,17
9271152D92DEE0D6C59BAA65F92CED5D,3
A6A77DA8F2C4102A83EED1D5216EB318,22
25008881407A8ADFDA4815AB5397810B,4
5CC5F51FFBA6289E36363D9C2F835B0C,8
8A1C79A7DD82197D40A2F4845010CF67,5
0EFA419FF8D1FB5BAA12E4794D511937,1
60399FD820E8529CA63D0C69C8B4AD45,1
8B7110AC0A6E048628AB4BCC751E0A09,1
03C8FFC95DEC2C1E87EB4646970FC12E,0
1EFB7DDCF75186BFDD85D88E84681B55,2
5B888A06EFF60B86B10367EEC3B44E85,63
018F03084C88E944163F76A0D0C2FBA1,114
6A71951BC1C5F03C22E9E892AEB90B19,6
8AFB3221668B5EF2E9A246387A266772,0
0A74C26349ABD323C5CE34AB8DD52164,3
2684EA4DDB1F988E3C979AB15CFF601F,19
7410C5CC4FA11D31DB5F9B1D8ECD6BD0,34
DA48D36D07835B1918BDF831AF83B5EF,283
4E0D2F7E40746B90029E4F4241F9ECA9,6
92C9E3FA3B35FC5A5ED1B36CF4D114B9,14
CA51DAF1373B5C2A16C174AFBD2132A4,89
382B7E4C3513E0B32AD100ABCC15B917,0
C52D9633B63526E066BFD3E9BCF762A3,0
5E09265F12D64B9FA85FF9427A0A7FB0,138
6EBDDD1BC5E5489D7FF0B41B8DAA9D86,11
751F1516AC974AC343F62070D3BA39F5,67
325CCD0662FC4EA9853B7D3E3B6693A5,7
CB2A03B9DC1894380C75344D15BC0BE6,15
5B763E8410411FFFEC4ADC5EEE935A84,35
D13AD8E2C50768FF1CAE163EF068EA52,9
97746CE0DF1E7BBB0EEB43509FEE15D3,8
4BF98D09CA8359FC59ADAF56D00338F8,59
3A6E4010B115AA8EB99461DA8E9A7275,6
5631892AB2E836FD3A72540D3C316C51,2
7841ADFC1D9068C1476F07B9CFA40F68,2
6DC8E9960F2EAE5C05215ADFC160359C,27
8BE102266AF2AEC727AE08D0A5241DE0,4
D5A6C5F4F8B3D73D0FADFCEE09B520DC,8
BBD99D8850F41DD900934E8A5859CEFA,2
B141B75E5E5D48DAD8298F91B94A2E07,33
7392FB7027578690D48268EE642A3895,30
1BDCB994173E8A509680B6351EE6A3AE,1
622E890EE63F0B83C532CC052BEE8A50,19
14EC3B93608EFEEC1FA22D31EB995403,6
3686DE7B4C85F5F0AF385348F03492C9,7
37DC3F34CD3CF0D57CD6A753364BEC30,0
ABAACFAF0D1D72E4EB8B4C2B4268AC83,1
CCE60CE7DBE296A7828A028094E21D51,7
5D8DA83FF9997DB4B4CE4518B0550DDD,0
062EFDCE1B385D06E7F44D063AF58A83,10
ADD0757874A418957AAA60903AA5F62D,3
ABF803076F199C505F76E3B1CD0FB4ED,9
0C873D77670D1231E2C1DB2F833679D0,7
386EE7D00E029293C53C2ED7319EF520,12
F506E5B5D610285BF94A2A917A1858D4,9
201E3B0D000A2177487384189D647E14,0
A62611DA6D4B45AC3DB2450BF3A24C23,9
44759496F6F519B1A4BEF55BE55C631C,54
97EFE88578CA49C1B43A95A781C7AD16,3
31F8F98A5B838C7375267F10DADBDA24,33
859BD5756C9635B9A657B90A7265679A,47
44386D9242DC9705DAFE219EC2C114F5,49
Query:
SELECT `user_pseudo_id`, DATE_TRUNC(DATE(PARSE_DATE('%Y%m%d', `event_date`)), WEEK(MONDAY)) AS week_start
FROM `firebase-public-project.analytics_153293282.events_*`
WHERE `event_name` = 'session_start' AND `event_date` >= '20180702'
GROUP BY `user_pseudo_id`, week_start
LIMIT 100
Answer:
user_pseudo_id,week_start
D0E006B5E441969283C94713E308A11D,2018-08-20
B2D359D114428D8DD085DFAFF11195CE,2018-08-20
2C6786FA363E378426FBEAE3D9AC1B2F,2018-08-20
F3917138A3D4B03ADA1C2E77E3B84649,2018-08-20
B3EFE616640788FE5B1D9776C9972238,2018-08-20
D5F9D9AF22EF5073E10342973D48FB2C,2018-08-20
31E8B3EB3D9167E813FDFB812898F2F6,2018-08-20
42E6A7C3536775E3B8C3DB919AE9A452,2018-08-20
CA04708DA02378999ECB402481FF1AE4,2018-08-20
E4196C5E0A92A22F69DE4E3AA288D6EE,2018-08-20
F34FF1C9F0C022B684BC885BA1DDC260,2018-08-20
533E79DF88C5D3B27AB10A32F8185503,2018-08-20
77619E28EEE4A7F622E5CAE5847B5B0E,2018-08-20
13C310CA6E62FD1EB15BB8610D0CAE89,2018-08-20
F183D1950EDA9E115C8C05A84E42EA62,2018-08-20
DB96F991CEBF843652230B0F802424FA,2018-08-20
7EE035CA8E6132A8877C39656896BA41,2018-08-20
5110D174E1BB8A7B1D364A9061FFA15B,2018-08-20
1181F8E1F7926B07A503427D76E34082,2018-08-20
A19F659EA9BA36A3595F088F30A6B7E7,2018-08-20
841A68D5D1F94857BEB64225193B2432,2018-08-20
DE3F49561A3E21ED2C9CC518F564961E,2018-08-20
373016F8F89C087DC8C89E06B362AD1A,2018-08-20
0B54075D3F149377C6D802237E9BC290,2018-08-20
D031112AF5E886F8CB7B5D88C2A6EB2A,2018-08-20
8572B4BE029A37D6D73C28E42805A49F,2018-08-20
091F09F594F7507A1D6D34D006A49CD9,2018-08-20
5E8B4AEF7E3373AA78408DB08E72E3B8,2018-08-20
82F141D1C5A86CB8F5F4DFC7E09E5513,2018-08-20
F5CA9C70FB5ACA0C36279A6FB407A7B7,2018-08-20
E0664E9E7883956A6E3084FD68AA274B,2018-08-20
12E5626928FE0885DEEF068683E8BD63,2018-08-20
56E8EC9522573BD1BAD8E18AD2E33C9A,2018-08-20
86C279CEE90D97565DD82D2A92A9F421,2018-08-20
EBE661044C1949546986A852F35083A1,2018-08-20
DDB627A00E4213B6A69F35DB89681AF8,2018-08-20
7A1371C7EAD50DB944A44ADC0351CB7B,2018-07-02
E9B5EC78F1F4D6F90B5AFB34D09697F2,2018-07-02
5256B2B115955E80DDB7449775D92325,2018-07-02
1CF315BC6864E7A71A81E47925E18A61,2018-07-02
A95BA9143018CA81430258E8A725C3E6,2018-07-02
89BD2B0E233951461CF06C9B4FDA0D81,2018-07-02
D9FEC4E4418413FCE771B203FD7D48D2,2018-07-02
3875A92B5F5C2BBA1355CED06A986079,2018-07-02
159002C6F393752AD79B3C2E8C7104C7,2018-07-02
F2ACDC8D64D4218BA63EB8732C110BA5,2018-07-02
E4C074EBC3729FB45CFA48D9F6EA4DFD,2018-07-02
DB3B6E984B29883EA02F1A504A33730F,2018-07-02
E4C6FF8288DD4BFCDE93E2218E20643B,2018-07-02
885852C000C31A983D41BBFB86D71AED,2018-07-02
84E491A60BE52A4C6A438A89FADE283C,2018-07-02
1DF3029854CC8787F3EC5A2A9B21334C,2018-07-02
FF955E4CA27C75CE0BEE9FC89AD275A3,2018-07-02
End Exploring Related Columns
Task: Can you group users by the week of their first session start, starting from July 2, 2018? For each group, calculate the retention rate in the fourth week (i.e., the percentage of users from the original group who returned in the fourth week after their first session). Please identify the cohort with the highest retention rate in the fourth week, and name the group by the Monday date of the cohort's first session week. Return the result in the format "YYYY-MM-DD".

Please answer only one complete SQL in bigquery dialect in ```sql``` format.
Usage example: ```sql
SELECT `column_name` FROM `database.schema.table` WHERE ... ``` (Replace `database`, `schema`, and `table` with actual names. Enclose column names and table identifiers with backticks.)
Follow the answer format like: ```csv
YYYY-MM-DD
2018-07-16
(Attention: answer in one row)
```

**Explanation:**
By grouping users by the week of their first session starting from July 2, 2018, and calculating the retention rate in the fourth week for each cohort, we find that the cohort starting on **2018-07-16** had the highest retention rate in the fourth week. This means that a higher percentage of users who started their first session during the week of July 16, 2018, returned in their fourth week compared to cohorts from other weeks..
Here are some useful tips for answering:
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'firebase-public-project': {'analytics_153293282': ['events_20180612', 'events_20180613', 'events_20180614', 'events_20180615', 'events_20180616', 'events_20180617', 'events_20180618', 'events_20180619', 'events_20180620', 'events_20180621', 'events_20180622', 'events_20180623', 'events_20180624', 'events_20180625', 'events_20180626', 'events_20180627', 'events_20180628', 'events_20180629', 'events_20180630', 'events_20180701', 'events_20180702', 'events_20180703', 'events_20180704', 'events_20180705', 'events_20180706', 'events_20180707', 'events_20180708', 'events_20180709', 'events_20180710', 'events_20180711', 'events_20180712', 'events_20180713', 'events_20180714', 'events_20180715', 'events_20180716', 'events_20180717', 'events_20180718', 'events_20180719', 'events_20180720', 'events_20180721', 'events_20180722', 'events_20180723', 'events_20180724', 'events_20180725', 'events_20180726', 'events_20180727', 'events_20180728', 'events_20180729', 'events_20180730', 'events_20180731', 'events_20180801', 'events_20180802', 'events_20180803', 'events_20180804', 'events_20180805', 'events_20180806', 'events_20180807', 'events_20180808', 'events_20180809', 'events_20180810', 'events_20180811', 'events_20180812', 'events_20180813', 'events_20180814', 'events_20180815', 'events_20180816', 'events_20180817', 'events_20180818', 'events_20180819', 'events_20180820', 'events_20180821', 'events_20180822', 'events_20180823', 'events_20180824', 'events_20180825', 'events_20180826', 'events_20180827', 'events_20180828', 'events_20180829', 'events_20180830', 'events_20180831', 'events_20180901', 'events_20180902', 'events_20180903', 'events_20180904', 'events_20180905', 'events_20180906', 'events_20180907', 'events_20180908', 'events_20180909', 'events_20180910', 'events_20180911', 'events_20180912', 'events_20180913', 'events_20180914', 'events_20180915', 'events_20180916', 'events_20180917', 'events_20180918', 'events_20180919', 'events_20180920', 'events_20180921', 'events_20180922', 'events_20180923', 'events_20180924', 'events_20180925', 'events_20180926', 'events_20180927', 'events_20180928', 'events_20180929', 'events_20180930', 'events_20181001', 'events_20181002', 'events_20181003']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book"
However, if the string is not decided, you may use fuzzy query and ignore upper or lower case. e.g. Get articles that mention "education".
When using ORDER BY, if there are duplicate values in the primary sort column, sort by an additional column as a secondary criterion.If the task description does not specify the number of decimal places, retain all decimals to four places.
Be careful of information in nested columns. e.g. When it comes to completed purchase, `hits.eCommerceAction.action_type` Indicates the type of ecommerce action and '6' represents completed purchases.
Be careful one country may have different country_name and country_region in different columns in a database.
Don't be misled by examples. For instance, a question related to Android development on StackOverflow might include tags like 'android-layout,' 'android-activity,' or 'android-intent.' However, you should not limit your analysis to just these three tags; instead, consider all tags related to Android: "tags" LIKE '%android%'.

2025-01-30 01:18:59 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:18:59 - root - INFO - ```sql
WITH first_sessions AS (
  SELECT
    user_pseudo_id,
    MIN(event_timestamp) AS first_session_timestamp,
    PARSE_DATE('%Y%m%d', MIN(event_date)) AS first_session_date,
    DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY)) AS first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
    AND event_name = 'session_start'
  GROUP BY user_pseudo_id
),
fourth_week_events AS (
  SELECT DISTINCT
    e.user_pseudo_id,
    fs.first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*` AS e
  INNER JOIN first_sessions AS fs
    ON e.user_pseudo_id = fs.user_pseudo_id
  WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
    AND TIMESTAMP_MICROS(e.event_timestamp) BETWEEN
      TIMESTAMP_ADD(TIMESTAMP_MICROS(fs.first_session_timestamp), INTERVAL 21 DAY) AND
      TIMESTAMP_ADD(TIMESTAMP_MICROS(fs.first_session_timestamp), INTERVAL 28 DAY)
)

SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week) AS `YYYY-MM-DD`
FROM (
  SELECT
    fs.first_session_week AS cohort_week,
    COUNT(DISTINCT fs.user_pseudo_id) AS cohort_size,
    COUNT(DISTINCT fw.user_pseudo_id) AS retained_users,
    SAFE_DIVIDE(COUNT(DISTINCT fw.user_pseudo_id), COUNT(DISTINCT fs.user_pseudo_id)) AS retention_rate
  FROM first_sessions fs
  LEFT JOIN fourth_week_events fw
    ON fs.user_pseudo_id = fw.user_pseudo_id
    AND fs.first_session_week = fw.first_session_week
  GROUP BY fs.first_session_week
  ORDER BY retention_rate DESC
  LIMIT 1
)
```

```csv
YYYY-MM-DD
2018-07-16
```
2025-01-30 01:19:05 - root - INFO - itercount: 1
2025-01-30 01:19:05 - root - INFO - 0
2025-01-30 01:19:05 - root - INFO - results: 
YYYY-MM-DD
2018-07-02


2025-01-30 01:19:05 - root - INFO - Please check the answer again by reviewing Can you group users by the week of their first session start, starting from July 2, 2018? For each group, calculate the retention rate in the fourth week (i.e., the percentage of users from the original group who returned in the fourth week after their first session). Please identify the cohort with the highest retention rate in the fourth week, and name the group by the Monday date of the cohort's first session week. Return the result in the format "YYYY-MM-DD"., reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
If the task description does not specify the number of decimal places, retain all decimals to four places.
The answer format should be like: ```csv
YYYY-MM-DD
2018-07-16
(Attention: answer in one row)
```

**Explanation:**
By grouping users by the week of their first session starting from July 2, 2018, and calculating the retention rate in the fourth week for each cohort, we find that the cohort starting on **2018-07-16** had the highest retention rate in the fourth week. This means that a higher percentage of users who started their first session during the week of July 16, 2018, returned in their fourth week compared to cohorts from other weeks. The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
YYYY-MM-DD
2018-07-02
Current sql:
WITH first_sessions AS (
  SELECT
    user_pseudo_id,
    MIN(event_timestamp) AS first_session_timestamp,
    PARSE_DATE('%Y%m%d', MIN(event_date)) AS first_session_date,
    DATE_TRUNC(PARSE_DATE('%Y%m%d', MIN(event_date)), WEEK(MONDAY)) AS first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
    AND event_name = 'session_start'
  GROUP BY user_pseudo_id
),
fourth_week_events AS (
  SELECT DISTINCT
    e.user_pseudo_id,
    fs.first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*` AS e
  INNER JOIN first_sessions AS fs
    ON e.user_pseudo_id = fs.user_pseudo_id
  WHERE _TABLE_SUFFIX BETWEEN '20180702' AND '20181003'
    AND TIMESTAMP_MICROS(e.event_timestamp) BETWEEN
      TIMESTAMP_ADD(TIMESTAMP_MICROS(fs.first_session_timestamp), INTERVAL 21 DAY) AND
      TIMESTAMP_ADD(TIMESTAMP_MICROS(fs.first_session_timestamp), INTERVAL 28 DAY)
)

SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week) AS `YYYY-MM-DD`
FROM (
  SELECT
    fs.first_session_week AS cohort_week,
    COUNT(DISTINCT fs.user_pseudo_id) AS cohort_size,
    COUNT(DISTINCT fw.user_pseudo_id) AS retained_users,
    SAFE_DIVIDE(COUNT(DISTINCT fw.user_pseudo_id), COUNT(DISTINCT fs.user_pseudo_id)) AS retention_rate
  FROM first_sessions fs
  LEFT JOIN fourth_week_events fw
    ON fs.user_pseudo_id = fw.user_pseudo_id
    AND fs.first_session_week = fw.first_session_week
  GROUP BY fs.first_session_week
  ORDER BY retention_rate DESC
  LIMIT 1
)
2025-01-30 01:19:57 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
2025-01-30 01:19:57 - root - INFO - ```sql
WITH first_sessions AS (
  SELECT
    user_pseudo_id,
    MIN(PARSE_DATE('%Y%m%d', event_date)) AS first_session_date,
    DATE_TRUNC(MIN(PARSE_DATE('%Y%m%d', event_date)), WEEK(MONDAY)) AS first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*`
  WHERE event_date >= '20180702'
    AND event_name = 'session_start'
  GROUP BY user_pseudo_id
),
fourth_week_events AS (
  SELECT DISTINCT
    e.user_pseudo_id,
    fs.first_session_week
  FROM `firebase-public-project.analytics_153293282.events_*` AS e
  INNER JOIN first_sessions AS fs
    ON e.user_pseudo_id = fs.user_pseudo_id
  WHERE PARSE_DATE('%Y%m%d', e.event_date) BETWEEN
    DATE_ADD(fs.first_session_week, INTERVAL 21 DAY) AND
    DATE_ADD(fs.first_session_week, INTERVAL 27 DAY)
)
SELECT
  FORMAT_DATE('%Y-%m-%d', cohort_week) AS `YYYY-MM-DD`
FROM (
  SELECT
    fs.first_session_week AS cohort_week,
    COUNT(DISTINCT fs.user_pseudo_id) AS cohort_size,
    COUNT(DISTINCT fw.user_pseudo_id) AS retained_users,
    SAFE_DIVIDE(COUNT(DISTINCT fw.user_pseudo_id), COUNT(DISTINCT fs.user_pseudo_id)) AS retention_rate
  FROM first_sessions fs
  LEFT JOIN fourth_week_events fw
    ON fs.user_pseudo_id = fw.user_pseudo_id
    AND fs.first_session_week = fw.first_session_week
  GROUP BY fs.first_session_week
  ORDER BY retention_rate DESC
  LIMIT 1
)
```
2025-01-30 01:20:04 - root - INFO - itercount: 2
2025-01-30 01:20:04 - root - INFO - 0
2025-01-30 01:20:04 - root - INFO - Total iteration counts: 2
