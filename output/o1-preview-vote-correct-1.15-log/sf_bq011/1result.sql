WITH Active_Last7Days AS (
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210101" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
    UNION
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210102" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
    UNION
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210103" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
    UNION
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210104" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
    UNION
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210105" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
),
Active_Last2Days AS (
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210106" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
    UNION
    SELECT DISTINCT t."USER_PSEUDO_ID"
    FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20210107" t,
         LATERAL FLATTEN(input => t."EVENT_PARAMS") AS f
    WHERE f.VALUE:"key"::STRING = 'engagement_time_msec'
)

SELECT COUNT(DISTINCT "USER_PSEUDO_ID") AS "number_of_pseudo_users"
FROM Active_Last7Days
WHERE "USER_PSEUDO_ID" NOT IN (SELECT "USER_PSEUDO_ID" FROM Active_Last2Days);