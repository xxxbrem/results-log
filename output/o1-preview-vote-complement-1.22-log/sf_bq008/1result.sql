WITH sessions AS (
    SELECT * FROM (
        SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170101"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170102"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170103"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170104"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170105"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170106"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170107"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170108"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170109"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170110"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170111"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170112"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170113"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170114"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170115"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170116"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170117"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170118"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170119"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170120"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170121"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170122"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170123"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170124"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170125"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170126"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170127"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170128"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170129"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170130"
        UNION ALL SELECT * FROM "GA360"."GOOGLE_ANALYTICS_SAMPLE"."GA_SESSIONS_20170131"
    )
)
SELECT
    REPLACE(np."nextPage", '"', '') AS "Most_Common_Next_Page",
    ROUND(MAX(np."durationSeconds"), 4) AS "Maximum_Duration_Seconds"
FROM (
    SELECT
        h1."fullVisitorId",
        h1."visitId",
        h1."hitNumber",
        h1."pagePath" AS "currentPage",
        h2."pagePath" AS "nextPage",
        (h2."hitTime" - h1."hitTime") AS "durationSeconds"
    FROM (
        SELECT
            s."fullVisitorId",
            s."visitId",
            h.value:"hitNumber"::NUMBER AS "hitNumber",
            s."visitStartTime" + (h.value:"time"::NUMBER / 1000) AS "hitTime",
            REPLACE(h.value:"page":"pagePath"::STRING, '"', '') AS "pagePath"
        FROM
            sessions s,
            LATERAL FLATTEN(input => s."hits") h
        WHERE
            s."trafficSource":"campaign" = 'Data Share Promo'
    ) h1
    LEFT JOIN (
        SELECT
            s."fullVisitorId",
            s."visitId",
            h.value:"hitNumber"::NUMBER AS "hitNumber",
            s."visitStartTime" + (h.value:"time"::NUMBER / 1000) AS "hitTime",
            REPLACE(h.value:"page":"pagePath"::STRING, '"', '') AS "pagePath"
        FROM
            sessions s,
            LATERAL FLATTEN(input => s."hits") h
        WHERE
            s."trafficSource":"campaign" = 'Data Share Promo'
    ) h2 ON
        h1."fullVisitorId" = h2."fullVisitorId" AND
        h1."visitId" = h2."visitId" AND
        h2."hitNumber" = h1."hitNumber" + 1
    WHERE
        h1."pagePath" LIKE '/home%'
) np
WHERE
    np."nextPage" IS NOT NULL
GROUP BY
    np."nextPage"
ORDER BY
    COUNT(*) DESC NULLS LAST
LIMIT 1;