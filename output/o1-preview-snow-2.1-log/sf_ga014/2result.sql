SELECT
  CASE
    WHEN "source" = '(direct)' AND ("medium" IS NULL OR "medium" IN ('(not set)', '(none)')) THEN 'Direct'
    WHEN "medium" IN ('organic', '(organic)') OR "source" IN ('google', 'bing', 'baidu', 'duckduckgo', 'ecosia', 'yahoo', 'yandex') THEN 'Organic Search'
    WHEN "medium" IN ('referral', '(referral)') THEN 'Referral'
    WHEN "medium" IN ('cpc', 'ppc', 'paidsearch', 'paid', 'cp', 'retargeting') THEN 'Paid Search'
    WHEN "medium" IN ('display', 'banner', 'expandable', 'interstitial', 'cpm') THEN 'Display'
    WHEN "medium" = 'email' OR "source" IN ('email', 'e-mail', 'e_mail', 'e mail') THEN 'Email'
    WHEN "medium" = 'affiliate' THEN 'Affiliates'
    WHEN "medium" = 'audio' THEN 'Audio'
    WHEN "medium" = 'sms' OR "source" = 'sms' THEN 'SMS'
    WHEN "medium" LIKE '%push' OR "medium" ILIKE '%mobile%' OR "medium" ILIKE '%notification%' THEN 'Mobile Push Notifications'
    WHEN "medium" IN ('social', 'social-network', 'social-media', 'sm', 'social network', 'social media')
      OR "source" ILIKE ANY ('%facebook%', '%twitter%', '%instagram%', '%linkedin%', '%pinterest%', '%tiktok%', '%whatsapp%', '%badoo%') THEN 'Organic Social'
    WHEN "medium" ILIKE '%video%' OR "source" ILIKE ANY ('%youtube%', '%vimeo%', '%dailymotion%', '%twitch%', '%disneyplus%', '%netflix%') THEN 'Organic Video'
    ELSE 'Unassigned'
  END AS "Channel",
  COUNT(*) AS "Number_of_Sessions"
FROM (
  SELECT
    t."USER_PSEUDO_ID",
    t."TRAFFIC_SOURCE":"source"::STRING AS "source",
    t."TRAFFIC_SOURCE":"medium"::STRING AS "medium"
  FROM (
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201201"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201202"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201203"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201204"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201205"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201206"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201207"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201208"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201209"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201210"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201211"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201212"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201213"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201214"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201215"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201216"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201217"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201218"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201219"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201220"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201221"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201222"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201223"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201224"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201225"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201226"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201227"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201228"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201229"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201230"
    UNION ALL
    SELECT * FROM "GA4"."GA4_OBFUSCATED_SAMPLE_ECOMMERCE"."EVENTS_20201231"
  ) t
  WHERE t."EVENT_NAME" = 'session_start'
) sessions
GROUP BY "Channel"
ORDER BY "Number_of_Sessions" DESC NULLS LAST;