WITH all_events AS (
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180801
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180802
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180803
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180804
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180805
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180806
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180807
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180808
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180809
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180810
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180811
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180812
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180813
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180814
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180815
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180816
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180817
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180818
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180819
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180820
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180821
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180822
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180823
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180824
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180825
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180826
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180827
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180828
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180829
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180830
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180831
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180901
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180902
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180903
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180904
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180905
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180906
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180907
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180908
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180909
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180910
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180911
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180912
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180913
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180914
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180915
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180916
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180917
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180918
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180919
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180920
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180921
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180922
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180923
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180924
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180925
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180926
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180927
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180928
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180929
    UNION ALL
    SELECT "user_pseudo_id", "event_name", "event_timestamp"
    FROM FIREBASE.ANALYTICS_153293282.EVENTS_20180930
),
installed_users AS (
    SELECT "user_pseudo_id", MIN("event_timestamp") AS "install_timestamp"
    FROM all_events
    WHERE "event_name" = 'first_open'
    GROUP BY "user_pseudo_id"
    HAVING "install_timestamp" BETWEEN 1533081600000000 AND 1538352000000000
),
uninstall_events AS (
    SELECT "user_pseudo_id", MIN("event_timestamp") AS "uninstall_timestamp"
    FROM all_events
    WHERE "event_name" = 'app_remove'
    GROUP BY "user_pseudo_id"
)
SELECT 
    ROUND(
        (COUNT(CASE 
            WHEN ("uninstall_timestamp" IS NULL) OR 
                 (("uninstall_timestamp" - "install_timestamp") > 7 * 24 * 60 * 60 * 1000000)
            THEN 1 END) * 100.0) / COUNT(*),
        4
    ) AS "Percentage_of_users"
FROM installed_users iu
LEFT JOIN uninstall_events ue
ON iu."user_pseudo_id" = ue."user_pseudo_id";