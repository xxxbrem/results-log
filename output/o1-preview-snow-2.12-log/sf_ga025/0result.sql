SELECT
    (COUNT(DISTINCT CASE WHEN u."experienced_crash" = 1 THEN u."user_pseudo_id" END) * 100.0) /
    COUNT(DISTINCT u."user_pseudo_id") AS "Percentage_of_users_who_experienced_crash"
FROM
(
    SELECT
        "user_pseudo_id",
        MIN(CASE WHEN "event_name" = 'first_open' AND "event_date" BETWEEN '20180901' AND '20180930' THEN "event_timestamp" END) AS "first_open_ts",
        MIN(CASE WHEN "event_name" = 'app_remove' THEN "event_timestamp" END) AS "app_remove_ts",
        MAX(CASE WHEN "event_name" = 'app_exception' THEN 1 ELSE 0 END) AS "experienced_crash"
    FROM
    (
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180901" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180902" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180903" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180904" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180905" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180906" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180907" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180908" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180909" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180910" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180911" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180912" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180913" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180914" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180915" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180916" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180917" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180918" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180919" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180920" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180921" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180922" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180923" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180924" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180925" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180926" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180927" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180928" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180929" UNION ALL
        SELECT * FROM "FIREBASE"."ANALYTICS_153293282"."EVENTS_20180930"
    ) e
    WHERE
        ("event_name" = 'first_open' AND "event_date" BETWEEN '20180901' AND '20180930')
        OR "event_name" = 'app_remove'
        OR "event_name" = 'app_exception'
    GROUP BY
        "user_pseudo_id"
) u
WHERE
    u."first_open_ts" IS NOT NULL
    AND u."app_remove_ts" IS NOT NULL
    AND DATEDIFF('day', TO_TIMESTAMP_NTZ(u."first_open_ts" / 1000000), TO_TIMESTAMP_NTZ(u."app_remove_ts" / 1000000)) <= 7;