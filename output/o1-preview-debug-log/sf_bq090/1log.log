2025-01-16 07:24:10 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:27:52 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:27:52 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:27:52 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:27:52 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:27:54 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:27:54 - snowflake.connector.connection - INFO - closed
2025-01-16 07:27:54 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:28:25 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:28:25 - root - INFO - ```sql
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING IS NOT NULL
  AND f.value:"Strategy"::STRING != ''
LIMIT 1000;
```
2025-01-16 07:28:25 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:28:25 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:28:25 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:28:27 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:28:27 - snowflake.connector.connection - INFO - closed
2025-01-16 07:28:27 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:30:27 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:30:27 - root - INFO - ```sql
SELECT DISTINCT f.value::STRING AS "SidesValue"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f
LIMIT 1000;
```
2025-01-16 07:30:27 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:30:27 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:30:27 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:30:29 - snowflake.connector.cursor - INFO - Number of results in first chunk: 617
2025-01-16 07:30:30 - snowflake.connector.connection - INFO - closed
2025-01-16 07:30:30 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:30:30 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""

2025-01-16 07:30:30 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:30:30 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:30:30 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:30:32 - snowflake.connector.cursor - INFO - Number of results in first chunk: 2
2025-01-16 07:30:32 - snowflake.connector.connection - INFO - closed
2025-01-16 07:30:32 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:30:32 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG

2025-01-16 07:30:32 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:30:32 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:30:32 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:30:34 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:30:34 - snowflake.connector.connection - INFO - closed
2025-01-16 07:30:34 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:32:08 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:32:08 - root - INFO - ```sql
SELECT DISTINCT p.value:"PartyID"::STRING AS "PartyID"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
LIMIT 1000;
```
2025-01-16 07:32:08 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:32:08 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:32:08 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:32:10 - snowflake.connector.cursor - INFO - Number of results in first chunk: 9
2025-01-16 07:32:10 - snowflake.connector.connection - INFO - closed
2025-01-16 07:32:10 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:32:10 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ

2025-01-16 07:32:10 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:32:10 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:32:10 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:32:12 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:32:12 - snowflake.connector.connection - INFO - closed
2025-01-16 07:32:12 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:32:49 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:32:49 - root - INFO - ```sql
SELECT t."TradeDate",
       t."Symbol",
       t."StrikePrice",
       t."LastPx",
       t."Quantity",
       t."Sides":"Side"::STRING AS "Side",
       p.value:"PartyID"::STRING AS "PartyID",
       CASE
         WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%' THEN 'feeling-lucky'
         WHEN p.value:"PartyID"::STRING LIKE 'MOMO%' THEN 'momentum'
         ELSE 'other'
       END AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides":"PartyIDs") p
WHERE t."Sides":"Side"::STRING = 'LONG'
  AND (p.value:"PartyID"::STRING LIKE 'LUCKY%' OR p.value:"PartyID"::STRING LIKE 'MOMO%')
LIMIT 1000;
```

This query extracts the necessary data to calculate the average intrinsic value for trades using the **feeling-lucky** and **momentum** strategies under **long-side trades**. It accesses the `"Sides"` column directly (since it's a VARIANT object) and drills down into the `"PartyIDs"` array to retrieve the `"PartyID"`. The `"Strategy"` is inferred from the `"PartyID"` by checking if it starts with `'LUCKY'` or `'MOMO'`.
2025-01-16 07:32:49 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:32:49 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:32:49 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:32:50 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:32:50 - snowflake.connector.connection - INFO - closed
2025-01-16 07:32:51 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:33:50 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:33:50 - root - INFO - ```sql
SELECT
  (AVG(CASE WHEN f.value:"Side"::STRING = 'LONG'
             AND p.value:"PartyID"::STRING LIKE 'LUCKY%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN f.value:"Side"::STRING = 'LONG'
             AND p.value:"PartyID"::STRING LIKE 'MOMO%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") p;
```

This query calculates the difference between the average intrinsic values for trades using the **feeling-lucky** strategy (identified by `PartyID` starting with `'LUCKY'`) and those using the **momentum** strategy (identified by `PartyID` starting with `'MOMO'`) under **long-side trades** (`"Side"` equals `'LONG'`).

The intrinsic value is computed as `GREATEST(t."LastPx" - t."StrikePrice", 0)` for each trade. The `AVG` functions calculate the average intrinsic values for each strategy, and the difference is obtained by subtracting the averages.

Note: Since we don't have the actual data, the result will be a numerical value representing the positive difference (`value:float > 0`).
2025-01-16 07:33:50 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:33:50 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:33:50 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:33:51 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:33:51 - snowflake.connector.connection - INFO - closed
2025-01-16 07:33:51 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:33:52 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753

2025-01-16 07:33:52 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:33:52 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:33:52 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:33:53 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:33:53 - snowflake.connector.connection - INFO - closed
2025-01-16 07:33:53 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:34:37 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:34:37 - root - INFO - ```sql
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL;
```
2025-01-16 07:34:37 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:34:37 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:34:37 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:34:39 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:34:39 - snowflake.connector.connection - INFO - closed
2025-01-16 07:34:39 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:34:39 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529

2025-01-16 07:34:39 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:34:39 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:34:39 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:34:41 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:34:41 - snowflake.connector.connection - INFO - closed
2025-01-16 07:34:41 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:36:17 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:36:17 - root - INFO - ```sql
SELECT
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Lucky",
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Momo",
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END)
  -
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND (p.value:"PartyID"::STRING LIKE 'LUCKY%' OR p.value:"PartyID"::STRING LIKE 'MOMO%');
```
2025-01-16 07:36:17 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:36:17 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:36:17 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:36:19 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:36:19 - snowflake.connector.connection - INFO - closed
2025-01-16 07:36:19 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:36:20 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529

2025-01-16 07:36:20 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:36:20 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:36:20 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:36:21 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:36:21 - snowflake.connector.connection - INFO - closed
2025-01-16 07:36:21 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:03 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:37:03 - root - INFO - ```sql
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN t."LastPx" - t."StrikePrice"
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN t."LastPx" - t."StrikePrice"
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."LastPx" IS NOT NULL AND t."StrikePrice" IS NOT NULL;
```
2025-01-16 07:37:03 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:03 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:03 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:37:05 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:37:05 - snowflake.connector.connection - INFO - closed
2025-01-16 07:37:05 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:05 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217

2025-01-16 07:37:05 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:05 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:05 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:37:06 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1000
2025-01-16 07:37:06 - snowflake.connector.connection - INFO - closed
2025-01-16 07:37:06 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:07 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140

2025-01-16 07:37:07 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:07 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:07 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:37:08 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:37:08 - snowflake.connector.connection - INFO - closed
2025-01-16 07:37:08 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:09 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX

2025-01-16 07:37:09 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:09 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:09 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:37:10 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:37:10 - snowflake.connector.connection - INFO - closed
2025-01-16 07:37:10 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:56 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:37:56 - root - INFO - ```sql
SELECT
  AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Momentum",
  (AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
        END) -
   AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
        END)) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") f2
WHERE f.value:"Side"::STRING = 'LONG'
  AND t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND (f2.value:"PartyID"::STRING LIKE 'LUCKY%' OR f2.value:"PartyID"::STRING LIKE 'MOMO%')
LIMIT 1000;
```

This query calculates the average intrinsic values for trades using the **feeling-lucky** strategy and the **momentum** strategy under **long-side trades**, and computes the difference between these averages.

- **Inference of Strategy**: Since the `"Strategy"` field is not present, we infer the strategy from the `"PartyID"`:
  - `PartyID` starting with `'LUCKY'` indicates the **feeling-lucky** strategy.
  - `PartyID` starting with `'MOMO'` indicates the **momentum** strategy.

- **Intrinsic Value Calculation**: The intrinsic value for each trade is calculated as `GREATEST(t."LastPx" - t."StrikePrice", 0)`.

- **Conditions Applied**:
  - Only trades where `"Side"` is `'LONG'` (long-side trades).
  - Both `"StrikePrice"` and `"LastPx"` are not null.
  - `PartyID` is either starting with `'LUCKY'` or `'MOMO'`.

- **Components of the Query**:
  - **LATERAL FLATTEN** is used twice:
    - To flatten the `"Sides"` column (`f`) which is a VARIANT containing the side details.
    - To flatten the `"PartyIDs"` array within `"Sides"` (`f2`) to access individual `"PartyID"` entries.

- **Selected Columns**:
  - `"Avg_FeelingLucky"`: Average intrinsic value for the feeling-lucky strategy.
  - `"Avg_Momentum"`: Average intrinsic value for the momentum strategy.
  - `"difference"`: The difference between the two averages (`Avg_FeelingLucky - Avg_Momentum`).

**Note**: Since the actual data is not available, executing this query may still return no data if there are no matching records. However, this query adjusts for empty columns and infers the strategy from the available `"PartyID"` data, as per the previous results and feedback.
2025-01-16 07:37:56 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:56 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:56 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:37:58 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:37:58 - snowflake.connector.connection - INFO - closed
2025-01-16 07:37:58 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:37:58 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753

2025-01-16 07:37:58 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:37:58 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:37:58 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:38:00 - snowflake.connector.cursor - INFO - Number of results in first chunk: 2
2025-01-16 07:38:00 - snowflake.connector.connection - INFO - closed
2025-01-16 07:38:00 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:38:00 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Results:
Side,TradeCount
SHORT,443312
LONG,779250

2025-01-16 07:38:00 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:38:00 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:38:00 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:38:02 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:38:02 - snowflake.connector.connection - INFO - closed
2025-01-16 07:38:02 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:39:02 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:39:02 - root - INFO - ```sql
SELECT
  f.value:"Side"::STRING AS "Side",
  f2.value:"PartyID"::STRING AS "PartyID",
  COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") f2
WHERE f2.value:"PartyID"::STRING LIKE 'LUCKY%'
   OR f2.value:"PartyID"::STRING LIKE 'MOMO%'
GROUP BY f.value:"Side"::STRING, f2.value:"PartyID"::STRING
LIMIT 1000;
```
2025-01-16 07:39:02 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:39:02 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:39:02 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:39:03 - snowflake.connector.cursor - INFO - Number of results in first chunk: 10
2025-01-16 07:39:03 - snowflake.connector.connection - INFO - closed
2025-01-16 07:39:04 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:39:04 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Results:
Side,TradeCount
SHORT,443312
LONG,779250
SQL:
-- 12. Calculate average "LastPx" per strategy under long-side trades
SELECT f.value:"Strategy"::STRING AS "Strategy",
       AVG(t."LastPx") AS "AverageLastPx"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Side,PartyID,TradeCount
LONG,MOMOES,72274
LONG,MOMONQ,66229
LONG,LUCKYES,69558
SHORT,LUCKYNQ,96036
SHORT,MOMOBTC,26485
LONG,LUCKYBTC,65825
SHORT,LUCKYES,69238
SHORT,LUCKYBTC,65331
LONG,LUCKYNQ,95495
LONG,MOMOBTC,28325

2025-01-16 07:39:04 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:39:04 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:39:04 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:39:06 - snowflake.connector.cursor - INFO - Number of results in first chunk: 264
2025-01-16 07:39:07 - snowflake.connector.connection - INFO - closed
2025-01-16 07:39:07 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:39:07 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Results:
Side,TradeCount
SHORT,443312
LONG,779250
SQL:
-- 12. Calculate average "LastPx" per strategy under long-side trades
SELECT f.value:"Strategy"::STRING AS "Strategy",
       AVG(t."LastPx") AS "AverageLastPx"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Side,PartyID,TradeCount
LONG,MOMOES,72274
LONG,MOMONQ,66229
LONG,LUCKYES,69558
SHORT,LUCKYNQ,96036
SHORT,MOMOBTC,26485
LONG,LUCKYBTC,65825
SHORT,LUCKYES,69238
SHORT,LUCKYBTC,65331
LONG,LUCKYNQ,95495
LONG,MOMOBTC,28325
SQL:
-- 13. Retrieve trades with non-null "StrikePrice" and "LastPx" for calculations
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "StrikePrice" IS NOT NULL AND "LastPx" IS NOT NULL
LIMIT 1000
Results:
Too long, hard cut:
SendingTime,TargetCompID,SenderCompID,Symbol,Quantity,OrderID,TransactTime,StrikePrice,LastPx,MaturityDate,TradeReportID,TradeDate,CFICode,Sides
1589822606000000,MOMOES-COMPID,MDOC,ESM0,1,d8eefa63-6f10-4566-8f15-81460448f2ac,1589822606393000,2953.125,2953.125,1589822666393000,d8eefa63-6f10-4566-8f15-81460448f2ac-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""d8eefa63-6f10-4566-8f15-81460448f2ac"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589822759000000,MOMOES-COMPID,MDOC,ESM0,1,7fa78bef-912c-41cb-b381-4c03b5a7c508,1589822759485000,2952.375,2952.375,1589822819485000,7fa78bef-912c-41cb-b381-4c03b5a7c508-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""7fa78bef-912c-41cb-b381-4c03b5a7c508"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823190000000,MOMOES-COMPID,MDOC,ESM0,1,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520,1589823190485000,2952.625,2953.375,1589823250485000,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""5a4c4d8b-b9b8-4307-a0c3-8c753ed93520"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823579000000,MOMOES-COMPID,MDOC,ESM0,1,a204ef77-1071-48ee-a5f5-21579311cd91,1589823580341000,2953.125,2952.625,1589823640341000,a204ef77-1071-48ee-a5f5-21579311cd91-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""a204ef77-1071-48ee-a5f5-21579311cd91"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824125000000,MOMOES-COMPID,MDOC,ESM0,1,b7a40778-7293-407b-8636-91a7ffe9817a,1589824125471000,2952.375,2953.625,1589824185471000,b7a40778-7293-407b-8636-91a7ffe9817a-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""b7a40778-7293-407b-8636-91a7ffe9817a"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824697000000,MOMOES-COMPID,MDOC,ESM0,1,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b,1589824697706000,2952.375,2953.125,1589824757706000,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""c67a3f6a-7253-4ec8-91be-a4a3f07aa27b"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825153000000,MOMOES-COMPID,MDOC,ESM0,1,83e09901-1182-4ad0-b423-0f92bf78a7a2,1589825153655000,2953.875,2955.375,1589825213655000,83e09901-1182-4ad0-b423-0f92bf78a7a2-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""83e09901-1182-4ad0-b423-0f92bf78a7a2"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825732000000,MOMOES-COMPID,MDOC,ESM0,1,8161e8ff-9aa3-4e27-9322-363a4a063a27,1589825732562000,2953.625,2953.875,1589825792562000,8161e8ff-9aa3-4e27-9322-363a4a063a27-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8161e8ff-9aa3-4e27-9322-363a4a063a27"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825809000000,MOMOES-COMPID,MDOC,ESM0,1,2e2c0922-e696-44f6-899e-9112f6129088,1589825809693000,2953.125,2953.625,1589825869693000,2e2c0922-e696-44f6-899e-9112f6129088-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""2e2c0922-e696-44f6-899e-9112f6129088"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825916000000,MOMOES-COMPID,MDOC,ESM0,1,8afcaa49-daca-470f-9479-6bfd2c648ccf,1589825917197000,2952.125,2952.625,1589825977197000,8afcaa49-daca-470f-9479-6bfd2c648ccf-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8afcaa49-daca-470f-9479-6bfd2c648ccf"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589826251000000,MOMOES-COMPID,MDOC,ESM0,1,4e25aae7-5b30-408a-a23e-ea3afb86c445,1589826252341000,2951.125,2952.625,1589826312341000,4e25aae7-5b30-408a-a23e-ea3afb86c445-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""4e25aae7-5b30-408a-a23e-ea3afb86c445"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRo

2025-01-16 07:39:07 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:39:07 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:39:07 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:39:09 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:39:09 - snowflake.connector.connection - INFO - closed
2025-01-16 07:39:09 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:40:15 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:40:15 - root - INFO - ```sql
SELECT
  AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_Momentum",
  (
    AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
    -
    AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
  ) AS "difference"
FROM
  "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
  LATERAL FLATTEN(INPUT => t."Sides") f
WHERE
  t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
LIMIT 1000;
```
2025-01-16 07:40:15 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:40:15 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:40:15 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:40:17 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:40:17 - snowflake.connector.connection - INFO - closed
2025-01-16 07:40:17 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:40:18 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Results:
Side,TradeCount
SHORT,443312
LONG,779250
SQL:
-- 12. Calculate average "LastPx" per strategy under long-side trades
SELECT f.value:"Strategy"::STRING AS "Strategy",
       AVG(t."LastPx") AS "AverageLastPx"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Side,PartyID,TradeCount
LONG,MOMOES,72274
LONG,MOMONQ,66229
LONG,LUCKYES,69558
SHORT,LUCKYNQ,96036
SHORT,MOMOBTC,26485
LONG,LUCKYBTC,65825
SHORT,LUCKYES,69238
SHORT,LUCKYBTC,65331
LONG,LUCKYNQ,95495
LONG,MOMOBTC,28325
SQL:
-- 13. Retrieve trades with non-null "StrikePrice" and "LastPx" for calculations
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "StrikePrice" IS NOT NULL AND "LastPx" IS NOT NULL
LIMIT 1000
Results:
Too long, hard cut:
SendingTime,TargetCompID,SenderCompID,Symbol,Quantity,OrderID,TransactTime,StrikePrice,LastPx,MaturityDate,TradeReportID,TradeDate,CFICode,Sides
1589822606000000,MOMOES-COMPID,MDOC,ESM0,1,d8eefa63-6f10-4566-8f15-81460448f2ac,1589822606393000,2953.125,2953.125,1589822666393000,d8eefa63-6f10-4566-8f15-81460448f2ac-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""d8eefa63-6f10-4566-8f15-81460448f2ac"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589822759000000,MOMOES-COMPID,MDOC,ESM0,1,7fa78bef-912c-41cb-b381-4c03b5a7c508,1589822759485000,2952.375,2952.375,1589822819485000,7fa78bef-912c-41cb-b381-4c03b5a7c508-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""7fa78bef-912c-41cb-b381-4c03b5a7c508"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823190000000,MOMOES-COMPID,MDOC,ESM0,1,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520,1589823190485000,2952.625,2953.375,1589823250485000,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""5a4c4d8b-b9b8-4307-a0c3-8c753ed93520"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823579000000,MOMOES-COMPID,MDOC,ESM0,1,a204ef77-1071-48ee-a5f5-21579311cd91,1589823580341000,2953.125,2952.625,1589823640341000,a204ef77-1071-48ee-a5f5-21579311cd91-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""a204ef77-1071-48ee-a5f5-21579311cd91"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824125000000,MOMOES-COMPID,MDOC,ESM0,1,b7a40778-7293-407b-8636-91a7ffe9817a,1589824125471000,2952.375,2953.625,1589824185471000,b7a40778-7293-407b-8636-91a7ffe9817a-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""b7a40778-7293-407b-8636-91a7ffe9817a"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824697000000,MOMOES-COMPID,MDOC,ESM0,1,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b,1589824697706000,2952.375,2953.125,1589824757706000,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""c67a3f6a-7253-4ec8-91be-a4a3f07aa27b"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825153000000,MOMOES-COMPID,MDOC,ESM0,1,83e09901-1182-4ad0-b423-0f92bf78a7a2,1589825153655000,2953.875,2955.375,1589825213655000,83e09901-1182-4ad0-b423-0f92bf78a7a2-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""83e09901-1182-4ad0-b423-0f92bf78a7a2"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825732000000,MOMOES-COMPID,MDOC,ESM0,1,8161e8ff-9aa3-4e27-9322-363a4a063a27,1589825732562000,2953.625,2953.875,1589825792562000,8161e8ff-9aa3-4e27-9322-363a4a063a27-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8161e8ff-9aa3-4e27-9322-363a4a063a27"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825809000000,MOMOES-COMPID,MDOC,ESM0,1,2e2c0922-e696-44f6-899e-9112f6129088,1589825809693000,2953.125,2953.625,1589825869693000,2e2c0922-e696-44f6-899e-9112f6129088-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""2e2c0922-e696-44f6-899e-9112f6129088"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825916000000,MOMOES-COMPID,MDOC,ESM0,1,8afcaa49-daca-470f-9479-6bfd2c648ccf,1589825917197000,2952.125,2952.625,1589825977197000,8afcaa49-daca-470f-9479-6bfd2c648ccf-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8afcaa49-daca-470f-9479-6bfd2c648ccf"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589826251000000,MOMOES-COMPID,MDOC,ESM0,1,4e25aae7-5b30-408a-a23e-ea3afb86c445,1589826252341000,2951.125,2952.625,1589826312341000,4e25aae7-5b30-408a-a23e-ea3afb86c445-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""4e25aae7-5b30-408a-a23e-ea3afb86c445"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRo
SQL:
-- 14. Get trade details for options (if "CFICode" indicates option instruments)
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "CFICode" LIKE '%O%'  -- Assuming 'O' indicates options in CFICode
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753

2025-01-16 07:40:18 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:40:18 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:40:18 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:40:19 - snowflake.connector.cursor - INFO - Number of results in first chunk: 0
2025-01-16 07:40:19 - snowflake.connector.connection - INFO - closed
2025-01-16 07:40:19 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:40:59 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:40:59 - root - INFO - ```sql
SELECT
  AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_Momentum",
  (
    AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
    -
    AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
  ) AS "difference"
FROM
  "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
  LATERAL FLATTEN(INPUT => t."Sides") s,
  LATERAL FLATTEN(INPUT => s.value:"PartyIDs") p
WHERE
  t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL;
```
2025-01-16 07:40:59 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:40:59 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:40:59 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:41:01 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:41:01 - snowflake.connector.connection - INFO - closed
2025-01-16 07:41:01 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:41:01 - root - INFO - SQL:
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
SQL:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Side
SHORT
LONG
SQL:
-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000
Results:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
SQL:
-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000
Results:
difference
-0.27640950080146753
SQL:
-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
-0.5685744671535529
SQL:
-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
SQL:
-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
difference
0.009200480030488217
SQL:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Results:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
SQL:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Results:
CFICode
MMMXXX
SQL:
-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Results:
Side,TradeCount
SHORT,443312
LONG,779250
SQL:
-- 12. Calculate average "LastPx" per strategy under long-side trades
SELECT f.value:"Strategy"::STRING AS "Strategy",
       AVG(t."LastPx") AS "AverageLastPx"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000
Results:
Side,PartyID,TradeCount
LONG,MOMOES,72274
LONG,MOMONQ,66229
LONG,LUCKYES,69558
SHORT,LUCKYNQ,96036
SHORT,MOMOBTC,26485
LONG,LUCKYBTC,65825
SHORT,LUCKYES,69238
SHORT,LUCKYBTC,65331
LONG,LUCKYNQ,95495
LONG,MOMOBTC,28325
SQL:
-- 13. Retrieve trades with non-null "StrikePrice" and "LastPx" for calculations
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "StrikePrice" IS NOT NULL AND "LastPx" IS NOT NULL
LIMIT 1000
Results:
Too long, hard cut:
SendingTime,TargetCompID,SenderCompID,Symbol,Quantity,OrderID,TransactTime,StrikePrice,LastPx,MaturityDate,TradeReportID,TradeDate,CFICode,Sides
1589822606000000,MOMOES-COMPID,MDOC,ESM0,1,d8eefa63-6f10-4566-8f15-81460448f2ac,1589822606393000,2953.125,2953.125,1589822666393000,d8eefa63-6f10-4566-8f15-81460448f2ac-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""d8eefa63-6f10-4566-8f15-81460448f2ac"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589822759000000,MOMOES-COMPID,MDOC,ESM0,1,7fa78bef-912c-41cb-b381-4c03b5a7c508,1589822759485000,2952.375,2952.375,1589822819485000,7fa78bef-912c-41cb-b381-4c03b5a7c508-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""7fa78bef-912c-41cb-b381-4c03b5a7c508"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823190000000,MOMOES-COMPID,MDOC,ESM0,1,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520,1589823190485000,2952.625,2953.375,1589823250485000,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""5a4c4d8b-b9b8-4307-a0c3-8c753ed93520"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823579000000,MOMOES-COMPID,MDOC,ESM0,1,a204ef77-1071-48ee-a5f5-21579311cd91,1589823580341000,2953.125,2952.625,1589823640341000,a204ef77-1071-48ee-a5f5-21579311cd91-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""a204ef77-1071-48ee-a5f5-21579311cd91"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824125000000,MOMOES-COMPID,MDOC,ESM0,1,b7a40778-7293-407b-8636-91a7ffe9817a,1589824125471000,2952.375,2953.625,1589824185471000,b7a40778-7293-407b-8636-91a7ffe9817a-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""b7a40778-7293-407b-8636-91a7ffe9817a"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824697000000,MOMOES-COMPID,MDOC,ESM0,1,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b,1589824697706000,2952.375,2953.125,1589824757706000,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""c67a3f6a-7253-4ec8-91be-a4a3f07aa27b"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825153000000,MOMOES-COMPID,MDOC,ESM0,1,83e09901-1182-4ad0-b423-0f92bf78a7a2,1589825153655000,2953.875,2955.375,1589825213655000,83e09901-1182-4ad0-b423-0f92bf78a7a2-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""83e09901-1182-4ad0-b423-0f92bf78a7a2"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825732000000,MOMOES-COMPID,MDOC,ESM0,1,8161e8ff-9aa3-4e27-9322-363a4a063a27,1589825732562000,2953.625,2953.875,1589825792562000,8161e8ff-9aa3-4e27-9322-363a4a063a27-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8161e8ff-9aa3-4e27-9322-363a4a063a27"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825809000000,MOMOES-COMPID,MDOC,ESM0,1,2e2c0922-e696-44f6-899e-9112f6129088,1589825809693000,2953.125,2953.625,1589825869693000,2e2c0922-e696-44f6-899e-9112f6129088-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""2e2c0922-e696-44f6-899e-9112f6129088"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825916000000,MOMOES-COMPID,MDOC,ESM0,1,8afcaa49-daca-470f-9479-6bfd2c648ccf,1589825917197000,2952.125,2952.625,1589825977197000,8afcaa49-daca-470f-9479-6bfd2c648ccf-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8afcaa49-daca-470f-9479-6bfd2c648ccf"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589826251000000,MOMOES-COMPID,MDOC,ESM0,1,4e25aae7-5b30-408a-a23e-ea3afb86c445,1589826252341000,2951.125,2952.625,1589826312341000,4e25aae7-5b30-408a-a23e-ea3afb86c445-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""4e25aae7-5b30-408a-a23e-ea3afb86c445"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRo
SQL:
-- 14. Get trade details for options (if "CFICode" indicates option instruments)
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "CFICode" LIKE '%O%'  -- Assuming 'O' indicates options in CFICode
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
SQL:
-- 15. Extract quantities and prices for calculation of intrinsic value
SELECT t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING IN ('feeling-lucky', 'momentum')
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000
Results:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753

2025-01-16 07:41:01 - root - INFO - itercount: 0
2025-01-16 07:41:01 - root - INFO - Database Name: CYMBAL_INVESTMENTS
Schema Name: CYMBAL_INVESTMENTS
DDL describes table information.
,0
table_name,TRADE_CAPTURE_REPORT
description,
DDL,"create or replace TABLE TRADE_CAPTURE_REPORT (
	""SendingTime"" NUMBER(38,0),
	""TargetCompID"" VARCHAR(16777216),
	""SenderCompID"" VARCHAR(16777216),
	""Symbol"" VARCHAR(16777216),
	""Quantity"" NUMBER(38,0),
	""OrderID"" VARCHAR(16777216),
	""TransactTime"" NUMBER(38,0),
	""StrikePrice"" FLOAT,
	""LastPx"" FLOAT,
	""MaturityDate"" NUMBER(38,0),
	""TradeReportID"" VARCHAR(16777216),
	""TradeDate"" DATE,
	""CFICode"" VARCHAR(16777216),
	""Sides"" VARIANT
);"

External knowledge that might be helpful: 
None
The table structure information is ({database name: {schema name: {table name}}}): 
{'CYMBAL_INVESTMENTS': {'CYMBAL_INVESTMENTS': ['TRADE_CAPTURE_REPORT']}}
Begin Exploring Related Columns
Columns and potential usages:

- **"Sides"**: Contains trade side details; potentially includes `"Side"` (e.g., 'long', 'short') and `"Strategy"` (e.g., 'feeling-lucky', 'momentum'). Critical for identifying the trade strategy and whether it's a long-side trade.
- **"LastPx"**: The trade price; may be used in calculating the intrinsic value.
- **"StrikePrice"**: The strike price; used in calculating intrinsic value for options.
- **"Quantity"**: The quantity traded; needed for calculating total values.
- **"CFICode"**: Financial instrument code; may indicate instrument type (e.g., option, equity).
- **"Symbol"**: Instrument symbol; may be useful for context or additional filtering.

Conditions that may be used:

- **Strategy Filter**: Trades where `"Strategy"` is `'feeling-lucky'` or `'momentum'`.
- **Side Filter**: Trades where `"Side"` is `'long'` (long-side trades).

Here are the SQL queries:

```sql
-- 1. Retrieve distinct strategies from the "Sides" column
SELECT DISTINCT f.value:"Strategy"::STRING AS "Strategy"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000;

-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000;

-- 3. Retrieve all trades using the "feeling-lucky" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
LIMIT 1000;

-- 4. Retrieve all trades using the "momentum" strategy
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
LIMIT 1000;

-- 5. Retrieve all long-side trades
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
LIMIT 1000;

-- 6. Retrieve "feeling-lucky" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'feeling-lucky'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000;

-- 7. Retrieve "momentum" strategy trades under long-side
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING = 'momentum'
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000;

-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000;

-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000;

-- 10. Get counts of trades per strategy
SELECT f.value:"Strategy"::STRING AS "Strategy",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000;

-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000;

-- 12. Calculate average "LastPx" per strategy under long-side trades
SELECT f.value:"Strategy"::STRING AS "Strategy",
       AVG(t."LastPx") AS "AverageLastPx"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Side"::STRING = 'long'
GROUP BY f.value:"Strategy"::STRING
LIMIT 1000;

-- 13. Retrieve trades with non-null "StrikePrice" and "LastPx" for calculations
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "StrikePrice" IS NOT NULL AND "LastPx" IS NOT NULL
LIMIT 1000;

-- 14. Get trade details for options (if "CFICode" indicates option instruments)
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "CFICode" LIKE '%O%'  -- Assuming 'O' indicates options in CFICode
LIMIT 1000;

-- 15. Extract quantities and prices for calculation of intrinsic value
SELECT t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
WHERE f.value:"Strategy"::STRING IN ('feeling-lucky', 'momentum')
  AND f.value:"Side"::STRING = 'long'
LIMIT 1000;
```

These queries are designed to explore the relevant data in the `TRADE_CAPTURE_REPORT` table, focusing on the strategies, sides, and pricing information necessary to calculate the average intrinsic values for the specified trades.Query:
SELECT DISTINCT f.value::STRING AS "SidesValue"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f
LIMIT 1000;
Answer:
Too long, hard cut:
SidesValue
"{""OrderID"":""0e4b7434-0da6-480a-83a0-5481c3ca8a60"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""a265dc44-4d01-4e2f-8a8a-54ceca9e6ea8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7805b66c-6df7-4d13-8936-fd41302d9c42"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""be539c12-3421-4108-b478-8d567a6c95c6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""0a7e4430-86c5-46fb-bf32-d72248b646ac"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""7511996a-893f-41a3-9d29-0d2219a372f8"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""71035bb1-1c1a-43bc-97cb-31445a6b9490"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4860dd01-82cf-4c47-a2cf-ac57dd0c98b2"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""75c8a1b1-50a5-4155-be79-e4908b0ed544"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""e00bc0bc-5193-4f88-910a-e5d375f3c519"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""962b0c32-150a-433f-9e74-e3c82e17a3f6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""091bbb71-05ba-4404-b180-1fc805b531e6"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6a9422e6-f9d7-40d8-a0e4-c79322cda30d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""6501ebcd-56e2-427d-82fd-7e6596adcc48"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""44958d40-c81e-4cb5-af35-1ab5e127a99c"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""bf7b6196-54b7-45a8-8bed-fa4dcca8da67"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""215011c1-5fbd-4dc2-a86b-cbc2660f87b3"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""330b7ad5-25fd-4851-96e0-1e58aa073a49"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""31b39891-89c1-46f0-ba7a-c82d2b262398"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""5f315aaa-5041-4f44-9080-7bd0aad6dbb5"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""3234fea2-cfaa-4db0-aa44-f664287cfaa9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""f0cf085b-9c29-4ce8-a193-e841c6912b62"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""d63986d9-b858-49f7-9f4f-0a0328089431"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""4bcf2662-377e-4ee6-a978-7698c0e6633b"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""390f66d1-6061-4c8a-8857-58758a38dd86"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""2600bb2b-4033-421c-8c89-131eb4c03cb9"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE"",""PartyRole"":""INITIATING TRADER""}],""Side"":""SHORT""}"
"{""OrderID"":""c75fe2a0-6fe7-4bd1-8381-53ffd6265b5d"",""PartyIDs"":[{""PartyID"":""PREDICTNQ"",""PartyIDSource"":""PROP CODE""
Query:
-- 2. Retrieve distinct sides (long/short) from the "Sides" column
SELECT DISTINCT f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Answer:
Side
SHORT
LONG
Query:
SELECT DISTINCT p.value:"PartyID"::STRING AS "PartyID"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
LIMIT 1000;
Answer:
PartyID
LUCKYBTC
PREDICTES
LUCKYES
MOMOBTC
MOMONQ
PREDICTBTC
PREDICTNQ
MOMOES
LUCKYNQ
Query:
SELECT
  (AVG(CASE WHEN f.value:"Side"::STRING = 'LONG'
             AND p.value:"PartyID"::STRING LIKE 'LUCKY%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN f.value:"Side"::STRING = 'LONG'
             AND p.value:"PartyID"::STRING LIKE 'MOMO%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") p;
Answer:
difference
-0.27640950080146753
Query:
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
             AND t."StrikePrice" IS NOT NULL
             AND t."LastPx" IS NOT NULL
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL;
Answer:
difference
-0.5685744671535529
Query:
SELECT
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Lucky",
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Momo",
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END)
  -
  AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND (p.value:"PartyID"::STRING LIKE 'LUCKY%' OR p.value:"PartyID"::STRING LIKE 'MOMO%');
Answer:
Avg_Lucky,Avg_Momo,difference
1.0093917327398843,1.5779661998934371,-0.5685744671535529
Query:
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN t."LastPx" - t."StrikePrice"
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN t."LastPx" - t."StrikePrice"
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") f,
     LATERAL FLATTEN(INPUT => f.value:"PartyIDs") p
WHERE t."LastPx" IS NOT NULL AND t."StrikePrice" IS NOT NULL;
Answer:
difference
0.009200480030488217
Query:
-- 8. Extract trade details with strategy and side information
SELECT t."TradeDate", t."Symbol", t."Quantity", t."StrikePrice", t."LastPx",
       f.value:"Strategy"::STRING AS "Strategy",
       f.value:"Side"::STRING AS "Side"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
LIMIT 1000
Answer:
Too long, hard cut:
TradeDate,Symbol,Quantity,StrikePrice,LastPx,Strategy,Side
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.0,11502.0,,SHORT
2020-09-07,NQU0,1,11502.125,11502.75,,SHORT
2020-09-07,NQU0,1,11532.75,11525.0,,SHORT
2020-09-07,NQU0,1,11529.375,11531.375,,SHORT
2020-09-07,NQU0,1,11527.875,11528.625,,SHORT
2020-09-07,NQU0,1,11528.75,11528.25,,SHORT
2020-09-07,NQU0,1,11532.75,11529.0,,SHORT
2020-09-07,NQU0,1,11573.5,11570.375,,SHORT
2020-09-07,NQU0,1,11569.125,11565.875,,SHORT
2020-09-07,NQU0,1,11582.75,11580.5,,SHORT
2020-09-07,NQU0,1,11579.875,11580.75,,SHORT
2020-09-07,NQU0,1,11579.0,11571.375,,SHORT
2020-09-07,NQU0,1,11559.625,11564.625,,SHORT
2020-09-07,NQU0,1,11555.75,11558.125,,SHORT
2020-09-07,NQU0,1,11554.875,11552.75,,SHORT
2020-09-07,NQU0,1,11553.625,11551.625,,SHORT
2020-09-07,NQU0,1,11564.625,11554.0,,SHORT
2020-09-07,NQU0,1,11558.25,11554.375,,SHORT
2020-09-08,NQU0,1,11550.75,11552.75,,SHORT
2020-09-08,NQU0,1,11548.125,11544.625,,SHORT
2020-09-08,NQU0,1,11537.125,11536.5,,SHORT
2020-09-08,NQU0,1,11536.875,11536.25,,SHORT
2020-09-08,NQU0,1,11536.75,11537.375,,SHORT
2020-09-08,NQU0,1,11541.0,11543.375,,SHORT
2020-09-08,NQU0,1,11539.375,11540.75,,SHORT
2020-09-08,NQU0,1,11538.875,11536.5,,SHORT
2020-09-08,NQU0,1,11526.875,11526.75,,SHORT
2020-09-08,NQU0,1,11526.75,11530.125,,SHORT
2020-09-08,NQU0,1,11533.625,11541.0,,SHORT
2020-09-08,NQU0,1,11527.375,11528.125,,SHORT
2020-09-08,NQU0,1,11535.0,11528.875,,SHORT
2020-09-08,NQU0,1,11537.5,11541.75,,SHORT
2020-09-08,NQU0,1,11533.625,11535.5,,SHORT
2020-09-08,NQU0,1,11535.875,11533.125,,SHORT
2020-09-08,NQU0,1,11533.5,11533.375,,SHORT
2020-09-08,NQU0,1,11543.25,11537.625,,SHORT
2020-09-08,NQU0,1,11559.875,11563.0,,SHORT
2020-09-08,NQU0,1,11563.625,11564.0,,SHORT
2020-09-08,NQU0,1,11556.375,11555.125,,SHORT
2020-09-08,NQU0,1,11553.375,11558.875,,SHORT
2020-09-08,NQU0,1,11525.625,11528.875,,SHORT
2020-09-08,NQU0,1,11525.875,11528.875,,SHORT
2020-09-08,NQU0,1,11479.625,11495.25,,SHORT
2020-09-08,NQU0,1,11487.5,11490.0,,SHORT
2020-09-08,NQU0,1,11486.375,11491.625,,SHORT
2020-09-08,NQU0,1,11488.375,11484.125,,SHORT
2020-09-08,NQU0,1,11483.25,11486.75,,SHORT
2020-09-08,NQU0,1,11482.75,11486.375,,SHORT
2020-09-08,NQU0,1,11490.375,11490.5,,SHORT
2020-09-08,NQU0,1,11479.125,11485.875,,SHORT
2020-09-08,NQU0,1,11495.875,11496.0,,SHORT
2020-09-08,NQU0,1,11489.75,11495.25,,SHORT
2020-09-08,NQU0,1,11491.625,11490.0,,SHORT
2020-09-08,NQU0,1,11491.375,11490.625,,SHORT
2020-09-08,NQU0,1,11494.125,11490.875,,SHORT
2020-09-08,NQU0,1,11498.625,11500.125,,SHORT
2020-09-08,NQU0,1,11499.25,11499.125,,SHORT
2020-09-08,NQU0,1,11498.125,11501.0,,SHORT
2020-09-08,NQU0,1,11493.75,11494.625,,SHORT
2020-09-08,NQU0,1,11506.75,11500.875,,SHORT
2020-09-08,NQU0,1,11502.0,11505.75,,SHORT
2020-09-08,NQU0,1,11494.875,11493.5,,SHORT
2020-09-08,NQU0,1,11499.75,11500.75,,SHORT
2020-09-08,NQU0,1,11508.5,11500.625,,SHORT
2020-09-08,NQU0,1,11504.125,11504.625,,SHORT
2020-09-08,NQU0,1,11517.25,11512.25,,SHORT
2020-09-08,NQU0,1,11524.5,11527.625,,SHORT
2020-09-08,NQU0,1,11518.5,11518.75,,SHORT
2020-09-08,NQU0,1,11546.125,11545.625,,SHORT
2020-09-08,NQU0,1,11558.125,11562.875,,SHORT
2020-09-08,NQU0,1,11553.5,11549.875,,SHORT
2020-09-08,NQU0,1,11549.75,11550.75,,SHORT
2020-09-08,NQU0,1,11551.0,11550.375,,SHORT
2020-09-08,NQU0,1,11551.125,11546.625,,SHORT
2020-09-08,NQU0,1,11548.75,11550.25,,SHORT
2020-09-08,NQU0,1,11557.875,11557.25,,SHORT
2020-09-08,NQU0,1,11557.0,11559.5,,SHORT
2020-09-08,NQU0,1,11555.625,11555.375,,SHORT
2020-09-08,NQU0,1,11550.25,11550.625,,SHORT
2020-09-08,NQU0,1,11537.625,11547.875,,SHORT
2020-09-08,NQU0,1,11537.25,11535.75,,SHORT
2020-09-08,NQU0,1,11533.875,11533.875,,SHORT
2020-09-08,NQU0,1,11520.25,11515.5,,SHORT
2020-09-08,NQU0,1,11522.75,11524.875,,SHORT
2020-09-08,NQU0,1,11520.25,11513.875,,SHORT
2020-09-08,NQU0,1,11516.625,11511.75,,SHORT
2020-09-08,NQU0,1,11523.375,11517.0,,SHORT
2020-09-08,NQU0,1,11517.75,11521.0,,SHORT
2020-09-08,NQU0,1,11521.0,11519.0,,SHORT
2020-09-08,NQU0,1,11492.875,11497.375,,SHORT
2020-09-08,NQU0,1,11421.375,11414.875,,SHORT
2020-09-08,NQU0,1,11385.25,11392.5,,SHORT
2020-09-08,NQU0,1,11403.875,11391.75,,SHORT
2020-09-08,NQU0,1,1140
Query:
-- 9. Retrieve distinct "CFICode" values to identify instrument types
SELECT DISTINCT "CFICode"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
LIMIT 1000
Answer:
CFICode
MMMXXX
Query:
SELECT
  AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'LUCKY%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'MOMO%'
           THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
      END) AS "Avg_Momentum",
  (AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
        END) -
   AVG(CASE WHEN f2.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
        END)) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") f2
WHERE f.value:"Side"::STRING = 'LONG'
  AND t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND (f2.value:"PartyID"::STRING LIKE 'LUCKY%' OR f2.value:"PartyID"::STRING LIKE 'MOMO%')
LIMIT 1000;
Answer:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
Query:
-- 11. Get counts of trades per side (long/short)
SELECT f.value:"Side"::STRING AS "Side",
       COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f
GROUP BY f.value:"Side"::STRING
LIMIT 1000
Answer:
Side,TradeCount
SHORT,443312
LONG,779250
Query:
SELECT
  f.value:"Side"::STRING AS "Side",
  f2.value:"PartyID"::STRING AS "PartyID",
  COUNT(*) AS "TradeCount"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(input => t."Sides") f,
     LATERAL FLATTEN(input => f.value:"PartyIDs") f2
WHERE f2.value:"PartyID"::STRING LIKE 'LUCKY%'
   OR f2.value:"PartyID"::STRING LIKE 'MOMO%'
GROUP BY f.value:"Side"::STRING, f2.value:"PartyID"::STRING
LIMIT 1000;
Answer:
Side,PartyID,TradeCount
LONG,MOMOES,72274
LONG,MOMONQ,66229
LONG,LUCKYES,69558
SHORT,LUCKYNQ,96036
SHORT,MOMOBTC,26485
LONG,LUCKYBTC,65825
SHORT,LUCKYES,69238
SHORT,LUCKYBTC,65331
LONG,LUCKYNQ,95495
LONG,MOMOBTC,28325
Query:
-- 13. Retrieve trades with non-null "StrikePrice" and "LastPx" for calculations
SELECT *
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT"
WHERE "StrikePrice" IS NOT NULL AND "LastPx" IS NOT NULL
LIMIT 1000
Answer:
Too long, hard cut:
SendingTime,TargetCompID,SenderCompID,Symbol,Quantity,OrderID,TransactTime,StrikePrice,LastPx,MaturityDate,TradeReportID,TradeDate,CFICode,Sides
1589822606000000,MOMOES-COMPID,MDOC,ESM0,1,d8eefa63-6f10-4566-8f15-81460448f2ac,1589822606393000,2953.125,2953.125,1589822666393000,d8eefa63-6f10-4566-8f15-81460448f2ac-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""d8eefa63-6f10-4566-8f15-81460448f2ac"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589822759000000,MOMOES-COMPID,MDOC,ESM0,1,7fa78bef-912c-41cb-b381-4c03b5a7c508,1589822759485000,2952.375,2952.375,1589822819485000,7fa78bef-912c-41cb-b381-4c03b5a7c508-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""7fa78bef-912c-41cb-b381-4c03b5a7c508"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823190000000,MOMOES-COMPID,MDOC,ESM0,1,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520,1589823190485000,2952.625,2953.375,1589823250485000,5a4c4d8b-b9b8-4307-a0c3-8c753ed93520-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""5a4c4d8b-b9b8-4307-a0c3-8c753ed93520"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589823579000000,MOMOES-COMPID,MDOC,ESM0,1,a204ef77-1071-48ee-a5f5-21579311cd91,1589823580341000,2953.125,2952.625,1589823640341000,a204ef77-1071-48ee-a5f5-21579311cd91-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""a204ef77-1071-48ee-a5f5-21579311cd91"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824125000000,MOMOES-COMPID,MDOC,ESM0,1,b7a40778-7293-407b-8636-91a7ffe9817a,1589824125471000,2952.375,2953.625,1589824185471000,b7a40778-7293-407b-8636-91a7ffe9817a-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""b7a40778-7293-407b-8636-91a7ffe9817a"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589824697000000,MOMOES-COMPID,MDOC,ESM0,1,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b,1589824697706000,2952.375,2953.125,1589824757706000,c67a3f6a-7253-4ec8-91be-a4a3f07aa27b-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""c67a3f6a-7253-4ec8-91be-a4a3f07aa27b"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825153000000,MOMOES-COMPID,MDOC,ESM0,1,83e09901-1182-4ad0-b423-0f92bf78a7a2,1589825153655000,2953.875,2955.375,1589825213655000,83e09901-1182-4ad0-b423-0f92bf78a7a2-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""83e09901-1182-4ad0-b423-0f92bf78a7a2"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825732000000,MOMOES-COMPID,MDOC,ESM0,1,8161e8ff-9aa3-4e27-9322-363a4a063a27,1589825732562000,2953.625,2953.875,1589825792562000,8161e8ff-9aa3-4e27-9322-363a4a063a27-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8161e8ff-9aa3-4e27-9322-363a4a063a27"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825809000000,MOMOES-COMPID,MDOC,ESM0,1,2e2c0922-e696-44f6-899e-9112f6129088,1589825809693000,2953.125,2953.625,1589825869693000,2e2c0922-e696-44f6-899e-9112f6129088-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""2e2c0922-e696-44f6-899e-9112f6129088"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589825916000000,MOMOES-COMPID,MDOC,ESM0,1,8afcaa49-daca-470f-9479-6bfd2c648ccf,1589825917197000,2952.125,2952.625,1589825977197000,8afcaa49-daca-470f-9479-6bfd2c648ccf-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""8afcaa49-daca-470f-9479-6bfd2c648ccf"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRole"": ""INITIATING TRADER""
      }
    ],
    ""Side"": ""LONG""
  }
]"
1589826251000000,MOMOES-COMPID,MDOC,ESM0,1,4e25aae7-5b30-408a-a23e-ea3afb86c445,1589826252341000,2951.125,2952.625,1589826312341000,4e25aae7-5b30-408a-a23e-ea3afb86c445-0,2020-05-18,MMMXXX,"[
  {
    ""OrderID"": ""4e25aae7-5b30-408a-a23e-ea3afb86c445"",
    ""PartyIDs"": [
      {
        ""PartyID"": ""MOMOES"",
        ""PartyIDSource"": ""PROP CODE"",
        ""PartyRo
Query:
SELECT
  AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_Momentum",
  (
    AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
    -
    AVG(CASE WHEN f.value:"Side"::STRING = 'LONG' AND f.value:"PartyIDs"[0]:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
  ) AS "difference"
FROM
  "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
  LATERAL FLATTEN(INPUT => t."Sides") f
WHERE
  t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
LIMIT 1000;
Answer:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
Query:
SELECT
  AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_FeelingLucky",
  AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END) AS "Avg_Momentum",
  (
    AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'LUCKY%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
    -
    AVG(CASE WHEN s.value:"Side"::STRING = 'LONG' AND p.value:"PartyID"::STRING LIKE 'MOMO%' THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
  ) AS "difference"
FROM
  "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
  LATERAL FLATTEN(INPUT => t."Sides") s,
  LATERAL FLATTEN(INPUT => s.value:"PartyIDs") p
WHERE
  t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL;
Answer:
Avg_FeelingLucky,Avg_Momentum,difference
1.012261345819004,1.2886708466204715,-0.27640950080146753
End Exploring Related Columns
Task: How much higher the average intrinsic value is for trades using the feeling-lucky strategy compared to those using the momentum strategy under long-side trades?

Please answer only one complete SQL in snowflake dialect in ```sql``` format.
Usage example: SELECT S."Column_Name" FROM {Database Name}.{Schema Name}.{Table_name} (ensure all column names are enclosed in double quotations)
Follow the answer format like: ```csv
difference
value:float > 0
```

The value above represents the positive difference in the average intrinsic value for trades using the **feeling-lucky** strategy compared to those using the **momentum** strategy under **long-side trades**. Since we don't have the actual data, the exact numerical value is depicted as a positive floating-point number (`value:float > 0`)..
Here are some useful tips for answering:
When calculating distances between two geometries, use `ST_MakePoint(x, y)` to make a point and `ST_Distance(geometry1 GEOMETRY, geometry2 GEOMETRY)` to compute. No need to convert from meters to miles unless requested. Don't use Haversine like 2 * 6371000 * ASIN(...), use ST_DISTANCE for more precise results.
Please refrain from adding any conditions that are not explicitly specified in the task.
When performing a UNION operation on many tables, ensure that all table names are explicitly listed. Union first and then add condition and selection. e.g. SELECT "col1", "col2" FROM (TABLE1 UNION ALL TABLE2) WHERE ...; Don't write sqls as (SELECT col1, col2 FROM TABLE1 WHERE ...) UNION ALL (SELECT col1, col2 FROM TABLE2 WHERE ...); Don't use ['-- Include all', '-- Omit', '-- Continue', '-- Union all', '-- ...', '-- List all', '-- Replace this', '-- Each table', '-- Add other'] to omit any table. Table names here: ({database name: {schema name: {table name}}}): 
{'CYMBAL_INVESTMENTS': {'CYMBAL_INVESTMENTS': ['TRADE_CAPTURE_REPORT']}}

For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book" SQL: WHERE "title" LIKE '%book%'
However, if the string is not decided, you may use ILIKE and %. e.g. Get articles that mention "education": SQL: "body" ILIKE '%education%' OR "title" ILIKE '%education%'
Be careful one country may have different names in different columns in a database.
When handling TO_TIMESTAMP_NTZ conversions, use query like: SELECT CASE WHEN "date" >= 1e15 THEN TO_TIMESTAMP_NTZ("date" / 1000000) WHEN "date" >= 1e12 THEN TO_TIMESTAMP_NTZ("date" / 1000) ELSE TO_TIMESTAMP_NTZ("date") END AS parsed_timestamp FROM my_table;
Be careful of information in nested JSON columns. e.g.1. When it comes to active users, it refers to has engagement_time_msec parameter rather than directly counting users. So the right query is: SELECT DISTINCT USER_PSEUDO_ID FROM all_user_activity, LATERAL FLATTEN(input => event_params) AS flattened_params WHERE flattened_params.value:key = 'engagement_time_msec'
e.g. When it comes to top-selling product, you should pay attention to hits2.value:"eCommerceAction":"action_type"::INTEGER = 6 where 6 means sold product.
When using ORDER BY xxx DESC, add NULLS LAST to exclude null records: ORDER BY xxx DESC NULLS LAST.
When counting for rows of a column, ensure they are distinct: SELECT COUNT(DISTINCT col_name) FROM table;
Keep all decimals to four decimal places.
You need to follow the format's positive and negative signs.

2025-01-16 07:41:55 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:41:55 - root - INFO - ```sql
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") s,
     LATERAL FLATTEN(INPUT => s.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND s.value:"Side"::STRING = 'LONG'
  AND (p.value:"PartyID"::STRING LIKE 'LUCKY%' OR p.value:"PartyID"::STRING LIKE 'MOMO%');
```
2025-01-16 07:41:55 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:41:55 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:41:55 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:41:57 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:41:57 - snowflake.connector.connection - INFO - closed
2025-01-16 07:41:57 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:41:57 - root - INFO - itercount: 1
2025-01-16 07:41:57 - root - INFO - 0
2025-01-16 07:41:57 - root - INFO - results: 
difference
-0.27640950080146753


2025-01-16 07:41:57 - root - INFO - Please check the answer again by reviewing How much higher the average intrinsic value is for trades using the feeling-lucky strategy compared to those using the momentum strategy under long-side trades?, reviewing Relevant Tables and Columns and Possible Conditions and then give the final SQL query. Don't output other queries. If you think the answer is right, just output the current SQL.
Keep all decimals to four decimal places.
The answer format should be like: ```csv
difference
value:float > 0
```

The value above represents the positive difference in the average intrinsic value for trades using the **feeling-lucky** strategy compared to those using the **momentum** strategy under **long-side trades**. Since we don't have the actual data, the exact numerical value is depicted as a positive floating-point number (`value:float > 0`). The answer should match the number of rows, the column name of the format and the filled values in the format (e.g. filled year or month). Don't output extra rows or nested rows!
Current snswer: 
difference
-0.27640950080146753
Current sql:
SELECT
  (AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'LUCKY%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
   -
   AVG(CASE WHEN p.value:"PartyID"::STRING LIKE 'MOMO%'
            THEN GREATEST(t."LastPx" - t."StrikePrice", 0)
       END)
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") s,
     LATERAL FLATTEN(INPUT => s.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND s.value:"Side"::STRING = 'LONG'
  AND (p.value:"PartyID"::STRING LIKE 'LUCKY%' OR p.value:"PartyID"::STRING LIKE 'MOMO%');For string-matching scenarios, if the string is decided, don't use fuzzy query, and avoid using REGEXP. e.g. Get the object's title contains the word "book" SQL: WHERE "title" LIKE '%book%'
However, if the string is not decided, you may use ILIKE and %. e.g. Get articles that mention "education": SQL: "body" ILIKE '%education%' OR "title" ILIKE '%education%'

2025-01-16 07:43:13 - httpx - INFO - HTTP Request: POST https://sfc-ml-sweden.openai.azure.com/openai/deployments/o1-preview/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
2025-01-16 07:43:13 - root - INFO - ```sql
SELECT
  ROUND(
    AVG(CASE WHEN p.value:"PartyID"::STRING IN ('LUCKYBTC', 'LUCKYES', 'LUCKYNQ')
             THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END)
    -
    AVG(CASE WHEN p.value:"PartyID"::STRING IN ('MOMOES', 'MOMONQ', 'MOMOBTC')
             THEN GREATEST(t."LastPx" - t."StrikePrice", 0) END),
    4
  ) AS "difference"
FROM "CYMBAL_INVESTMENTS"."CYMBAL_INVESTMENTS"."TRADE_CAPTURE_REPORT" t,
     LATERAL FLATTEN(INPUT => t."Sides") s,
     LATERAL FLATTEN(INPUT => s.value:"PartyIDs") p
WHERE t."StrikePrice" IS NOT NULL
  AND t."LastPx" IS NOT NULL
  AND s.value:"Side"::STRING = 'LONG'
  AND p.value:"PartyID"::STRING IN ('LUCKYBTC', 'LUCKYES', 'LUCKYNQ', 'MOMOES', 'MOMONQ', 'MOMOBTC');
```
2025-01-16 07:43:13 - snowflake.connector.connection - INFO - Snowflake Connector for Python Version: 3.12.4, Python Version: 3.11.11, Platform: Linux-6.1.38-x86_64-with-glibc2.31
2025-01-16 07:43:13 - snowflake.connector.connection - INFO - Connecting to GLOBAL Snowflake domain
2025-01-16 07:43:13 - snowflake.connector.connection - INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
2025-01-16 07:43:14 - snowflake.connector.cursor - INFO - Number of results in first chunk: 1
2025-01-16 07:43:14 - snowflake.connector.connection - INFO - closed
2025-01-16 07:43:15 - snowflake.connector.connection - INFO - No async queries seem to be running, deleting session
2025-01-16 07:43:15 - root - INFO - itercount: 2
2025-01-16 07:43:15 - root - INFO - 0
2025-01-16 07:43:15 - root - INFO - Total iteration counts: 2
